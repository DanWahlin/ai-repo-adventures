<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Datastream Alignment Core - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Horizons: Charting the Code Galaxy</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Datastream Alignment Core</h1>
<hr>
<p>The starship <em>Horizons</em> approached the luminous vortex of the Repomix Nebula, its hazy clouds swirling like a galactic kaleidoscope. Beneath the radiant nebula’s chaos lay a task vital to the crew’s journey—the mysterious Datastream Alignment Core, a beacon said to synchronize fragmented datasets across galaxies. Commander Rhea prepped the team for an intricate challenge: they would decipher, align, and repurpose alien data through their navigation systems, bridging fractured networks and unlocking treasures hidden within the code woven into the stars. Adventure pulsed through every console as the quest began.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration system for guided adventures</h3>
<p>This file functions as the trusty map guiding the <em>Horizons</em> crew through the maze of interconnected missions and datasets. It handles critical operations like loading, parsing, and extracting data from the <code class="inline-code">adventure.config.json</code> file—a blueprint for the synchronized alignment of the Datastream. At its heart, <code class="inline-code">loadAdventureConfig()</code> retrieves raw data from this configuration file, ensuring it is available for parsing. This task is passed to <code class="inline-code">parseAdventureConfig()</code>, which translates the raw JSON into actionable objects. Additionally, <code class="inline-code">extractUniqueFilePaths()</code> dives deep into the structure of the config, intelligently identifying all essential file paths required for analysis. Finally, <code class="inline-code">formatAdventureConfigForPrompt()</code> acts as the narrator, transforming extracted information into clear, structured prompts for their LLM systems. With this configuration, adventures and their associated quests are seamlessly orchestrated, uniting technical precision and exploratory spirit. Efficient, structured, and secure, this file exemplifies foundational code needed to make sense of the Repomix nebula.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig()</code> enables seamless loading of the configuration file, acting as an entry gate for adventures.</li>
<li><code class="inline-code">extractUniqueFilePaths()</code> traverses the configurations to uncover all relevant file paths for alignment.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code> converts parsed data into structured text for LLM integration.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    // Missing or unreadable file is non-fatal
    return null;
  }
}

/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<p>This code acts like the ship’s proximity scanner, cautiously retrieving nearby data—if it exists—without disrupting operations.</p>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Just as a translator deciphers alien languages into understandable meaning, this function turns raw JSON data into actionable objects or flags issues.</p>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>Like mapping uncharted galaxies, this function meticulously sifts through configurations to identify and catalog only valid, unique paths.</p>
<pre><code class="language-typescript">/**
 * Formats adventure config into a readable format for LLM prompts
 * This ensures structured sections always appear in quest content
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure Guidelines\n\n`;
  formatted += `**CRITICAL: Each quest MUST include dedicated file analysis sections**\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    formatted += `${quest.description}\n\n`;
    formatted += `**Required File Analysis Sections:**\n`;

    for (const file of quest.files) {
      if (!file.path || !file.description) continue;

      formatted += `\n**File: \`${file.path}\`**\n`;
      formatted += `- Description: ${file.description}\n`;
      
      if (Array.isArray(file.highlights)) {
        formatted += `- Key Functions/Areas to Highlight:\n`;
        for (const highlight of file.highlights) {
          if (highlight.name &amp;&amp; highlight.description) {
            formatted += `  • **${highlight.name}**: ${highlight.description}\n`;
          }
        }
      }
    }
    formatted += `\n`;
  }

  formatted += `\n**FORMATTING INSTRUCTIONS:**\n`;
  formatted += `- Each file mentioned in the quest structure above MUST have its own dedicated analysis section\n`;
  formatted += `- **MANDATORY**: Include at least 2-3 separate code snippet sections (## filename) with real code blocks\n`;
  formatted += `- Show actual function signatures, imports, class definitions, or key methods from the files\n`;
  formatted += `- Include real code snippets from the actual files (never invent code)\n`;
  formatted += `- Provide practical explanations using real-world analogies\n`;
  formatted += `- End with helpful hints and next steps\n`;

  return formatted;
}
</code></pre>
<p>This function transforms raw data into a narrative, much like a star chart conveys complex spatial relationships through clear visuals.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Run <code class="inline-code">parseAdventureConfig()</code> after updating any <code class="inline-code">adventure.config.json</code> file to verify it’s error-free.</li>
<li>Consider expanding <code class="inline-code">extractUniqueFilePaths()</code> to flag paths that might cause runtime issues under specific environments.</li>
<li>Experiment with modifying <code class="inline-code">formatAdventureConfigForPrompt()</code> to incorporate alternative storytelling frameworks for quests.</li>
</ul>
<hr>
<p>Mission Control confirms a flawless synchronization of the Datastream Alignment Core—your starship is 80% through the cosmic journey, blazing toward the ultimate frontier with precision and brilliance! 🚀⭐📡</p>

</div>


    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>