<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundations of the Repository - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Code Chronicles: The Quest for Stellar Harmony</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundations of the Repository</h1>
<hr>
<p>Your starship, the <em>SS Code Explorer</em>, approaches a swirling stellar anomaly within the Repository Galaxy ‚Äì the Foundation Nebula. Here, the systems that govern the galaxy&#39;s core configuration files falter, sending ripples of chaos through interstellar networks. As the captain, you must navigate your crew to a critical waypoint: the <em>adventure-config node</em>. This node houses the galaxy‚Äôs blueprint, including its quests, themes, and critical guidelines. Decoding and stabilizing it will restore the Repository Galaxy‚Äôs structural integrity and prepare it for the void beyond. Brace yourself ‚Äì the final challenge lies ahead.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Nebula Navigation</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function ensure safe handling of improperly formatted or missing configuration files?</li>
<li>‚ö° <strong>Stellar Extraction</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> traverse the adventure configuration to identify significant paths, and what safeguards are implemented?</li>
<li>üõ°Ô∏è <strong>Prompt Stabilization</strong>: What is the role of <code class="inline-code">formatAdventureConfigForPrompt</code> in simplifying adventure data, and how does it ensure the system remains within performance constraints?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Adventure node configuration</h3>
<p>This file contains essential utilities for managing the adventure configuration file (<code class="inline-code">adventure.config.json</code>). It provides functionality to load, parse, and format the configuration for purposes such as validation, file path extraction, and natural language processing. By centralizing these operations, the file ensures that the configuration data is handled consistently and securely across the system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Reads and parses the <code class="inline-code">adventure.config.json</code> file, carefully handling errors and invalid data. This is critical for maintaining the system‚Äôs robustness under uncertain conditions.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Recursively examines the parsed configuration for ‚Äúpath‚Äù fields, validates their existence, and ensures uniqueness. This function plays a key role in identifying essential files for the repository‚Äôs operation.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Compresses the adventure configuration into a concise format optimized for LLM inputs. This optimization reduces processing overhead while preserving necessary details.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function fetches the raw JSON content using <code class="inline-code">loadAdventureConfig</code> and attempts to parse it.</li>
<li>Errors during parsing are caught and returned as <code class="inline-code">null</code>, preventing system crashes due to invalid configurations.</li>
<li>This minimal failure approach is critical in ensuring the system remains operational even when specific configuration issues arise.</li>
<li>Centralizing the parse logic ensures reusable validation across multiple modules.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function inspects the configuration object to find unique file paths referenced in its &quot;path&quot; fields.</li>
<li>Uses a <code class="inline-code">Set</code> to maintain uniqueness and verify paths&#39; existence on disk with <code class="inline-code">fs.existsSync</code>.</li>
<li>A depth-first traversal ensures that nested structures are fully explored.</li>
<li>Prioritizing validation prevents attempts to use invalid or non-existent file paths, ensuring reliability.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function processes the adventure configuration, reducing its size and complexity for efficient input into an LLM.</li>
<li>By stripping redundant data, it minimizes token usage, making it optimal for resource-constrained environments.</li>
<li>The output focuses on core structural elements like file paths and function names, which align with LLM processing needs.</li>
<li>This contributes to a seamless integration between large-scale configuration data and AI systems.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>For recursive functions like <code class="inline-code">extractUniqueFilePaths</code>, diagramming the stack and iteration process can clarify traversal logic.</li>
<li>Experiment with test cases for malformed configurations when reviewing <code class="inline-code">parseAdventureConfig</code> to see its defensive mechanisms in action.</li>
<li>To explore the design choices in <code class="inline-code">formatAdventureConfigForPrompt</code>, compare its output with the original format to understand the reduction strategy.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Repository Galaxy! With the adventure-config node stabilized, the interstellar network hums back to life, binding the galaxy together in unity. Your adventure is complete.</p>
<p>Mission accomplished, Stargazer! Quest 5: Foundations of the Repository is complete‚Äîyour knowledge base is now orbiting at cosmic heights, hurtling boldly at 80% completion‚Äîkeep fueling that rocket to reach the final frontier! ‚≠êüöÄüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>