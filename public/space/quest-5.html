<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Refine the Codex Core - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Odyssey: The Codex of Knowledge</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Refine the Codex Core</h1>
<hr>
<p>The galaxy turns its gaze to you, star voyager, for the Codex‚Äôs final mission demands unparalleled precision. The ship&#39;s core‚Äîthe lifeblood of its narrative-generating capabilities‚Äîmust be honed further to ensure sustainable interstellar adventures. Your task lies within the Codex Core: extracting pathways, refining adventure parsing heuristics, and ensuring a harmonious flow of galactic discovery. Engage with the ship&#39;s shared systems to inspect its adventure configuration handling and solidify its foundation for endless stellar journeys. This is your final trial‚Äîrefine the core and secure the Codex‚Äôs legacy.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pathway Scanner</strong>: How does the <code class="inline-code">extractUniqueFilePaths</code> function ensure all referenced file paths are unique, valid, and relevant to the Codex‚Äôs mission?</li>
<li>‚ö° <strong>Signal Interpreter</strong>: How does <code class="inline-code">parseAdventureConfig</code> orchestrate the transformation of raw configuration data into usable structures for the Codex?</li>
<li>üõ°Ô∏è <strong>Core Calibration</strong>: What measures does <code class="inline-code">formatAdventureConfigForPrompt</code> implement to optimize adventure configuration for compact and efficient use in prompts?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core Configuration Management</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file serves as the structural frame for managing the Codex&#39;s adventure configurations. It delivers vital utilities for loading, parsing, and optimizing configuration data. These functions facilitate interaction with JSON-based configuration files, providing mechanisms for validation, file extraction, and format transformation. The functions are crafted to interact seamlessly with other components, ensuring the smooth flow of narrative creation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Retrieves adventure configuration data as raw text from the filesystem. It encapsulates file-reading logic and supplies the base resource for further processing.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Validates and parses JSON content from the loaded configuration, returning structured data or guarding against invalid configurations.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses a parsed configuration to identify all unique and existing file paths. It employs validation mechanisms to ensure operational integrity.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses the configuration into a minimalistic format, prioritizing brevity while retaining essential details for machine-readability.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Facilitates raw data retrieval from an external JSON configuration file.</li>
<li>Combines <code class="inline-code">projectPath</code> with the predefined <code class="inline-code">ADVENTURE_CONFIG_FILE</code> to locate the target file.</li>
<li>Uses <code class="inline-code">readFileIfExists</code> to ensure that missing files or access failures do not disrupt the program flow.</li>
<li>Provides the foundation for higher-level parsing and validation operations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Calls <code class="inline-code">loadAdventureConfig</code> to acquire the raw JSON text from the specified project path.</li>
<li>Attempts parsing of the retrieved content into a JavaScript object using <code class="inline-code">JSON.parse</code>.</li>
<li>Implements error handling: returns <code class="inline-code">null</code> if the file is missing, unreadable, or contains invalid JSON.</li>
<li>Centralized JSON parsing ensures that all downstream operations receive consistent and validated data.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Processes the validated configuration from <code class="inline-code">parseAdventureConfig</code> to extract file path references.</li>
<li>Uses a depth-first traversal of the configuration structure, pushing all objects and arrays onto a <code class="inline-code">stack</code> for exploration.</li>
<li>Validates file paths via <code class="inline-code">fs.existsSync</code> prior to inclusion in the <code class="inline-code">unique</code> set, ensuring only existing and accessible paths are returned.</li>
<li>Supports nested structures through recursive extraction, improving adaptability to complex configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;

    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Produces a compact and structured summary of the adventure configuration suitable for LLM prompts.</li>
<li>Iterates through the parsed configuration‚Äôs <code class="inline-code">adventure</code> object to extract quest titles, file lists, and function highlights.</li>
<li>Optimizes output size by eliminating redundant descriptions and focusing only on key identifiers.</li>
<li>Ensures adaptability by supporting a wide range of quest structures and nested configurations.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Carefully trace the flow of data from one function to the next‚Äîloading, parsing, and processing all interact interdependently.</li>
<li>Look for opportunities to explore advanced validation methods in future iterations to fortify the Codex against corrupted configurations.</li>
<li>Consider how optimizations in <code class="inline-code">formatAdventureConfigForPrompt</code> streamline workflows and improve prompt performance.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Codex Core! Your adventure is complete.</p>
<p>Mission accomplished, Star Voyager! Quest 5: Refine the Codex Core has fueled your cosmic engines with brilliance‚Äîyou&#39;re now orbiting success at 80%, closing in on the final frontier! üöÄüíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>