<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Utilities of the Cosmos - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Codex: The Tales of the Starship Codexia</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Utilities of the Cosmos</h1>
<hr>
<p>The voyage of the Starship Codexia has reached its climactic phase. Orbiting the luminescent heart of the Repository Nebula, the crew stands before an intricate matrix of celestial utilities ‚Äì a labyrinth of algorithms, paths, and intersecting patterns pulsating with the essence of intergalactic configuration. To unlock the final cipher hidden within the Nebula, you must delve into the structural foundation of the Repository&#39;s core utilities. Your mission is to analyze the configuration systems and data extraction pipelines to ensure seamless operation under the extremes of the cosmic environment. Assemble your tools, calibrate your systems, and brace for the stellar challenge ahead!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configuration Orbit</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function ensure consistent reading and validation of the adventure configuration within the ecosystem?</li>
<li>‚ö° <strong>Path Navigation</strong>: What methods does <code class="inline-code">extractUniqueFilePaths</code> use to traverse and validate data paths from nested config structures in an efficient manner?</li>
<li>üõ°Ô∏è <strong>Optimization Shield</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> reduce redundant data to optimize readability and utility for its intended consumers?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Repository Configuration Utilities</h3>
<p>This file defines the backbone of the Repository&#39;s configuration utilities, containing methods to load, parse, and optimize data structures related to the adventure system. It is essential for managing the complex interplay between file paths, JSON parsing, and maintaining robustness in error handling. The design of these functions balances efficiency with resilience, ensuring critical components of the system operate smoothly within varied galactic conditions.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Validates the adventure configuration file by parsing JSON data and handling errors gracefully. This ensures corrupted or missing files do not break the system.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts and verifies unique file paths from the configuration, enabling streamlined navigation through nested structures.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the configuration data into a compact format for efficient consumption by language processing systems or other clients.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function ensures that the raw configuration file is safely parsed into an object, returning <code class="inline-code">null</code> for any errors.</li>
<li>Implements robust error handling, ensuring corrupted or missing files do not disrupt the broader system.</li>
<li>Acts as the central point for configuration validation, emphasizing reliability for downstream processes.</li>
<li>Demonstrates single responsibility by only handling JSON-specific parsing and using helper functions for file operations.</li>
<li>Integrates seamlessly with higher-level functions that rely on structured configuration data.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses a nested object structure to locate all valid file paths referenced in the configuration.</li>
<li>Combines the flexibility of recursive traversal with the robustness of <code class="inline-code">Set</code> to maintain uniqueness.</li>
<li>Utilizes <code class="inline-code">fs.existsSync</code> to ensure that only existing files are included, avoiding potential errors from stale or invalid paths.</li>
<li>Demonstrates patterns of iterative depth-first search for complex data structures.</li>
<li>Strengthens the adventure system&#39;s adaptability, allowing it to dynamically evolve with changes in file references.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Reduces configuration data to its essence, organizing it for optimal processing by downstream systems.</li>
<li>Discards redundant information, focusing solely on quest titles, file paths, and highlighted functions.</li>
<li>Provides a structured output with intuitive headers for improved readability and faster parsing.</li>
<li>Leverages concise JavaScript methods like <code class="inline-code">map</code> and <code class="inline-code">filter</code> for streamlined data extraction.</li>
<li>Supports mission-critical optimization by ensuring external systems receive concise, context-sensitive information.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Build on the foundational patterns shown here to create resilient file-handling features in other systems.</li>
<li>Explore recursion versus iteration in scenarios involving deeply nested structures.</li>
<li>Test these functions across a variety of edge cases, including empty, corrupted, or partially complete configurations.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Repository Nebula! Your adventure is complete. The Codexia crew salutes you for unlocking the cosmic utilities and securing their place in the galaxy&#39;s history.</p>
<p>Stellar navigator, you‚Äôve harnessed the cosmic energies of &#39;Utilities of the Cosmos,&#39; rocketing 80% closer to your galaxy of mastery‚Äîkeep shining like the brilliant star you are! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>