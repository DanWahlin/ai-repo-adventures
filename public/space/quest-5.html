<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Mapping Andromeda - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Journey to the Andromeda Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Mapping Andromeda</h1>
<hr>
<p>The starship <em>AIA Explorer</em> is nearing the final frontier: the uncharted heart of the Andromeda Codebase. This mission, known as &quot;Mapping Andromeda,&quot; will be your most complex yet. As the engineer tasked with untangling vast cosmic networks of project configurations, you&#39;ll chart unknown territories and optimize systems for intergalactic developers. With spacefaring technologies such as <code class="inline-code">extractUniqueFilePaths</code> and <code class="inline-code">formatAdventureConfigForPrompt</code> at your disposal, you must uncover the inner workings of the configuration code that powers the galaxy-spanning RepoAdventureServer. Illuminate the nebula of Andromeda as a beacon to future adventurers.  </p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Config Nebula Plotting</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> traverse and validate file references within the adventure configuration?  </li>
<li>‚ö° <strong>Prompt Formatting Dynamics</strong>: What optimizations are performed by <code class="inline-code">formatAdventureConfigForPrompt</code> to streamline the configuration for machine consumption?  </li>
<li>üõ°Ô∏è <strong>Parsing Safety Protocols</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure robust error handling when loading and validating configuration data?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core configuration processor</h3>
<p>This file is the backbone of the adventure generator, responsible for reading, validating, and interpreting project configurations. Functions such as <code class="inline-code">parseAdventureConfig</code> and <code class="inline-code">extractUniqueFilePaths</code> process <code class="inline-code">adventure.config.json</code> files, ensuring references to quests, files, and operational logic are accurate. Additionally, <code class="inline-code">formatAdventureConfigForPrompt</code> transforms these configurations into simplified formats optimized for LLM consumption, reducing redundancy while preserving critical information. These functions provide the navigational systems necessary to chart the Andromeda Codebase and prepare developers for their complex quests.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses the raw configuration JSON, returning a usable object while handling errors gracefully. This function ensures that configurations are both accurate and safe for further processing.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Iterates through the configuration to extract all valid and unique file paths, ensuring only existing paths are included. It validates files dynamically and uses a depth-first traversal method.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Reassembles configuration data into a concise format for LLM consumption. It reduces overhead by stripping redundant data, making the output lightweight yet functional.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function reads raw JSON configuration data from the project directory and attempts to parse it.  </li>
<li>If the loaded data is invalid or absent, the function gracefully returns <code class="inline-code">null</code>, preventing crashes.  </li>
<li>Error handling is designed for resilience, ensuring unstructured data does not derail the processing pipeline.  </li>
<li>Establishes a single entry point for JSON parsing, reinforcing modular and secure design principles.  </li>
<li>Integrates seamlessly with downstream functions, such as <code class="inline-code">extractUniqueFilePaths</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function locates and collects all <code class="inline-code">path</code> fields in the quest configuration into a unique array.  </li>
<li>Paths are validated using <code class="inline-code">fs.existsSync</code>, ensuring that only existing files are referenced.  </li>
<li>Implements a depth-first search through configuration objects, robustly handling nested structures.  </li>
<li>Avoids duplication by leveraging a <code class="inline-code">Set</code> to track unique file paths.  </li>
<li>Ensures that downstream operations work only with valid paths, reducing errors during processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts project configuration details into a structured format suitable for LLM consumption.  </li>
<li>Trims unnecessary details, focusing on <code class="inline-code">quests</code>, <code class="inline-code">files</code>, and <code class="inline-code">functions</code> for lean output.  </li>
<li>Enhances efficiency by skipping verbose descriptions, directly mapping titles, paths, and highlights.  </li>
<li>Simplifies the representation of configuration data, reducing cognitive load during processing.  </li>
<li>Delivers important context for machine and developer workflows alike, aligning technical goals with mission objectives.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Config File Verification</strong>: Ensure the <code class="inline-code">adventure.config.json</code> file is correctly formatted before running operations. Syntax errors can cause misinterpretations.  </li>
<li><strong>Depth-First Debugging</strong>: If <code class="inline-code">extractUniqueFilePaths</code> fails to return valid paths, inspect nested objects for invalid or missing <code class="inline-code">path</code> fields.  </li>
<li><strong>Prompt Optimization</strong>: For efficient LLM responses, focus on simplifying configuration data, as demonstrated in <code class="inline-code">formatAdventureConfigForPrompt</code>.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Andromeda&#39;s code structure! Your adventure is complete.</p>
<p>Stellar navigator, you&#39;ve rocketed through Quest 5: Mapping Andromeda with cosmic precision‚Äîcharting 80% of your galactic journey; the final frontier awaits! ‚≠êüöÄüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>