<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Star Map Synthesis Protocol - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Starship Repo Odyssey</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Star Map Synthesis Protocol</h1>
<hr>
<p>The Repo Odyssey drops from warp at the Code Constellation‚Äôs midpoint, where charts must be fused into a single stellar map for future crews. The AdventureManager and StoryGenerator align trajectories while the RepoAnalyzer decodes nebula static into navigable signals. Your LLMClient interprets distant pulses. Validators and themes tune instruments, and MCP relays sync ground-to-ship telemetry. This chapter‚Äôs mission: harmonize the Star Map Synthesis by understanding how configuration is read, validated, and distilled into compact prompts for the plotting computers. Plot carefully, Navigator‚Äîclarity now means safe voyages ahead.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Scanner Calibration: How does <code class="inline-code">parseAdventureConfig</code> centralize JSON parsing and gracefully return <code class="inline-code">null</code> across failure modes?</li>
<li>‚ö° Signal Compression: In <code class="inline-code">formatAdventureConfigForPrompt</code>, what filtering and reduction steps are used to minimize prompt size while preserving structure?</li>
<li>üõ°Ô∏è Hull Integrity Check: How does <code class="inline-code">extractUniqueFilePaths</code> traverse arbitrary config shapes and ensure only existing file paths are returned?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration intake, traversal, and prompt condensation for navigation plotting</h3>
<p>This module is the ship‚Äôs chart room: it loads raw config, parses it safely, extracts referenced paths that truly exist, and condenses quest metadata for LLM-friendly prompts. The <code class="inline-code">parseAdventureConfig</code> function is the designated parsing gate, delegating file IO to <code class="inline-code">loadAdventureConfig</code> and returning <code class="inline-code">null</code> on any malformed input‚Äîthis isolates risk so downstream callers can rely on predictable outputs. The <code class="inline-code">extractUniqueFilePaths</code> routine explores arbitrarily nested structures by pushing objects onto a <code class="inline-code">stack</code>, inspecting each <code class="inline-code">node</code> for a <code class="inline-code">path</code> string, validating with <code class="inline-code">fs.existsSync</code>, and accumulating into a <code class="inline-code">Set</code> for deduplication. This prevents phantom files from contaminating the navigational map. Finally, <code class="inline-code">formatAdventureConfigForPrompt</code> constructs a compact textual star map: it checks for the <code class="inline-code">adventure.quests</code> array, emits only <code class="inline-code">Files:</code> and <code class="inline-code">Functions:</code> lines, and trims descriptions that would bloat the payload. It iterates quests safely, skips incomplete entries, and uses <code class="inline-code">.flatMap</code> across each file‚Äôs <code class="inline-code">highlights</code> to gather function names. Collectively, these pieces form a resilient acquisition-compression pipeline: minimal assumptions, defensive returns, and tight formatting that readies the data for prompt-bound warp transmissions without overwhelming the LLM sensor arrays.</p>
<h4>Highlights</h4>
<ul>
<li>Centralized JSON parsing with failure-safe <code class="inline-code">null</code> returns in <code class="inline-code">parseAdventureConfig</code></li>
<li>Graph traversal and deduplicated path extraction in <code class="inline-code">extractUniqueFilePaths</code></li>
<li>Prompt-size optimization and safe iteration in <code class="inline-code">formatAdventureConfigForPrompt</code></li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Like reading a star chart through a visor: if the glass fogs or cracks, you step back and report ‚Äúno visibility‚Äù rather than guessing the route.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>Like scanning every cargo pod in the hold, tagging only those verified on the manifest and discarding phantom readings.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths - LLM can see descriptions in actual code
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
    
    // Just function names - LLM can understand purpose from implementation
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }
    
    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p>Like compressing a stellar cartography plate into a concise route brief: headings, sectors, and critical waypoints without the ornamental starfield.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Validate your <code class="inline-code">projectPath</code> before scanning; empty returns are a sign of safe failure rather than silent corruption.</li>
<li>Compare the set returned by <code class="inline-code">extractUniqueFilePaths</code> to your repo to ensure your quest‚Äôs files actually exist.</li>
<li>Pipe the output of <code class="inline-code">formatAdventureConfigForPrompt</code> into your LLM prompts to keep bandwidth efficient and focused.</li>
</ul>
<hr>
<p>Star charts synthesized, Navigator. Your MCP relay now carries a crisp route for the next crew. Plot the next jump when ready.</p>
<p>Mission accomplished, Star Voyager‚Äîby synthesizing the Star Map in Quest 5, you‚Äôve navigated a stellar waypoint in your cosmic curriculum, boosting your trajectory to 80% completion as your learning engines fire at full thrust toward the final objective‚Äîkeep those sensors sharp and prepare for a triumphant final burn! üöÄ‚≠êüì°üó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>