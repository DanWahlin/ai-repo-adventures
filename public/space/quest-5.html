<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Forging the Cosmic Configuration Grid - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Repository Missions: The Codebase Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Forging the Cosmic Configuration Grid</h1>
<hr>
<p>The <em>RepoStar Matrix</em>, poised at the threshold of intergalactic deployment, hums with potential as you embark on your final mission. With the support of the Stellar Code Alliance, you must refine its most critical systems‚Äîthe Configuration Grid. This grid, essential for adapting to uncharted codebases and galactic environments, demands precision. As data pulses like stardust, your task is to align every parameter and theme module, ensuring the ship‚Äôs systems operate harmoniously across unknown cosmic territories. Prepare to validate, extract, and enhance‚Äîdestiny awaits in the stars!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configuration Calibration</strong>: How does the system ensure the configuration file is read and parsed effectively, even in adverse conditions?</li>
<li>‚ö° <strong>Theme Navigation</strong>: How are adventure themes defined, validated, and applied across the system to maintain thematic consistency?</li>
<li>üõ°Ô∏è <strong>Command Integrity</strong>: What mechanisms sanitize and validate input data to ensure fault tolerance and security?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Management</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file serves as the nucleus of the configuration system, responsible for reading, validating, and formatting the adventure&#39;s parameters. It ensures that the configuration loads seamlessly from the file system, employs safe parsing, and facilitates data extraction for themes and quests. This module enables the <em>RepoStar Matrix</em> to adapt to varied missions by tailoring configuration inputs and outputs responsively.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code> reads the raw configuration file, ensuring the path is accounted for while handling missing files gracefully.</li>
<li><code class="inline-code">parseAdventureConfig</code> parses the configuration JSON, providing error-resistant handling for invalid or absent data, allowing seamless integration.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> extracts and validates file paths within the configuration, ensuring that every referenced path exists and is accessible.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    return null;
  }
}

/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Reads configuration files, enabling compatibility with dynamic project structures.</li>
<li>Uses try-catch to ensure that missing or unreadable files do not generate critical failures.</li>
<li>Ensures flexibility and reliability by returning <code class="inline-code">null</code> for non-existent files.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Converts raw configuration data into structured JSON for further processing.</li>
<li>Includes error handling for invalid or corrupt JSON, returning a safe fallback (<code class="inline-code">null</code>).</li>
<li>Demonstrates the importance of decoupling file reading and parsing for modular design.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Extracts file paths referenced in the configuration file, ensuring they exist.</li>
<li>Uses a stack-based traversal for flexibility in handling nested configurations.</li>
<li>Enhances reliability by verifying the validity and existence of paths.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Theme System</h3>
<p>The <code class="inline-code">theme.ts</code> module is the thematic compass of the adventure system. It provides a centralized architecture for defining, validating, and retrieving adventure themes. By integrating rich metadata, such as descriptions and emojis, this module ensures that each quest resonates with its designated theme. It empowers the <em>RepoStar Matrix</em> to align its missions with user-specified or system-directed cosmic motifs.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code> defines the catalog of available adventure themes, encapsulating their core properties.</li>
<li><code class="inline-code">getAllThemes</code> retrieves an array of all themes for dynamic exploration and presentation.</li>
<li><code class="inline-code">isValidTheme</code> validates user-submitted themes against the defined theme keys to ensure integrity.</li>
</ul>
<h3>Code</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  }
  // Additional themes omitted for brevity
} as const;
</code></pre>
<ul>
<li>Defines themes as immutable objects, emphasizing consistency and avoiding unintended modifications.</li>
<li>Includes metadata like <code class="inline-code">description</code> and <code class="inline-code">keywords</code> to enhance usability and semantic clarity.</li>
<li>Ensures each theme is well-documented and easy to reference during configuration.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function getAllThemes(): ThemeDefinition[] {
  return THEMES_ARRAY;
}
</code></pre>
<ul>
<li>Provides a simple accessor to retrieve the complete list of available themes.</li>
<li>Centralizes theme data in one place, reducing redundancy across the codebase.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
</code></pre>
<ul>
<li>Validates user inputs, ensuring that only defined theme keys are accepted.</li>
<li>Uses a type guard for enhanced developer tooling and runtime safety.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Input Validation</h3>
<p>The <code class="inline-code">input-validator.ts</code> file is the gatekeeper for all user and system inputs within the adventure system. By sanitizing and validating data, it shields the <em>RepoStar Matrix</em> from errant or malicious input. Through structured validation methods, this module ensures seamless and secure operation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> ensures user selections meet format and length requirements.</li>
<li><code class="inline-code">validateTheme</code> normalizes theme inputs and validates them against available options.</li>
<li><code class="inline-code">sanitizeForDisplay</code> cleanses data for safe display, removing potentially hazardous characters.</li>
</ul>
<h3>Code</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Verifies that adventure choices are neither empty nor excessively long.</li>
<li>Prevents unnecessary errors by trimming initial input before processing.</li>
<li>Plays a pivotal role in user input processing for crucial mission selection.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Normalizes and validates user-inputted themes against the defined catalog.</li>
<li>Provides specific feedback, including valid options, when validation fails.</li>
<li>Implements both normalization and type-checking for comprehensive validation.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>Strips potentially harmful characters to safeguard against injection attacks.</li>
<li>Normalizes whitespace and truncates overly long strings for safer display.</li>
<li>Protects outputs in logs or user interfaces, demonstrating best practices.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üöÄ <strong>Plan Ahead</strong>: While extracting file paths, consider how these will align with other modules such as <code class="inline-code">theme.ts</code> or <code class="inline-code">input-validator.ts</code>.</li>
<li>üìú <strong>Map Connections</strong>: Look for how theme validation ties directly into input sanitization to maintain seamless user experiences.</li>
<li>‚öôÔ∏è <strong>Spot Patterns</strong>: Use these validation techniques as blueprints for expanding functionality across the starship&#39;s systems.</li>
</ul>
<hr>
<p>You have mastered all the secrets of this cosmic project! Your adventure is complete.</p>
<p>Stellar work, cadet! You&#39;ve successfully forged the Cosmic Configuration Grid, propelling our mission into hyperspace with your brilliance‚Äîone quest away from mastering the galaxy! üöÄ‚≠êüíéüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>