<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundation & Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Odyssey of the Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundation &amp; Utilities</h1>
<hr>
<p>The starship <em>Codex Voyager</em> approaches the final frontier of its cosmic exploration: the foundational utilities that bind its advanced systems together. As the crew ventures deep into the nebula of interconnected technology within the galaxy of the <code class="inline-code">adventure-config.ts</code> file, they must map critical protocols that form the backbone of mission management. These utilities power everything‚Äîfrom interpreting cosmic adventure scripts to ensuring the ship‚Äôs systems align with stellar configurations. Prepare for this vital investigation. The fate of universal exploration rests on unraveling these essential functions!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Config Scanner</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure data integrity when processing JSON from the adventure repository?</li>
<li>‚ö° <strong>Path Navigator</strong>: What role does <code class="inline-code">extractUniqueFilePaths</code> play in filtering and validating referenced paths across the adventure configuration?</li>
<li>üõ°Ô∏è <strong>Optimization Protocol</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> streamline adventure data for reduced resource usage during prompt generation?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> packages/core/src/shared/adventure-config.ts</h3>
<p>Your mission takes you into the heart of the code that deals with raw adventure configuration. This file provides foundational utilities to read, parse, and format adventure settings and ensure accurate file path resolution. You&#39;ll encounter three key functions: <code class="inline-code">parseAdventureConfig</code>, <code class="inline-code">extractUniqueFilePaths</code>, and <code class="inline-code">formatAdventureConfigForPrompt</code>. Together, they encapsulate the ability to validate, extract, and optimize data while maintaining core integrity.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: A robust function that loads raw configuration data, parses it into JSON, and handles errors gracefully. Essential for making sense of adventure scripts.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Dynamic path extraction ensuring only valid, accessible file paths are included, pivotal for seamless project integration.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Transforms the adventure configuration data into a concise, optimized format, ideal for AI-driven operations.</li>
</ul>
<h2>Code</h2>
<h3><span class="header-prefix">File:</span> packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This code reads raw adventure data and converts it to a structured format using <code class="inline-code">JSON.parse</code>.</li>
<li>It gracefully handles errors by returning <code class="inline-code">null</code>, ensuring invalid data does not disrupt operations.</li>
<li>Centralized parsing minimizes redundancy and improves maintainability in adventure-related systems.</li>
<li>Embodies the principle of single responsibility by focusing exclusively on parsing and validation.</li>
<li>The function‚Äôs design is crucial for integrating external configuration sources while guaranteeing resilience.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function uses recursive traversal to process the entire configuration blob.</li>
<li>It validates paths and ensures only existing files are included in the final output.</li>
<li>By leveraging <code class="inline-code">Set</code>, it avoids duplicate paths‚Äîa vital operation for scalable systems.</li>
<li>Demonstrates effective usage of recursion and stack-based processing.</li>
<li>Plays a critical role in maintaining synchronization between config data and project structure.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function transforms configuration data for optimized consumption by AI systems.</li>
<li>It reduces unnecessary verbosity while retaining all essential context elements.</li>
<li>Facilitates seamless integration between config data and external prompt generation workflows.</li>
<li>Demonstrates pattern-matching techniques to filter and format nested data.</li>
<li>A prime example of efficient data reduction for performance-critical applications.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Ensure project paths exist by manually verifying them in the filesystem to avoid configuration errors.</li>
<li>Use <code class="inline-code">formatAdventureConfigForPrompt</code> as a testing ground for understanding optimization techniques applied to raw data.</li>
<li>Explore relationships between extracted file paths (<code class="inline-code">extractUniqueFilePaths</code>) and their role in adventure initialization pipelines.</li>
</ul>
<hr>
<p>You have mastered all the secrets of stellar coding systems and cosmic configurations aboard <em>Codex Voyager</em>! Your adventure is complete. The universe calls, and your technical mastery echoes across the stars. Bravo, intrepid explorer!</p>
<p>Mission accomplished, cadet‚ÄîQuest 5: Foundation &amp; Utilities has been conquered, propelling you to 80% completion with the precision of a starship navigating the cosmos; onward to the final frontier! üöÄ‚≠êüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>