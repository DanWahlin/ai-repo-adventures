<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Plot the Adventure Flight Plan - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Starship Aurora: Navigating the Repository Constellation</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Plot the Adventure Flight Plan</h1>
<hr>
<p>Your helm glows with starmaps as the Aurora prepares to plot the Adventure Flight Plan. The crew needs a compact, navigable briefing distilled from raw mission charts. You align scanners toward configuration nebulae, where paths to code constellations await extraction and formatting. With the LLM reactor humming, your task is to parse the mission config, chart unique file trajectories, and compress the plan into a prompt-friendly star chart. Stay sharp: one misread path could throw the expedition off orbit.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Scanner Calibration: How does <code class="inline-code">parseAdventureConfig</code> centralize JSON parsing so other systems avoid duplicating parsing logic?</li>
<li>‚ö° Chart Compression: In <code class="inline-code">formatAdventureConfigForPrompt</code>, what techniques trim verbose config into a minimal, prompt-ready flight plan?</li>
<li>üõ°Ô∏è Path Integrity Shields: How does <code class="inline-code">extractUniqueFilePaths</code> validate referenced <code class="inline-code">path</code> entries and avoid false positives or missing files?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core navigational instruments for loading, parsing, distilling, and extracting adventure configuration</h3>
<p>This module equips the Aurora with precise instruments for mission configuration handling. At launch, <code class="inline-code">loadAdventureConfig</code> performs a pure file read of <code class="inline-code">adventure.config.json</code>, delegating all parsing to <code class="inline-code">parseAdventureConfig</code>. That separation prevents accidental coupling between I/O and validation while allowing upstream systems to treat missing or malformed data as non-fatal. The <code class="inline-code">parseAdventureConfig</code> function is the single waypoint for JSON interpretation, returning <code class="inline-code">null</code> on any anomaly, which simplifies flow control for callers that just need a yes/no readiness signal.</p>
<p>For route plotting, <code class="inline-code">extractUniqueFilePaths</code> traverses the entire parsed config graph iteratively, looking for any <code class="inline-code">path</code> fields. Each candidate is trimmed, resolved relative to the project root, and verified with <code class="inline-code">fs.existsSync</code> before inclusion. This ensures only physically valid routes are placed on the star map, eliminating phantom references. Finally, <code class="inline-code">formatAdventureConfigForPrompt</code> compresses adventures into a concise format capturing just quest titles, file paths, and function names. This compression aligns with LLM prompt constraints, minimizing noise while preserving essential navigation cues for downstream generators. Together, these instruments transform raw configuration dust into actionable star charts that the crew can follow across the code galaxy.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> centralizes JSON parsing and validation, returning <code class="inline-code">null</code> on errors so callers can fail gracefully without throwing.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> performs a graph walk to find all <code class="inline-code">path</code> fields, resolves and validates them with the filesystem, and returns de-duplicated routes.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> converts rich config into a minimal, LLM-optimized briefing listing quest titles, file paths, and function names.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Establishes a single point for JSON parsing, ensuring consistent error handling by returning <code class="inline-code">null</code> instead of throwing.</li>
<li>Separates concerns: file reading happens in <code class="inline-code">loadAdventureConfig</code>, while parsing and validation live here.</li>
<li>Encourages defensive calling patterns, allowing higher layers to branch on presence/absence without try/catch.</li>
<li>Simplifies integration with other modules that expect a clean <code class="inline-code">object | null</code> result for system flow decisions.</li>
<li>Avoids leaky abstractions by not exposing parsing exceptions to the rest of the navigation stack.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Iteratively walks the entire config graph to find <code class="inline-code">path</code> occurrences, preventing missed references nested in arrays or objects.</li>
<li>Validates each discovered path with <code class="inline-code">fs.existsSync</code> after resolving to an absolute path, ensuring only real files are charted.</li>
<li>Uses a <code class="inline-code">Set</code> to de-duplicate routes, keeping the flight plan concise and free of redundant waypoints.</li>
<li>Employs a stack-based traversal to avoid recursion depth issues, providing robustness for large configs.</li>
<li>Returns a stable array of unique, validated file paths ready for downstream analyzers and mission planners.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Produces a compact, LLM-friendly overview by listing quest titles, file paths, and function names without verbose prose.</li>
<li>Validates structure at each step, returning an empty string for missing or malformed data to prevent noisy prompts.</li>
<li>Applies a clear separation between data extraction and presentation, aiding maintainability and testability.</li>
<li>Uses <code class="inline-code">flatMap</code> on highlights to collect function names efficiently, ensuring coverage of all file-level highlights.</li>
<li>Aligns with prompt token budgets, improving reliability of downstream generation within resource constraints.</li>
</ul>
<h2>Helpful Hints</h2>
<ul>
<li>Start by checking <code class="inline-code">parseAdventureConfig</code> results before invoking path extraction or formatting to avoid null flows.</li>
<li>Compare the output of <code class="inline-code">extractUniqueFilePaths</code> against your workspace to verify the navigator‚Äôs integrity.</li>
<li>Use <code class="inline-code">formatAdventureConfigForPrompt</code> to preview your mission brief and ensure it lists only essential coordinates.</li>
</ul>
<hr>
<p>You have mastered all the secrets of this project! Your adventure is complete.</p>
<p>Mission accomplished, cadet‚Äîyour stellar success in Quest 5: Plot the Adventure Flight Plan has locked in a precise trajectory for our starship‚Äôs next burn, pushing you to 80% mission completion and priming your cosmic instruments for a triumphant final orbit‚Äîkeep those thrusters hot and sensors aligned! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>