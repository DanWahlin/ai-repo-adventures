<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Extracting Code Coordinates - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Expedition: Chronicles of the Codebase</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Extracting Code Coordinates</h1>
<hr>
<p>As the <em>Codexus</em> glides deeper into the Code Nebula, a cosmic transmission reveals your next mission: uncover the coordinates of key source files hidden within the adventure configuration. The <em>Codexus</em>&#39;s system charts rely on this information to navigate the complex pathways of the Repository Galaxy. Your crew must analyze the configuration module to extract these hidden paths, ensuring the quest directives can be plotted accurately. Steady your resolve, for precision is critical to avoid being lost in this endless digital expanse.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pathfinder‚Äôs Map</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> identify and accumulate valid file paths from the configuration data structure?</li>
<li>‚ö° <strong>Signal Relay</strong>: What role does <code class="inline-code">parseAdventureConfig</code> play when coordinating between raw input and consumable data for path extraction or formatting?</li>
<li>üõ°Ô∏è <strong>Error Horizon</strong>: What mechanisms prevent configuration parsing from causing mission-critical failures, and how are errors handled gracefully?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Navigation Systems</h3>
<p>This module drives the adventure configuration logic, bridging raw file inputs with structured outputs. It includes utilities for reading the configuration file, parsing its content to handle errors securely, and extracting unique file paths referenced within the configuration. By chaining functions like <code class="inline-code">loadAdventureConfig</code> and <code class="inline-code">parseAdventureConfig</code>, the system maintains a robust flow that isolates responsibilities while enabling modular debugging. Additionally, <code class="inline-code">extractUniqueFilePaths</code> uses a depth-first search pattern to traverse nested structures, ensuring that file paths are comprehensively gathered without redundancy. This systematic approach guarantees integrity and scalability in processing sprawling configurations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> ensures data integrity and safely parses the configuration file into a structured object.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> recursively navigates the parsed configuration to gather valid file paths.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> simplifies configuration data for streamlined AI-based processing.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Much like an astronaut interpreting star maps, <code class="inline-code">parseAdventureConfig</code> transforms raw configuration data into a usable format, while shielding the system from parse errors.</p>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p><code class="inline-code">extractUniqueFilePaths</code> functions like a relentless scout drone, exploring all nodes in the data graph to identify and collect destination coordinates.</p>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;

    // Just file paths - LLM can see descriptions in actual code
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }

    // Just function names - LLM can understand purpose from implementation
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }

    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p>Like a tactical briefing, <code class="inline-code">formatAdventureConfigForPrompt</code> distills critical configuration details into a concise format for immediate interpretation.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Test extracted file paths with real project folders to verify traversal accuracy.</li>
<li>Trace how <code class="inline-code">parseAdventureConfig</code> interacts with <code class="inline-code">extractUniqueFilePaths</code> to understand their dependency structure.</li>
<li>Pay attention to how error handling ensures that incomplete or malformed configurations don‚Äôt disrupt the mission.</li>
</ul>
<hr>
<p>Quest accomplished, adventurer! You‚Äôve unlocked the map to unearth new possibilities in the Repository Galaxy. Navigate boldly!</p>
<p>Stellar success, Cadet! Quest 5: Extracting Code Coordinates has been charted with precision‚Äîyour cosmic journey is now 80% complete as you blaze toward the final frontier! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>