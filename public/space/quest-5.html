<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Discovering Foundation Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Chronicles: The Codebase Voyager</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Discovering Foundation Utilities</h1>
<hr>
<p>In this climactic chapter of your mission, the <em>Infinitum</em> approaches the heart of the Digital Nebula. Pulsing signals on your sensors point to critical foundation utilities that anchor your starship&#39;s operations. These utilities fuel the decoding of galactic structures and ensure directives are meticulously followed. With the Model Context Protocol (MCP) guiding your way, your crew must explore the <code class="inline-code">adventure-config.ts</code> utility systems to uncover how they seamlessly process configurations, extract vital pathways, and prepare for the echoes of future adventures across this vast digital cosmos.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Cosmic Mapper</strong>: How does the code ensure raw configuration data is loaded safely and effectively?</li>
<li>‚ö° <strong>Pathfinder&#39;s Insight</strong>: What mechanisms are used to identify and validate unique file paths within the configuration?</li>
<li>üõ°Ô∏è <strong>Signal Compression</strong>: How is data formatted and optimized for communication with LLM systems?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> A foundation for galactic configuration management</h3>
<p>This file encapsulates the essential mechanics behind handling adventure configuration files. At the core of its purpose is the ability to read, parse, and transform configuration data while maintaining reliability and fault tolerance. Through a robust framework of utility functions, the <code class="inline-code">adventure-config.ts</code> file retrieves project-specific data, ensures its structural integrity, and extracts actionable insights, making it pivotal for both operational readiness and exploration efficiency.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: A dedicated function for loading raw adventure configuration data. This ensures foundational information is retrieved for subsequent parsing or handling.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: A traversal-based utility that scans configuration objects to determine the distinct file paths referenced, validating their existence.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: An optimization-focused method designed to condense configuration data into a lightweight format suitable for LLM interactions, removing redundancy.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Defines the method to fetch raw configuration text from a specific project directory.</li>
<li>Leverages <code class="inline-code">readFileIfExists</code> to handle file read operations non-fatally, ensuring stability even if the file is missing or inaccessible.</li>
<li>Acts as the initial step in the broader configuration parsing pipeline.</li>
<li>Maintains fault tolerance, a critical trait for navigating cosmic uncertainties.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Implements a recursive, stack-based traversal to scan an object structure, targeting <code class="inline-code">path</code> fields.</li>
<li>Validates the existence of each referenced file, filtering out invalid or unresolvable entries.</li>
<li>Utilizes a <code class="inline-code">Set</code> to ensure uniqueness, preventing duplicate file paths.</li>
<li>Efficiently identifies critical resources for further processing or analysis in mission operations.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts raw configuration data into a streamlined format for use in LLM prompts.</li>
<li>Extracts only the most meaningful structural elements, such as file paths and function names, omitting verbose details.</li>
<li>Significantly reduces data size to ensure compatibility with limited prompt tokens, improving communication efficiency with the LLM.</li>
<li>Demonstrates optimization and adaptability, vital traits for navigating high-stakes cosmic environments.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Ensure the <code class="inline-code">adventure.config.json</code> file is properly structured to enable smooth integration with these utilities.</li>
<li>Pay attention to error-handling patterns; they&#39;re critical in ensuring the system&#39;s fault tolerance under unexpected conditions.</li>
<li>Analyze how unique file paths are extracted as it highlights efficient data traversal techniques.</li>
</ul>
<hr>
<p>You have mastered all the secrets of <em>Infinitum</em>‚Äôs operational framework! Your quest across the Digital Nebula is complete, and you stand as a true explorer of galactic code.</p>
<p>Stellar work on Quest 5: Discovering Foundation Utilities‚Äîyour cosmic mastery is propelling the mission to brilliance at warp speed, with just one more quest before achieving intergalactic glory! ‚≠êüöÄ‚ö°üíéüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>