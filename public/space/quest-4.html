<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Align Configuration Stars - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Starship Aurora: Navigating the Repository Constellation</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Align Configuration Stars</h1>
<hr>
<p>Your helm glows with system schematics as the Aurora slips into orbit above a configuration nebula. To align the configuration stars, you must harmonize navigation constants, theme spectra, and input filtration shields so allied ships can request missions via the MCP interface without drift. Your scanners relay parameters from the LLM reactor, while star maps define themed sectors for exploration. This chapter focuses on calibrating these cosmic dials and validating crew commands, ensuring every journey follows the intended star charts and survives turbulence in the void.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Scanner Calibration: How do configuration constants like <code class="inline-code">LLM_REQUEST_TIMEOUT</code> and <code class="inline-code">MAX_FILE_SIZE_MB</code> constrain mission scope and safeguard the reactor during long prompts?</li>
<li>‚ö° Star Map Selection: By what path does <code class="inline-code">parseTheme</code> resolve a theme from raw input, and how does <code class="inline-code">isValidTheme</code> cooperate to confirm a stable orbit around a valid theme?</li>
<li>üõ°Ô∏è Shield Integrity: How does <code class="inline-code">validateTheme</code> surface helpful errors using <code class="inline-code">getAllThemes</code>, and how does <code class="inline-code">sanitizeForDisplay</code> protect bridge consoles from unsafe characters?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Mission configuration constants and operational limits</h3>
<p>This file is the Aurora‚Äôs astrogation console for constants that tune the LLM reactor, analysis drives, and scanning boundaries. The <code class="inline-code">LLM_REQUEST_TIMEOUT</code> sets the maximum burn duration for generator calls, preventing runaway thruster usage during story prompts. <code class="inline-code">REPOMIX_CACHE_TTL</code> governs how long repomix echoes remain in memory, balancing responsiveness with resource conservation. File analysis safeguards like <code class="inline-code">MAX_FILE_SIZE_MB</code> and <code class="inline-code">MAX_SCAN_DEPTH</code> keep the probe from diving into black holes of data, while <code class="inline-code">KEY_SOURCE_FILES</code>, <code class="inline-code">TOP_FUNCTIONS</code>, and <code class="inline-code">TOP_CLASSES</code> focus the telescope on the brightest signals. Defaults such as <code class="inline-code">DEFAULT_THEME</code> ensure a safe trajectory if theme beacons fail. The constants under LLM settings, including <code class="inline-code">LLM_TEMPERATURE</code> and <code class="inline-code">LLM_MAX_TOKENS_QUEST</code>, define narrative variability and payload limits, and the GPT-5 fields modulate verbosity and reasoning effort. Collectively, these parameters align the configuration stars so mission flows remain predictable, efficient, and secure across varying galactic environments. When the MCP requests a mission, these values determine how far, how fast, and how focused the Aurora can scan, extract, and narrate, ensuring allied ships receive stable adventures without reactor overload.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> defines the maximum duration for LLM calls, stabilizing long-running narrative burns.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> sets caching windows for repository context, balancing freshness and performance.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> limits per-file analysis size to avoid memory gravitational wells and keep the scan nimble.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Theme constellations and parsing beacons</h3>
<p>This file charts the theme constellations for the entire fleet. The <code class="inline-code">THEMES</code> object is the canonical star catalog, mapping ids, keys, descriptions, emojis, and keyword clusters for input matching. Explorers can reference <code class="inline-code">getAllThemes</code> to enumerate viable orbits, while <code class="inline-code">isValidTheme</code> confirms whether a resolved key is part of the recognized sky. The <code class="inline-code">parseTheme</code> function provides an approach-vector navigator: it first seeks exact key matches, then numeric ids, then keyword inclusions, allowing flexible docking with minimal friction. The formatting helpers guide how themes appear on command displays, but the core purpose here is interpretability and validation. A stable adventure hinges on selecting the right constellation, and these helpers ensure that free-form crew input locks onto legitimate sectors. In conjunction with input validation systems, they provide clear and resilient theme alignment that prevents wandering into uncharted sectors. Observing the order of operations in <code class="inline-code">parseTheme</code> reveals how operator intent is captured even when inputs vary, making the theme lock reliable in the heat of a mission.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code> is the central registry of theme constellations with keys, ids, and keywords used for matching.</li>
<li><code class="inline-code">getAllThemes</code> exposes the full list for displays and validation messages across the bridge.</li>
<li><code class="inline-code">parseTheme</code> resolves an input to a theme via key, numeric id, or keyword matching, ensuring flexible docking.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Bridge input shields and sanitation filters</h3>
<p>This file is the shield emitter that protects consoles from malformed commands. <code class="inline-code">validateAdventureChoice</code> ensures a mission choice is present and within length constraints, avoiding signal noise on the command deck. <code class="inline-code">validateTheme</code> is the critical validator that normalizes input, runs it through <code class="inline-code">parseTheme</code>, and checks <code class="inline-code">isValidTheme</code>; if alignment fails, it composes a helpful error listing valid constellation keys via <code class="inline-code">getAllThemes</code>. The <code class="inline-code">validateProjectPath</code> function asserts sane project paths with length and null-byte checks, defaulting to <code class="inline-code">process.cwd()</code> if none is provided, which keeps navigation rooted. Finally, <code class="inline-code">sanitizeForDisplay</code> strips risky characters and compresses whitespace, preventing UI anomalies when echoing crew input to terminals. These validators ensure that upstream analyzers and the LLM reactor receive clean, trustworthy signals, minimizing misfires and enhancing mission reliability.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> enforces presence and size limits, ensuring clear mission selection signals.</li>
<li><code class="inline-code">validateTheme</code> normalizes input, parses themes, validates against catalog, and emits helpful errors.</li>
<li><code class="inline-code">validateProjectPath</code> applies length and null-byte checks and provides a sensible default for stable navigation.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
</code></pre>
<ul>
<li>Caps the burn time of LLM requests to prevent resource thrashing during heavy narrative generation.</li>
<li>Encourages predictable mission latency and mitigates stalled reactor cycles.</li>
<li>Aligns with other token constraints to balance cost and responsiveness.</li>
<li>Interacts with client request flows to abort or handle delayed responses safely.</li>
<li>Important for MCP-triggered missions where allied ships depend on timely results.</li>
</ul>
<hr>
<pre><code class="language-typescript">export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
</code></pre>
<ul>
<li>Sets a cache lifespan for repository context, improving repeated mission responsiveness.</li>
<li>Uses environment configuration to tune fleet-wide behavior without code changes.</li>
<li>Prevents stale data by enforcing expiration, balancing freshness and performance.</li>
<li>Connects to analysis stages that reuse repomix output across similar scans.</li>
<li>Highlights a pattern of environment-driven, safe defaults for operational agility.</li>
</ul>
<hr>
<pre><code class="language-typescript">export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li>Restricts scanning to manageable artifacts, avoiding memory gravity wells.</li>
<li>Ensures the analyzer focuses on code rather than oversized binaries or dumps.</li>
<li>Reduces risk of timeouts and keeps telemetry within the defined mission envelope.</li>
<li>Pairs with depth and count limits to maintain a focused exploration vector.</li>
<li>A concrete safety rail that stabilizes the scanning subsystem.</li>
</ul>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  },
  DEVELOPER: {
    id: 4,
    key: &#39;developer&#39;,
    displayName: &#39;Developer Documentation&#39;,
    emoji: &#39;üìñ&#39;,
    description: &#39;Technical documentation approach with clear explanations, best practices, and code analysis&#39;,
    keywords: [&#39;developer&#39;, &#39;code&#39;, &#39;technical&#39;, &#39;debug&#39;, &#39;guide&#39;, &#39;tutorial&#39;, &#39;binary&#39;]
  },
  CUSTOM: {
    id: 5,
    key: &#39;custom&#39;,
    displayName: &#39;Custom Theme&#39;,
    emoji: &#39;üé®&#39;,
    description: &#39;Design your own adventure! You\&#39;ll be prompted to provide theme name, description, and keywords&#39;,
    keywords: [&#39;custom&#39;, &#39;personalized&#39;, &#39;unique&#39;, &#39;creative&#39;, &#39;personal&#39;]
  }
} as const;
</code></pre>
<ul>
<li>Serves as the canonical star catalog for all theme routes.</li>
<li>Each entry couples ids, keys, and keywords enabling multiple docking vectors.</li>
<li>Powers validation, display, and keyword inference across the fleet.</li>
<li>Guarantees stable references so tools and UI remain synchronized.</li>
<li>Encourages expansion with minimal refactoring due to structured typing.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function getAllThemes(): ThemeDefinition[] {
  return THEMES_ARRAY;
}
</code></pre>
<ul>
<li>Provides a single route to enumerate valid constellations for UIs and errors.</li>
<li>Centralizes access, avoiding fragmented theme lists elsewhere.</li>
<li>Enables helpful validation messages that list available keys.</li>
<li>Encourages consistent ordering and transforms via higher-level helpers.</li>
<li>Simple implementation supports reliability and testability.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  // Check for exact key match
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  // Check for numeric ID
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  // Check keywords using simple includes check
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>Implements a three-stage approach vector: key, id, then keyword hints.</li>
<li>Normalizes input to tolerate operator variance and noise.</li>
<li>Prioritizes exactness before fuzzy matching to reduce misalignment.</li>
<li>Bridges human-friendly inputs to strict internal keys.</li>
<li>Returns null on failure, enabling validators to craft precise errors.</li>
</ul>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Ensures mission selections are present and concise for clear routing.</li>
<li>Uses simple length checks to prevent console clutter and misuse.</li>
<li>Trimming removes stray whitespace, improving signal quality.</li>
<li>Throws explicit errors, guiding operators to correct inputs quickly.</li>
<li>Provides a stable surface for downstream decision logic.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Orchestrates theme alignment: normalize, parse, then validate.</li>
<li>Produces actionable error output listing valid keys via <code class="inline-code">getAllThemes</code>.</li>
<li>Combines deterministic matching with user-friendly input handling.</li>
<li>Forms a critical gate before mission generation and UI presentation.</li>
<li>Keeps the system within known constellations, avoiding chartless space.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  
  if (input.length &gt; 500) {
    throw new Error(&#39;Project path too long (max 500 characters)&#39;);
  }
  
  if (input.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid characters&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Defaults to current working directory for predictable navigation.</li>
<li>Enforces length and null-byte checks to block hazardous paths.</li>
<li>Trimming yields clean, comparable paths for analysis systems.</li>
<li>Balances convenience with strong guardrails for safety.</li>
<li>Critical for repo scanning commands initiated from MCP requests.</li>
</ul>
<h2>Helpful Hints</h2>
<ul>
<li>Tune environment variables to adjust cache TTLs and timeouts without redeploying the fleet.</li>
<li>Verify theme inputs with sample values like <code class="inline-code">1</code>, <code class="inline-code">space</code>, or <code class="inline-code">galaxy</code> to observe <code class="inline-code">parseTheme</code> pathways.</li>
<li>Test invalid paths and themes to study error clarity and resilience of the input shields.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission update: Quest 4‚ÄîAlign Configuration Stars‚Äîsuccessfully navigated, boosting your starship to 60% completion as you rocket past this cosmic milestone with stellar precision and momentum toward the final frontier! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>