<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Starforge Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Codex: Adventures in Repository Space</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Starforge Engine</h1>
<hr>
<p>The <em>Code Odyssey</em> glides through the cosmic lattice of repositories, its AI systems humming with purpose. For this leg of your galactic journey, you must unravel the secrets of the <em>Starforge Engine</em>, the storytelling module that fabricates entire quests from raw code and context. Within its fusion core lies the <code class="inline-code">AdventureManager</code>, the captain of story operations, and the <code class="inline-code">StoryGenerator</code>, weaving intricate narratives from threads of data scattered across your project. The challenge: decipher how these celestial constructs work harmoniously to bring your adventures to life.</p>
<p>As you venture into these critical systems, prepare to decode adventure initialization, explore quest execution, and analyze prompt generation. The <em>Starforge Engine</em> holds the key to perfecting the art of galactic storytelling!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Core Initialization</strong>: How does <code class="inline-code">AdventureManager</code> leverage the <code class="inline-code">AdventureState</code> to orchestrate its stories and quests? </li>
<li>‚ö° <strong>Quest Content Fabrication</strong>: What role does <code class="inline-code">StoryGenerator</code> play in generating quest narratives, and how does it format the Markdown output?</li>
<li>üõ°Ô∏è <strong>Validation Protocols</strong>: How are user inputs validated and sanitized during quest selection and execution?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Story orchestration and quest handling</h3>
<p>The <code class="inline-code">AdventureManager</code> is the primary conductor of storytelling, responsible for coordinating quest initialization and execution. It interacts deeply with <code class="inline-code">AdventureState</code> to manage progress, cache quest content, and ensure a seamless mission experience.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: This method sets up the full adventure, including quests, story, and theme configuration. It syncs data from config files and story generation systems for a comprehensive setup.</li>
<li><code class="inline-code">exploreQuest</code>: Handles the execution of a chosen quest, utilizing cached content or generating new material dynamically, while also managing prerequisites.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Ensures user inputs during quest selection are valid, preventing errors or interruptions.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Narrative creation and prompt management</h3>
<p>The <code class="inline-code">StoryGenerator</code> is the literary heart of the <em>Starforge Engine</em>, synthesizing quests and stories from metadata, adventure configs, and AI-driven insights.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: The engine&#39;s starting point, it uses the configured theme and project information to spawn adventures and structure quests.</li>
<li><code class="inline-code">generateQuestContent</code>: Transforms code context into fleshed-out quest content, formatting the output in Markdown for readability.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Processes AI-provided Markdown responses into structured <code class="inline-code">StoryResponse</code> objects, ensuring compatibility with the rest of the system.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Adventure configuration and validation</h3>
<p>This file ensures the system retrieves and processes the adventure&#39;s configuration settings. It enables flexible, dynamic environments based on the specified adventure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Loads raw adventure configuration data from a file, supporting initialization.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Validates and converts raw configuration into an object for safer traversal.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Analyzes configuration data to identify valid file paths linked to the adventure, incorporating only those that exist.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This setup synchronizes story, quests, and configuration files, ensuring each adventure starts with clean state management.</li>
<li>It handles custom themes and ensures consistency between files and generative content.</li>
<li>The modular design compartmentalizes story generation and config enforcement, making debugging easier.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>This method combines user input validation with quest execution logic.</li>
<li>It elegantly separates finding a quest from running it, adhering to the single-responsibility principle.</li>
<li>The <code class="inline-code">isProgressRequest</code> utility enables seamless navigation between quests and progress checks.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const { quest, theme, codeContent, questPosition, totalQuests } = config;
  let adventureGuidance = &#39;&#39;;
  let customInstructions = &#39;&#39;;
  if (this.projectPath) {
    const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);
    if (formattedConfig) {
      adventureGuidance = formattedConfig;
    }
    const customInstructionsFromConfig = extractCustomInstructions(this.projectPath);
    if (customInstructionsFromConfig) {
      customInstructions = customInstructionsFromConfig;
    }
  }
  const prompt = loadQuestContentPrompt({ theme, adventureTitle: quest.title, codeContent, storyContent: this.currentStoryContent || &#39;No story context available.&#39;, adventureGuidance: adventureGuidance || &#39;&#39;, ...(customInstructions &amp;&amp; { customInstructions }), questPosition, totalQuests, ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData }) });
  const response = await this.withTimeout(this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST }));
  if (!response.content || response.content.trim() === &#39;&#39;) {
    throw new Error(&#39;LLM returned empty response for quest content&#39;);
  }
  return {
    adventure: response.content.trim(),
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<ul>
<li>Focused on translating code context into Markdown-based quests, it merges multiple inputs to produce a themed narrative.</li>
<li>The integration of <code class="inline-code">formattedConfig</code> and <code class="inline-code">extractCustomInstructions</code> provides adventure-specific customization at a granular level.</li>
<li>Embeds safety checks (e.g., empty response handling) to ensure robust execution.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Converts raw JSON from the config file into an accessible object.</li>
<li>Includes error handling for invalid/missing data, ensuring no crashes during parsing.</li>
<li>Establishes a dependable step for downstream configuration processes.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use logging to trace the interactions between <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code> when debugging.</li>
<li>Focus on how file and quest mappings are merged during initialization to understand dynamic story adaptations.</li>
<li>For further exploration, investigate the custom instructions embedded in quest content for enhanced dynamics.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission accomplished, Star Voyager! üåü By completing Quest 2: The Starforge Engine, you&#39;ve ignited the cosmic core of your journey‚Äîkeep rocketing toward the stars at warp speed! üöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>