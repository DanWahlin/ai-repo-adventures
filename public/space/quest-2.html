<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Cosmic Quest Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Stellar Repository Exploration: A Space Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Cosmic Quest Generation Engine</h1>
<hr>
<p>The starship Stellar Repository Exploration‚Äôs mission is at a critical juncture. Data shimmering within the starsea reveals incomplete configurations, fragmented code, and untouched mysteries. The onboard Cosmic Quest Generation Engine has activated, calling upon the crew to decode alien-like paths linking quests to configuration files and dynamic story flows. This mission delves into the ship&#39;s cerebral Adventure Manager, Story Generator, and enigmatic Adventure Config mappings. Will your crew unveil the mechanisms powering this stellar narrative engine?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Cosmic Initialization</strong>: How does <code class="inline-code">initializeAdventure</code> orchestrate the initiation of a new quest and bind it to the starship&#39;s cosmic narrative?</li>
<li>‚ö° <strong>Quest Navigation</strong>: What patterns define <code class="inline-code">exploreQuest</code> in validating, identifying, and executing exploratory missions aboard the starship?</li>
<li>üõ°Ô∏è <strong>Config Synchronization</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure celestial lifelines (adventure configurations) are retrieved, validated, and formatted?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Managing the Cosmic Plot</h3>
<p>This file houses the <code class="inline-code">AdventureManager</code> and <code class="inline-code">AdventureState</code> classes, which chain critical systems together to frame quests and pull configurations. The <code class="inline-code">initializeAdventure</code> method acts as the engine‚Äôs spark, setting narrative threads in motion. Another pivotal function, <code class="inline-code">exploreQuest</code>, handles user interactions, steering the crew through defined quests or presenting their progress. Central themes of these methods include validation logic, caching reusable elements, and relying on supplementary configurations to enrich quests. The file exemplifies structured design and reusable paradigms for quest management.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: How narratives and quest lists are initialized and adapted to project contexts.</li>
<li><code class="inline-code">exploreQuest</code>: How player choices are validated, which decision trees are invoked, and how quests are cached.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Calculating completion rates dynamically to report crew progress.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(
    projectInfo, 
    theme, 
    this.state.projectPath
  );

  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; 
                     ? storyResponse.story 
                     : storyResponse.story.content;

  this.state.quests = this.mergeQuestFilesFromConfig(
    storyResponse.quests, 
    this.state.projectPath
  );

  this.state.quests = this.enforceConfigQuestCount(
    this.state.quests, 
    this.state.projectPath
  );

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p><code class="inline-code">initializeAdventure</code> is like the stardrive, orchestrating the ship‚Äôs initial propulsion through celestial narratives.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<p><code class="inline-code">exploreQuest</code> acts as the navigator, interpreting the crew‚Äôs input to steer the starship toward exploratory destinations.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p><code class="inline-code">progressPercentage</code> keeps the starship updated with real-time telemetry on the crew‚Äôs completion of quests.</p>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Mapping Celestial Configurations</h3>
<p>This file provides vital support for extracting the adventure configuration across star systems, specifically from the <code class="inline-code">adventure.config.json</code> file. The <code class="inline-code">parseAdventureConfig</code> function ensures adventure data is synchronized as proper JSON. Functions such as <code class="inline-code">extractUniqueFilePaths</code> navigate through nested configurations to collect file paths tied to quests, ensuring that mission-critical relationships remain intact.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses JSON adventure data safely and ensures fallbacks for invalid formats.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Collects and validates unique file paths from configuration files.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Formats configuration files optimally for LLM interpretation.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;

  try {
    return JSON.parse(raw);
  } catch {
    return null; // Return null gracefully on parsing failure
  }
}
</code></pre>
<p><code class="inline-code">parseAdventureConfig</code> is like a signal decoder, interpreting celestial adventure transmissions while gracefully handling corrupted signals.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p><code class="inline-code">extractUniqueFilePaths</code> acts as a cartographer, drawing maps of valid file paths from an exploration plan.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;

    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }

    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p><code class="inline-code">formatAdventureConfigForPrompt</code> compresses adventure blueprints into efficient signals for machine parsing.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Remember that quest files can influence generation logic, so focus on how <code class="inline-code">mergeQuestFilesFromConfig</code> functions within <code class="inline-code">adventure-manager.ts</code>.</li>
<li>Use <code class="inline-code">parseAdventureConfig</code> as an anchor point to examine JSON parsing patterns for safe exploration.</li>
<li>Think about caching strategies in <code class="inline-code">exploreQuest</code>‚Äîhow could it store repeated adventure content to reduce redundant computation?</li>
</ul>
<hr>
<p>The cosmic enigma deepens, but the light of knowledge glimmers brighter. May your starship proceed boldly through the software nebula!</p>
<p>You&#39;ve ignited the thrusters of brilliance and successfully charted the celestial coordinates of the &quot;Cosmic Quest Generation Engine&quot;‚Äîyour cosmic voyage is 20% powered up, soaring toward the stars with unparalleled momentum! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>