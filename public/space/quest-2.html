<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Stellar Content Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Repository Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Stellar Content Generation Engine</h1>
<hr>
<p>In the cold silence of cosmic space, the Repository Voyager awaits your intervention. As its systems hum faintly, you access code that serves as vital fuel for launching interactive adventures. Your mission? To understand the machinery behind storytelling: the quest generation engine. Three files contain the blueprints - decipher their structures, uncover how adventures coalesce from fragments, and harmonize the Repository&#39;s systems to spark galactic explorations once again.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Adventure Initialization Calibration</strong>: How does the <code class="inline-code">AdventureManager.initializeAdventure</code> method set the stage for cosmic storytelling?</li>
<li>‚ö° <strong>Quest Execution Circuitry</strong>: What mechanisms allow the <code class="inline-code">AdventureManager.exploreQuest</code> function to identify and execute user-selected quests?</li>
<li>üõ°Ô∏è <strong>Story and Theme Alignment</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> ensure themes and stories resonate with the user journey?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Quest orchestration and initialization mechanics</h3>
<p>The <code class="inline-code">AdventureManager</code> class functions as the command bridge for storytelling operations. It blends contextual inputs, themes, and interactive outputs, preparing the Repository Voyager for intelligent navigation through quests. Key highlights include methods for initializing adventure campaigns, validating choices, and translating selections into executed quests. Investigate how its internal state guides quest handling and contributes to user progression.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code> - Establishes the framework, resetting state and generating narratives/quests with provided inputs.</li>
<li><code class="inline-code">AdventureManager.exploreQuest</code> - Processes user choices, validates them, and activates corresponding quest content.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code> - Calculates completion metrics as a part of the galactic journey.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
    projectInfo: ProjectInfo, 
    theme: AdventureTheme, 
    projectPath?: string,
    customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>Imagine initializing a starship&#39;s navigation system by aligning its cosmic logs, tools, and mission guidance packages.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<p>Think of activating a star-module within a vast fleet based on a user&#39;s encrypted cosmic beacon.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>Picture mission control calculating fleet alignment based on completed projections within a cosmic map.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Galactic storytelling through dynamic generation</h3>
<p>The <code class="inline-code">StoryGenerator</code> class operates as the Repository&#39;s central engine for compelling cosmic narratives. It synthesizes input like project details and themes to generate stories and quests. Core functions include the orchestration of data parsing and prompt construction for LLM interaction, enabling stellar adventures. Uncover how storytelling aligns project context with exploration themes.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code> - Primary method for translating themes and project inputs into quests and narratives.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code> - Bridges markdown into structured, usable stories.</li>
<li><code class="inline-code">generateQuestContent</code> - Creates quest details and file scopes dynamically based on user exploration choices.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent: projectInfo.repomixContent,
    adventureGuidance: formatAdventureConfigForPrompt(projectPath)
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY })
  );

  return parseMarkdownToStoryResponse(response.content.trim());
}
</code></pre>
<p>Imagine sending stellar signals to craft navigation logs based on intergalactic project input.</p>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);
  let title = &#39;&#39;;
  let story = &#39;&#39;;
  const quests: Quest[] = [];

  tokens.forEach((token) =&gt; {
    if (token.type === &#39;heading&#39; &amp;&amp; token.depth === 1) title = token.text;
    else if (token.type === &#39;paragraph&#39;) story += token.text + &#39;\n&#39;;
    else if (token.type === &#39;heading&#39; &amp;&amp; token.depth === 3) quests.push({ title: token.text });
  });

  return { title, story, quests };
}
</code></pre>
<p>Envision extracting navigational directives from encrypted cosmic manuscripts within a star chart.</p>
<pre><code class="language-typescript">async generateQuestContent(quest: Quest, theme: AdventureTheme, codeContent: string): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
  });

  const response = await this.llmClient.generateResponse(prompt);

  return { adventure: response.content.trim(), hints: [] };
}
</code></pre>
<p>You are crafting intricate star-maps where each node defines a step in an exploration adventure.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration scaffolding for galactic paths</h3>
<p>The adventure configuration defines file paths and structures critical to the Repository Voyager&#39;s navigational modules. Core processing methods parse JSON-based configs, extract file references, and format prompts for guided content generation. Discover how these utilities refine explorations by providing thematic anchors.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> - Converts raw JSON into navigable configuration objects.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> - Locates valid file paths referenced in quest configurations.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> - Reduces adventure configs into functional contextual data for LLM consumption.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  return raw ? JSON.parse(raw) : null;
}
</code></pre>
<p>Think of decrypting files within a nebula archive to position celestial navigation modules.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  const files = new Set&lt;string&gt;();

  const stack = [parsed];
  stack.forEach(node =&gt; {
    if (node?.path &amp;&amp; fs.existsSync(node.path)) files.add(node.path);
  });

  return Array.from(files);
}
</code></pre>
<p>An analogy: sorting cosmic cargo, extracting valid navigation crystals from storage modules scattered across galaxies.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed) return &#39;&#39;;

  return `## Quest Structure\n${ /* Simplified listing */ &#39;&#39; }`;
}
</code></pre>
<p>Picture condensing astronomical maps into compressed coordinates for hyperspace navigation prompts.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Seek connections between initialization flows and quest processing to synchronize narrative output effectively.</li>
<li>Experiment with how different inputs influence story generation - consider variations in themes and file paths.</li>
<li>Observe how formatting quest structures for LLM can aid in narrative precision.</li>
</ul>
<hr>
<p>Your understanding of the Repository Voyager deepens! Venture forth to uncover the stars encoded in its cosmic matrix.</p>
<p>Bravo, cosmic trailblazer‚ÄîQuest 2: Stellar Content Generation Engine achieved with starship precision, propelling your voyage to mastery at warp speed! üöÄüíé‚≠ê‚ö°üì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>