<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Forging the Stellar Quest Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Starship Horizons: Adventures in Galactic Code</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Forging the Stellar Quest Engine</h1>
<hr>
<p>Aboard the starship <em>Horizons</em>, the crew prepares for an ambitious journey into the uncharted territories of the Code Nebula. Their mission: to forge the Stellar Quest Engine, a sophisticated system capable of decoding and navigating the wisdom hidden in garbled signals from the galactic data cores. This quest requires mastery over the starship&#39;s advanced adventure generation systems. The Stellar Quest Engine is key to accelerating exploration, enabling the ship&#39;s AI to craft cosmic narratives with precision. The galaxy awaits its brave explorers!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>System Initialization Scan</strong>: How does the <code class="inline-code">AdventureManager</code> initialize with project context and generate quests from the provided project configuration?</li>
<li>‚ö° <strong>Quest Workflow Mapping</strong>: What is the flow of selecting and executing a quest in <code class="inline-code">AdventureManager</code>, and how are user inputs validated?</li>
<li>üõ°Ô∏è <strong>Content Safeguards</strong>: How does the system ensure that adventure themes, file paths, and quest generation are properly validated and error-free?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Management Core</h3>
<p>The <code class="inline-code">AdventureManager</code> and <code class="inline-code">AdventureState</code> form the backbone of the Stellar Quest Engine, orchestrating the retrieval and management of quests. This class is responsible for initializing quests, validating choices, and managing progress. It integrates logic to dynamically generate quests, synchronize theme-based narratives, and streamline user navigation through the adventure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Establishes the foundational state for the adventure, linking project paths, themes, and the configuration database.</li>
<li><code class="inline-code">exploreQuest</code>: Facilitates execution or progress display based on user input while employing validation and execution caching mechanisms.</li>
<li><code class="inline-code">generateQuestContent</code>: Dynamically generates detailed quest content by analyzing the project context and utilizing AI.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This function sets up the adventure by integrating settings such as project information, the chosen theme, and additional configuration data.</li>
<li>By dynamically generating both the overarching narrative and its component quests, this function ensures seamless integration of AI-driven content.</li>
<li>The use of <code class="inline-code">mergeQuestFilesFromConfig</code> allows any external configuration to refine the generated quests.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Handles user inputs for quests, distinguishing between progress queries and specific quest executions.</li>
<li>Demonstrates input validation and quest lookup through ID, title, or numeric reference.</li>
<li>The <code class="inline-code">createNotFoundResult</code> ensures graceful feedback when no valid quest is found.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async generateQuestContent(quest: Quest): Promise&lt;QuestContent&gt; {
  let codeContent: string;
  
  if (quest.codeFiles &amp;&amp; quest.codeFiles.length &gt; 0 &amp;&amp; this.state.projectPath) {
    try {
      codeContent = await repoAnalyzer.generateTargetedContent(this.state.projectPath, quest.codeFiles, false);
    } catch (error) {
      console.warn(`Failed to generate targeted content:`, error);
      codeContent = this.state.projectInfo!.repomixContent;
    }
  } else {
    codeContent = this.state.projectInfo!.repomixContent;
  }

  const questPosition = this.state.quests.findIndex(q =&gt; q.id === quest.id) + 1;
  const totalQuests = this.state.quests.length;

  return await this.storyGenerator.generateQuestContent(quest, this.state.currentTheme!, codeContent, questPosition, totalQuests);
}
</code></pre>
<ul>
<li>Dynamically creates detailed quest content by analyzing specified or fallback code files.</li>
<li>Integrates targeted content analysis for deep, context-aware quest narratives.</li>
<li>Error handling redirects generation to global repository context if specified files fail.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üîß <em>Pro Tip</em>: Try modifying the <code class="inline-code">adventure.config.json</code> file to see how it affects the generated quest content.</li>
<li>üåÄ <em>Exploration Reminder</em>: Look closely at the mechanisms for merging and enforcing configurations in <code class="inline-code">initializeAdventure</code>.</li>
<li>üí° <em>Next Steps</em>: Start probing the <code class="inline-code">story-generator</code> to uncover how narratives and adventure content are forged in the depths of the codebase.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>You&#39;ve successfully ignited the cosmic drive of ingenuity, propelling your mission forward at warp speed‚Äîstellar progress on Quest 2, Captain! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>