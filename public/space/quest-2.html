<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Stellar Quest Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Codebase Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Stellar Quest Engine</h1>
<hr>
<p>The <strong>Starship Repo Voyager</strong> has entered the &quot;Aetherial Quadrant,&quot; a region of the codebase galaxy teeming with volatile logic streams and concealed functionality clusters. Here lies the Stellar Quest Engine, the subsystem responsible for orchestrating the heroic efforts of the ship&#39;s crew. However, interference from improperly indexed data nebulae is halting your progress. Your mission is to navigate unstructured cosmic pathways and stabilize the quest framework within the Stellar Engine. Calibrate the engine to ensure smooth interstellar exploration and efficient quest-to-quest navigation for future missions!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Engine Calibration</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> ensure the engine loads quests with the correct theme and project data? </li>
<li>‚ö° <strong>Quest Navigator</strong>: What logic does <code class="inline-code">AdventureManager.exploreQuest</code> use to find and execute the right quest, and how does it handle user input variations?</li>
<li>üõ°Ô∏è <strong>Cache Shield</strong>: How does <code class="inline-code">AdventureManager.executeQuest</code> utilize cached content to optimize execution and avoid redundant resource consumption?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> The backbone of quest management</h3>
<p>This file houses the <strong>AdventureManager</strong> class, the pivotal subsystem responsible for initializing and managing all active quests. It powers core functionalities such as the generation of quests, validation of inputs, and execution leveraging cached content for optimization. Additionally, its companion class, <strong>AdventureState</strong>, maintains the engine&#39;s current status and progress indicators.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets the engine state, generates the story narrative and quests, and adjusts configurations according to the project path and selected theme. </li>
<li><code class="inline-code">exploreQuest</code>: Interprets user input to identify and execute the specified quest, including validation against the adventure&#39;s current state.</li>
<li><code class="inline-code">executeQuest</code>: Handles the content generation, caching, and completion marking of active quests while addressing any quest prerequisites.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  
  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This function recalibrates the <strong>Stellar Quest Engine</strong> for a new tale by resetting prior states, importing project and theme data, and ensuring configurations align with the project&#39;s context. </li>
<li>It employs external systems (<code class="inline-code">mergeQuestFilesFromConfig</code>) to integrate file references from the configuration, which enhances modularity.</li>
<li>This method also ensures robustness through the validation of theme-related input.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  // Check if this is a progress request
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  // Find the quest based on the choice
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  // Execute the quest
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Acting as the ship&#39;s <strong>Navigator</strong>, it interprets user input (e.g., quest names, numbers, or key terms) to locate and execute corresponding quests. </li>
<li>It validates the integrity of the choice and distinguishes between content exploration and progress inquiries, ensuring seamless interactivity.</li>
<li>By outsourcing quest identification to <code class="inline-code">findQuest</code>, the function separates concerns and upholds maintainability.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async executeQuest(quest: Quest): Promise&lt;AdventureResult&gt; {
  // Validate prerequisites
  this.validateQuestPrerequisites();

  let content: QuestContent;
  let summary: string;

  // Check if quest content is already cached (completed quest)
  const cached = this.state.questContentCache.get(quest.id);
  if (cached) {
    // Use cached content - no LLM calls needed  
    console.log(`üîÑ Retrieving completed quest from cache...`);
    
    // Add a small delay to make the loading feel more natural
    await new Promise(resolve =&gt; setTimeout(resolve, 500));
    
    content = cached.content;
    summary = cached.summary;

    // Add visual indicator that this is cached content
    content = {
      ...content,
      adventure: `üîÑ **[REVISITING COMPLETED QUEST]**\n\n${content.adventure}`
    };
  } else {
    // Generate new quest content (LLM call)
    console.log(`üéØ Generating new content for quest: ${quest.title}`);
    content = await this.generateQuestContent(quest);
    
    // Generate completion summary (LLM call)
    summary = await this.generateCompletionSummary(quest);
    
    // Cache the content for future access
    this.state.questContentCache.set(quest.id, { content, summary });
  }
  
  // Mark as completed (or update completion if revisiting)
  this.markQuestCompleted(quest);

  // Return formatted result
  return this.createQuestResult(content, summary);
}
</code></pre>
<ul>
<li>This critical system component showcases efficient resource utilization through content caching, ensuring redundant operations and excessive LLM calls are avoided.</li>
<li>Provides helpful user feedback when revisiting completed quests, reinforcing narrative immersion in the <strong>cosmic journey</strong>.</li>
<li>It adheres to the adventure&#39;s overarching structure by marking quests completed only after their definitive execution.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Before initiating quest exploration, ensure that the entire configuration (<code class="inline-code">adventure.config.json</code>) aligns with the intended scope.</li>
<li>Investigate the interaction between <code class="inline-code">executeQuest</code> and <code class="inline-code">generateQuestContent</code> to understand the modular design for LLM calls.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the cosmic codebase.</p>
<p>Mission accomplished! üöÄ You&#39;ve ignited the Stellar Quest Engine and charted a brilliant 20% of your intergalactic journey‚Äîforward to the stars, Commander! ‚≠êüåü</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>