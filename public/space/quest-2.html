<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Generating Cosmic Missions - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Adventures Across the Codeverse</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Generating Cosmic Missions</h1>
<hr>
<p>Aboard the starship <em>Infinity Loop</em>, the crew prepares to embark on their next cosmic mission across the Codeverse. Their goal: to decipher stellar algorithms and unlock quests hidden within fragments of code scattered across the galaxy. The starship&#39;s engines hum, powered by intricate configurations and dynamic story generators. As the crew delves into the uncharted depths, they face the challenge of transforming raw code structures into flowing narratives that unravel the secrets of their digital universe. Exploration and ingenuity are key to charting new pathways in this cosmic odyssey.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Mission Deployment</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> organize the starship&#39;s setup and prepare its systems for a new mission?</li>
<li>‚ö° <strong>Story Generation Flow</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> bring narratives to life from the underlying project context?</li>
<li>üõ°Ô∏è <strong>Configuration Mapping</strong>: How does <code class="inline-code">parseAdventureConfig</code> integrate the adventure configuration into functional outputs for quests?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Starship Mission Commander</h3>
<p>The <code class="inline-code">AdventureManager</code> class acts as the captain of the starship <em>Infinity Loop</em>, actively managing missions and quests, and interfacing between the crew and the code galaxy. With methods like <code class="inline-code">initializeAdventure</code>, it dissipates the chaos of the Codeverse into structured adventures. Its internal state tracks progress, caches completed quests, and directs journey updates.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Prepares the starship&#39;s mission by resetting the state, setting themes, and generating quests from project info.</li>
<li><code class="inline-code">exploreQuest</code>: Executes chosen quests, validating user input and finding the relevant quest or handling progress inquiries.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Integrates configuration files into quests, ensuring project-specific adventures remain aligned with predefined parameters.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Cosmic Story Architect</h3>
<p>The <code class="inline-code">StoryGenerator</code> class is the engine behind the cosmic narrative, shaping structured quests and delivering dynamic stories. Powered by the Codeverse&#39;s stellar content, it generates legends that guide the crew&#39;s journey.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Generates stories and quests using LLMs, aligning themes with code context for immersive exploration.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Converts raw markdown from LLM responses into a structured <code class="inline-code">StoryResponse</code>.</li>
<li><code class="inline-code">generateQuestContent</code>: Builds detailed quest explorations, tying specific code files to narrative and thematic goals.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Stellar Configuration Hub</h3>
<p>This module acts as the navigational guide, processing and parsing the starship&#39;s adventure config. With its functions, it extracts structured insight from project directories, enabling high-precision mission integration.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses adventure configuration files, turning raw JSON into usable objects for quests.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies and validates unique file paths in the config, refining targeted mission scopes.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Transforms adventure config into a compact format optimized for LLM-driven generation.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Resets the adventure state for a clean slate on new missions.</li>
<li>Configures project and theme, extending custom themes when applicable.</li>
<li>Dynamically generates stories and quests based on the project&#39;s context.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;

  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;

  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;

  const configQuestFiles = new Map&lt;string, string[]&gt;();
  for (const configQuest of adventure.quests) {
    if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {
      const filePaths = configQuest.files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
      if (filePaths.length &gt; 0) {
        configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);
      }
    }
  }

  return quests.map((quest, index) =&gt; {
    const configQuests = adventure.quests;
    if (index &lt; configQuests.length &amp;&amp; configQuests[index].files) {
      const files = configQuests[index].files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
      return { ...quest, codeFiles: files };
    }

    const questTitleLower = quest.title.toLowerCase();
    for (const [configTitle, files] of configQuestFiles.entries()) {
      if (questTitleLower.includes(configTitle) || configTitle.includes(questTitleLower)) {
        return { ...quest, codeFiles: files };
      }
    }
    return quest;
  });
}
</code></pre>
<ul>
<li>Integrates adventure config files into quest generation for precise contextual relevance.</li>
<li>Matches quest titles across configuration entries to ensure alignment with project specifics.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Tracks progress using percentage calculation for completed quests.</li>
<li>Provides insights for milestone updates and mission depth.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses configuration files into usable JSON structures for missions.</li>
<li>Handles safely missing or malformed JSON inputs.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Extracts and validates unique file paths for mission targeting.</li>
<li>Ensures only relevant and existing files are utilized in story generation.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;
  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;

    const functions = quest.files.flatMap((f: any) =&gt; f.highlights || []).map((h: any) =&gt; h.name).filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Optimizes adventure configuration for concise LLM inputs.</li>
<li>Reduces verbosity, focusing on structured connections between files and quests.</li>
</ul>
<hr>
<p>Helpful Hints</p>
<ul>
<li>üåå <strong>Exploration Tip</strong>: Utilize <code class="inline-code">progressPercentage</code> to benchmark mission success rates across quests.</li>
<li>üõ†Ô∏è <strong>Development Advice</strong>: When debugging quest setups, check <code class="inline-code">mergeQuestFilesFromConfig</code> integration.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>üöÄ Stellar work navigating the cosmos of creativity‚ÄîQuest 2 complete, and your mission trajectory is shining brighter than a supernova at 20% completion! ‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>