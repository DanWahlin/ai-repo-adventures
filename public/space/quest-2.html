<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Chart the Narrative Galaxy - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Odyssey: The Codex of Knowledge</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Chart the Narrative Galaxy</h1>
<hr>
<p>In the vast expanse of the Narrative Galaxy, the <strong>Codex</strong> starship zips through swirling clouds of data and star clusters of unorganized code. In the wake of a completed mission, your next task is to chart the galaxy of dynamic storytelling engines. Your goal is to navigate the core of quest generation and find the keystones of the engine that powers interactive adventures for galactic travelers. Activate your scanners and dive into the star maps of code to unlock the secrets of adaptive storytelling.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Starship Compass</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> ensure the setup of the project context, theme selection, and quest creation?</li>
<li>‚ö° <strong>Galactic Routes</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> coordinate project content and theme to produce a structured narrative and quests?</li>
<li>üõ°Ô∏è <strong>Signal Shielding</strong>: What mechanisms does <code class="inline-code">loadAdventureConfig</code> offer to handle missing, incorrect, or corrupted configuration files?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Core adventure management system</h3>
<p>The <code class="inline-code">AdventureManager</code> orchestrates the creation of dynamic adventures by setting up the adventure configuration, selecting themes, and generating quests through the integration of storytelling components. This class acts as the mission command center, seamlessly combining data and code structure to offer tailored adventures. Of particular interest are the methods responsible for initializing the adventure context, resolving user-selected quests, and caching quest content for performance.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Configures the adventure by resetting the state, setting project context, choosing themes, and creating quests with dynamic file mappings.</li>
<li><code class="inline-code">exploreQuest</code>: Handles user-selected quests, implements validation for inputs, retrieves cached quests, or generates new content dynamically.</li>
<li><code class="inline-code">state.progressPercentage</code>: A computed property measuring and returning adventure completion progress as a percentage.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  // Merge files from adventure config into quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  
  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Resets the current state to ensure a clean slate for newly generated quests.</li>
<li>Dynamically merges file paths from the configuration into generated quests.</li>
<li>Makes use of an AI-based generator <code class="inline-code">generateStoryAndQuests</code> for narrative creation.</li>
<li>Enforces strict quest generation rules based on the presence or absence of configuration files.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  // Check if this is a progress request
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  // Find the quest based on the choice
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  // Execute the quest
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Sanitizes user input with <code class="inline-code">validateAndSanitizeChoice</code> to prevent invalid selections.</li>
<li>Identifies progress-specific requests to return adventure statistics.</li>
<li>Uses dynamic content creation (<code class="inline-code">executeQuest</code>) or a fallback retrieval of cached adventures for responsiveness.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Calculates completion as a percentage based on the total number of quests.</li>
<li>Prevents <code class="inline-code">NaN</code> scenarios by checking division readiness.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Configuration management</h3>
<p>This module provides a robust toolkit for reading, parsing, and extracting adventure configuration data. Its functions ensure the smooth handling of <code class="inline-code">adventure.config.json</code>, gracefully dealing with missing or invalid files while extracting critical data. It supports the alignment of quests and their associated file mappings within the broader narrative galaxy.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Attempts to read the raw adventure configuration; returns <code class="inline-code">null</code> on failures.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Converts file content into structured JSON data and validates it.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses configuration data to extract only valid, distinct paths for anticipated quest files.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Loads the <code class="inline-code">adventure.config.json</code> if it exists.</li>
<li>Protects against file-related failures by returning <code class="inline-code">null</code> for inaccessible paths.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Transforms raw configuration files into JSON objects for further processing.</li>
<li>Implements error handling to gracefully manage corrupt or ill-formed files.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Builds a unique set of valid file paths found within the adventure configuration.</li>
<li>Validates each path by checking its existence on the file system.</li>
<li>Uses depth traversal to locate all <code class="inline-code">path</code> fields, enabling a robust file extraction pattern.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Start Small</strong>: Begin with understanding how themes are applied using <code class="inline-code">initializeAdventure</code> before diving into quest dynamics.</li>
<li><strong>Validate Inputs</strong>: Investigate how the system prevents invalid configurations.</li>
<li><strong>Trace Execution</strong>: Follow the flow of code in <code class="inline-code">generateStoryAndQuests</code> to decode the narrative galaxy generation process.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries hidden in the galactic archive.</p>
<p>Mission accomplished, Star Navigator‚ÄîQuest 2 is complete! You‚Äôve charted the narrative galaxy with cosmic brilliance, earning stellar momentum for the epic journey ahead! ‚≠êüöÄüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>