<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Quest Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Code Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Quest Generation Engine</h1>
<hr>
<p>The <strong>Nebula Architect</strong> is now poised at the heart of the Andromeda Cluster‚Äôs maze-like data nebula, where encrypted configurations pulsate in cosmic harmony. Your next mission is no small challenge: decrypt the mechanisms of the <strong>Quest Generation Engine</strong>, which serves as the core navigational beacon for this repository. The engine‚Äôs stellar algorithms govern how quests are mapped and how starpath narratives unfold. Decoding its layered files will illuminate the constellations of your own intergalactic code pipeline, steering the galaxy into a brighter age of adventure.</p>
<p>Brace yourself, as the files ahead may reveal both the brilliance of the coded stars and the turbulence of their arrangement. Your mission, explorer, is to unveil the systemic magic operating beneath the cosmic tapestry and ensure everything is primed for stellar harmony.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Engine Activation</strong>: How does <code class="inline-code">AdventureManager</code> initialize quests to adapt to different project themes and configurations?</li>
<li>‚ö° <strong>Quest Mapping</strong>: Which mechanisms are used by <code class="inline-code">StoryGenerator</code> to parse and generate adventures based on repository context? </li>
<li>üõ°Ô∏è <strong>Config Safeguards</strong>: How does <code class="inline-code">adventure-config.ts</code> ensure the extraction of valid file paths and structured configurations while handling errors gracefully?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Managing Galactic Quests</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file is the operational heart of the quest generation system, managing state, initializing adventures, validating input, and executing individual quests. It also dynamically integrates loosely defined files based on configuration, evolving the codebase exploration paths adaptively. Through core methods like <code class="inline-code">initializeAdventure</code> and <code class="inline-code">exploreQuest</code>, it becomes the backbone of interstellar narrative progression and user engagement.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: This function resets the adventure context, sets configurations such as project info and theme, and uses <code class="inline-code">StoryGenerator</code> to create stories and quests dynamically. </li>
<li><code class="inline-code">exploreQuest</code>: Executes or retrieves data for a specific quest based on user input, refining input validation and ensuring continuity in quest progression.</li>
<li><code class="inline-code">progressPercentage</code>: Dynamically calculates the completion percentage by comparing finished quests to total available.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Crafting Cosmic Narratives</h3>
<p>The <code class="inline-code">story-generator.ts</code> file orchestrates the generation and parsing of stories and quests using a combination of markdown parsing and AI response. It‚Äôs mission-critical for dynamic quest creation and ensuring deeply engaging thematic adventures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Converts repository content into thematic stories and associated quests using AI prompts and content parsing workflows.</li>
<li><code class="inline-code">generateQuestContent</code>: Uses targeted repository data to generate quest-specific content, augmenting deeper LLM context integration.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Transforms AI markdown responses into structured <code class="inline-code">StoryResponse</code> objects, organizing titles, stories, and quests.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Star Maps</h3>
<p>This file focuses on reading and parsing the adventure configuration, ensuring file paths are correctly resolved, and formatting configurations for optimal LLM guidance. It enhances the consistency and integrity of quest-specific file exploration.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses the central JSON configuration for validation and use, ensuring the quest layout conforms to adventure guidelines.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts unique paths from configuration data to avoid redundant analysis and ensures only valid paths are included.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses configuration data into a format suited for efficient AI prompt generation.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);
  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>This code initializes the adventure by combining project context, thematic elements, and file-specific configurations.</li>
<li>Utilizes dynamic theming options with <code class="inline-code">customThemeData</code> to personalize quests.</li>
<li>Enhances functionality by integrating user-created configurations and AI-driven story generation.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>A lean example of dynamic content tracking, calculating quest progression as a percentage.</li>
<li>Highlights simplicity in managing user feedback and gamification.</li>
<li>Ensures user clarity about progression in the cosmic adventure.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  const response = await this.generateWithLLM(projectInfo, this.validateTheme(theme));
  this.currentStoryContent = response.story;
  return response;
}
</code></pre>
<ul>
<li>Validates themes and dynamically triggers the generation of repository-driven narratives.</li>
<li>Bridges structured repository data with AI responses, adapting the narrative to the user‚Äôs project.</li>
</ul>
<hr>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);
  const title = extractTitle(tokens);
  const quests: Quest[] = [];
  return { title, story: &#39;&#39;, quests }; // Simplified for key illustration
}
</code></pre>
<ul>
<li>Markdown parsing adapts AI responses into actionable quest data.</li>
<li>Displays how <code class="inline-code">marked</code> is employed to tokenize narrative streams.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses JSON-based adventure configurations for streamlined access to quest data.</li>
<li>Handles potential parsing errors cleanly for resilience.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const unique = new Set&lt;string&gt;();
  return Array.from(unique);
}
</code></pre>
<ul>
<li>Extracts and validates unique file paths to prevent redundancy in repository analysis.</li>
<li>Forms the backbone for detailing relevant repository contexts.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ∏ Key files to analyze during quest execution live inside the <code class="inline-code">packages/core/src/adventure</code> directory.</li>
<li>‚ú® Pay attention to how AI and JSON configurations converge to generate structured adventures.</li>
<li>üöÄ Use starship-generated quests as your guide to understanding modular code flows.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Quest 2: Quest Generation Engine is now complete‚Äîstellar work, Cadet! You&#39;ve ignited the thrusters on your cosmic journey, charting 25% of your starship&#39;s course toward intergalactic mastery! üíé‚≠êüöÄ</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>