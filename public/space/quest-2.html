<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Forging Stellar Adventures - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Odyssey: The Codebase Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Forging Stellar Adventures</h1>
<hr>
<p>As the <strong>SS Code Explorer</strong> accelerates deeper into the swirling chaos of the Code Nebula, you are tasked with refining and perfecting the starship&#39;s quest generation engine. This engine, the very core of your navigation, is the vessel’s means of building narrative journeys. The adventure unfolds as you delve into an intricate cluster of cosmic logic, boldly navigating the stellar streams of logic governing quests, their configurations, and dynamic storytelling. Stretch your ingenuity to stabilize these systems and uncover the celestial patterns behind their operations.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>🌌 <strong>Galactic Framework</strong>: How does the <code class="inline-code">AdventureManager.initializeAdventure</code> method organize initialization, resetting state, and integrating various modules to prepare the ship for new missions?</li>
<li>🚀 <strong>Orbit Mapping</strong>: What are the mechanisms by which <code class="inline-code">AdventureManager.exploreQuest</code> locates and executes specific quests, and how is quest caching implemented to improve efficiency?</li>
<li>🔧 <strong>Core Architectures</strong>: In the <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> function, how are custom themes and structured storytelling integrated into the starship’s quest engine?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Stellar Quest Control System</h3>
<p>This file contains the <code class="inline-code">AdventureManager</code> and <code class="inline-code">AdventureState</code>, the primary classes responsible for piloting the entirety of the quest generation and tracking mechanisms. These systems coordinate the initialization of new adventures, processes quest exploration, and manage core state transitions. Seamlessly weaving together the inputs from configuration files, logic validation, and generative story management, they ensure smooth stellar operations in the Code Nebula.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code> launches the foundational systems for a new adventure, integrating project context, themes, state resets, and even custom configurations.</li>
<li><code class="inline-code">exploreQuest</code> dynamically validates, retrieves, and executes quests, utilizing caching for revisits and a modular framework for handling diverse types of input.</li>
<li><code class="inline-code">progressPercentage</code> provides a simple mechanism for monitoring progress, crucial for evaluating the crew’s journey and stellar conquests.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  
  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This function resets all state variables within <code class="inline-code">AdventureState</code>, ensuring the pristine initialization of a new adventure.</li>
<li>Customizable thematics allow adventures to adopt unique storytelling dimensions.</li>
<li>Seamless integration with configuration data ensures coherent input validation and mission protocols.</li>
<li>LLM integration generates quest narratives dynamically, making each adventure adaptable to new and evolving code challenges.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  // Check if this is a progress request
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  // Find the quest based on the choice
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  // Execute the quest
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>The <code class="inline-code">exploreQuest</code> method dynamically identifies and executes quests based on the crew’s inputs, encapsulating validation and handling unrecognized commands with grace.</li>
<li>Use of the <code class="inline-code">state.questContentCache</code> ensures efficient revisits to completed cosmic missions, elevating computational performance.</li>
<li>Flow modularity enables selective expansions for additional quest retrieval mechanisms.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>A simple yet essential computation elegantly measures mission success against the total quest count within the adventure.</li>
<li>This ensures transparency for the Crew’s navigation decisions, assisting them in calibrating their course through the Code Nebula.</li>
<li>The modular design highlights clean state dependency without introducing unnecessary side effects.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Galactic Story Engineering</h3>
<p>This file is home to the <code class="inline-code">StoryGenerator</code> class, which dynamically constructs the creative backbone of your missions. Its functions process source material (e.g., repomix content and config files) and generate narrative structures in alignment with the selected themes. The storytelling logic transforms procedural code analysis into a seamless and engaging quest narrative.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code> synthesizes foundational stories and quests by leveraging large language models, custom themes, and configuration-driven cues.</li>
<li><code class="inline-code">generateQuestContent</code> delves deeper to create detailed, file-specific technical narratives and prepare focused content for quest explorations.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code> converts LLM markdown outputs into structured quest and story data, validating for accuracy and coherence.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Centralizes story creation around project metadata and selected themes, ensuring tailored, well-integrated storylines.</li>
<li>Validation of themes and configuration-based prompts ensure adaptability to a wide variety of settings and narratives.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const { quest, theme, codeContent, questPosition, totalQuests } = config;
  // Include formatted adventure config as context if available
  let adventureGuidance = &#39;&#39;;
  let customInstructions = &#39;&#39;;
  
  if (this.projectPath) {
    const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);
    if (formattedConfig) {
      adventureGuidance = formattedConfig;
    }
  }

  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    adventureGuidance: adventureGuidance || &#39;&#39;,
    questPosition,
    totalQuests
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );

  if (!response.content || response.content.trim() === &#39;&#39;) {
    throw new Error(&#39;LLM returned empty response for quest content&#39;);
  }

  return {
    adventure: response.content.trim(),
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<ul>
<li>Generates detailed content for individual quests by refining both code-driven and generative storytelling content to perfectly suit the selected theme.</li>
<li>Leveraging configurable LLM prompts, the system adapts deeply to scenarios from context-laden galaxy explorations to precise code insights.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">initializeAdventure</code> as your guide for integrating high-level module systems into effective workflows.</li>
<li>Investigate <code class="inline-code">generateQuestContent</code> to observe how storytelling facets dynamically align with your galactic themes.</li>
<li>For further clarity, trace the caching mechanisms in <code class="inline-code">exploreQuest</code>.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission accomplished, Commander—Quest 2: Forging Stellar Adventures is complete, and your stellar progress has ignited the thrusters for a radiant journey to the stars! 🚀⭐⚡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">← Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>