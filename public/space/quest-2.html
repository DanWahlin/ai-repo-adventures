<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Quest Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Odyssey of the Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Quest Generation Engine</h1>
<hr>
<p>The <em>Codex Voyager</em> navigates through a swirling nebula of data streams, its mission to decode the mysteries of automation and storytelling within the vast, uncharted expanses of repository frameworks. As the glowing panels hum with activity, the ship&#39;s onboard algorithms direct you to the heart of its Quest Generation Engine. It&#39;s here where stories are forged and quests come to life, shaped by the stellar logic of interwoven systems. To understand this process is to grasp the core of your starship‚Äôs exploratory essence. </p>
<p>Prepare yourself, adventurer! The engine whirs‚Äîit‚Äôs time to delve into the code that powers your journey. Are you ready to explore the heart of the <em>Quest Generation Engine</em>?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Adventure Initialization</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> orchestrate the setup of themes, quests, and project context?  </li>
<li>‚ö° <strong>Dynamic Quest Execution</strong>: What logic enables <code class="inline-code">AdventureManager.exploreQuest</code> to validate choices and execute the correct quest?  </li>
<li>üõ°Ô∏è <strong>Content Management Systems</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> handle the creation of adventures and integrate with external systems for structured storytelling?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Managing Adventure State</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file serves as the central command for initializing and executing adventures within the framework. It connects with data repositories and orchestrates interactions with the story generator, ensuring the seamless creation and progression of coding quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Sets up the adventure context, merges configuration details, and delivers the narrative and available quests.</li>
<li><code class="inline-code">exploreQuest</code>: Validates user selections, identifies the correct quest, and manages the execution of new or cached quest content.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Tracks and calculates the percentage of completed quests, offering real-time progress updates.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Forging Stellar Stories</h3>
<p>The <code class="inline-code">story-generator.ts</code> file is the narrative powerhouse of the system. It defines how quests, adventures, and stories are dynamically created using external LLMs (large language models) while adhering to provided themes and guidance.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Combines the project context with the selected theme, creates overarching narratives, and produces quests with contextually linked files.</li>
<li><code class="inline-code">generateQuestContent</code>: Crafts the detailed exploration content for individual quests, leveraging both general and targeted configurations.</li>
<li><code class="inline-code">generateCompletionSummary</code>: Synthesizes a personalized summary upon quest completion, emphasizing mission progress and adherence to thematic tone.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration &amp; Context Utilities</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file handles the parsing, validation, and formatting of adventure-specific configuration stored in <code class="inline-code">adventure.config.json</code>. These utilities ensure that generated quests align with project-specific requirements.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses and validates the JSON configuration file to extract quest metadata and structural information.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies all referenced files within the configuration and ensures validity by cross-referencing the project path.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Simplifies the configuration for use in LLM generation prompts, optimizing textual brevity and relevance.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset(); 
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);
  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Resets the state to accommodate new adventures, ensuring no residual data interferes. </li>
<li>Dynamically generates new narrative content and quests using themes and project-related configurations.</li>
<li>Incorporates optional files from project-specific configurations to enrich quest data.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }
  
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates user input and identifies if the request is for progress or quest execution.</li>
<li>Dynamically associates the choice with quests by title, number, or ID, enhancing usability.</li>
<li>Executes quests while handling caching for previously completed ones.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Provides real-time feedback on progress by calculating completed quests relative to the total number of quests.</li>
<li>Ensures players stay engaged by offering clear indicators of mission success rates.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Validates input for consistent thematic integrity and integrates project context.</li>
<li>Leverages LLM technology to dynamically construct meaningful stories and quests anchored in the selected theme.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  codeContent: string,
  questPosition?: number,
  totalQuests?: number
): Promise&lt;QuestContent&gt; {
  let adventureGuidance = &#39;&#39;;
  let customInstructions = &#39;&#39;;

  if (this.projectPath) {
    const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);
    if (formattedConfig) {
      adventureGuidance = formattedConfig;
    }
    const customInstructionsFromConfig = extractCustomInstructions(this.projectPath);
    if (customInstructionsFromConfig) {
      customInstructions = customInstructionsFromConfig;
    }
  }

  const prompt = loadQuestContentPrompt({
    theme, adventureTitle: quest.title, codeContent, 
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    adventureGuidance: adventureGuidance || &#39;&#39;, customInstructions
  });

  const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST });
  
  return { 
    adventure: response.content.trim(), 
    fileExploration: &#39;&#39;, 
    codeSnippets: [], 
    hints: [] 
  };
}
</code></pre>
<ul>
<li>Merges content from configured files across multiple sources for maximum contextual relevance.</li>
<li>Uses sophisticated prompt loading to maximize storytelling flexibility while maintaining efficiency.</li>
<li>Delivers a modularized quest structure suited to real-time exploration.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateCompletionSummary(
  quest: Quest,
  theme: AdventureTheme,
  progress: number,
  total: number
): Promise&lt;string&gt; {
  const percentComplete = Math.round((progress / total) * 100);
  
  const prompt = loadCompletionPrompt({
    themeDescription: theme, 
    adventureTitle: quest.title, 
    progress, total, percentComplete
  });

  const response = await this.llmClient.generateResponse(prompt);
  return response.content.trim();
}
</code></pre>
<ul>
<li>Synthesizes summaries based on quest completions, adhering to thematic guidelines for consistent tone.</li>
<li>Generates personalized progress indicators to enhance user engagement.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses raw JSON configuration for integration with the Quest Generation Engine to ensure adventures align with repository metadata.</li>
<li>Employs robust error-catching mechanisms for invalid configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];
  while (stack.length) {
    const node = stack.pop();
    if (typeof node.path === &#39;string&#39; &amp;&amp; fs.existsSync(path.resolve(projectPath, node.path.trim()))) {
      unique.add(node.path.trim());
    }
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; stack.push(child));
  }
  return Array.from(unique);
}
</code></pre>
<ul>
<li>Recursively extracts file paths based on <code class="inline-code">adventure.config.json</code> entries to identify dependencies for quest generation.</li>
<li>Ensures that paths are validated and deduplicated, avoiding redundant file reads.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;
  
  let formatted = `## Quest Structure\n`;
  for (const quest of (parsed as any).adventure.quests) {
    formatted += `### ${quest.title}\nFiles: ${quest.files.map((f: any) =&gt; f.path).join(&#39;, &#39;)}\n`;
  }
  return formatted;
}
</code></pre>
<ul>
<li>Simplifies configuration for integration into prompts by removing extraneous details.</li>
<li>Optimizes data structure for large-scale processing in LLM engines, ensuring minimal overhead.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ† When exploring the <code class="inline-code">AdventureManager</code> class, examine how caching is implemented for efficiency in quest execution.</li>
<li>üöÄ In <code class="inline-code">StoryGenerator</code>, focus on how the partnership between LLM prompts and configuration data shapes the generated stories.</li>
<li>üîé Look for reusable patterns in <code class="inline-code">adventure-config.ts</code> to understand how file paths are structured.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission Control, this is Star Learner‚Äî‚ÄòQuest 2: Quest Generation Engine‚Äô has been successfully completed, propelling us 20% closer to the galactic frontier; keep aiming for the stars, Commander! üöÄ‚ú®üíéüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>