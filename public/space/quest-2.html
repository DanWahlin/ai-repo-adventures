<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Quest Generation Engine Programming - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Repository Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Quest Generation Engine Programming</h1>
<hr>
<p>In the swirling cosmic void, a sector of Codex Prime&#39;s sprawling repository pulses with enigmatic signals. This sector, designated as the &quot;Quest Generation Engine,&quot; is the heart of the cybernetic repository. The starship <em>CodeSeeker</em> has been tasked to uncover its secrets‚Äîan amalgamation of orchestration code, adaptive storytelling algorithms, and dynamic questing utilities. These programs breathe life into adventures. Can you and your crew decode the engine‚Äôs operations to wield the power of interstellar content generation?</p>
<h3>Adventure Awaits! Let your programming dexterity guide you through mysteries of the Quest Engine.</h3>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>System Initialization Protocols</strong>: How does the <code class="inline-code">AdventureManager</code> synchronize project information, configure themes, and generate the storyline and quests during initialization?</li>
<li>‚ö° <strong>Quest Execution Dynamics</strong>: How does the <code class="inline-code">exploreQuest</code> method validate choices, locate quests, and execute their logic? What caching mechanisms enhance performance during revisits?</li>
<li>üõ°Ô∏è <strong>Configuration Integration</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function support extracting and adapting file paths for the adventure engine?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Key orchestrations and state handling</h3>
<p>This file is the central command module for managing adventures within the <em>CodeSeeker</em> system. It handles everything from initializing themes to dynamically loading and executing quests. At its core is the <code class="inline-code">AdventureManager</code> class, which interacts with the <code class="inline-code">StoryGenerator</code> to produce storylines based on project data. This file also integrates with the repository&#39;s configuration and caching mechanisms.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets the system to load project context, themes, and quests from configuration to establish a new adventure.</li>
<li><code class="inline-code">exploreQuest</code>: Validates and executes a chosen quest, handles cached quests for efficiency, and integrates result summaries.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Tracks quest progress as a simple percentage metric for user-visible progression feedback.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Initializes the adventure engine by resetting state and reading project-specific context.</li>
<li>Interfaces with <code class="inline-code">StoryGenerator</code> to produce story content with theming options.</li>
<li>Integrates with configuration to limit quest count and adjust file mappings.</li>
<li>By dynamically assembling configuration rules and generated quests, the function enables personalized adventures across diverse codebases.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Parses the quest choice using <code class="inline-code">validateAndSanitizeChoice</code>, ensuring secure inputs.</li>
<li>Differentiates &quot;progress requests&quot; from executable quests, offering story progress updates as needed.</li>
<li>Employs caching mechanisms for completed quests, accelerating revisits without re-fetching content.</li>
<li>Incorporates adaptive execution for personalized outcomes.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Calculates the current percentage of completed quests relative to total available.</li>
<li>Provides user-friendly metrics to guide adventure milestones.</li>
<li>Ensures efficiency by auto-updating through the reactive <code class="inline-code">quests</code> and <code class="inline-code">completedQuests</code> data points.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration parsing and handling</h3>
<p>This file parses and processes <code class="inline-code">adventure.config.json</code>, enabling project-specific guidance for available quests and code files. By consolidating and performing JSON parsing, data extraction, and validation, it becomes integral to adapting storytelling efficiently.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Loads and parses the configuration to ensure valid JSON and access its contents as structured data.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts valid and unique file paths from the configuration, enabling meaningful quest scope filtering.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Decodes adventure configuration in JSON format while handling errors gracefully.</li>
<li>Forms the basis for quest-specific context extraction (e.g., code files and highlights).</li>
<li>Fulfills the modular extraction of reusable configuration objects vital to context-driven storytelling.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses the nested configuration objects to identify referenced file paths.</li>
<li>Verifies the existence of files within the project path to ensure reliability.</li>
<li>Structures results as a unique and consistent collection for quest file contexts.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>ü™ê When initializing a new adventure in <code class="inline-code">AdventureManager</code>, notice the interplay between <code class="inline-code">StoryGenerator</code> and the quest configuration‚Äîhow context-driven generation enhances variety.</li>
<li>üß≠ Explore error handling in <code class="inline-code">parseAdventureConfig</code> to understand missing or invalid file cases. Quest resilience depends on adaptive mechanisms here.</li>
</ul>
<hr>
<p>Embark on this stellar programming endeavor, adventurer! The Quest Generator awaits your ingenuity.</p>
<p>Your cosmic courage has ignited stellar success, programming the Quest Generation Engine‚Äîprepare for lightspeed to glory at 20% mission completion! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>