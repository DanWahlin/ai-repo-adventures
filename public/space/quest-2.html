<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Generating Stellar Adventures - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Journey to the Andromeda Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Generating Stellar Adventures</h1>
<hr>
<p>As a key engineer aboard the <em>AIA Explorer</em>, your latest challenge illuminates before you like a nebula bursting into view. The Andromeda Codebase is dense and untamed, and your task is to map its chaos into an interactive and structured sequence of quests. You will use advanced Long-Lived Machina (LLM) tools onboard to generate dynamic storylines for developers seeking meaningful adventures among lines of code. The <em>Quest Generation Engine</em> is your focus‚Äîensuring the interplay between narrative and code is seamless.</p>
<p>Prepare your systems, study the deep algorithms of the <strong>Adventure Manager</strong> and the <strong>Story Generator</strong>, and embark on a mission where the essence of storytelling meets code clarity.</p>
<h2>Quest Objectives</h2>
<p>As you explore the files below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Cosmic Initialization</strong>: How does the <code class="inline-code">AdventureManager</code> use project metadata and themes to structure new adventures in <code class="inline-code">initializeAdventure</code>?</li>
<li>‚ö° <strong>Quest Navigation</strong>: What is the process flow in <code class="inline-code">exploreQuest</code>, and how are quest execution and validation intertwined with user input?</li>
<li>üõ°Ô∏è <strong>Narrative Validation</strong>: How do <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> and <code class="inline-code">parseMarkdownToStoryResponse</code> ensure markdown consistency and quest integrity?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Managing Galactic Adventures</h3>
<p>The <code class="inline-code">AdventureManager</code> class orchestrates the creation of adventures, from resetting their state to generating quests and processing user input. It is vital in combining user choices with codebase insights to deliver an interactive experience across the Andromeda Codebase.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Sets up an adventure with a project&#39;s context, selects a theme, and integrates quests by leveraging the <strong>Long-Lived Machina</strong>.</li>
<li><code class="inline-code">exploreQuest</code>: Executes a specific quest by validating user input and generating results, caching quests for future reference.</li>
<li><code class="inline-code">generateQuestContent</code>: Dynamically creates quest details by analyzing key files and repo configurations, ensuring relevance and depth.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Crafting the Cosmic Narrative</h3>
<p>This file houses the <strong>StoryGenerator</strong> class, responsible for converting code insights and themes into structured storylines and quests. It merges user-picked themes with analyzed code to ensure the adventure feels relevant and immersive.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Central to generating the overarching adventure, this method uses the Long-Lived Machina and showcases how thematic inputs evolve into multi-quest configurations.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Parses markdown story descriptions to extract details about titles, quests, and their respective descriptions.</li>
<li><code class="inline-code">generateQuestContent</code>: A critical function for generating individual quest content aligned with adventure themes.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Initializes the adventure by resetting the <code class="inline-code">AdventureState</code> and setting up themes and project details.</li>
<li>Calls the <code class="inline-code">StoryGenerator</code> to create a storyline and quests, ensuring thematic alignment.</li>
<li>Merges code-contextual files for quests using configuration, improving relevance based on user settings.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates user choices for quests and identifies matching quests.</li>
<li>Uses <code class="inline-code">isProgressRequest</code> to handle progress-related queries.</li>
<li>If a valid quest is found, calls <code class="inline-code">executeQuest</code> to retrieve or generate its results.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async generateQuestContent(quest: Quest): Promise&lt;QuestContent&gt; {
  let codeContent: string;
  if (quest.codeFiles &amp;&amp; quest.codeFiles.length &gt; 0 &amp;&amp; this.state.projectPath) {
    try {
      codeContent = await repoAnalyzer.generateTargetedContent(
        this.state.projectPath,
        quest.codeFiles,
        false
      );
    } catch (error) {
      console.warn(&#39;Falling back to full content due to error:&#39;, error);
      codeContent = this.state.projectInfo!.repomixContent;
    }
  } else {
    codeContent = this.state.projectInfo!.repomixContent;
  }

  const questPosition = this.state.quests.findIndex(q =&gt; q.id === quest.id) + 1;
  const totalQuests = this.state.quests.length;

  return await this.storyGenerator.generateQuestContent({
    quest,
    theme: this.state.currentTheme!,
    codeContent,
    questPosition,
    totalQuests
  });
}
</code></pre>
<ul>
<li>Dynamically analyzes code linked to a quest by targeting specific files if available.</li>
<li>Leverages the <code class="inline-code">repoAnalyzer</code> for deeper insights into the project.</li>
<li>Calculates quest position to guide the user through the adventure sequence smoothly.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  const repomixContent = projectInfo.repomixContent || &#39;No content available&#39;;
  const adventureGuidance = formatAdventureConfigForPrompt(projectPath || &#39;&#39;);
  const prompt = loadStoryGenerationPrompt({ 
    theme, 
    repomixContent, 
    adventureGuidance 
  });

  const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY });
  const parsed = parseMarkdownToStoryResponse(response.content.trim());
  StoryResponseSchema.parse(parsed);

  this.currentStoryContent = parsed.story;
  return parsed;
}
</code></pre>
<ul>
<li>Creates a prompt incorporating project data and configuration.</li>
<li>Uses the <code class="inline-code">LLMClient</code> to request a story generation response.</li>
<li>Extracts and validates structure using <code class="inline-code">parseMarkdownToStoryResponse</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);
  const title = extractTitle(tokens);
  let story = &#39;&#39;;
  const quests: Quest[] = [];

  let currentSection = &#39;&#39;;
  let currentQuest: Partial&lt;Quest&gt; = {};

  tokens.forEach(token =&gt; {
    if (token.type === &#39;heading&#39;) {
      if (token.depth === 1) currentSection = &#39;story&#39;;
      if (token.depth === 3 &amp;&amp; currentSection === &#39;quests&#39;) {
        if (currentQuest.title &amp;&amp; currentQuest.description) {
          quests.push(createQuest(currentQuest, quests.length));
        }
        currentQuest = { title: token.text, description: &#39;&#39; };
      }
    } else if (token.type === &#39;paragraph&#39; &amp;&amp; currentQuest.title) {
      currentQuest.description += token.text;
    }
  });

  if (currentQuest.title) quests.push(createQuest(currentQuest, quests.length));
  return { title, story, quests };
}
</code></pre>
<ul>
<li>Processes markdown content into structured story data.</li>
<li>Extracts quest descriptions and code file details from tokens, ensuring reliable parsing.</li>
<li>Returns a <code class="inline-code">StoryResponse</code> object required for further adventures.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When debugging <code class="inline-code">initializeAdventure</code>, trace state updates to verify correct integration of quests and themes.</li>
<li>Use the output of <code class="inline-code">parseMarkdownToStoryResponse</code> to guarantee LLM consistency across generated quests.</li>
<li>For optimization, review how <code class="inline-code">generateQuestContent</code> uses <code class="inline-code">repoAnalyzer</code> and target files selectively.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission accomplished, cosmic trailblazer! Quest 2: &#39;Generating Stellar Adventures&#39; is now a brilliant star in your learning galaxy‚Äîkeep your thrusters blazing as you chart the course to interstellar mastery! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>