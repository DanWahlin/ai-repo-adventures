<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Galactic Story Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Adventures: The Codebase Chronicles</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Galactic Story Engine</h1>
<hr>
<p>The <strong>Codebreaker</strong>&#39;s mission brings you to the long-forgotten star cluster of Cygnus Prime, where fleeting pulsars and shadowy dark matter clouds conceal the truth. To unlock the <strong>Repository Core</strong>, your team must activate the ship’s powerful Story Engine. This enigmatic device uses cosmic data to generate quests and lore suitable for exploring uncharted regions. You will engage its subsystems, analyze decryption methods, and synchronize its logic circuits—but beware! Errors in the system could destabilize the quest continuum. </p>
<p><strong>Stellar navigation, crew intelligence, and code mastery are your tools. Adventure awaits in the boundless void of space!</strong></p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Manager Operations</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file is the neural hub of the <strong>Codebreaker’s</strong> mission. It contains the <code class="inline-code">AdventureManager</code> class, which orchestrates quest creation, selection, and progression. It depends heavily on <code class="inline-code">generateQuestContent</code> for producing dynamic quest data while integrating custom themes and specific files for mission relevance. The centric <code class="inline-code">AdventureState</code> tracks overall progress and caches results to accelerate repeated operations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: Initializes the galactic adventure, setting themes, project data, and quests.</li>
<li><code class="inline-code">AdventureManager.exploreQuest</code>: Executes a selected quest, validates progress, and checks completion.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Outputs mission progress as a percentage.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Adventure Configurator</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file manipulates the configuration data pivotal to customizing any galactic exploration mission. It primarily interacts with <code class="inline-code">adventure.config.json</code> to adjust quest files, formats, and highlights parsed configurations for optimal storytelling.</p>
<h4><span class="header-prefix">Highlights:</span></h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Interprets the JSON configuration file into actionable objects.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Gathers unique file paths embedded throughout the configuration.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Tailors configuration for compact, LLM-friendly usage.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Story Generation System</h3>
<p>The <code class="inline-code">story-generator.ts</code> file connects the Story Engine’s decryption schema to live dynamic session feedback. The <code class="inline-code">StoryGenerator</code> class synthesizes storylines, quest details, and summaries derived from contextual project data, providing an interactive experience.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">StoryGenerator.generateStoryAndQuests</code>: Constructs the galaxy’s overarching tale with adaptive quests sourced from project metadata.</li>
<li><code class="inline-code">StoryGenerator.generateQuestContent</code>: Focused creation of mission objectives based on specific requirements and file data.</li>
<li><code class="inline-code">StoryGenerator.generateCompletionSummary</code>: Delivers a succinct summary of the achieved quest within mission goals.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Generate story and enforce quest limits
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme);
  this.state.quests = this.enforceConfigQuestCount(storyResponse.quests, this.state.projectPath);
  return this.formatStoryWithQuests(storyResponse);
}
</code></pre>
<p>The <code class="inline-code">initializeAdventure</code> function is like launching a navigational matrix by recalibrating all systems before departure.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) return this.createNotFoundResult();
  return await this.executeQuest(quest);
}
</code></pre>
<p>The <code class="inline-code">exploreQuest</code> function acts like selecting a waypoint for interstellar travel using refined user inputs.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>The <code class="inline-code">progressPercentage</code> function operates like a galactic odometer, showing exploratory completion metrics.</p>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p><code class="inline-code">parseAdventureConfig</code> is akin to decoding an encrypted astro-chart from raw incoming signals.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) unique.add(node.path);
  }
  return Array.from(unique);
}
</code></pre>
<p><code class="inline-code">extractUniqueFilePaths</code> functions like an asteroid miner, uncovering valuable data veins across spatial fields.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;
  let formatted = &#39;## Quest Structure\n&#39;;
  for (const quest of (parsed as any).adventure.quests || []) {
    formatted += `### ${quest.title}\nFiles: ${quest.files.map(f =&gt; f.path).join(&#39;, &#39;)}\n`;
  }
  return formatted;
}
</code></pre>
<p><code class="inline-code">formatAdventureConfigForPrompt</code> composes condensed galactic charts for efficient AI-guidance transmission.</p>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme): Promise&lt;StoryResponse&gt; {
  const prompt = loadStoryGenerationPrompt({ theme, repomixContent: projectInfo.repomixContent });
  const response = await this.llmClient.generateResponse(prompt);
  return parseMarkdownToStoryResponse(response.content.trim());
}
</code></pre>
<p>The <code class="inline-code">generateStoryAndQuests</code> function ignites the Story Engine’s warp core, drafting tales that span the cosmos.</p>
<pre><code class="language-typescript">async generateQuestContent(quest: Quest, theme: AdventureTheme, codeContent: string): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({ theme, adventureTitle: quest.title });
  const response = await this.llmClient.generateResponse(prompt);
  return { adventure: response.content.trim() };
}
</code></pre>
<p><code class="inline-code">generateQuestContent</code> resembles decrypting a star map, revealing hidden pathways within cosmic patterns.</p>
<pre><code class="language-typescript">async generateCompletionSummary(quest: Quest, theme: AdventureTheme, progress: number, total: number): Promise&lt;string&gt; {
  const completion = Math.round((progress / total) * 100);
  const prompt = loadCompletionPrompt({ themeDescription: theme, adventureTitle: quest.title });
  return (await this.llmClient.generateResponse(prompt)).content.trim();
}
</code></pre>
<p><code class="inline-code">generateCompletionSummary</code> distills celestial adventures into concise stardust chronicles.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Augment <code class="inline-code">adventure.config.json</code> for tailored quest paths.</li>
<li>Explore <code class="inline-code">formatAdventureConfigForPrompt</code> to enhance LLM integration.</li>
<li>Test <code class="inline-code">initializeAdventure</code> for robustness when changing themes/files.</li>
</ul>
<hr>
<p>Mission logs updated—venture forth to uncover the Repository Core. Starship <strong>Codebreaker’s</strong> systems await your command!</p>
<p>Mission accomplished, Star Navigator! You&#39;ve ignited the thrusters of the Galactic Story Engine and charted a stellar course through 20% of this cosmic adventure—keep soaring toward the stars! 🚀💎⭐</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">← Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>