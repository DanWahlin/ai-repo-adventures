<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Cosmic Story Forge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Cosmic Codebase</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Cosmic Story Forge</h1>
<hr>
<p>The <strong>Starship Repomix</strong> is navigating the cosmic seas of its internal systems to establish harmony between its advanced neural pathways and galactic data banks. In this mission, you must activate the <strong>Cosmic Story Forge</strong> to generate themed quests and propel your adventure into the stellar unknown. Brace yourself for insights into how the narrative and quest systems are programmed for thematic exploration.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Structural Orbit</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> process thematic input to generate quests?  </li>
<li>‚ö° <strong>Data Parsing Pulse</strong>: What role does <code class="inline-code">parseAdventureConfig</code> play in validating and structuring quest data?  </li>
<li>üõ°Ô∏è <strong>Validation Shield</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> ensure safe integration of data and themes?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Quest Generation Processes</h3>
<p>This file orchestrates the dynamic generation of quests and storylines. It formulates the interaction between input validation, quest creation, and progress tracking. Look for how the code constructs adventures by integrating project-specific details and thematic contexts.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: Establishes state for new adventures, integrates project data, and generates quests. Critical for thematic story initialization.  </li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Tracks completion metrics dynamically, calculating precise percentages reflecting the user&#39;s journey.  </li>
<li><code class="inline-code">AdventureManager.exploreQuest</code>: Executes specific quests, leveraging cached content or generating fresh narratives.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li><strong>Functionality</strong>: Resets state and initializes adventure context based on project and theme inputs. Handles custom themes and integrates quests dynamically.  </li>
<li><strong>Pattern Use</strong>: Utilizes modular theme configuration and state management techniques to maintain flexibility across projects.  </li>
<li><strong>Challenges Solved</strong>: Aligns story and quest generation with user-defined themes while maintaining compatibility with project data.  </li>
<li><strong>Connection</strong>: Interacts with <code class="inline-code">StoryGenerator</code> to produce cohesive narrative outputs.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li><strong>Core Role</strong>: Calculates user&#39;s progress as a percentage based on completed versus total quests. Essential for ongoing feedback and engagement.  </li>
<li><strong>Techniques</strong>: Leverages mathematical operations on dynamic data structures (<code class="inline-code">Set</code>, <code class="inline-code">Array</code>) for real-time calculation.  </li>
<li><strong>Benefits</strong>: Enables the creation of a consistent, progress-driven user experience.  </li>
<li><strong>Interaction</strong>: Supports <code class="inline-code">AdventureManager.exploreQuest</code> by reflecting updated completion metrics during quest branching.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li><strong>Utility</strong>: Executes quests based on user input, creating narrative results while leveraging cached content for revisited adventures.  </li>
<li><strong>Validation</strong>: Integrates input sanitization methods to safeguard against invalid commands.  </li>
<li><strong>Impact</strong>: Provides a flexible mechanism for quest selection, maintaining streamlined statefulness across multiple entries.  </li>
<li><strong>Edge Cases</strong>: Hands errors gracefully when a quest is not found, returning informative messages.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Adventure Configuration Interpretation</h3>
<p>This file serves as the bridge between raw configuration data and structured quest generation. Its functions enrich the quests by extracting meaningful details, folding them into usable formats, and validating inputs.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Transforms raw JSON data into structured objects. Fundamental for ensuring quests align with external configurations.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies and validates file references within configuration data, connecting quests to specific code files for analysis.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses configuration data for efficient use in narrative generation prompts.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li><strong>Purpose</strong>: Reads and parses adventure configuration files, handling input errors gracefully.  </li>
<li><strong>Patterns Used</strong>: Safeguards JSON parsing via error trapping for robust input validation.  </li>
<li><strong>Challenges Addressed</strong>: Protects against malformed configuration files potentially disrupting quest generation.  </li>
<li><strong>Integration Points</strong>: Directly consumed by <code class="inline-code">initializeAdventure</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li><strong>Functional Scope</strong>: Extracts all valid file paths from the configuration, ensuring quests can reference only existing files.  </li>
<li><strong>Implementation Elegance</strong>: Uses iterative validation and path resolution for efficient discovery of dependencies.  </li>
<li><strong>Enhancements</strong>: Guarantees that quests have their contextual code files linked explicitly.  </li>
<li><strong>Cross-File Interaction</strong>: Supports targeted exploration by <code class="inline-code">initializeAdventure</code> methods.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li><strong>Design Goal</strong>: Formats adventure configurations into concise, LLM-friendly prompts for improving story generation clarity.  </li>
<li><strong>Optimized Output</strong>: Reduces verbosity, focusing on function and file references essential for quest design.  </li>
<li><strong>Impacts</strong>: Enhances narrative relevance and accuracy during thematic integration.  </li>
<li><strong>Thematic Alignment</strong>: Facilitates alignment between Repomix content and quest exploration requirements.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üåå <strong>System Map</strong>: Begin with <code class="inline-code">initializeAdventure</code> to observe how themes interact with configuration structs.  </li>
<li>ü™ê <strong>File Trails</strong>: Trace <code class="inline-code">formatAdventureConfigForPrompt</code> to see patterns in linking files and functions to quests.  </li>
<li>üõ∞Ô∏è <strong>Validation Radar</strong>: Focus on error handling in <code class="inline-code">parseAdventureConfig</code> to ensure robust input parsing.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the starship&#39;s codebase.</p>
<p>Quest 2: The Cosmic Story Forge is complete‚Äîyour starship has charted its first stellar path through the cosmos at warp speed, igniting a brilliant supernova of creativity on this epic mission! üöÄ ‚≠ê ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>