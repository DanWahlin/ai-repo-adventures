<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Stellar Forge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Code Chronicles: The Quest for Stellar Harmony</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Stellar Forge</h1>
<hr>
<p>In the heart of the Repository Galaxy lies the legendary &quot;Stellar Forge,&quot; a cosmic relay station responsible for creating, distributing, and maintaining the flow of adventures across the galaxy. With its alloyed nodes corroding over time and data streams fragmented, the forge has long ceased to operate at peak capacity. Systems that connect critical star systems‚Äîthe MCP Nexus, Quest Engine, and others‚Äîare breaking apart faster than light itself. It‚Äôs up to you, navigator of the <em>SS Code Explorer</em>, to step inside this technological marvel, refactor unstable code structures, and ignite the Stellar Forge.</p>
<p>Your mission? To rekindle its dormant energy and align the web of adventures back into a stable formation. But beware, ancient dependencies and misaligned paths could send your ship spiraling into chaos. Choose your path carefully, traveler.</p>
<p><strong>The Stellar Forge must burn bright once again!</strong></p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these critical patterns to ensure the Forge aligns with its mission:  </p>
<ul>
<li>üîç <strong>Forge Calibration</strong>: How does <code class="inline-code">initializeAdventure</code> establish the codebase‚Äôs theme and story? What setup steps are involved?  </li>
<li>‚ö° <strong>Ignition Protocols</strong>: What sequence enables <code class="inline-code">generateQuestContent</code> to parse adventures and bind functionality together?  </li>
<li>üõ°Ô∏è <strong>Code Path Safeguard</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> ensure that only specific, valid file paths are extracted for exploration?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Managing the Mission Control</h3>
<p>This file forms the core of the <em>Stellar Forge&#39;s</em> operational suite. As the Adventure Manager, it initializes story campaigns, executes quests, and injects contextual data into the mission&#39;s flow. It ensures proper handling of themes, validates quest choices, and manages the final journey experience.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Validates the initial project setup, generates story context, and configures themed adventures. Critical to ensuring the mission starts correctly.  </li>
<li><code class="inline-code">exploreQuest</code>: Directs the execution of a selected quest, leveraging cache and validation routines to optimize navigation through the Stellar Forge.  </li>
<li><code class="inline-code">generateQuestContent</code>: Dynamically generates detailed content for each quest using repomix data and a built-in LLM prompt system. Empowers the creation of code narratives.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Star Map Configuration</h3>
<p>The <em>Adventure Config</em> module extracts and processes crucial star map data. It verifies settings, paths, and formats related to the repository‚Äôs operational state. This ensures the mission operates on a clean and complete dataset without unnecessary drift in the Forge‚Äôs primary pipelines.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Safely parses configuration files into structured objects, allowing the Forge to load consistent datasets. Critical for avoiding crashes during map initialization.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Recursively scans the adventure config to identify and validate all referred paths. Ensures that only existing and relevant paths traverse the system pipelines.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Formats critical data and files, enabling the creation of tailored LLM suggestions with minimal redundancy. Vital for effective LLM navigation.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Cosmic Story Weaving</h3>
<p>The <em>Story Generator</em> is a vital subroutine of the forge. This intelligent module parses raw data, generating captivating narratives. It aligns quests with meaningful context, preparing the galaxy‚Äôs adventures for execution and exploration.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateQuestContent</code>: Main mechanism for producing detailed quests and related exploration pipelines. Integrates LLM response to steer contextual cosmic journeys.  </li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Mechanism to translate LLM markdown outputs into structured data‚Äîcritical for adapting nebulous quest information into structured timelines.  </li>
<li><code class="inline-code">generateCompletionSummary</code>: Generates final reports summarizing progress and thematic consistency across chosen missions.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Orchestrates setup of key systems, validates configurations, and adapts to the project‚Äôs current state.  </li>
<li>Custom theme data provides flexibility in crafting specialized mission experiences.  </li>
<li>Ensures that LLM stories align with user-defined quests and maximum configurations.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Extracts file references to validate existence and ensures only existing files pass through pipelines.  </li>
<li>Recursively analyzes deeply nested configurations while avoiding crash scenarios from invalid data.  </li>
<li>Produces a unique, deduplicated set of file paths critical to mission content exploration.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const { quest, theme, codeContent, questPosition, totalQuests } = config;
  let adventureGuidance = &#39;&#39;;
  let customInstructions = &#39;&#39;;
  
  if (this.projectPath) {
    const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);
    if (formattedConfig) adventureGuidance = formattedConfig;
    
    const customInstructionsFromConfig = extractCustomInstructions(this.projectPath);
    if (customInstructionsFromConfig) customInstructions = customInstructionsFromConfig;
  }

  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    adventureGuidance: adventureGuidance || &#39;&#39;,
    ...(customInstructions &amp;&amp; { customInstructions }),
    questPosition,
    totalQuests,
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  }) + &#39;\n\nIMPORTANT: Respond with ONLY markdown content between explicit delimiters.\n\nFormat your response EXACTLY like this:\n\n---BEGIN MARKDOWN---&#39;;

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );
  
  return {
    adventure: response.content.trim(),
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<ul>
<li>Dynamically composes and sends prompts to the LLM to generate quest content.  </li>
<li>Integrates additional guidance from adventure config ensuring laser-focused mission objectives.  </li>
<li>Safeguarded by strict timeout to prevent delays in processing.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Cross-reference quest titles with their position in the adventure sequence to maintain focus.  </li>
<li>Validate file existence using local utilities before tracing adventures to reduce errors.  </li>
<li>Monitor execution flows carefully when generating quest content to spot LLM inconsistencies.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission accomplished, Starseeker! ‚ö° You‚Äôve navigated the cosmic currents of Quest 2: The Stellar Forge with precision, igniting a brilliant nova of knowledge‚Äîonward to the stars! üöÄ‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>