<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Empowering the Quest Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Repository Missions: The Codebase Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Empowering the Quest Engine</h1>
<hr>
<p>The starship <em>RepoStar Matrix</em> hums with the latent energy of its core modules, awaiting your expert command to fine-tune its quest engine. Within its digital framework lies the <em>Adventure Manager</em>, where quests are orchestrated, and the <em>Story Generator</em>, where epic narratives are forged. Your task is to explore these core systems alongside the <em>Adventure Config</em>, the starship&#39;s thematic guide. Traverse these files to ensure readiness for interstellar storytelling and uncover how they synergize to power mission-critical operations.</p>
<p>Your journey into the modular nebula begins now‚Äîignite the engines of discovery!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Quasar Interface</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> coordinate with the <code class="inline-code">StoryGenerator</code> to set up the quest parameters for a project?</li>
<li>‚ö° <strong>The Cosmic Workflow</strong>: How does the quest execution flow work in <code class="inline-code">AdventureManager.exploreQuest</code>, including how it manages state caching and user input validation?</li>
<li>üõ°Ô∏è <strong>System Integrity Check</strong>: How do error handling and validation mechanisms ensure robustness in functions like <code class="inline-code">parseAdventureConfig</code> and <code class="inline-code">loadAdventureConfig</code>?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Adventure Manager - The Galactic Central Hub</h3>
<p>The <em>Adventure Manager</em> module encapsulates the system responsible for managing and executing quests. It&#39;s the main interface between the crew&#39;s input and the execution of their chosen missions. From initializing thematic stories to validating user interactions, it manages the lifecycle of the exploration journey. Key highlights include initialization, user input sanitization, and seamless integration with <code class="inline-code">StoryGenerator</code>.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code> builds a questing environment by resetting the system state, invoking the <code class="inline-code">StoryGenerator</code>, and merging external configurations.</li>
<li><code class="inline-code">exploreQuest</code> orchestrates quest selection, handles caching for completed quests, and dynamically executes new operations based on user choice.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code> calculates real-time mission progress by monitoring completed quests against the total.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(
    projectInfo, 
    theme, 
    this.state.projectPath
  );
    
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(
    storyResponse.quests,
    this.state.projectPath
  );

  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);
  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>This method resets the adventure state and begins anew with updated project data and thematic configurations.</li>
<li>It demonstrates logical flow management, particularly with fallback mechanisms for <code class="inline-code">projectPath</code>.</li>
<li>Connections to <code class="inline-code">StoryGenerator</code> highlight modular design for setting up quests and creating engaging narratives.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>User commands are interpreted, validated, and dynamically routed to quest-specific functions.</li>
<li>Caching mechanisms ensure optimal resource utilization when revisiting completed quests.</li>
<li>This method highlights the intricate interplay between state validation, error handling, and user-driven input.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Calculates mission progress, providing real-time feedback to the operator.</li>
<li>Demonstrates effective use of calculated properties for monitoring user engagement.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: The Thematic Calibration Blueprint</h3>
<p>The <em>Adventure Config</em> module manages the integration of configuration data, including loading, parsing, and extracting mission-critical paths from a JSON file. This acts as the connective tissue between external settings and the quest engine.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code> reads the thematic setup file to identify quest structure and parameters.</li>
<li><code class="inline-code">parseAdventureConfig</code> validates and parses the loaded JSON for safe processing and usage.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> traverses the config structure to identify all quest-specific file paths.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Handles low-level file access with fail-safes; missing files don‚Äôt cause fatal errors.</li>
<li>Simplifies the thematic setup process for seamless initialization.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Protects the system from invalid JSON in user-provided configuration files.</li>
<li>Ensures clean separation of file reading and parsing logic, adhering to the single-responsibility principle.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node)
      ? node
      : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Extracts file references systematically, ensuring only valid paths are processed.</li>
<li>Demonstrates recursive traversal with strong error tolerance for complex data structures.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Consider how <code class="inline-code">initializeAdventure</code> and <code class="inline-code">exploreQuest</code> interact with caching to optimize subsequent quest selections.</li>
<li>Think about potential ways to enhance the robustness of the validation functions in <code class="inline-code">parseAdventureConfig</code>.</li>
<li>Validate how well <code class="inline-code">extractUniqueFilePaths</code> handles edge cases, such as symbolic links or deeply nested structures.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission Control reports a stellar success as Quest 3 ignites the Quest Engine&#39;s thrusters, propelling you to 40% completion‚Äîkeep charting this cosmic course, star navigator! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>