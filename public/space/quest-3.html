<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Cosmic Analysis Core - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Adventures: Uncovering the Starship‚Äôs Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Cosmic Analysis Core</h1>
<hr>
<p>The <em>Starship Codexus</em> drifts silently near the Orion Nebula, a fragile orbit maintained by failing subsystems. As the ship‚Äôs Cosmic Analysis Core sputters, its ability to process critical quest data diminishes. Your mission: investigate the computational heart of the ship, restore its functionality, and ensure it can analyze the code driving the starship&#39;s operations. The journey will lead you through deeply intertwined systems, where every function could be the piece needed to unlock stability. Time is critical, engineer‚Äîthe ship cannot last long in its current state.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Core Initialization</strong>: How does <code class="inline-code">initializeAdventure</code> set up the core state and integrate files into the mission&#39;s narrative?</li>
<li>‚ö° <strong>Quest Execution Flow</strong>: What mechanisms ensure the correct quest is chosen and executed in <code class="inline-code">exploreQuest</code>? </li>
<li>üõ°Ô∏è <strong>Data Validation Shields</strong>: How does <code class="inline-code">validateQuestPrerequisites</code> safeguard against invalid states or missing data?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Core adventure control</h3>
<p>The file <code class="inline-code">adventure-manager.ts</code> serves as the mission control for the starship‚Äôs narrative and operational flow. It defines the <code class="inline-code">AdventureManager</code> and <code class="inline-code">AdventureState</code> classes, responsible for initializing quests, executing user selections, and validating the starship‚Äôs contextual readiness. By managing the integration of quests, themes, and configuration, it serves as the backbone of the starship&#39;s code exploration systems.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Establishes the foundational state of the cosmic mission, integrating project-specific data, themes, and configuration into the narrative system.</li>
<li><code class="inline-code">exploreQuest</code>: Handles the selection and execution of quests based on user input, leveraging validation and cache mechanisms to streamline interactivity.</li>
<li><code class="inline-code">validateQuestPrerequisites</code>: Enforces preconditions such as project context and theme selection, ensuring no critical components are missing.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);

  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This function orchestrates the setup of the starship&#39;s adventure context by resetting state, assigning a theme, and invoking the story generator.</li>
<li>Configuration from <code class="inline-code">adventure.config.json</code> is merged, ensuring alignment between the narrative flow and provided file scopes.</li>
<li>Modular design enables support for custom themes and dynamic adjustments to quest listings.</li>
<li>Demonstrates the principle of enforcing data consistency by syncing generated quests with configuration files.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  // Check if this is a progress request
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  // Find the quest based on the choice
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  // Execute the quest
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Responsible for commanding the starship to navigate a selected quest, returning progress or results.</li>
<li>Sanitizes user input to prevent invalid selections, routing &quot;progress&quot; requests appropriately.</li>
<li>Implements a layered approach to quest selection, handling both numerical and title-based choices.</li>
<li>Links tightly to the <code class="inline-code">executeQuest</code> function to manage quest execution while abstracting workflow complexity.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateQuestPrerequisites(): void {
  if (!this.state.projectInfo) {
    throw new Error(&#39;No project context available&#39;);
  }

  if (!this.state.currentTheme) {
    throw new Error(&#39;No theme selected&#39;);
  }
}
</code></pre>
<ul>
<li>Acts as a safeguard for critical mission data, ensuring key prerequisites are satisfied before proceeding.</li>
<li>Enforces state integrity by checking for both project and theme context, raising meaningful errors when conditions are unmet.</li>
<li>A concise yet vital function that demonstrates excellent use of defensive programming practices in complex systems.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Double-check how file-specific content is merged during initialization to coordinate changes between <code class="inline-code">adventure.config.json</code>.</li>
<li>Experiment with how different themes modify quest descriptions during <code class="inline-code">initializeAdventure</code>.</li>
<li>To uncover additional narratives, explore the functions that handle customization and progress visualization.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Stellar work, cosmic explorer‚ÄîQuest 3: Cosmic Analysis Core is now a shining star in your galactic logbook; onward to charting the next celestial frontier! ‚≠êüöÄüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>