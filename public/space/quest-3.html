<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Unleash the Stellar Story Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Code Chronicles: The Quest for Stellar Optimization</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Unleash the Stellar Story Engine</h1>
<hr>
<p>The VirtuScope continues its interstellar voyage, piercing the spiraling arms of nebulae and decoding the star-dust trails of ancient supernovae. Now, the focus of your mission is the Stellar Story Engine‚Äîa delicate system that uses encoded cosmic signatures to project explorative narratives and generate quests for the crew. This intricate machinery, powered by algorithms and vast datasets, is central to guiding your ship‚Äôs adventures deeper into the galactic unknown.</p>
<p>To ensure the Story Engine functions optimally, you must delve into the heart of its programming. Examine its ability to orchestrate adventures, regenerate quests under new themes, and synchronize seamlessly with configuration modules. Adapt and recalibrate as you traverse the dark matter between stars, for the galaxy is vast, and a misstep can cascade into chaotic unpredictability.</p>
<p>The fate of your exploration lies in your skillful calibration of the Story Engine‚Äôs core systems. Will your ingenuity translate the galaxy&#39;s whispers into tales of cosmic wonder?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Engine Calibration</strong>: How does the <code class="inline-code">AdventureManager</code> initialize with a project and synchronize its story and quests into actionable components?</li>
<li>‚ö° <strong>Code-to-Quest Harmony</strong>: What mechanisms link the code content from configuration files to the dynamically generated quest narratives in the <code class="inline-code">StoryGenerator</code> class?</li>
<li>üõ°Ô∏è <strong>Data Robustness Check</strong>: How does the system validate and extract vital components (e.g., files, highlights) from configurations to ensure quests are generated accurately and safely?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Adventure lifecycle and quest orchestration</h3>
<p>This file is crucial for initiating and managing adventures across the VirtuScope‚Äôs systems. The <code class="inline-code">AdventureManager</code> class handles everything from integrating project details to dynamically generating story-driven quests. It also ensures synchronization between the implemented project configuration and the generated narrative context.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Sets up the adventure environment by merging project info, selecting a theme, and generating corresponding storylines and quests.</li>
<li><code class="inline-code">exploreQuest</code>: Executes the selected quest, leveraging content caching for performance while ensuring prerequisites are met.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Integrates file-specific data from the configuration file into the generated quests, ensuring a precise linkage between the narrative and the codebase.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Quest generation and story synthesis</h3>
<p>This file encapsulates the logic for crafting dynamic stories and converting codebase data into meaningful interactive quests. The <code class="inline-code">StoryGenerator</code> bridges the technical details of the code with the thematic constructs of the adventure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Combines project details and the selected theme to create a structured story with multiple quests.</li>
<li><code class="inline-code">generateQuestContent</code>: Produces detailed quest narratives using code highlights and relevant context extracted from configuration files.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Parses Markdown input to extract story sections and individual quests, ensuring proper formatting and structure.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Parsing and validating configuration data</h3>
<p>This file houses essential utility functions for managing adventure configurations. It plays a critical role in extracting and validating file paths and metadata that guide quest generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Loads and validates the <code class="inline-code">adventure.config.json</code> file, turning it into a usable JavaScript object.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies and filters unique file references from the configuration, ensuring all specified files exist within the project directory.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Prepares configuration data in a condensed format optimized for Large Language Model (LLM) prompts.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This function orchestrates all major steps in initializing a new coding adventure.</li>
<li>It leverages <code class="inline-code">generateStoryAndQuests</code> to dynamically craft a narrative and quests based on project configuration.</li>
<li>The merging and enforcement of configuration files ensure accuracy in aligning quests with the file system.</li>
<li>Returning the formatted story gives users an immediate questable narrative.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async executeQuest(quest: Quest): Promise&lt;AdventureResult&gt; {
  const cached = this.state.questContentCache.get(quest.id);
  
  let content = cached ? cached.content : await this.generateQuestContent(quest);
  let summary = cached ? cached.summary : await this.generateCompletionSummary(quest);

  if (!cached) {
    this.state.questContentCache.set(quest.id, { content, summary });
  }

  this.markQuestCompleted(quest);
  return this.createQuestResult(content, summary);
}
</code></pre>
<ul>
<li>Ensures quests can be executed seamlessly while using cache to reduce redundant operations.</li>
<li>Produces new content using <code class="inline-code">generateQuestContent</code> when unavailable, ensuring each quest is unique.</li>
<li>The design balances performance and dynamic content generation for user experience.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  const config = parseAdventureConfig(projectPath);
  if (!config) return quests;

  return quests.map(quest =&gt; {
    const filePaths = extractUniqueFilePaths(projectPath);
    return { ...quest, codeFiles: filePaths };
  });
}
</code></pre>
<ul>
<li>Merges configuration paths into quest structures, linking them explicitly with matching files.</li>
<li>This guarantees that quests generated dynamically by <code class="inline-code">AdventureManager</code> are fully enriched with actual project data.</li>
<li>Ensures quests remain contextually relevant by integrating precise file references.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent: projectInfo.repomixContent
  });

  const response = await this.llmClient.generateResponse(prompt);
  return parseMarkdownToStoryResponse(response.content);
}
</code></pre>
<ul>
<li>Central to creating cohesive narratives that connect technical project details with exploratory quests.</li>
<li>Uses LLM calls to dynamically generate storylines enriched by project-specific data.</li>
<li>The structured response ensures Markdown adherence and proper story parsing.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  return raw ? JSON.parse(raw) : null;
}
</code></pre>
<ul>
<li>Converts raw JSON configuration into usable data for quest generation.</li>
<li>Validates file integrity to ensure the quest system avoids unnecessary errors.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ†Ô∏è <strong>Focus on hierarchy</strong>: Note the interplay between <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code> for theme and quest synchronization.</li>
<li>üöÄ <strong>Think modular</strong>: Observe how configuration parsing ensures adaptability across projects.</li>
<li>üß≠ <strong>Experiment practically</strong>: Test adding file paths or modifying <code class="inline-code">adventure.config.json</code>.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>üöÄ Your stellar trajectory shines brighter than a supernova as Quest 3 ignites the warp drive of the Story Engine‚Äîcharting 40% of your cosmic journey toward mastery! ‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>