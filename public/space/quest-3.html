<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Stellar Narrative Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Code Chronicles: The Repository Odyssey</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Stellar Narrative Engine</h1>
<hr>
<p>The starship <em>Code Voyager</em> drifts gracefully into the heart of the cosmic code nebula, a region rife with enigmatic structures and stellar anomalies. Among the glittering trails of unidentified syntax and interstellar projects, the crew is tasked with constructing the <strong>Stellar Narrative Engine</strong>, a powerful tool designed to transform the chaotic streams of alien files into clear, navigable paths. But this mission is no simple endeavor; it requires bridging abstract constructs with functional knowledge to navigate the nebulous terrain effectively. Will you decode the mysteries woven into the depths of this system and bring clarity to the interstellar narrative?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Nebula Mapping</strong>: How does <code class="inline-code">parseAdventureConfig</code> reveal unique paths and ensure critical files are accounted for in the dynamic narrative?</li>
<li>‚ö° <strong>Thruster Synchronization</strong>: What role does <code class="inline-code">initializeAdventure</code> play in setting up the Stellar Narrative Engine and aligning project themes with mission objectives?</li>
<li>üõ°Ô∏è <strong>Fault Resistance</strong>: How does <code class="inline-code">loadAdventureConfig</code> handle missing files or errors to ensure continuity during the narrative synchronization process?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Config file reader and parser</h3>
<p>This file contains foundational functionality that reads, parses, and formats the codebase&#39;s narrative configuration. Each function in this file works harmoniously to identify file paths and ensures the narrative engine can process dynamic configurations reliably. It is crucial for extracting meaningful insights from underlying projects.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads the configuration file text, handling potential absence or access issues seamlessly.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Parses configuration files to extract their meaning and makes them usable by other systems in the narrative engine.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies unique file paths referenced across the config, ensuring the Stellar Narrative Engine focuses on critical data structures.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Simple but effective, this function ensures the presence of critical narrative data by reading configuration files safely and returning <code class="inline-code">null</code> if unavailable, preventing fatal interruptions.</li>
<li>Uses <code class="inline-code">readFileIfExists</code> encapsulation to isolate file access logic.</li>
<li>Enables robust exploration by handling file access edge cases gracefully, such as unavailable paths.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Converts raw narrative data into a structured and usable format. If parsing fails, it safeguards against unexpected crashes by returning <code class="inline-code">null</code>.</li>
<li>A single point for JSON validation and error defense ensures compatibility between various narrative subsystems.</li>
<li>Establishes a modular system flow by associating parsed configurations with mission-specific operations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Implements a stack-based exploration algorithm to traverse nested configurations, making it adept at processing interwoven code paths.</li>
<li>Leverages <code class="inline-code">Set</code> to ensure uniqueness, eliminating redundant references efficiently.</li>
<li>Focuses on extracting meaningful data like valid file paths, filtering irrelevant or malformed entries.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Stellar Engine Initialization</h3>
<p>This file serves as the command bridge for the Stellar Narrative Engine, guiding logic for quest generation and content exploration. It merges foundational data structures from the config reader and extracts meaningful project insights, aligning them with thematic objectives.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets the narrative engine state, configures the theme, and prepares quests based on the dynamic codebase context.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Integrates configuration-defined file paths into generated quests, ensuring thematic accuracy and structural alignment.</li>
<li><code class="inline-code">markQuestCompleted</code>: Marks quests as completed for progress tracking and efficient navigation of subsequent missions.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Builds the foundation of the exploration narrative by initializing project settings, themes, and associated quests.</li>
<li>Dynamically configures quests using <code class="inline-code">mergeQuestFilesFromConfig</code>, extending contextual alignment.</li>
<li>Resets previous mission states seamlessly through <code class="inline-code">this.state.reset</code>, ensuring clean systems for the next operation.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;
  
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;
  
  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;
  
  const configQuestFiles = new Map&lt;string, string[]&gt;();
  for (const configQuest of adventure.quests) {
    if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {
      const filePaths = configQuest.files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
      if (filePaths.length &gt; 0) {
        configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);
      }
    }
  }
  
  return quests.map((quest, index) =&gt; {
    if (index &lt; adventure.quests.length &amp;&amp; adventure.quests[index] &amp;&amp; adventure.quests[index].files) {
      const files = adventure.quests[index].files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
      if (files.length &gt; 0) return { ...quest, codeFiles: files };
    }
    const questTitleLower = quest.title.toLowerCase();
    for (const [configTitle, files] of configQuestFiles.entries()) {
      if (questTitleLower.includes(configTitle) || configTitle.includes(questTitleLower)) {
        return { ...quest, codeFiles: files };
      }
    }
    return quest;
  });
}
</code></pre>
<ul>
<li>Bridges abstract quests with tangible file paths extracted from configurations, enriching the exploration narrative with thematic relevance.</li>
<li>Ensures data consistency by validating configuration file structures before integration.</li>
<li>Implements fallback mechanisms for partial matches, enhancing reliability during quest generation.</li>
</ul>
<hr>
<pre><code class="language-typescript">private markQuestCompleted(quest: Quest): void {
  this.state.completedQuests.add(quest.id);
}
</code></pre>
<ul>
<li>Tracks mission progress efficiently by marking completed quests.</li>
<li>Facilitates adaptive scenarios, such as revisiting previous quests for deeper exploration.</li>
<li>Integrates clean progress tracking, maintaining clarity in user navigation.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Review how <code class="inline-code">extractUniqueFilePaths</code> identifies critical files to refine quests around meaningful data.</li>
<li>Observe the modularity in quest generation and file path integration to understand scalable theme configurations.</li>
<li>Experiment with dynamic theme setups in <code class="inline-code">initializeAdventure</code> for custom explorations.</li>
</ul>
<hr>
<p>&quot;Excellent work! Continue to the next quest to uncover more mysteries.&quot;</p>
<p>Congratulations, brave navigator of knowledge‚Äîyour creative thrusters have propelled Quest 3: Stellar Narrative Engine to success, igniting 40% completion on your cosmic journey toward the stars! üöÄ‚ö°‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>