<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Stellar Quest Generator Core - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Code Voyages: The Quest for Stellar Automation</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Stellar Quest Generator Core</h1>
<hr>
<p>The <em>Galactic Refactorer</em> sails through an uncharted nebula, its systems abuzz with activity. The crew now turns their focus to a critical task‚Äîthe refinement of the Stellar Quest Generator Core. The generator is the brain of the Universal Code Alliance‚Äôs mission, capable of crafting epic coding journeys from lines of raw interstellar repositories. However, its intricate design requires inspection, for its subsystems must unite in cosmic harmony to avoid catastrophic failures during intense void storms.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üöÄ <strong>Cosmic Initialization</strong>: How does <code class="inline-code">initializeAdventure</code> configure the Stellar Quest Generator Core with project context, and what safeguards ensure a smooth launch?</li>
<li>üó∫Ô∏è <strong>Quest Navigation Systems</strong>: What mechanisms does <code class="inline-code">exploreQuest</code> use to identify and execute quests, and how does it manage progress tracking in the adventure log?</li>
<li>üåü <strong>Interstellar Content Generation</strong>: How does <code class="inline-code">generateStoryAndQuests</code> convert repository data into themed adventures and what role does the theme configuration play?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Quest Manager Operations</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file houses the central command module for the Stellar Quest Generator Core. It instantiates and manages adventures for interstellar coders through processes like initialization, quest exploration, and progress tracking. Key highlights include dynamically generating content while ensuring system state integrity.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code> resets the adventure state, configures the theme, and orchestrates the generation of storylines and quests.</li>
<li><code class="inline-code">exploreQuest</code> identifies the selected quest, validates its prerequisites, and either retrieves cached content or generates new material.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code> dynamically calculates the completion status of all available quests.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Configures the adventure by setting the theme and initializing required states like quests, project paths, and custom configurations.</li>
<li>Calls <code class="inline-code">generateStoryAndQuests</code> to dynamically build themed adventures, ensuring alignment with the repository context.</li>
<li>Integrates additional configurations from <code class="inline-code">adventure.config.json</code> to enrich quest quality.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Handles user input for quest selection, validating and matching it to available quests via <code class="inline-code">findQuest</code>.</li>
<li>Supports progress tracking by handling ‚Äúprogress‚Äù requests through <code class="inline-code">isProgressRequest</code>.</li>
<li>Executes the selected quest and dynamically generates or retrieves content, ensuring fluid navigation between tasks.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Calculates completion progress as a percentage based on completed quests.</li>
<li>Provides real-time feedback on overall adventure progress, enhancing user engagement.</li>
<li>Uses the dynamic <code class="inline-code">Set</code> structure to efficiently track completed quests.</li>
</ul>
<hr>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Content Creation Engine</h3>
<p>The <code class="inline-code">story-generator.ts</code> file is the creative heart of the Stellar Quest Generator Core, transforming raw repository data into intricately themed adventures. It communicates with an LLM client to generate narratives, quests, and completion summaries dynamically.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code> organizes the transformation of repository data and theme configurations into structured storylines and quests.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code> cleans and structures LLM responses into a <code class="inline-code">StoryResponse</code> through tokenization and validation.</li>
<li><code class="inline-code">generateQuestContent</code> produces detailed quest material with custom instructions and thematic alignment.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Analyzes repository data and project information to create tailored adventures.</li>
<li>Leverages validated themes to guide LLM interactions, enhancing narrative coherence.</li>
<li>Provides a flexible entry for generating new content based on current explorations.</li>
</ul>
<hr>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);
  
  const title = extractTitle(tokens);
  let story = &#39;&#39;;
  const quests: Quest[] = [];
  
  let currentSection = &#39;&#39;;
  let currentQuest: Partial&lt;Quest&gt; = {};
  
  for (const token of tokens) {
    if (token.type === &#39;heading&#39;) {
      currentSection = token.text.toLowerCase();
    } else if (token.type === &#39;paragraph&#39;) {
      if (isStorySection(currentSection, false)) {
        story += token.text + &#39;\n\n&#39;;
      } else if (currentQuest.title) {
        currentQuest.description += token.text + &#39;\n\n&#39;;
      }
    }
  }

  if (currentQuest.title) {
    quests.push({
      id: `quest-${quests.length + 1}`,
      title: currentQuest.title,
      description: currentQuest.description.trim(),
      codeFiles: []
    });
  }
  
  return {
    title,
    story: story.trim(),
    quests
  };
}
</code></pre>
<ul>
<li>Converts raw markdown into structured <code class="inline-code">StoryResponse</code> data for narrative clarity.</li>
<li>Extracts quests dynamically, iterating over tokens to populate titles and descriptions.</li>
<li>Ensures that adventures maintain a well-defined structure with clear sections.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const { quest, theme, codeContent, questPosition, totalQuests } = config;
  
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );
  
  const content = response.content.trim();
  return {
    adventure: content,
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<ul>
<li>Coordinates the LLM to create quest content aligned with the overarching theme.</li>
<li>Uses <code class="inline-code">codeContent</code> to ensure generated materials are rooted in real-world context.</li>
<li>Manages token limits in the LLM transaction for consistent, high-quality results.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üí° Look for patterns where configuration components in <code class="inline-code">adventure-config.ts</code> are merged into generated story content.</li>
<li>üõ†Ô∏è Experiment with modifying themes to observe how narratives adapt for different settings.</li>
<li>üóÇÔ∏è Dive deeper into <code class="inline-code">mergeQuestFilesFromConfig</code> for insights on how file paths influence quest creation.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Quest 3: Stellar Quest Generator Core complete‚Äîyour cosmic journey is gaining warp speed, shining brilliantly among the stars at 40% progress; keep soaring, voyager! üöÄ‚≠êüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>