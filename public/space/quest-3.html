<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Forge the Cosmic Quest Generator - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Starship Nexus: Adventures in the Code Cosmos</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Forge the Cosmic Quest Generator</h1>
<hr>
<p>As the Starship Nexus continues its stellar expedition, the crew approaches the heart of the Code Cosmos: the Quest Generation Engine. This subsystem powers the ship‚Äôs ability to forge interactive adventures, tailoring each quest to the data streams and stellar object mappings encountered. To harness its full potential, the crew must navigate extensive cosmic data flows, decrypt encoded patterns, and fine-tune the Nexus using innovative techniques. The stars beckon as the crew sets forth to understand, explore, and optimize this powerhouse of creativity‚Äîthe forge where quests are born.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Quest Calibration</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> configure the state with theme and project information while enforcing precise configurations?  </li>
<li>‚ö° <strong>Story Mapping</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> adapt data sources to cosmic narratives and link quests cohesively?  </li>
<li>üõ°Ô∏è <strong>Config Synchronization</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure quests are aligned with the user-provided configuration file?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Managing Adventure States</h3>
<p>The <code class="inline-code">AdventureManager</code> class orchestrates the cosmic machinery behind quest generation. It bridges project, theme, and quest metadata into a unified system, leveraging reusable data flows to craft dynamic narratives. This file highlights critical initialization mechanisms that fuel the ship‚Äôs quest generation capabilities.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: Configures the adventure state using project paths, themes, and customization preferences. Its structured approach ensures no data point is lost in cosmic translation.  </li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Calculates completion metrics to chart clear progress across quests.  </li>
<li><code class="inline-code">AdventureManager.mergeQuestFilesFromConfig</code>: Aligns quests with specific code files defined within the adventure configuration.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(  
  projectInfo: ProjectInfo,  
  theme: AdventureTheme,  
  projectPath?: string,  
  customThemeData?: CustomThemeData  
): Promise&lt;string&gt; {  
  this.state.reset();  
  this.state.projectInfo = projectInfo;  
  this.state.currentTheme = theme;  
  this.state.projectPath = projectPath || process.cwd();  

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {  
    this.storyGenerator.setCustomTheme(customThemeData);  
  }  

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);  
  this.state.title = storyResponse.title;  
  this.state.story = storyResponse.story;  

  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);  
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);  

  return this.formatStoryWithQuests({...storyResponse, quests: this.state.quests});  
}  
</code></pre>
<ul>
<li>Essential for initializing the adventure, incorporating both user-defined and system-generated configurations.  </li>
<li>Combines file-based constraints with narrative orchestration, ensuring seamless interlinking between quests.  </li>
<li>Utilizes methods like <code class="inline-code">mergeQuestFilesFromConfig</code> to ensure quest integration aligns with external config data.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {  
  return this.quests.length &gt; 0  
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)  
    : 0;  
}  
</code></pre>
<ul>
<li>Converts cosmic quest completion into tangible metrics for explorers.  </li>
<li>Provides a clear view of exploration progress by integrating quantitative and thematic summaries embedded in the adventure state.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {  
  if (!projectPath) return quests;  

  const config = parseAdventureConfig(projectPath);  
  if (!config || typeof config !== &#39;object&#39;) return quests;  

  const adventure = (config as any).adventure;  
  if (!adventure || !Array.isArray(adventure.quests)) return quests;  

  return quests.map((quest, index) =&gt; {  
    if (index &lt; adventure.quests.length &amp;&amp; adventure.quests[index].files) {  
      const files = adventure.quests[index].files  
        .filter((f: any) =&gt; f.path)  
        .map((f: any) =&gt; f.path);  

      return {...quest, codeFiles: files};  
    }  
    return quest;  
  });  
}  
</code></pre>
<ul>
<li>Guarantees synchronization between user-defined config and dynamic quest creation.  </li>
<li>Simplifies cosmic file alignment by intelligently mapping external configurations to generated quests.  </li>
<li>Ensures narrative consistency by preserving file associations during quest initialization.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Synchronizing Cosmic Blueprints</h3>
<p>The adventure configuration file acts as the cosmic blueprint, guiding quest structure and thematic alignment. Parsing this file ensures no misalignment exists in the ship‚Äôs journey across the cosmos.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Extracts and validates structured configurations, maintaining accuracy despite the complexity of the cosmos.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Aggregates file paths into distinct nodes for efficient interstellar navigation.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Streamlines config details into lightweight prompts for quest development clarity.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {  
  const raw = loadAdventureConfig(projectPath);  
  if (!raw) return null;  

  try {  
    return JSON.parse(raw);  
  } catch {  
    return null;  
  }  
}  
</code></pre>
<ul>
<li>Safely parses adventure configuration files, preventing system failure from malformed inputs.  </li>
<li>Converts raw cosmic data into a structured alignment of thematic progressions, fostering system stability.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {  
  const parsed = parseAdventureConfig(projectPath);  
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];  

  const unique = new Set&lt;string&gt;();  
  const stack: any[] = [parsed];  

  while (stack.length) {  
    const node = stack.pop();  
    if (typeof node.path === &#39;string&#39; &amp;&amp; fs.existsSync(path.resolve(projectPath, node.path))) {  
      unique.add(node.path.trim());  
    }  
    const children = Array.isArray(node) ? node : Object.values(node);  
    children.forEach(child =&gt; { if (typeof child === &#39;object&#39;) stack.push(child); });  
  }  

  return Array.from(unique);  
}  
</code></pre>
<ul>
<li>Extracts file mapping from sprawling configurations, ensuring exploration paths remain uncompromised.  </li>
<li>Enables efficient starship navigation through tailored cosmic roadmaps.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {  
  const parsed = parseAdventureConfig(projectPath);  
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;  

  const adventure = (parsed as any).adventure;  
  if (!adventure || !Array.isArray(adventure.quests)) return &#39;&#39;;  

  return adventure.quests  
    .map(quest =&gt; `### ${quest.title}\nFiles: ${quest.files.map((f: any) =&gt; f.path).join(&#39;, &#39;)}\n`)  
    .join(&#39;\n&#39;);  
}  
</code></pre>
<ul>
<li>Simplifies complex user input into optimized structures for real-time prompt generation.  </li>
<li>Reduces redundancy in data presentation to accelerate quest creation workflows.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ†Ô∏è When aligning quests with files, ensure configuration paths are validated for system compatibility.  </li>
<li>üöÄ Investigate how <code class="inline-code">AdventureManager</code> integrates parsing techniques to merge dynamic and static configurations.  </li>
<li>üåå Use progress metrics as a guide for refining narrative enrichment and maintaining quest cadence.</li>
</ul>
<hr>
<p>Congratulations, explorer! You are now armed with the knowledge of cosmic quest generation systems. Continue your journey to unveil the remaining secrets of the Code Cosmos.</p>
<p>Mission accomplished, Stargazer‚Äîyour cosmic brilliance has ignited the Quest Generator‚Äôs core, propelling you 40% closer to charting the universe of triumphs! üåüüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>