<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The MCP Command Bridge: Protocols of the Navigator - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Galactic Navigator: Secrets of the Code Nebula</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The MCP Command Bridge: Protocols of the Navigator</h1>
<hr>
<p>The <strong>Galactic Navigator</strong> hummed softly under the starlit expanse of the <strong>Code Nebula</strong>, a beacon of structure amidst the chaos of fragmented syntax. Onboard the bridge, the <strong>MCP Server</strong> powered up its adventure systems, ready to interpret the scattered stardust of repositories into grand cosmic expeditions. The crew of adventurers gathered, staring at the readout ‚Äî their next mission involved activating the <strong>Adventure Tools Protocol</strong> and navigating through the <strong>Stellar Paths of Code Analysis</strong>. But as the Navigator initialized its subsystems, obstacles loomed ahead in the form of unresolved errors and perplexing configurations.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>The <strong>server.ts</strong> file is the central control room for launching and managing the MCP-powered adventure system. At the heart of it lies the <code class="inline-code">RepoAdventureServer</code> class, which orchestrates how tools are registered and executed. This file defines protocol handlers for user commands like listing available tools (<code class="inline-code">ListToolsRequestSchema</code>) and calling specific handlers (<code class="inline-code">CallToolRequestSchema</code>). The <code class="inline-code">RepoAdventureServer.setupHandlers()</code> method dynamically registers these handlers, allowing each tool to perform its role with precision. Meanwhile, <code class="inline-code">RepoAdventureServer.run()</code> establishes the <code class="inline-code">stdio</code> interface for communication and also pre-generates code context using <code class="inline-code">repoAnalyzer.preGenerate()</code> to optimize the user experience.</p>
<p>Error handling and graceful exits are well-designed in this file. The <code class="inline-code">main()</code> function sets the tone for robust error recovery, managing unforeseen events like unhandled promise rejections. The inclusion of system signals (<code class="inline-code">SIGINT</code>, <code class="inline-code">SIGTERM</code>) ensures smooth shutdowns without leaving behind stray processes. The warm-up of the <code class="inline-code">repomix</code> cache kicks off in the background, hinting at a performance-first approach.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers()</code> dynamically configures tool-based protocol handling for a versatile system.</li>
<li><code class="inline-code">main()</code> integrates signal management for smooth server shutdowns.</li>
<li><code class="inline-code">preGenerate()</code> helps prime the code analysis engine by warming up the Repomix cache.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tool Definitions</h3>
<p>The <strong>tools.ts</strong> file is the deck of adventure utilities that powers the MCP universe. It brings together four primary tools: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>, each of which corresponds to a step in the code exploration journey. These enable users to analyze repositories, select thematic storylines, dive into specific quests, and track their progress.</p>
<p>This file acts as a command center, importing logic like <code class="inline-code">adventureManager</code> and defining the tools in one accessible location. It organizes these as first-class citizens, exporting them for interactive functionality while ensuring seamless integration with the overarching MCP protocol. Better modularity is achieved here as each tool resides in its own file, making maintenance straightforward. Even though the file mainly aggregates definitions, its clarity and structure enforce a strong foundation for the adventure experience.</p>
<h4>Highlights</h4>
<ul>
<li>Aggregates tools into a single exportable interface.</li>
<li><code class="inline-code">start_adventure</code> empowers users to analyze repositories at the start of their journey.</li>
<li><code class="inline-code">explore_quest</code> enables specific exploration tasks with progress tracking.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      // Execute the tool handler with validated arguments
      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>Tools navigate the vast galaxy of repositories, validating their flight paths with structured schemas and precise routing.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This compiles an arsenal of exploration tools, ready to be deployed on command for any cosmic repository journey.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Pay attention to how <code class="inline-code">setupHandlers()</code> dynamically integrates tools ‚Äî it ensures the MCP server remains flexible for future expansions.</li>
<li>Explore the <code class="inline-code">tools.ts</code> file for ideas on modular tool exports; this structure minimizes code duplication.</li>
<li>Dig into how <code class="inline-code">ListToolsRequestSchema</code> and <code class="inline-code">CallToolRequestSchema</code> validate inputs to ensure reliable tool operations.</li>
</ul>
<hr>
<p>Your starship has charted the uncharted and secured the cosmic codes of navigation‚ÄîQuest 1 complete, stellar voyager! üöÄ‚ö°‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Stellar Forge: Crafting Gal... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>