<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Cosmic HTML Foundry - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Galactic Chronicles: The AI Odyssey</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Cosmic HTML Foundry</h1>
<hr>
<p>The <em>Cerebral Voyager</em> peers through the swirling mists of the infinite Code Nebula to uncover the secrets of rendering modular content with cosmic precision. Your starship&#39;s AI must master the integration of asset pipelines, modular template systems, and seamless navigation tools to forge a galactic HTML generator. Captain, can you navigate the stellar labyrinth of functions before your engine&#39;s power is consumed by errors?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Template Navigator</strong>: How does the <code class="inline-code">TemplateEngine</code> efficiently load and cache templates while managing placeholders for dynamic content?</li>
<li>‚ö° <strong>Asset Synchronization</strong>: How does the <code class="inline-code">AssetManager</code> manage the transporting of critical assets across themes and directories?</li>
<li>üõ°Ô∏è <strong>Generator Workflow</strong>: How does <code class="inline-code">HTMLAdventureGenerator</code> orchestrate the construction and delivery of entire HTML outputs?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> The Cosmic Template Mechanic</h3>
<p>The <code class="inline-code">TemplateEngine</code> provides the infrastructure for creating HTML pages by utilizing reusable templates stored in a directory. It handles everything from loading and caching templates to replacing placeholders with dynamic values, serving as the foundation for modular HTML generation. This highly efficient design ensures that repeated use of templates remains performant during the extensive demands of interstellar rendering.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadTemplate</code> retrieves templates from the file system, caches them for reuse, and raises an error if a template cannot be found.</li>
<li><code class="inline-code">replacePlaceholders</code> dynamically substitutes placeholders (e.g., <code class="inline-code">{{key}}</code>) with corresponding values, ensuring templates are filled with mission-specific data.</li>
<li><code class="inline-code">renderPage</code> combines a base layout with specific content templates and placeholders to produce fully-realized HTML views.</li>
</ul>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> The Asset Relay System</h3>
<p>The <code class="inline-code">AssetManager</code> is the starship&#39;s cargo bay, ensuring critical image, CSS, and JavaScript files are properly copied to the correct destinations. This class manages both theme-specific assets and shared resources while logging warnings for missing files. It ensures your HTML generator has all the external dependencies required to complete its mission.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyImages</code> transfers theme-specific and shared image files, ensuring assets are replicated accurately for multiple themes.</li>
<li><code class="inline-code">copySharedNavigator</code> handles the movement of navigational assets, such as <code class="inline-code">quest-navigator.css</code> and <code class="inline-code">compass-icon.svg</code>, to ensure consistent navigation across themes.</li>
<li><code class="inline-code">copyGlobalAssets</code> ensures universal assets (e.g., global shared images) are available for multi-theme deployments.</li>
</ul>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> Command Post of HTML Adventuring</h3>
<p>The <code class="inline-code">HTMLAdventureGenerator</code> is the command post where all elements of the HTML generation process converge. It manages the generation of HTML pages, starting from input configuration to final output, and includes processes such as template rendering, asset copying, and final delivery.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code> processes the overall orchestration of HTML generation, including analysis, template execution, and asset management.</li>
<li><code class="inline-code">generateAllThemes</code> caters to multi-theme setups by creating separate but interconnected outputs for each theme.</li>
<li><code class="inline-code">startHttpServer</code> launches a local HTTP server to preview the generated HTML adventures.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">/**
 * Load a template file with caching
 */
private loadTemplate(templateName: string): string {
  if (this.templateCache.has(templateName)) {
    return this.templateCache.get(templateName)!;
  }

  const templatePath = path.join(this.templatesDir, templateName);

  try {
    const content = fs.readFileSync(templatePath, &#39;utf-8&#39;);
    this.templateCache.set(templateName, content);
    return content;
  } catch (error) {
    throw new Error(`Failed to load template ${templateName}: ${error}`);
  }
}
</code></pre>
<ul>
<li>Efficiently loads and caches templates, reducing redundant file reads after initial load.</li>
<li>Uses <code class="inline-code">Map</code> to store template data in memory for quick access in subsequent requests.</li>
<li>Provides fallback error handling for invalid or missing templates.</li>
</ul>
<pre><code class="language-typescript">/**
 * Replace placeholders in template with variables
 */
private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;

  for (const [key, value] of Object.entries(variables)) {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, &#39;g&#39;), value || &#39;&#39;);
  }

  return result;
}
</code></pre>
<ul>
<li>Dynamically replaces placeholders in templates using <code class="inline-code">{{key}}</code> syntax.</li>
<li>Implements <code class="inline-code">RegExp</code> for global replacement of all matching placeholders.</li>
<li>Ensures compatibility with varying variable formats and edge cases.</li>
</ul>
<pre><code class="language-typescript">/**
 * Render a complete page using base template + content template
 */
renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);

  const renderedContent = this.replacePlaceholders(contentHtml, variables);

  const pageVariables = {
    ...variables,
    CONTENT: renderedContent
  };

  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>First combines the content into a content template, then merges it into a base layout.</li>
<li>Creates a hierarchy by inserting the result of one template render into another template.</li>
<li>Manages variables at multiple layers of a complex rendering output.</li>
</ul>
<hr>
<h3>packages/generator/src/cli/asset-manager.ts</h3>
<pre><code class="language-typescript">/**
 * Copy images for single or multi-theme generation
 */
copyImages(outputDir: string, isMultiTheme: boolean = false): void {
  const sourceImagesDir = path.join(this.sourceDir, &#39;assets&#39;, &#39;images&#39;);
  const sourceSharedDir = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;);
  const targetImagesDir = path.join(outputDir, &#39;assets&#39;, &#39;images&#39;);
  const targetSharedDir = path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;);

  try {
    // Copy theme-specific images
    if (fs.existsSync(sourceImagesDir)) {
      fs.mkdirSync(targetImagesDir, { recursive: true });
      const imageFiles = fs.readdirSync(sourceImagesDir);
      imageFiles.forEach(file =&gt; {
        const sourcePath = path.join(sourceImagesDir, file);
        const targetPath = path.join(targetImagesDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      });
    }

    // Copy shared images
    if (fs.existsSync(sourceSharedDir)) {
      fs.mkdirSync(targetSharedDir, { recursive: true });
      const sharedFiles = fs.readdirSync(sourceSharedDir);
      sharedFiles.forEach(file =&gt; {
        const sourcePath = path.join(sourceSharedDir, file);
        const targetPath = path.join(targetSharedDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      });
    }
  } catch (error) {
    console.log(chalk.yellow(&#39;‚ö†Ô∏è Warning: Could not copy images from source directory&#39;));
  }
}
</code></pre>
<ul>
<li>Ensures theme-specific images are organized in separate directories.</li>
<li>Uses <code class="inline-code">fs.mkdirSync</code> to create necessary directories for both single and multi-theme builds.</li>
<li>Implements error handling for missing directories or file copy failures.</li>
</ul>
<pre><code class="language-typescript">/**
 * Copy shared navigator files to global location (for multi-theme)
 */
copySharedNavigator(rootOutputDir: string): void {
  const templatesDir = path.join(this.sourceDir, &#39;templates&#39;);
  const sharedAssetsDir = path.join(rootOutputDir, &#39;assets&#39;, &#39;shared&#39;);
  
  fs.mkdirSync(sharedAssetsDir, { recursive: true });

  [&#39;quest-navigator.css&#39;, &#39;quest-navigator.js&#39;, &#39;compass-icon.svg&#39;].forEach(file =&gt; {
    const sourcePath = path.join(templatesDir, file);
    if (fs.existsSync(sourcePath)) {
      fs.copyFileSync(sourcePath, path.join(sharedAssetsDir, file));
    }
  });
}
</code></pre>
<ul>
<li>Moves critical shared navigator files like CSS, JavaScript, and SVG assets into a consolidated shared directory.</li>
<li>Ensures assets are accessible from multiple themes hosted in the same output structure.</li>
<li>Simplifies the path structure for shared assets.</li>
</ul>
<pre><code class="language-typescript">/**
 * Copy global shared assets for multi-theme generation
 */
copyGlobalAssets(outputDir: string): void {
  try {
    const globalSharedDir = path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;);
    const targetImagesDir = path.join(outputDir, &#39;assets&#39;, &#39;images&#39;);
    
    fs.mkdirSync(globalSharedDir, { recursive: true });

    const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
    globalImages.forEach(file =&gt; {
      const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
      if (fs.existsSync(sourcePath)) {
        const targetPath = path.join(globalSharedDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      }
    });
  } catch (error) {
    console.log(chalk.yellow(&#39;‚ö†Ô∏è Warning: Could not copy global images&#39;));
  }
}
</code></pre>
<ul>
<li>Facilitates the consistent inclusion of global resources, such as logos.</li>
<li>Reduces duplication of shared files by maintaining a single &quot;global&quot; directory.</li>
<li>Applies careful error handling to avoid breaking generation workflows due to missing files.</li>
</ul>
<hr>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">/**
 * Generate the entire adventure HTML structure
 */
async generateAdventure(): Promise&lt;void&gt; {
  console.log(chalk.yellow.bold(&#39;üöÄ Generating Adventure...&#39;));

  // Analyze project repository
  const repomixContent = await repoAnalyzer.generateRepomixContext(this.projectPath);

  // Generate themed story and quests
  const storyContent = await this.adventureManager.initializeAdventure(repomixContent, this.selectedTheme);
  
  this.extractQuestInfo();
  await this.generateQuestPages();
  await this.generateSummaryHTML();
}
</code></pre>
<ul>
<li>Orchestrates the entire process of generating the HTML output for an adventure.</li>
<li>Interfaces with repository analyzers, adventure managers, and asset managers.</li>
<li>Provides a cohesive sequence for managing dependencies between steps in the pipeline.</li>
</ul>
<pre><code class="language-typescript">/**
 * Generate pages for all themes
 */
async generateAllThemes(args: Map&lt;string, string&gt;): Promise&lt;void&gt; {
  const themes: AdventureTheme[] = [&#39;space&#39;, &#39;mythical&#39;, &#39;ancient&#39;, &#39;developer&#39;];
  
  for (const theme of themes) {
    console.log(`Starting generation for theme: ${theme}`);
    this.selectedTheme = theme;
    await this.generateAdventure();
  }
}
</code></pre>
<ul>
<li>Iteratively switches between themes, ensuring all necessary files are generated for each theme.</li>
<li>Allows users to preview adventures in different styles or audiences.</li>
</ul>
<pre><code class="language-typescript">/**
 * Start an HTTP server for local preview
 */
async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
  const server = http.createServer((req, res) =&gt; {
    let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url);

    fs.readFile(filePath, (err, content) =&gt; {
      if (err) {
        res.writeHead(404);
        res.end(&#39;File not found&#39;);
      } else {
        res.writeHead(200, { &#39;Content-Type&#39;: &#39;text/html&#39; });
        res.end(content);
      }
    });
  });

  server.listen(port);
  console.log(`üåê HTTP server started on http://localhost:${port}`);
}
</code></pre>
<ul>
<li>Provides a quick way to preview HTML output in a browser with a local HTTP server.</li>
<li>Dynamically serves the generated pages based on request paths.</li>
<li>Outputs clear console logs to indicate server status and accessibility.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Caching Efficiency</strong>: Examine how <code class="inline-code">loadTemplate</code> in <code class="inline-code">TemplateEngine</code> uses caching to optimize repeated template usage.</li>
<li><strong>Error Tracing</strong>: Watch how asset copying functions handle failures gracefully with fallback options.</li>
<li><strong>Local Preview</strong>: Use <code class="inline-code">startHttpServer</code> to immediately visualize changes to theme or adventure content.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of interstellar coding adventures.</p>
<p>Congratulations, Cadet! You‚Äôve ignited the warp core of learning in Quest 1: Cosmic HTML Foundry‚Äîyour journey through the coding cosmos is now set to rocket toward the stars! üöÄ‚≠êüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>