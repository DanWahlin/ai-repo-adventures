<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Navigating Galactic Protocols - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Voyage of the Galactic Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Navigating Galactic Protocols</h1>
<hr>
<p>As the <em>Codeseeker-42</em> hovers in orbit around an uncharted repository, the crew prepares to decipher the mysterious formats and cosmic rules of the Model Context Protocol (MCP). Your first mission is critical: establish interstellar communication by aligning our tools and systems with the pulsar signals of incoming data requests. The server must hum seamlessly as it connects our stellar tools to the MCP network and aids in unraveling the galaxy&#39;s coding enigmas. The fate of intergalactic code explorers rests in your hands, Cadet. Onward, to the outer reaches of structured data and precise tool execution!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server protocol implementation</h3>
<p>This file contains the infrastructure for the MCP server that powers the <em>Codeseeker-42</em>&#39;s adventures. It defines the <code class="inline-code">RepoAdventureServer</code>, which is responsible for registering tools, handling requests, and enabling communication between the crew&#39;s tools and the MCP network. Among its highlights, the <code class="inline-code">setupHandlers</code> function dynamically binds handlers for tool listing and execution while validating requests using schemas. The <code class="inline-code">run</code> function initializes the server‚Äôs connection via standard I/O and primes the repomix engine for smoother operation. The <code class="inline-code">main</code> function coordinates startup and ensures graceful error handling during unexpected cosmic disturbances. These elements combine to ensure the mission&#39;s foundation remains stable in the chaotic storm of uncharted repositories.</p>
<h4>Highlights</h4>
<ul>
<li><strong>RepoAdventureServer.setupHandlers</strong>: Configures handlers for dynamic tool discovery and execution.</li>
<li><strong>RepoAdventureServer.run</strong>: Connects to a standard I/O transport and pre-generates repomix content.</li>
<li><strong>main</strong>: Primary entry point; manages signals, errors, and ensures server readiness.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>Think of this like programming a spaceport docking system. Dynamic validators keep rogue ships (or invalid data) from landing, ensuring all traffic is orderly and secure.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>This function acts as a command bridge operator, initializing communication channels and running system readiness checks for the server.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>This is the pilot‚Äôs final checklist, confirming all systems are prepared for takeoff and ensuring readiness for potential emergencies.</p>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The 4 main MCP tools</h3>
<p>This file serves as the launchpad for the tools that guide <em>Codeseeker-42</em> on its adventures. The tools (e.g., <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>) power the interactive, gamified interactions between the crew and the MCP server. Each corresponds to a unique phase of exploration, from initiating the adventure framework to diving into specific quests and tracking mission status. The tools are modularly designed, re-exported for versatility and registration with the MCP.</p>
<h4>Highlights</h4>
<ul>
<li><strong>start_adventure.handler</strong>: Kicks off repository analysis and presents thematic options.</li>
<li><strong>choose_theme.handler</strong>: Creates thematic storylines and quests using user preferences.</li>
<li><strong>explore_quest.handler</strong>: Executes individual quest logic and tracks progress.</li>
<li><strong>view_progress.handler</strong>: Displays mission status and ongoing completions.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
</code></pre>
<p>Just as a launch sequence requires specific command modules, this line orchestrates the starting point for cosmic exploration.</p>
<pre><code class="language-typescript">import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
</code></pre>
<p>This is akin to letting the crew select their mission theme‚Äîwhether it‚Äôs deciphering black hole codebases or rebuilding nebulae repositories.</p>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>Think of this as equipping the captain‚Äôs toolkit: every tool is ready for seamless usage on the next cosmic coding quest.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">setupHandlers</code> to streamline the addition of new tools and ensure schema validation for consistent response handling.</li>
<li>Modularize tool functions as seen in <code class="inline-code">tools.ts</code> for extensibility; each phase of exploration becomes easier to debug and enhance.</li>
<li>Always warm up the repomix engine to minimize cold start delays in analyzing new repositories.</li>
</ul>
<hr>
<p>Mission Complete, Captain. The MCP server is calibrated, and your tools are primed for interstellar exploration!</p>
<p>Quest 1 complete: You&#39;ve successfully charted the cosmic currents of Galactic Protocols‚Äîstellar navigation skills like yours light the path to interstellar glory! üöÄ‚≠êüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: Commanding the Quest Generator ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>