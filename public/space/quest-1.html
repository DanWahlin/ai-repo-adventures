<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: MCP Tool Interface - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Stellar Repository Expeditions</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: MCP Tool Interface</h1>
<hr>
<p>In the vast cosmic expanse of the codebase galaxy, a starship known as &quot;Repo Adventure&quot; awaits activation. Today, the mission brings us to the MCP Tool Interface‚Äîan advanced command console designed to interact with specialized code exploration tools. As captain, your task is to assess the starship‚Äôs operational capabilities: dynamically listing available tools, executing them with precision, and safely navigating error constellations. Embark on this stellar investigation of interconnected systems to unlock the power of MCP tools and chart the unknown realms of repository adventures.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Tool Alignment</strong>: How does <code class="inline-code">RepoAdventureServer.setupHandlers</code> dynamically list available tools and ensure their schemas are accurate representations?</li>
<li>‚ö° <strong>Mission Activation</strong>: What sequence of operations does <code class="inline-code">RepoAdventureServer.run</code> perform during server initialization and tool cache warm-up?</li>
<li>üõ°Ô∏è <strong>Error Orbit Analysis</strong>: How does the <code class="inline-code">main</code> function handle server errors and ensure a smooth shutdown during unexpected challenges?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server and Tool Integration</h3>
<p>This file is the control center of the MCP server, implementing key functionality like tool registration and request handling. The <code class="inline-code">setupHandlers</code> method dynamically incorporates tools from <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a>, validating parameters with Zod schemas and executing handlers when tools are invoked. Meanwhile, the <code class="inline-code">run</code> method orchestrates server initialization, connects with the communication transport, and triggers utility pre-generation to optimize subsequent use. The <code class="inline-code">main</code> function wraps everything together with signal handling and robust error management, ensuring mission continuity during unforeseen events.</p>
<h4>Highlights</h4>
<ul>
<li>Dynamic tool listing and validation via <code class="inline-code">setupHandlers</code></li>
<li>Server initialization and transport configuration in <code class="inline-code">run</code></li>
<li>Graceful shutdown and error handling in <code class="inline-code">main</code></li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>This method ensures the tools and their schemas align perfectly with operational requirements, like starship modules prepared for deployment.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>The starship‚Äôs cosmic engines ignite as the MCP server undergoes cargo pre-generation‚Äîwarming up for interstellar expeditions.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>Like a stellar captain ensuring smooth mission completion, the <code class="inline-code">main</code> function saves the ship from derailment during cosmic hazards.</p>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Tool Repository</h3>
<p>This file provides the essential resources for the MCP server, defining the tools available for exploration missions. Each tool has its own unique behavior, schema, and handler, with key functionalities exported for seamless integration into the server. The organization of tools reflects a stellar alignment of varied modules harnessed for code exploration greatness.</p>
<h4>Highlights</h4>
<ul>
<li>Registration of primary tools in <code class="inline-code">tools</code></li>
<li>Handler definitions for individual tools: <code class="inline-code">start_adventure.handler</code>, <code class="inline-code">choose_theme.handler</code>, <code class="inline-code">explore_quest.handler</code>, <code class="inline-code">view_progress.handler</code></li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export const tools = {
  start_adventure: startAdventure,
  choose_theme: chooseTheme,
  explore_quest: exploreQuest,
  view_progress: viewProgress
};
</code></pre>
<p>The constellation of tools are mapped and prepared for deployment within the mission toolkit, awaiting captain commands.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Familiarize yourself with Zod schemas used to validate tool parameters‚Äîprecision is key for execution accuracy.</li>
<li>Investigate how tools dynamically integrate with the server&#39;s request handlers, ensuring seamless interaction.</li>
<li>Explore error-handling techniques to ensure robustness under unexpected cosmic conditions.</li>
</ul>
<hr>
<p>Your mission begins! Explore the interface and steer the starship to new repository galaxies. Stellar success awaits, adventurer!</p>
<p>Stellar work navigating Quest 1: MCP Tool Interface‚Äîyou&#39;re officially cleared for launch on your cosmic learning mission, Cadet, so keep fueling those thrusters! üöÄüåüüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>