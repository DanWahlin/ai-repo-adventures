<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Stellar Forge Pipeline - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Codex: Chronicles of the Stellar Repository</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Stellar Forge Pipeline</h1>
<hr>
<p>In the year 3027, the galaxy teems with secrets waiting to be unlocked. Your crew aboard the starship <em>Codemancer</em> intercepts data resonating through the Stellar Repository ‚Äì the ancient, enigmatic archive. The repository contains blueprints for the Stellar Forge Pipeline, a system rumored to create vast networks of interstellar links, enabling seamless communication between star systems. To understand its machinations, you must analyze layered components of generation templates, asset management, and HTML rendering procedures. The path to retrieving the cosmic patterns begins now.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Galactic Rendering Systems</strong>: How does the <code class="inline-code">TemplateEngine.renderPage</code> method generate complete, dynamic pages for quests?</li>
<li>‚ö° <strong>Mission Resource Flow</strong>: What patterns does <code class="inline-code">AssetManager.copyGlobalAssets</code> use for resource management, and how does it ensure cross-theme consistency?</li>
<li>üõ°Ô∏è <strong>Interstellar Integrity Checks</strong>: How does <code class="inline-code">HTMLAdventureGenerator.startHttpServer</code> handle security and ensure access is controlled for local file serving?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> Template Engine for Quest Rendering</h3>
<p>This file implements the <code class="inline-code">TemplateEngine</code> class, which is pivotal for generating HTML content dynamically. It focuses on loading templates, replacing placeholders, and rendering complete pages using a modular structure. The <code class="inline-code">renderPage</code> method is central to integrating specific content with a pre-defined base layout. This ensures flexibility in adapting various quest themes and maintaining stellar consistency.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">renderPage</code>: Combines base templates with content placeholders to generate complete quest pages.</li>
<li><code class="inline-code">replacePlaceholders</code>: Substitutes dynamic placeholders in a template with contextual variables.</li>
<li><code class="inline-code">loadTemplate</code>: Implements caching for templates to avoid redundant file reads.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">/**
 * Render a complete page using base template + content template
 */
renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  
  // First render the content template
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  
  // Then render the base template with the content
  const pageVariables = {
    ...variables,
    CONTENT: renderedContent
  };
  
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>Combines <code class="inline-code">base-template.html</code> with specific content templates to create cohesive pages.</li>
<li>Leverages <code class="inline-code">replacePlaceholders</code> to dynamically inject variables ensuring that the output reflects each quest&#39;s context.</li>
<li>Promotes reusability through separation of base structure and unique content.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> Managing Resources for the Adventure</h3>
<p>The <code class="inline-code">AssetManager</code> class in this file is responsible for copying and managing assets like images, CSS, and global resources for HTML adventures. Its streamlined functions ensure multi-theme compatibility and optimize resource handling, even in multi-quest pipelines.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyGlobalAssets</code>: Copies shared assets like global images and CSS to the output directory.</li>
<li><code class="inline-code">copyQuestNavigator</code>: Moves navigation-related files to the quest-specific output folder.</li>
<li><code class="inline-code">copyImages</code>: Manages theme-specific and shared image resources for seamless visual integration.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/asset-manager.ts</h3>
<pre><code class="language-typescript">/**
 * Copy global shared assets for multi-theme generation
 */
copyGlobalAssets(outputDir: string): void {
  try {
    const globalAssetsDir = path.join(outputDir, &#39;assets&#39;);
    const targetImagesDir = path.join(globalAssetsDir, &#39;images&#39;);
    fs.mkdirSync(targetImagesDir, { recursive: true });

    // Copy global shared images to shared directory  
    const globalSharedDir = path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;);
    fs.mkdirSync(globalSharedDir, { recursive: true });
    
    const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
    globalImages.forEach(file =&gt; {
      const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
      if (fs.existsSync(sourcePath)) {
        const targetPath = path.join(globalSharedDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      }
    });

    // Copy header image for theme selection page
    const headerImageSource = path.join(this.sourceDir, &#39;assets&#39;, &#39;images&#39;, &#39;ai-adventures.png&#39;);
    if (fs.existsSync(headerImageSource)) {
      const headerImageTarget = path.join(targetImagesDir, &#39;ai-adventures.png&#39;);
      fs.copyFileSync(headerImageSource, headerImageTarget);
    }
  } catch (error) {
    console.log(chalk.yellow(&#39;‚ö†Ô∏è Warning: Could not copy global images&#39;));
  }
}
</code></pre>
<ul>
<li>Ensures important shared resources like global assets (e.g., <code class="inline-code">ai-adventures.png</code>) are available for all themes.</li>
<li>Centrally manages paths, preventing duplication or path conflicts across systems.</li>
<li>Guarantees directory integrity by creating necessary folders before files are copied.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> Dynamic Page &amp; Server Initialization</h3>
<p>The <code class="inline-code">HTMLAdventureGenerator</code> class orchestrates the rendering and serving of generated HTML files. Using highly modular techniques, each generated adventure site can be previewed locally. The <code class="inline-code">startHttpServer</code> method provides a localized server to view generated quests while ensuring unauthorized access is prohibited.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">startHttpServer</code>: Facilitates a lightweight HTTP server to preview adventures while ensuring directory security.</li>
<li><code class="inline-code">generateAdventure</code>: Orchestrates quest rendering, resource linking, and theme integration across themes.</li>
<li><code class="inline-code">buildQuestHTML</code>: Customizes each quest&#39;s layout by integrating unique content, navigation, and templates.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">/**
 * Start an HTTP server in the output directory
 */
private async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
  return new Promise((resolve, reject) =&gt; {
    const server = http.createServer((req, res) =&gt; {
      let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);
      
      // Security check - ensure we stay within the directory
      if (!filePath.startsWith(this.outputDir)) {
        res.writeHead(403);
        res.end(&#39;Forbidden&#39;);
        return;
      }

      // Set content type based on file extension
      const extname = path.extname(filePath);
      let contentType = &#39;text/html&#39;;
      switch (extname) {
        case &#39;.js&#39;:
          contentType = &#39;text/javascript&#39;;
          break;
        case &#39;.css&#39;:
          contentType = &#39;text/css&#39;;
          break;
        case &#39;.json&#39;:
          contentType = &#39;application/json&#39;;
          break;
        case &#39;.png&#39;:
          contentType = &#39;image/png&#39;;
          break;
        case &#39;.jpg&#39;:
          contentType = &#39;image/jpg&#39;;
          break;
        case &#39;.svg&#39;:
          contentType = &#39;image/svg+xml&#39;;
          break;
      }

      fs.readFile(filePath, (err, content) =&gt; {
        if (err) {
          if (err.code === &#39;ENOENT&#39;) {
            res.writeHead(404);
            res.end(&#39;File not found&#39;);
          } else {
            res.writeHead(500);
            res.end(&#39;Server error&#39;);
          }
        } else {
          res.writeHead(200, { &#39;Content-Type&#39;: contentType });
          res.end(content, &#39;utf-8&#39;);
        }
      });
    });

    server.listen(port, () =&gt; {
      const url = `http://localhost:${port}`;
      console.log(chalk.green(`üåê HTTP server started on ${url}`));
      
      // Open browser after a brief delay
      setTimeout(() =&gt; {
        this.openBrowser(url);
      }, 1000);
      
      console.log(chalk.dim(&#39;\nüí° Press Ctrl+C to stop the server when you\&#39;re done exploring&#39;));
      
      // Keep the server running - user will stop with Ctrl+C
      process.on(&#39;SIGINT&#39;, () =&gt; {
        console.log(chalk.yellow(&#39;\nüëã Shutting down HTTP server...&#39;));
        server.close(() =&gt; {
          console.log(chalk.green(&#39;‚úÖ Server stopped successfully!&#39;));
          process.exit(0);
        });
      });
      
      process.on(&#39;SIGTERM&#39;, () =&gt; {
        server.close(() =&gt; process.exit(0));
      });
      
      resolve();
    });

    server.on(&#39;error&#39;, (err) =&gt; {
      console.error(chalk.red(&#39;‚ùå Failed to start HTTP server:&#39;), err);
      console.log(chalk.yellow(&#39;\nüìÅ Files are still available at:&#39;));
      console.log(chalk.cyan(`  ${this.outputDir}`));
      reject(err);
    });
  });
}
</code></pre>
<ul>
<li>Implements safeguards to prevent directory traversal attacks by ensuring <code class="inline-code">filePath</code> starts within <code class="inline-code">outputDir</code>.</li>
<li>Dynamically sets content type to handle multiple asset types (e.g., CSS, JS, images).</li>
<li>Facilitates an intuitive server startup process with visual feedback and auto-browser launch.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Pre-cache templates</strong>: The <code class="inline-code">TemplateEngine</code> method <code class="inline-code">loadTemplate</code> can optimize performance when applied to frequently used templates.</li>
<li><strong>Secure your assets</strong>: The <code class="inline-code">AssetManager</code> ensures flexibility across single or multi-theme pipelines; replicate its modular resource allocation across systems.</li>
<li><strong>Validate server paths</strong>: Ensure critical resources are only accessible from within the output directory to prevent accidental leakage.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Stellar Repository.</p>
<p>Your rocket has ignited, and in completing Quest 1: The Stellar Forge Pipeline, you&#39;ve launched into the vast cosmos of discovery‚Äîstellar progress, cadet! üöÄ‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>