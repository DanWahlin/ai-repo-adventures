<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The MCP Command Module - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Galactic Odyssey: The Codebase Chronicles</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Navigating the MCP Command Module</h1>
<hr>
<p>Beneath the flickering glow of the <strong>AI Repository Nexus</strong>, you find yourself in the MCP Command Module, its panels alive with streams of data cascading down like cosmic waterfalls. The Repomix Engines hum beneath your feet, awaiting your instructions to weave interstellar narratives from the repository&#39;s depths. The control interface crackles to life, a voice intoning, &quot;Pathways unlocked‚Äîadventures ahead.&quot; But first, you must master the tools at your disposal and align your exploration with the heartbeat of the journey. Your mission? Configure this galactic storyteller and chart the stars of its codebase.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>The <code class="inline-code">server.ts</code> file serves as the operational nucleus of the MCP system, orchestrating tool communication and managing the lifecycle of the adventure server. At its core, the <code class="inline-code">RepoAdventureServer</code> class is responsible for setting up protocol handlers for managing <code class="inline-code">ListTools</code> and <code class="inline-code">CallTool</code> requests, ensuring the MCP tools can be executed on command. This file also includes the <code class="inline-code">main</code> function, which acts as the program&#39;s entry point. It oversees the orderly startup and shutdown of the server, safeguarding processes from unexpected interruptions. </p>
<p>A key aspect of the <code class="inline-code">RepoAdventureServer</code> class is the <code class="inline-code">run()</code> method, which establishes a connection to the <code class="inline-code">StdioServerTransport</code>. This communication pipeline ensures seamless interaction between the tools and the MCP system. Additionally, it initiates a <code class="inline-code">repoAnalyzer</code> operation to generate Repomix content for the current project directory. This feature facilitates quicker access to adventure-related data by pre-caching relevant information. By streamlining error handling and integrating hooks for graceful shutdowns, this file ensures that the MCP server remains robust and resilient.</p>
<h4>Highlights</h4>
<ul>
<li>The <code class="inline-code">setupHandlers()</code> method establishes handlers for protocol requests, mapping tools dynamically.</li>
<li>The <code class="inline-code">run()</code> method connects the <code class="inline-code">StdioServerTransport</code> and triggers Repomix content pre-generation.</li>
<li>The <code class="inline-code">main</code> function gracefully manages shutdown signals such as <code class="inline-code">SIGINT</code> or <code class="inline-code">SIGTERM</code>.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools Entry Point</h3>
<p>The <code class="inline-code">tools.ts</code> file functions as a central hub for defining and registering the four core MCP tools: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. These tools represent the interactive modules that enable users to analyze, customize, and engage with codebases in dynamic ways. Each tool is designed with a specific purpose, from initializing an adventure to tracking progress, ensuring a cohesive narrative journey for adventurers exploring the digital galaxy.</p>
<p>Notably, these tools leverage the capabilities of the <code class="inline-code">adventureManager</code> module to maintain context and progress across user interactions. By separating logic into dedicated files, the architecture promotes maintainability and scalability. For example, <code class="inline-code">startAdventure</code> focuses on repository analysis and initialization, while <code class="inline-code">exploreQuest</code> enables on-demand navigation through specific quests. Through its modular design, the <code class="inline-code">tools.ts</code> file exemplifies how well-structured code can enhance functionality while minimizing complexity.</p>
<h4>Highlights</h4>
<ul>
<li>Centralized access to the four primary MCP tools.</li>
<li>Exports <code class="inline-code">adventureManager</code> for shared state management.</li>
<li>Promotes modularity by separating logic into distinct tool files.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, {
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(
          ErrorCode.MethodNotFound,
          `Unknown tool: ${name}`
        );
      }

      const tool = tools[name as keyof typeof tools];

      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt;
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>This is like the switchboard of a telephone network, intelligently routing requests to the correct destinations.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { adventureManager } from &#39;@ai-repo-adventures/core/adventure&#39;;
import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export { adventureManager };

export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This acts as a central directory, ensuring every tool is appropriately labeled and ready for use.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Investigate how handlers in <code class="inline-code">setupHandlers()</code> validate tool arguments using the Zod schema library.</li>
<li>To expand functionality, consider integrating additional metrics into the <code class="inline-code">view_progress</code> tool for deeper insights.</li>
<li>Continue exploring <code class="inline-code">adventureManager</code> to see how state syncing is maintained across quests.</li>
</ul>
<hr>
<p>Mission Accomplished: Quest 1 complete‚Äîyour stellar mastery of the MCP Command Module propels you one giant leap closer to conquering the cosmic frontier! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Quest Forge ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>