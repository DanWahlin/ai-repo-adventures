<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The MCP Command Table - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Adventures: The Codebase Chronicles</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The MCP Command Table</h1>
<hr>
<p>In the infinite void of space, aboard the starship <strong>Codebreaker</strong>, your crew stumbles upon a spatial anomaly‚Äîa pulsating cosmic flux. Within its radiance lies the secret to accessing the <strong>MCP Command Table</strong>, an essential interface for making sense of the galaxy‚Äôs most intricate data structures. To decode its mysteries, your team must engage the ship‚Äôs MCP Tool Interface, a pivotal system that enables interactive storytelling and expedition management. The fate of your mission rests on successfully engineering this stellar gateway.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Initialization and Tooling Interface</h3>
<p>The file implements the backbone architecture for the command table, defining crucial server-side interactions. Key highlights include <code class="inline-code">RepoAdventureServer.setupHandlers</code> to dynamically register MCP tools, <code class="inline-code">RepoAdventureServer.run</code> for initializing the global adventure interface, and <code class="inline-code">main</code> for activating the server. Here, the <strong>Codebreaker</strong> metaphorically turns technical handlers into cosmic navigational aides. Its star map includes tools to list capabilities, validate schema-based user input, and execute specialized handlers. This file represents the galactic router, translating explorer commands into focused outputs.</p>
<h4>Highlights</h4>
<ul>
<li>Tool registration and schema validation via <code class="inline-code">RepoAdventureServer.setupHandlers</code></li>
<li>Adventure server launch sequence through <code class="inline-code">RepoAdventureServer.run</code></li>
<li>Graceful shutdown and error handling from the <code class="inline-code">main</code> function</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        return await tool.handler(validationResult.data as any);

      } catch (error) {
        throw new McpError(ErrorCode.InternalError, `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`);
      }
    });
}
</code></pre>
<p>Much like assembling components of a stellar navigation system, this block brings tools into actionable alignment, with schemas acting as gravitational coordinates for validation.</p>
<pre><code class="language-typescript">async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
    const projectPath = process.cwd();
    console.error(`Pre-generating repomix content for project at ${projectPath}...`);
    repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>Similar to priming a hyperspace engine, the server warms up with heuristic analysis, leveraging <code class="inline-code">repoAnalyzer</code> to set the mission stage before launch.</p>
<pre><code class="language-typescript">async function main() {
    try {
        const server = new RepoAdventureServer();
        [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; process.on(sig as NodeJS.Signals, gracefulShutdown));
        process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
            console.error(&#39;Unhandled promise rejection:&#39;, reason);
        });
        await server.run();
    } catch (error) {
      console.error(&#39;Fatal error starting MCP server:&#39;, error);
      process.exit(1);
    }
}
</code></pre>
<p>This sequence mirrors a command bridge receiving transmissions and adjusting starship parameters before final lift-off.</p>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools Configuration</h3>
<p>The <code class="inline-code">tools.ts</code> file defines the operational toolkit available for cosmic data exploration. It functions as the space-control console, where tools like <code class="inline-code">start_adventure.handler</code> and <code class="inline-code">choose_theme.handler</code> operate as voyage modulations. The highlights encapsulate four key tools‚Äî<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. These act as individual missions tied to overarching quests, crafting unique pathways for explorers into the galactic data ecosystem.</p>
<h4>Highlights</h4>
<ul>
<li>Initialization via <code class="inline-code">start_adventure.handler</code></li>
<li>Theme selection from <code class="inline-code">choose_theme.handler</code></li>
<li>In-depth exploration handled by <code class="inline-code">explore_quest.handler</code></li>
<li>Progress monitoring enabled by <code class="inline-code">view_progress.handler</code></li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
</code></pre>
<p>Like firing thrusters to commence exploration, this hook initializes the interface for cosmic journey preparation.</p>
<pre><code class="language-typescript">export const choose_theme = chooseTheme;
</code></pre>
<p>This block serves as setting the ship‚Äôs course, with a thematic compass guiding adventurers toward uncovering nuanced galactic arcs.</p>
<pre><code class="language-typescript">export const explore_quest = exploreQuest;
</code></pre>
<p>The explorer lands on foreign worlds, uncovering unique quests tied to different star systems, much like deciphering encrypted nebular coordinates.</p>
<pre><code class="language-typescript">export const view_progress = viewProgress;
</code></pre>
<p>Analogue to monitoring ship diagnostics post-mission, this tool charts overall progress and highlights remaining objectives.</p>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Tip:</strong> Use tools sequentially (e.g., begin with <code class="inline-code">start_adventure</code>) to unlock immersive quest paths.  </li>
<li><strong>Recommendation:</strong> Explore schema-validation capabilities in <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> to optimize tool interactions.  </li>
<li><strong>Next Steps:</strong> Harness advanced prompts in companion systems for more intricate adventures, tying data pipelines with storytelling.</li>
</ul>
<hr>
<p>The Codebreaker‚Äôs role in space exploration just became cosmic‚Äîprepare your crew for the mission ahead!</p>
<p>Stellar achievement, commander‚ÄîQuest 1: The MCP Command Table is successfully navigated; your cosmic journey has ignited at full thrust toward the stars! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>