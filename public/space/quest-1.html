<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Building the Stellar Nexus - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Cosmic Code Chronicles: Navigating the Nebula of Innovation</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Building the Stellar Nexus</h1>
<hr>
<p>In the vast expanse of your starship&#39;s mission to unlock the intricate workings of the MCP (Model Code Protocol) architecture, a critical objective emerges: constructing the &quot;Stellar Nexus.&quot; This is the command center for your galactic code exploration. To achieve this, your task is to analyze the <code class="inline-code">HTMLAdventureGenerator</code>, <code class="inline-code">TemplateEngine</code>, and <code class="inline-code">AssetManager</code> systemsâ€”three core subsystemsâ€”the graviton engines of storytelling. By aligning these systems, you can mold your starship&#39;s pipeline into a precise adventure generator, breathing life into galactic code realms. Letâ€™s orbit closer to the code&#39;s heart.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>ğŸ” <strong>Nexus Blueprint Scanning</strong>: How does the <code class="inline-code">HTMLAdventureGenerator</code> orchestrate the generation of quests, assets, and the overall adventure pipeline in the provided codebase?</li>
<li>âš¡ <strong>Placeholder Synchronization</strong>: How does the <code class="inline-code">TemplateEngine</code> efficiently load templates and manage variable substitutions to tailor dynamic quest pages seamlessly?</li>
<li>ğŸ›¡ï¸ <strong>Asset Transport System Safety</strong>: How does <code class="inline-code">AssetManager</code> handle file copying operations across directories, and what safeguards are in place to address errors during this process?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> Galactic Mission Orchestrator</h3>
<p>The <code class="inline-code">HTMLAdventureGenerator</code> acts as the control hub for generating HTML adventures. It bridges the content processing, template rendering, and asset inclusion, ensuring that interstellar adventures are generated efficiently. The methods highlighted here demonstrate its inner workings, from constructing quests to tailoring themes.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code>: Constructs the entire adventure pipeline, including quest creation, asset management, and navigation.</li>
<li><code class="inline-code">generateAllThemes</code>: Facilitates the generation of multiple themed adventures in parallel using isolated subdirectories.</li>
<li><code class="inline-code">startHttpServer</code>: Deploys a local HTTP server to preview the constructed adventures, simulating deployment in a cosmic dockyard.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">async generateAdventure(): Promise&lt;void&gt; {
  console.log(chalk.yellow.bold(&#39;ğŸš€ Generating Adventure...&#39;));
  const repomixContent = await repoAnalyzer.generateRepomixContext(this.projectPath);
  const projectInfo = createProjectInfo(repomixContent);
  const storyContent = await this.adventureManager.initializeAdventure(projectInfo, this.selectedTheme, this.projectPath, this.customThemeData);
  this.extractQuestInfo();
  const questsToGenerate = this.maxQuests !== undefined ? Math.min(this.maxQuests, this.quests.length) : this.quests.length;
  this.quests = this.quests.slice(0, questsToGenerate);

  this.generateThemeCSS();
  this.copyQuestNavigator();
  this.copyImages();
  this.generateIndexHTML();
  await this.generateQuestPages();
  await this.generateSummaryHTML();
}
</code></pre>
<ul>
<li>ğŸš§ <strong>Pipeline Control</strong>: This function constructs the core adventure pipeline, handling everything from story initialization to the generation of individual quest pages.</li>
<li>ğŸ“œ <strong>Data Processing</strong>: The flow leverages <code class="inline-code">adventureManager.initializeAdventure</code> to dynamically build story content and quests tailored to the selected theme.</li>
<li>ğŸ”— <strong>Subsystem Integration</strong>: Calls various helper functions (e.g., <code class="inline-code">generateThemeCSS</code>, <code class="inline-code">copyQuestNavigator</code>) to ensure smooth coordination among all components.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateAllThemes(args: Map&lt;string, string&gt;): Promise&lt;void&gt; {
  this.isMultiTheme = true;
  this.outputDir = args.get(&#39;output&#39;) || &#39;./public&#39;;
  const themes: AdventureTheme[] = [&#39;space&#39;, &#39;mythical&#39;, &#39;ancient&#39;, &#39;developer&#39;];
  
  const themePromises = themes.map(async (theme) =&gt; {
    const themeGenerator = new HTMLAdventureGenerator();
    themeGenerator[&#39;selectedTheme&#39;] = theme;
    themeGenerator[&#39;outputDir&#39;] = path.join(this.outputDir, theme);
    await themeGenerator.generateAdventure();
  });

  await Promise.allSettled(themePromises);
  this.generateHomepageIndex();
  this.copyGlobalAssets();
}
</code></pre>
<ul>
<li>ğŸŒŒ <strong>Parallel Theme Generation</strong>: Iterates through multiple themes and spins off isolated instances of <code class="inline-code">HTMLAdventureGenerator</code> to process each theme independently.</li>
<li>ğŸ§© <strong>Directory Separation</strong>: Maps each theme&#39;s generation to a dedicated subdirectory within the output directory.</li>
<li>ğŸŒ <strong>Global Structure</strong>: Concludes by generating a unified homepage index and copying shared assets to the root output directory.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
  const server = http.createServer((req, res) =&gt; {
    let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);
    if (!filePath.startsWith(this.outputDir)) {
      res.writeHead(403);
      res.end(&#39;Forbidden&#39;);
      return;
    }

    fs.readFile(filePath, (err, content) =&gt; {
      if (err) {
        res.writeHead(err.code === &#39;ENOENT&#39; ? 404 : 500);
        res.end(&#39;File not found&#39;);
      } else {
        res.writeHead(200, { &#39;Content-Type&#39;: &#39;text/html&#39; });
        res.end(content, &#39;utf-8&#39;);
      }
    });
  });
  server.listen(port);
}
</code></pre>
<ul>
<li>ğŸŒ <strong>Local Deployment</strong>: This method starts an HTTP server to preview the generated HTML output locally, suitable for validating the interstellar adventures.</li>
<li>ğŸ›¡ï¸ <strong>Security Check</strong>: Ensures requests do not access files outside the designated output directory.</li>
<li>ğŸ” <strong>Error Management</strong>: Responds gracefully to missing files with 404 errors and server issues with 500 errors.</li>
</ul>
<hr>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> Template Mutation Drive</h3>
<p>The <code class="inline-code">TemplateEngine</code> is a powerhouse, dynamically customizing adventure templates. This helps turn predefined blueprints into unique missions filled with vivid imagery and details.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">renderPage</code>: Generates complete HTML pages by layering content templates and applying variable placeholders.</li>
<li><code class="inline-code">replacePlaceholders</code>: Searches for placeholders in templates and substitutes them based on provided variables.</li>
<li><code class="inline-code">loadTemplate</code>: Loads and caches template files to optimize rendering performance.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  const pageVariables = { ...variables, CONTENT: renderedContent };
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>ğŸš€ <strong>Dynamic Rendering</strong>: Merges content templates into a base layout, ensuring seamless integration and consistent styling.</li>
<li>ğŸ”§ <strong>Variable Substitution</strong>: Allows dynamic customization of content through the <code class="inline-code">replacePlaceholders</code> function.</li>
</ul>
<hr>
<pre><code class="language-typescript">private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;
  for (const [key, value] of Object.entries(variables)) {
    result = result.replace(new RegExp(`{{${key}}}`, &#39;g&#39;), value || &#39;&#39;);
  }
  return result;
}
</code></pre>
<ul>
<li>ğŸª <strong>Flexible Substitution</strong>: Matches placeholders (<code class="inline-code">{{key}}</code>) in the template with provided values, ensuring adaptability to dynamic content.</li>
</ul>
<hr>
<pre><code class="language-typescript">private loadTemplate(templateName: string): string {
  if (this.templateCache.has(templateName)) {
    return this.templateCache.get(templateName)!;
  }

  const templatePath = path.join(this.templatesDir, templateName);
  const content = fs.readFileSync(templatePath, &#39;utf-8&#39;);
  this.templateCache.set(templateName, content);
  return content;
}
</code></pre>
<ul>
<li>âš¡ <strong>Caching Efficiency</strong>: Avoids reloading template files repeatedly, enhancing performance by storing loaded templates in memory.</li>
<li>ğŸ› ï¸ <strong>File Management</strong>: Validates file existence and content, ensuring smooth operation during runtime.</li>
</ul>
<hr>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> Asset Transport System</h3>
<p>The <code class="inline-code">AssetManager</code> handles file operations, such as copying assets (e.g., images, CSS) to the appropriate output directories, ensuring adventures have the resources needed to shine.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyGlobalAssets</code>: Transfers global assets like shared images and styles to the output directory for universal access.</li>
<li><code class="inline-code">copyQuestNavigator</code>: Copies theme-specific navigator assets for proper quest progression.</li>
<li><code class="inline-code">copyImages</code>: Handles the transfer of image assets to the appropriate directories, supporting both shared and theme-specific contexts.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/asset-manager.ts</h3>
<pre><code class="language-typescript">copyGlobalAssets(outputDir: string): void {
  const globalAssetsDir = path.join(outputDir, &#39;assets&#39;);
  const targetImagesDir = path.join(globalAssetsDir, &#39;images&#39;);
  fs.mkdirSync(targetImagesDir, { recursive: true });
  const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
  globalImages.forEach(file =&gt; {
    const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
    fs.copyFileSync(sourcePath, path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;, file));
  });
}
</code></pre>
<ul>
<li>ğŸŒŒ <strong>Global Accessibility</strong>: Ensures universal assets are correctly placed for accessibility in any adventure context.</li>
<li>ğŸ›¡ï¸ <strong>Safe File Operations</strong>: Uses recursive directory creation and safe copying methods to avoid common file-handling pitfalls.</li>
</ul>
<hr>
<pre><code class="language-typescript">copyQuestNavigator(outputDir: string): void {
  const templatesDir = path.join(this.sourceDir, &#39;templates&#39;);
  const cssSource = path.join(templatesDir, &#39;quest-navigator.css&#39;);
  const jsSource = path.join(templatesDir, &#39;quest-navigator.js&#39;);
  fs.copyFileSync(cssSource, path.join(outputDir, &#39;assets&#39;, &#39;quest-navigator.css&#39;));
  fs.copyFileSync(jsSource, path.join(outputDir, &#39;assets&#39;, &#39;quest-navigator.js&#39;));
}
</code></pre>
<ul>
<li>ğŸ—ºï¸ <strong>Theme Navigation</strong>: Transfers essential assets for interactive navigation within theme-specific adventures.</li>
<li>ğŸ“‚ <strong>Adaptability</strong>: Easily locates and replicates resources, enabling efficient application in multiple directories.</li>
</ul>
<hr>
<pre><code class="language-typescript">copyImages(outputDir: string, isMultiTheme: boolean = false): void {
  const sourceImagesDir = path.join(this.sourceDir, &#39;assets&#39;, &#39;images&#39;);
  const targetImagesDir = path.join(outputDir, &#39;assets&#39;, &#39;images&#39;);
  fs.mkdirSync(targetImagesDir, { recursive: true });
  fs.readdirSync(sourceImagesDir).forEach(file =&gt; {
    fs.copyFileSync(path.join(sourceImagesDir, file), path.join(targetImagesDir, file));
  });
}
</code></pre>
<ul>
<li>ğŸ“¸ <strong>Visual Harmony</strong>: Transfers image assets to align with generated adventures, enhancing visual storytelling.</li>
<li>ğŸš¨ <strong>Error Mitigation</strong>: Employs checks to ensure images exist before attempting operations, preventing runtime failures.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>ğŸ› ï¸ <strong>Optimization Tip</strong>: Revisit the caching mechanism in <code class="inline-code">TemplateEngine</code> to reduce redundant file system operations.</li>
<li>ğŸ”­ <strong>Exploration Idea</strong>: Enhance error detection in the <code class="inline-code">AssetManager</code> for environments with limited permissions.</li>
<li>ğŸŒŸ <strong>Next Milestone</strong>: Proceed to the next quest to analyze dynamic content and story generation within the <code class="inline-code">AdventureManager</code>.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission accomplished, stellar pioneer: the Stellar Nexus is fully operational, igniting your cosmic journey with boundless possibilitiesâ€”keep rocketing toward the stars! ğŸš€â­âš¡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>