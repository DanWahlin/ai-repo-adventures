<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Nebula of Code Analysis - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Lumina: The Odyssey of Code</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Nebula of Code Analysis</h1>
<hr>
<p>Beyond the shimmering waves of cosmic light lay the Nebula of Code Analysis, a swirling maelstrom of complex repositories waiting to be deciphered. Commanders of the <em>Starship Lumina</em> aimed their tools at this celestial challenge, tasked with piercing through the fog of undocumented functions and misplaced imports. This time, their mission was clear: utilize the mighty Repomix Analyzer and LLM integration to uncover the most critical files, revealing the blueprint of the Model Context Protocol‚Äôs core systems. Every line of code held the key to progress.</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a>: Repomix Integration for Code Analysis</h3>
<p>The <code class="inline-code">repo-analyzer.ts</code> file is the strategic tool for extracting valuable insights from repository galaxies. Acting as the bridge between the vast codebases and the <em>Lumina‚Äôs</em> analytical systems, it harnesses the power of Repomix to generate both full and targeted content from any project. With security protocols such as <code class="inline-code">validateProjectPath()</code> and <code class="inline-code">validateAndNormalizeTargetFiles()</code>, it ensures the integrity of analysis remains pristine‚Äîeven within the turbulence of uncharted directories. Coded safeguards prevent null byte exploits, path traversal attacks, and overloading with excessive files. Notably, its <code class="inline-code">generateRepomixContext()</code> function enables comprehensive scans with caching efficiency, while <code class="inline-code">generateTargetedContent()</code> focuses on reducing noise by analyzing specific files.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateProjectPath()</code>: Secures directory traversal and ensures valid project paths for scanning.</li>
<li><code class="inline-code">generateRepomixContext()</code>: Provides adaptive analysis for entire repositories with caching.</li>
<li><code class="inline-code">captureRepomixStdout()</code>: Executes secure subprocess calls to Repomix for CLI-based output collection.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a>: Multi-provider LLM Request Engine</h3>
<p>This file is the <em>Lumina‚Äôs</em> communication portal to the galaxy‚Äôs most advanced reasoning engines: OpenAI, Azure, and GitHub models. The <code class="inline-code">llm-client.ts</code> file manages the seamless generation of responses from large language models, handling providers with different APIs and architectures. Its <code class="inline-code">generateResponse()</code> method spearheads the process, bringing clarity to queries with built-in error handling and timeout protection. The capability to deal with Azure-specific configurations via <code class="inline-code">isAzureOpenAI()</code> highlights its versatility. Additionally, its <code class="inline-code">getApiKey()</code> cleverly ensures that the right keys are used for the right scenarios, minimizing the risk of authentication failures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse()</code>: Retrieves thoughtful answers, tackling incomplete or truncated responses.</li>
<li><code class="inline-code">isAzureOpenAI()</code>: Recognizes provider-specific configurations for custom handling.</li>
<li><code class="inline-code">validateResponse()</code>: Ensures a non-empty, actionable response from LLM providers.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">private validateAndNormalizeTargetFiles(projectPath: string, targetFiles: string[]): string[] {
  const MAX_TARGET_FILES = 50;
  const projectRoot = path.resolve(projectPath);
  
  const safeFiles = [...new Set(targetFiles)]
    .slice(0, MAX_TARGET_FILES) 
    .map(file =&gt; {
      if (typeof file !== &#39;string&#39; || !file.trim()) {
        return null;
      }

      const trimmed = file.trim();
      if (trimmed.includes(&#39;\0&#39;) || trimmed.includes(&#39;..&#39;)) {
        console.warn(`Rejecting potentially unsafe file path: ${trimmed}`);
        return null;
      }
      
      return trimmed;
    })
    .filter((file): file is string =&gt; file !== null)
    .map(file =&gt; path.relative(projectPath, path.resolve(projectPath, file)))
    .sort();

  return safeFiles;
}
</code></pre>
<p>This function ensures that only safe and relevant file paths are considered for analysis, like equipping navigators with high-fidelity star charts for safe journeys.</p>
<hr>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">private async executeRequest(requestParams: OpenAIRequestParams) {
  return Promise.race([
    this.client.chat.completions.create(requestParams as any),
    new Promise&lt;never&gt;((_, reject) =&gt; 
      setTimeout(() =&gt; reject(new Error(`LLM request timeout after ${LLM_REQUEST_TIMEOUT}ms`)), LLM_REQUEST_TIMEOUT)
    )
  ]);
}
</code></pre>
<p>With a timeout mechanism, this function ensures conversations with LLMs are prompt and reliable, like using a smart fail-safe in a communications relay.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Remember to cache long-running Repomix processes with <code class="inline-code">generateRepomixContext()</code> to avoid repetitive workload when revisiting the same codebases.</li>
<li>Check <code class="inline-code">validateProjectPath()</code> for inspiration if you‚Äôre implementing custom security checks in your code.</li>
<li>Explore additional error scenarios in <code class="inline-code">generateResponse()</code> to better understand how LLM redundancy can be managed.</li>
</ul>
<hr>
<p>Stellar navigator, you‚Äôve decoded the cosmic currents of Quest 3: The Nebula of Code Analysis‚Äîyour starship‚Äôs systems are now 50% optimized for the galaxy-spanning journey ahead, so keep soaring at warp speed! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: The Stardock of Theme Selection ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>