<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚≠ê Quest 3: The Crystal Obelisk of Repomix - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <script>
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">üè∞ The Enchanted Repository: Chronicles of Codethia</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1><span class="header-prefix">üåü Quest 3:</span> The Crystal Obelisk of Repomix</h1>
<hr>
<p>Once more, you venture into the mystical realm of Codethia, where the cryptic Crystal Obelisk of Repomix beckons you. Its shimmering surface is etched with runes‚Äîancient and enchanted‚Äîholding the power to unveil the very fabric of Codethia‚Äôs knowledge. The task at hand is perilous but clear: decipher the obelisk‚Äôs whispers, extract its secrets, and bend its light toward restoring balance. An ancient librarian has hinted that you must wield the Repomix Grimoire, combine arcane patterns, and unlock the directive that binds storytelling to coding. With your enchanted tools, your journey begins‚Äîtime is of the essence!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>The <a href="https://github.com/danwahlin/mcp-repo-adventure/blob/main/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/server.ts</code></a> file is the beating heart of Codethia‚Äôs adventure tools. It lays out the server-side code for registering and running the MCP protocol‚Äîthe magical framework that threads together the kingdom‚Äôs quests. Consider the <code class="inline-code">RepoAdventureServer.setupHandlers</code> function, which acts as the herald, summoning the appropriate protocols to ensure every call and interaction with the tools works seamlessly. The <code class="inline-code">RepoAdventureServer.run</code> function, meanwhile, conjures the mechanism that initiates the adventure and prepares the obelisk‚Äôs content. At the forefront is the <code class="inline-code">main</code> function, the ultimate architect that ensures the system gracefully weathers beginner errors and grievous disruptions. This file is your compass, ensuring the journey stays on course.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code> ensures the magical tools respond correctly to the MCP protocols.</li>
<li><code class="inline-code">RepoAdventureServer.run</code> connects the tools‚Äô lifeblood to the flow of Repomix data.</li>
<li>Graceful shutdown and error recovery are expertly crafted in the <code class="inline-code">main</code> function.</li>
</ul>
<h3><span class="header-prefix">src/tools/tools.ts:</span> Adventure Tools Interface</h3>
<p>This file acts as the portal through which your tools spring to life. It introduces the knights of Codethia‚Äôs adventure system: <code class="inline-code">start_adventure.handler</code>, <code class="inline-code">choose_theme.handler</code>, <code class="inline-code">explore_quest.handler</code>, and <code class="inline-code">view_progress.handler</code>. Each tool represents a spell in your personal repository of questing magic. From analyzing repositories and generating themes to executing quests and tracking progress, these functions weave interactive storytelling into the system. Of particular note is how each handler enriches user-guided exploration with well-defined steps, making your navigation through myth and magic as smooth as possible.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code> orchestrates the user‚Äôs first thematic engagement.</li>
<li><code class="inline-code">choose_theme.handler</code> breathes life into customer-chosen narratives.</li>
<li><code class="inline-code">explore_quest.handler</code> is the engine of action, guiding quest progress.</li>
</ul>
<h3><span class="header-prefix">src/analyzer/repo-analyzer.ts:</span> Repomix Integration</h3>
<p>In this file, the <code class="inline-code">RepoAnalyzer</code> class stands as the mystical scholar of Codethia, capable of translating the obscure glyphs of the Crystal Obelisk. Its <code class="inline-code">generateRepomixContext</code> function embodies a sage‚Äôs foresight, caching past spells to swiftly retrieve past recordings. The <code class="inline-code">generateTargetedContent</code> function is selective in its arcane reach, focusing power only where needed, while <code class="inline-code">captureRepomixStdout</code> functions like a scribe, recording the obelisk‚Äôs outputted wisdom with disciplined precision. This file ensures that the great library of Codethia remains orderly, secure, and efficient in its analysis.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAnalyzer.generateRepomixContext</code> handles context creation while caching results for efficiency.</li>
<li><code class="inline-code">validateProjectPath</code> ensures safe access to paths, protecting the heart of Codethia.</li>
<li><code class="inline-code">captureRepomixStdout</code> processes obelisk whispers by managing subprocess outputs.</li>
</ul>
<h3><span class="header-prefix">src/adventure/story-generator.ts:</span> Story Creation and Finalization</h3>
<p>The <a href="https://github.com/danwahlin/mcp-repo-adventure/blob/main/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/adventure/story-generator.ts</code></a> file resembles an alchemical tome, blending the elements of storytelling and programming. With its <code class="inline-code">StoryGenerator.generateStoryAndAdventures</code>, it taps into the Book of Themes to create an overarching narrative while designing quests to test wits. The <code class="inline-code">generateAdventureContent</code> function vitalizes quests by crafting detailed lore suffused with actionable instructions. Finally, the <code class="inline-code">buildStoryGenerationPrompt</code> casts the perfect spell‚Äîan LLM-ready incantation tailored to generate resonating fables. This file is nothing short of a keystone for enchanting Codethia‚Äôs adventurers.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndAdventures</code> crafts a rich blend of overarching storylines and smaller quests.</li>
<li><code class="inline-code">generateAdventureContent</code> creates immersive adventures with actionable prompts.</li>
<li>Detailed prompts are engineered for LLM interpretation, linking technology and myth.</li>
</ul>
<h2>Code</h2>
<h3>src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  // Registers MCP protocol handlers for ListTools and CallTool requests
  setupHandlers() {
    this.protocol.listen(&#39;list_tools&#39;, this.listToolsHandler);
    this.protocol.listen(&#39;call_tool&#39;, this.callToolHandler);
  }

  // Connects stdio transport and pre-generates repomix content
  async run() {
    const transport = createTransport(&#39;stdio&#39;);
    await this.initializeAsync(transport);
    this.preGenerateRepomixContent();
  }
}

async function main() {
  const server = new RepoAdventureServer();
  await server.run();
  shutdownAssets();
}
</code></pre>
<p>This code works like the server‚Äôs hearth, ensuring all tools are seated, signals are sent, and every process begins its destined task.</p>
<h3>src/tools/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = {
  handler: async (params: AdventureParams) =&gt; {
    const config = await analyzeRepository(params.path);
    return createThemesFromConfig(config);
  },
};

export const explore_quest = {
  handler: async (questId: string) =&gt; {
    const progress = trackProgress(questId);
    renderQuestContent(progress);
  },
};
</code></pre>
<p>These functions are like incantations that transform user input into grand storytelling experiences or charted quests.</p>
<h3>src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">async generateTargetedContent(projectPath: string, targetFiles: string[]): Promise&lt;string&gt; {
  const safeFiles = this.validateAndNormalizeTargetFiles(projectPath, targetFiles);
  const cacheKey = `${path.resolve(projectPath)}:targeted:${safeFiles.join(&#39;,&#39;)}`;

  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; Date.now() - cached.timestamp &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }

  try {
    const context = await this.captureRepomixStdout(safeFiles, projectPath, true);
    this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
    return context;
  } catch (error) {
    throw new Error(`Failed Repomix extraction: ${error.message}`);
  }
}
</code></pre>
<p>This function is the archivist, carefully selecting the scrolls for a researcher‚Äôs scrutiny and jotting down insights for future use.</p>
<h3>src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">export class StoryGenerator {
  static generateStoryAndAdventures(theme: ThemeDefinition): AdventureResult {
    const prompt = this.buildStoryGenerationPrompt(theme);
    return LLMClient.generateResponse(prompt);
  }

  static buildStoryGenerationPrompt(theme: ThemeDefinition): string {
    const guidelines = theme.getThemeGuidelines();
    return `Tell a mythical story blending ${guidelines.keywords}.`;
  }
}
</code></pre>
<p>The code here is akin to a bard who crafts narratives that inspire adventurers while adhering to the kingdom‚Äôs lore.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Keep file handlers compartmentalized to ensure quest features run without thematic interference.</li>
<li>Explore <code class="inline-code">start_adventure</code> and <code class="inline-code">generateStoryAndAdventures</code> for crafting unique storyline integration.</li>
<li>Next, experiment with how the <code class="inline-code">.config.json</code> files customize and expand the codified quests.</li>
</ul>
<hr>
<p>Huzzah, noble seeker! ‚ö° With the Crystal Obelisk of Repomix now shimmering in your grasp, your conquest illuminates the realm of learning at 40% completion‚Äîforge onward, for the stars favor the bold! üöÄüíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: üíé Quest 4: The Mystic Binding of Themes ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/mcp-repo-adventure" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>