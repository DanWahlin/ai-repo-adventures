<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Theme Vault - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Lost Codes</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Theme Vault</h1>
<hr>
<p>In the heart of the jungle lies the Pyramid of Lost Codes, its ancient walls concealing artifacts of intricate design. Deep within, carved into the walls and safeguarded by traps, awaits The Theme Vault‚Äîan archive of sacred scripts that define the very essence of adventures. These hieroglyphic inscriptions hold the power to shape expedition templates and guide explorers. But beware: ancient scholars devised puzzles to test adventurers‚Äô intellect, ensuring only the worthy could unlock the wisdom stored here. Will you prove your mettle and recover the sacred themes?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Theme Key Secrets</strong>: How does the <code class="inline-code">THEMES</code> object ensure consistency and scalability in supporting themes across adventures?</li>
<li>‚ö° <strong>Validation Rituals</strong>: How does <code class="inline-code">validateTheme</code> parse and verify user inputs to align with existing themes and handle errors gracefully?</li>
<li>üõ°Ô∏è <strong>Display Purification</strong>: How does <code class="inline-code">sanitizeForDisplay</code> filter and normalize raw user input for safe representation in the system?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Ancient theme scaffolding and validation system</h3>
<p>The <code class="inline-code">theme.ts</code> file is the cornerstone of defining adventure themes. It centralizes theme options like &quot;Ancient Civilization&quot; within the <code class="inline-code">THEMES</code> structure and provides tools to retrieve, validate, and format themes for quests. By grounding theme processing in this file, the adventure system ensures coherence and provides critical functionalities to handle user input. From retrieving theme details via <code class="inline-code">getThemeById</code> to parsing user entries with <code class="inline-code">parseTheme</code>, each function forms a pillar of expeditions shaped by user decisions. Whether selecting hieroglyphs or validating inputs, this file is key to managing theme-related logic.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code> centralizes definitions, ensuring all theme-related data is consistent and immutable.</li>
<li><code class="inline-code">isValidTheme</code> checks a string against predefined theme keys to confirm validity.</li>
<li><code class="inline-code">parseTheme</code> intelligently parses user inputs and matches them to themes using key or keyword detection.</li>
<li><code class="inline-code">formatThemeOption</code> creates user-friendly theme descriptions for display.</li>
<li><code class="inline-code">getFormattedThemeOptions</code> fetches and formats all available themes for explorers to choose from.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  }
};
</code></pre>
<ul>
<li>Consolidates theme metadata (e.g., names, IDs, descriptions), ensuring centralized control.</li>
<li>Immutable keys prevent accidental modification, making themes reliable across quests.</li>
<li>Keyword matching allows robust input flexibility, helping users find themes intuitively.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
</code></pre>
<ul>
<li>A simple, efficient type guard ensures user inputs align with valid themes.</li>
<li>Supports error-free theme processing across dependencies.</li>
<li>Balances simplicity and functionality by iterating over the theme array.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>Parses user input intelligently with key and keyword matching.</li>
<li>Facilitates multiple entry options (e.g., numeric ID or textual keyword).</li>
<li>Prioritizes exact matches for accuracy, then falls back to flexible keyword checks.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Purification and user input safeguard rituals</h3>
<p>The <code class="inline-code">input-validator.ts</code> file handles vital validation and sanitization to protect the adventure system from erroneous or unsafe user inputs. <code class="inline-code">validateAdventureChoice</code>, <code class="inline-code">validateTheme</code>, and <code class="inline-code">sanitizeForDisplay</code> enforce strict rules on user-submitted data for quest selection, theme usage, and safe display. The file‚Äôs functionality ensures user decisions are meaningful and formatted clearly, enabling seamless interactions with sacred code relics. These routines provide an essential barrier against invalid entries, preserving the integrity of quests while aiding explorers as they navigate the Pyramid&#39;s secrets.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> trims and validates user input for quest selection.</li>
<li><code class="inline-code">validateTheme</code> validates and parses themes using keywords and preexisting definitions.</li>
<li><code class="inline-code">sanitizeForDisplay</code> removes unsafe characters to prepare data for secure display.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Maps user inputs to normalized themes via <code class="inline-code">parseTheme</code>, ensuring reuse of existing logic.</li>
<li>Error messaging improves user clarity, guiding explorers to valid themes.</li>
<li>Rejects empty or invalid inputs upfront, keeping the adventure system robust.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>Filters dangerous characters to ensure safe rendering in UI components.</li>
<li>Uses trimming and slicing for concise, readable inputs.</li>
<li>Serves as the last line of defense against input-based exploits.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>For efficient theme customization, study how <code class="inline-code">parseTheme</code> leverages both exact and keyword matches.</li>
<li>Observe consistent error messaging in <code class="inline-code">validateTheme</code> for a user-friendly feedback system.</li>
<li>When ensuring secure input handling, refer to <code class="inline-code">sanitizeForDisplay</code>&#39;s approach to remove unsafe characters.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries within the Pyramid of Lost Codes.</p>
<p>Hail, valiant seeker, for the sacred gates of the Theme Vault have been unlocked by thy wisdom and perseverance, marking thy triumphant passage through this ancient odyssey‚Äî60% of the celestial path to full enlightenment now shines bright like a divine beacon! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>