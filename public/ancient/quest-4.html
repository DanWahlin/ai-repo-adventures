<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Configuration & Theme System - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Sacred Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Configuration &amp; Theme System</h1>
<hr>
<p>At the foot of the sandstone repository, you enter the Chamber of Tablets where climate-worn slabs dictate sacred limits and styles of storytelling. Torchlight reveals inscriptions describing <code class="inline-code">LLM_REQUEST_TIMEOUT</code> and caches to preserve the Oracle‚Äôs breath, while a mosaic of themes like <code class="inline-code">ANCIENT</code> and <code class="inline-code">SPACE</code> governs the tale‚Äôs attire. Scribes once carved validators here to keep novices from profaning the rites with wild paths and errant choices. To unite relics and awaken narrative, you must read these tablets and trace their logic like an archaeologist brushing dust from truth.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Glyph Patterning: How do constants like <code class="inline-code">LLM_REQUEST_TIMEOUT</code>, <code class="inline-code">REPOMIX_CACHE_TTL</code>, and <code class="inline-code">MAX_FILE_SIZE_MB</code> influence pacing, resource limits, and safety across the system?</li>
<li>‚ö° Ritual Selection: How does <code class="inline-code">THEMES</code> shape the allowable paths in <code class="inline-code">validateTheme</code>, and what matching rites does <code class="inline-code">parseTheme</code> perform for keys, ids, and keywords?</li>
<li>üõ°Ô∏è Wardings of the Gate: What guardrails do <code class="inline-code">validateAdventureChoice</code> and <code class="inline-code">validateProjectPath</code> enforce to keep the temple free of harmful or malformed inputs?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> The Law Tablet of Limits and Provisions</h3>
<p>This tablet sets the covenant of time, memory, and breadth. By invoking <code class="inline-code">config({ quiet: true })</code>, it quietly summons environment glyphs without noisy omens. The <code class="inline-code">LLM_REQUEST_TIMEOUT</code> decree governs how long the Oracle may chant before the rite must cease, while <code class="inline-code">REPOMIX_CACHE_TTL</code> carves a tunable preservation window using environment sand. The boundary stones of <code class="inline-code">MAX_FILE_SIZE_MB</code> and <code class="inline-code">MAX_SCAN_DEPTH</code> prevent expeditions from vanishing into labyrinths of excess. Defaults like <code class="inline-code">LLM_MODEL</code> and <code class="inline-code">LLM_BASE_URL</code> tether the ritual to known constellations, and adventure strictures such as <code class="inline-code">MAX_FILES_PER_QUEST</code> preserve narrative focus. Error tablets like <code class="inline-code">ERROR_MESSAGES</code> and boons like <code class="inline-code">INCLUDE_STACK_TRACES</code> define how the temple speaks in calamity. These constants are not idle; they are living boundaries that shape behavior across analyzers, storytellers, and caches. Reading them reveals how every procession, from Repo Analyzer‚Äôs gathering to Story Generator‚Äôs invocations, must bow to timeouts, sizes, and allowed paths. The tablet‚Äôs <code class="inline-code">IGNORE_PATTERNS</code> mark forbidden corridors like <code class="inline-code">node_modules</code>, ensuring explorers traverse meaningful chambers. Finally, <code class="inline-code">PROMPT_PATHS</code> codifies where incantations lie, binding the adventure to canonical scrolls.</p>
<h4>Highlights</h4>
<ul>
<li>Time is chained by <code class="inline-code">LLM_REQUEST_TIMEOUT</code>, and caches breathe by <code class="inline-code">REPOMIX_CACHE_TTL</code>.</li>
<li>Size and scope constraints are etched by <code class="inline-code">MAX_FILE_SIZE_MB</code> and <code class="inline-code">MAX_SCAN_DEPTH</code>.</li>
<li>Defaults and environment fallbacks give resilience to every rite.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> The Mosaic of Masks and Rites</h3>
<p>Within this mosaic, <code class="inline-code">THEMES</code> enumerates civilizations of style: <code class="inline-code">SPACE</code>, <code class="inline-code">MYTHICAL</code>, <code class="inline-code">ANCIENT</code>, <code class="inline-code">DEVELOPER</code>, and <code class="inline-code">CUSTOM</code>. Each mask bears an <code class="inline-code">id</code>, <code class="inline-code">key</code>, <code class="inline-code">displayName</code>, <code class="inline-code">emoji</code>, and lore-filled <code class="inline-code">description</code>, along with <code class="inline-code">keywords</code> for pilgrim matching. The parser <code class="inline-code">parseTheme</code> performs three sacred checks: exact key, numeric id, and keyword inclusion, while <code class="inline-code">isValidTheme</code> acts as a gatekeeper against pretenders. <code class="inline-code">getAllThemes</code> lays the parade of options at your feet, and <code class="inline-code">formatThemeOption</code> shapes a ceremonial line fit for display tablets. This single source of truth ensures the whole sanctuary keeps consistent attire and voice. Through <code class="inline-code">getThemeByKey</code> and <code class="inline-code">getThemeById</code>, the rites remain accessible by multiple paths, inviting flexible invocations across the temple‚Äôs subsystems. Lastly, <code class="inline-code">getFormattedThemeOptions</code> crafts a full procession list sorted by <code class="inline-code">id</code>, so initiates can choose their mask with clarity. The mosaic guarantees that when <code class="inline-code">validateTheme</code> summons a shape, it aligns with these stones.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code> defines approved masks with ids, keys, descriptions, and keywords.</li>
<li><code class="inline-code">getAllThemes</code> returns the array used for displays and validation.</li>
<li><code class="inline-code">ThemeDefinition</code> codifies what every mask must contain.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> The Gatekeeper‚Äôs Chisel</h3>
<p>This gatehouse applies sharp rules to keep the sanctum unsullied. <code class="inline-code">validateAdventureChoice</code> trims excess and rejects emptiness or unruly length. <code class="inline-code">validateTheme</code> converts offerings to lower-case, seeks a <code class="inline-code">parseTheme</code> match, and uses <code class="inline-code">isValidTheme</code> for final acceptance; if the rite fails, it names every permitted key via <code class="inline-code">getAllThemes</code>, offering clarity rather than confusion. <code class="inline-code">validateProjectPath</code> returns the pilgrim‚Äôs current chamber when none is provided, deflects lengths beyond reason, and rejects the null rune <code class="inline-code">\0</code> as taboo. Finally, <code class="inline-code">sanitizeForDisplay</code> strips fangs from user inscriptions, removing dangerous symbols and constraining length so the temple‚Äôs walls remain unmarred. Together, these chisels prevent ill-formed prayers, suspicious runes, and boundless labyrinth paths from seeping into sacred machinery.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateTheme</code> orchestrates parsing, validation, and helpful error messages using theme helpers.</li>
<li><code class="inline-code">validateAdventureChoice</code> protects against emptiness and overlong invocations.</li>
<li><code class="inline-code">validateProjectPath</code> normalizes paths and rejects forbidden characters.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">// Timeouts in milliseconds
export const FILE_READ_TIMEOUT = 10000;
export const FILE_ANALYSIS_TIMEOUT = 30000;
export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const LLM_CACHE_TTL = 300000; // 5 minutes
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const REPOMIX_SUBPROCESS_TIMEOUT = parseInt(process.env.REPOMIX_SUBPROCESS_TIMEOUT || &#39;120000&#39;); // 2 minutes, configurable via env
export const REPOMIX_GRACEFUL_TIMEOUT = 5000; // 5 seconds for graceful shutdown before SIGKILL
export const REPOMIX_MAX_BUFFER_SIZE = 100 * 1024 * 1024; // 100MB max buffer to prevent memory exhaustion

// Analysis limits
export const MAX_SCAN_DEPTH = 3; // Maximum directory depth to prevent infinite recursion and keep analysis focused
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
export const KEY_SOURCE_FILES = 10; // Number of key files to highlight in adventure generation
export const TOP_FUNCTIONS = 20; // Maximum functions to include in code analysis summaries
export const TOP_CLASSES = 5; // Maximum classes to include in analysis to keep stories focused
</code></pre>
<p>These are the sun dials and boundary stones that set expedition pace and scope.</p>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  },
  DEVELOPER: {
    id: 4,
    key: &#39;developer&#39;,
    displayName: &#39;Developer Documentation&#39;,
    emoji: &#39;üìñ&#39;,
    description: &#39;Technical documentation approach with clear explanations, best practices, and code analysis&#39;,
    keywords: [&#39;developer&#39;, &#39;code&#39;, &#39;technical&#39;, &#39;debug&#39;, &#39;guide&#39;, &#39;tutorial&#39;, &#39;binary&#39;]
  },
  CUSTOM: {
    id: 5,
    key: &#39;custom&#39;,
    displayName: &#39;Custom Theme&#39;,
    emoji: &#39;üé®&#39;,
    description: &#39;Design your own adventure! You\&#39;ll be prompted to provide theme name, description, and keywords&#39;,
    keywords: [&#39;custom&#39;, &#39;personalized&#39;, &#39;unique&#39;, &#39;creative&#39;, &#39;personal&#39;]
  }
} as const;
</code></pre>
<p>This is the fresco of masks, each a cultural lens for the tale.</p>
<pre><code class="language-typescript">export function getAllThemes(): ThemeDefinition[] {
  return THEMES_ARRAY;
}
</code></pre>
<p>This opens the storeroom to display every mask on the rack.</p>
<pre><code class="language-typescript">export interface ThemeDefinition {
  readonly id: number;
  readonly key: string;
  readonly displayName: string;
  readonly emoji: string;
  readonly description: string;
  readonly keywords: readonly string[];  // For matching user input
}
</code></pre>
<p>This tablet defines the sacred shape every mask must follow.</p>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<p>This ritual checks the pilgrim‚Äôs mask, and if false, recites the allowed lineage.</p>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<p>A gatekeeper ensures the offering is neither empty nor sprawling.</p>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  
  if (input.length &gt; 500) {
    throw new Error(&#39;Project path too long (max 500 characters)&#39;);
  }
  
  if (input.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid characters&#39;);
  }
  
  return input.trim();
}
</code></pre>
<p>The path ward prevents cursed runes and points to the current chamber when none is given.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Trace how constants propagate: imagine each timeout and limit as a border that downstream priests must respect.</li>
<li>Compare theme selection flows by passing different keys, ids, and keyword-laden inputs to see where <code class="inline-code">parseTheme</code> leads.</li>
<li>Try crafting edge offerings: long choices, null path runes, or unknown themes, and observe the tablet‚Äôs protective errors.</li>
</ul>
<hr>
<p>You close the tablets, their glyphs now clear. The laws of pace, attire, and entry are yours. Proceed to awaken the repository‚Äôs living narrative.</p>
<p>Hail, seeker of wisdom‚Äîby mastering Quest 4: Configuration &amp; Theme System, thou hast inscribed sacred patterns upon the temple‚Äôs tablets, advancing 3 of 5 quests (60%) with triumphant clarity, and the sanctum‚Äôs torches blaze brighter in honor of thy refined craft and steadfast ascent.</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>