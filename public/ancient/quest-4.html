<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Configuration & Theme System - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Code Pyramid</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Configuration &amp; Theme System</h1>
<hr>
<p>Beneath the pyramid‚Äôs basalt slabs, you uncover a chamber of settings and styles. Stone tablets etched with time limits, cache lifespans, and guarded paths define how long torches may burn and how far the expedition roams. Beside them, a gallery of painted motifs catalogs every sanctioned theme of the ancient journey. A third alcove houses scriveners who test choices, refuse corrupted sigils, and cleanse inscriptions before they reach the grand hall. Decipher these codices to harmonize constraints, aesthetics, and safe passage, and the pyramid‚Äôs wisdom will align with your expedition‚Äôs intent.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Glyph Weighing: How do timeout and limit constants shape analysis breadth and LLM behavior across the system?</li>
<li>‚ö° Style Canon: By what steps does input text become a recognized theme key, and how are keyword hints used to match choices?</li>
<li>üõ°Ô∏è Sentinel Rites: What validations sanitize inputs, enforce length limits, and resolve paths safely to keep explorers protected?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Expedition constraints and operational constants for the entire system</h3>
<p>Within this tablet of configuration, the expedition‚Äôs rules are declared using simple constants. The <code class="inline-code">LLM_API_KEY</code>, <code class="inline-code">LLM_BASE_URL</code>, and <code class="inline-code">LLM_MODEL</code> outline how the scribe is contacted, while <code class="inline-code">LLM_REQUEST_TIMEOUT</code>, <code class="inline-code">LLM_CACHE_TTL</code>, and token limits control the scribe‚Äôs patience and verbosity. Repository exploration is framed by <code class="inline-code">MAX_SCAN_DEPTH</code>, <code class="inline-code">MAX_FILE_SIZE_MB</code>, and patterns to ignore, ensuring the team does not wander into buried chambers that would waste precious torchlight. Cache sizes and process timeouts like <code class="inline-code">REPOMIX_CACHE_TTL</code>, <code class="inline-code">REPOMIX_SUBPROCESS_TIMEOUT</code>, and <code class="inline-code">REPOMIX_MAX_BUFFER_SIZE</code> prevent runaway excavations. Error messages provide standardized inscriptions when mishaps occur, keeping responses tidy and consistent. The default expedition style is set by <code class="inline-code">DEFAULT_THEME</code>, which ties into the theme canon elsewhere. Prompt file paths point to the scrolls used by the generation rituals, making cross-chamber coordination reliable. As you read, observe the choice of transparent, flat constants: this avoids complex hierarchies and makes each limit immediately visible, like labels carved over each doorway. Such directness helps maintainers quickly adjust expedition parameters without deciphering layered abstractions.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> sets the maximum duration for story engraving, preventing the scribe from lingering too long; vital for responsive expeditions.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> defines how long repository fragments remain fresh, balancing speed with accuracy in repeated analyses.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> constrains which scrolls are examined, guarding against unwieldy tomes that could slow or endanger the mission.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Canon of themes and the matching rites that interpret explorer intentions</h3>
<p>This gallery lists every sanctioned theme using <code class="inline-code">THEMES</code>, each with an <code class="inline-code">id</code>, <code class="inline-code">key</code>, glyph, and descriptive mural. The structure is simple and predictable, enabling quick catalog access via <code class="inline-code">getAllThemes</code>, <code class="inline-code">getThemeByKey</code>, and <code class="inline-code">getThemeById</code>. The matching ritual <code class="inline-code">parseTheme</code> acts like a curator: it first checks exact keys, then numeric engravings, and finally searches through keywords to accommodate varied traveler phrases such as ‚Äúpyramid‚Äù or ‚Äúruins‚Äù for the ancient motif. Validation is supported by <code class="inline-code">isValidTheme</code>, which ensures any chosen motif exists in the canon. Formatting helpers, <code class="inline-code">formatThemeOption</code> and <code class="inline-code">getFormattedThemeOptions</code>, prepare a marquee display of available styles with steady ordering. This module is the single source of truth for style identity, keeping downstream components aligned with a consistent palette. Note the careful layering of matching strategies: exact, numeric, then keyword-based. This progression minimizes ambiguity while still welcoming imperfect but themed input, like a guide who recognizes intent from partial clues carved in the dust.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code> defines all motifs with keys, descriptions, and keywords; crucial for consistent expedition styling.</li>
<li><code class="inline-code">getAllThemes</code> returns the full canon, letting other chambers display or validate against the complete set.</li>
<li><code class="inline-code">parseTheme</code> interprets traveler inscriptions into a recognized theme, using exact, numeric, and keyword matching for resilience.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Gatekeepers that cleanse inscriptions and approve safe passage</h3>
<p>This alcove enshrines validation rites that protect the expedition from errant inscriptions. <code class="inline-code">validateAdventureChoice</code> ensures non-empty, concise choices free from rambling lines. <code class="inline-code">validateTheme</code> collaborates with the theme canon: it normalizes input, runs it through <code class="inline-code">parseTheme</code>, then ensures the outcome is recognized via <code class="inline-code">isValidTheme</code>, finally returning the matched key. When an inscription strays off canon, it lists valid themes using <code class="inline-code">getAllThemes</code> to guide the traveler back to sanctioned paths. <code class="inline-code">validateProjectPath</code> resolves to the current chamber when no path is given, rejects suspiciously long or null-embedded paths, and trims edges for a clean route. Finally, <code class="inline-code">sanitizeForDisplay</code> removes sharp characters and collapses whitespace before presenting text in the public square, preventing ugly or unsafe glyphs from marring the walls. Each validator prefers small, direct checks over heavy constructs, yielding readable and maintainable sentinels that are easy to trust during perilous excavations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateTheme</code> transforms raw inscriptions into a valid motif using <code class="inline-code">parseTheme</code> and <code class="inline-code">isValidTheme</code>, guarding style integrity.</li>
<li><code class="inline-code">getAllThemes</code> (via theme module) is used to compose helpful error messages listing permitted motifs; improves explorer guidance.</li>
<li><code class="inline-code">validateAdventureChoice</code> and <code class="inline-code">validateProjectPath</code> enforce length and character safety, protecting the expedition‚Äôs corridors from corruption.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">/**
 * Simplified configuration for the MCP Repo Adventure system
 */

import { config } from &#39;dotenv&#39;;

// Load environment variables
config({ quiet: true });

// Simple constants instead of complex nested objects
export const LLM_API_KEY = process.env.LLM_API_KEY || &#39;&#39;;
export const LLM_BASE_URL = process.env.LLM_BASE_URL || &#39;https://api.openai.com/v1&#39;;
export const LLM_MODEL = process.env.LLM_MODEL || &#39;gpt-4o-mini&#39;;
export const LLM_API_VERSION = process.env.LLM_API_VERSION || &#39;2023-12-01-preview&#39;;
export const GITHUB_TOKEN = process.env.GITHUB_TOKEN || &#39;&#39;;

// Timeouts in milliseconds
export const FILE_READ_TIMEOUT = 10000;
export const FILE_ANALYSIS_TIMEOUT = 30000;
export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const LLM_CACHE_TTL = 300000; // 5 minutes
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const REPOMIX_SUBPROCESS_TIMEOUT = parseInt(process.env.REPOMIX_SUBPROCESS_TIMEOUT || &#39;120000&#39;); // 2 minutes, configurable via env
export const REPOMIX_GRACEFUL_TIMEOUT = 5000; // 5 seconds for graceful shutdown before SIGKILL
export const REPOMIX_MAX_BUFFER_SIZE = 100 * 1024 * 1024; // 100MB max buffer to prevent memory exhaustion

// Analysis limits
export const MAX_SCAN_DEPTH = 3; // Maximum directory depth to prevent infinite recursion and keep analysis focused
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
export const KEY_SOURCE_FILES = 10; // Number of key files to highlight in adventure generation
export const TOP_FUNCTIONS = 20; // Maximum functions to include in code analysis summaries
export const TOP_CLASSES = 5; // Maximum classes to include in analysis to keep stories focused

// LLM settings
export const LLM_CACHE_SIZE = parseInt(process.env.LLM_CACHE_SIZE || &#39;100&#39;);
export const LLM_TEMPERATURE = parseFloat(process.env.LLM_TEMPERATURE || &#39;0.7&#39;);
export const LLM_MAX_TOKENS = parseInt(process.env.LLM_MAX_TOKENS || &#39;4000&#39;);
export const LLM_MAX_TOKENS_STORY = Math.max(LLM_MAX_TOKENS, 8000); // Maximum tokens for story generation (use env var if higher)
export const LLM_MAX_TOKENS_QUEST = Math.max(LLM_MAX_TOKENS, 6000); // Maximum tokens for individual quest exploration content (use env var if higher)
export const LLM_MAX_TOKENS_DEFAULT = LLM_MAX_TOKENS; // Use env var or default to 4000

// GPT-5 specific settings
export const GPT5_VERBOSITY = (process.env.GPT5_VERBOSITY as &#39;low&#39; | &#39;medium&#39; | &#39;high&#39;) || &#39;medium&#39;;
export const GPT5_REASONING_EFFORT = (process.env.GPT5_REASONING_EFFORT as &#39;minimal&#39; | &#39;medium&#39; | &#39;high&#39;) || &#39;medium&#39;;

// Cache settings

// Adventure settings
export const DEFAULT_THEME = &#39;space&#39; as const;
export const MAX_FILE_LINES_FOR_LLM = 100; // Truncate files to keep LLM prompts manageable
export const MAX_FILES_PER_QUEST = 3; // Limit files per quest to maintain focus and readability

// Error settings
export const MAX_ERROR_MESSAGE_LENGTH = 200;
export const INCLUDE_STACK_TRACES = process.env.NODE_ENV === &#39;development&#39;;

// Default error messages
export const ERROR_MESSAGES = {
  LLM_UNAVAILABLE: &#39;LLM service is currently unavailable. Please check your configuration.&#39;,
  ANALYSIS_FAILED: &#39;Failed to analyze the project. Please ensure the path is valid.&#39;,
  THEME_INVALID: &#39;Invalid theme specified. Using default theme.&#39;,
  FILE_NOT_FOUND: &#39;The requested file could not be found.&#39;,
  PERMISSION_DENIED: &#39;Permission denied accessing the specified path.&#39;,
} as const;

// Directory patterns to ignore during scanning
export const IGNORE_PATTERNS = [
  &#39;node_modules&#39;,
  &#39;.git&#39;,
  &#39;.next&#39;,
  &#39;.nuxt&#39;,
  &#39;dist&#39;,
  &#39;build&#39;,
  &#39;coverage&#39;,
  &#39;.nyc_output&#39;,
  &#39;logs&#39;,
  &#39;*.log&#39;,
  &#39;.env&#39;,
  &#39;.DS_Store&#39;,
  &#39;Thumbs.db&#39;,
] as const;

// Prompt file paths
export const PROMPT_PATHS = {
  STORY_GENERATION: &#39;src/prompts/story-generation-prompt.md&#39;,
  QUEST_CONTENT: &#39;src/prompts/quest-content-prompt.md&#39;,
  COMPLETION: &#39;src/prompts/completion-prompt.md&#39;,
  THEME_GUIDELINES: &#39;src/prompts/theme-guidelines.json&#39;
} as const;
</code></pre>
<ul>
<li>Sets time, cache, and size thresholds that cap exploration range and scribe patience</li>
<li>Chooses flat constants to make limits legible like labeled doorways; quick tuning with minimal indirection</li>
<li>Balances performance with safety via buffer caps and subprocess timeouts; prevents runaway excavations</li>
<li>Links to prompt scrolls, unifying this tablet with the generation and quest chambers</li>
<li>Establishes <code class="inline-code">DEFAULT_THEME</code> for consistent styling when travelers provide no motif</li>
</ul>
<hr>
<pre><code class="language-typescript">// Timeouts in milliseconds
export const FILE_READ_TIMEOUT = 10000;
export const FILE_ANALYSIS_TIMEOUT = 30000;
export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const LLM_CACHE_TTL = 300000; // 5 minutes
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const REPOMIX_SUBPROCESS_TIMEOUT = parseInt(process.env.REPOMIX_SUBPROCESS_TIMEOUT || &#39;120000&#39;); // 2 minutes, configurable via env
export const REPOMIX_GRACEFUL_TIMEOUT = 5000; // 5 seconds for graceful shutdown before SIGKILL
export const REPOMIX_MAX_BUFFER_SIZE = 100 * 1024 * 1024; // 100MB max buffer to prevent memory exhaustion
</code></pre>
<ul>
<li>Highlights expedition pacing: request, analysis, and subprocess time limits cooperate to avoid stalls</li>
<li>Uses <code class="inline-code">parseInt</code> on environment-overridable knobs for tunable fieldwork based on site conditions</li>
<li>Adds a graceful shutdown before hard stops, mirroring careful extraction techniques</li>
<li>Constrains buffers to prevent memory floods when unrolling large scrolls</li>
<li>Encourages predictable performance under varied repository sizes</li>
</ul>
<hr>
<pre><code class="language-typescript">// Analysis limits
export const MAX_SCAN_DEPTH = 3; // Maximum directory depth to prevent infinite recursion and keep analysis focused
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
export const KEY_SOURCE_FILES = 10; // Number of key files to highlight in adventure generation
export const TOP_FUNCTIONS = 20; // Maximum functions to include in code analysis summaries
export const TOP_CLASSES = 5; // Maximum classes to include in analysis to keep stories focused
</code></pre>
<ul>
<li>Enforces bounded exploration, crucial for efficient and safe decoding of repository ruins</li>
<li>Filters oversized artifacts to keep attention on readable source, not heavy relics</li>
<li>Caps summary granularity to produce coherent adventure briefs</li>
<li>Clarifies intended scope with explicit numeric limits, easing future calibration</li>
<li>Supports consistent storytelling quality by controlling content size</li>
</ul>
<hr>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">/**
 * Central theme definitions for the adventure system
 * Single source of truth for all theme-related data
 */

// Define the structure of a theme
export interface ThemeDefinition {
  readonly id: number;
  readonly key: string;
  readonly displayName: string;
  readonly emoji: string;
  readonly description: string;
  readonly keywords: readonly string[];  // For matching user input
}
</code></pre>
<ul>
<li>Establishes a stable contract for motifs across chambers</li>
<li>Uses readonly fields to preserve canonical integrity</li>
<li>Guides implementers to include keywords for resilient matching</li>
<li>Ensures every theme carries display, identity, and descriptive glyphs</li>
<li>Serves as the base for consistent formatting and selection flows</li>
</ul>
<hr>
<pre><code class="language-typescript">// Single source of truth for all themes
export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  },
  DEVELOPER: {
    id: 4,
    key: &#39;developer&#39;,
    displayName: &#39;Developer Documentation&#39;,
    emoji: &#39;üìñ&#39;,
    description: &#39;Technical documentation approach with clear explanations, best practices, and code analysis&#39;,
    keywords: [&#39;developer&#39;, &#39;code&#39;, &#39;technical&#39;, &#39;debug&#39;, &#39;guide&#39;, &#39;tutorial&#39;, &#39;binary&#39;]
  },
  CUSTOM: {
    id: 5,
    key: &#39;custom&#39;,
    displayName: &#39;Custom Theme&#39;,
    emoji: &#39;üé®&#39;,
    description: &#39;Design your own adventure! You\&#39;ll be prompted to provide theme name, description, and keywords&#39;,
    keywords: [&#39;custom&#39;, &#39;personalized&#39;, &#39;unique&#39;, &#39;creative&#39;, &#39;personal&#39;]
  }
} as const;
</code></pre>
<ul>
<li>Provides the full motif canon, including the ancient style at <code class="inline-code">key: &#39;ancient&#39;</code></li>
<li>Uses <code class="inline-code">as const</code> to preserve literal types and make downstream checks precise</li>
<li>Embeds keyword arrays to enable flexible input mapping</li>
<li>Assigns numeric <code class="inline-code">id</code> for alternative selection paths</li>
<li>Centralizes description texts for consistent displays and prompts</li>
</ul>
<hr>
<pre><code class="language-typescript">// Simple theme parser using basic string matching
export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  // Check for exact key match
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  // Check for numeric ID
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  // Check keywords using simple includes check
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>Implements a three-tier matching rite: exact key, numeric id, then keyword includes</li>
<li>Normalizes input for lenient parsing, welcoming varied traveler phrases</li>
<li>Leverages canonical getters to keep logic centralized and consistent</li>
<li>Returns the theme key as the single truth used downstream</li>
<li>Falls back to <code class="inline-code">null</code> to let validators craft helpful guidance</li>
</ul>
<hr>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">import { getAllThemes, isValidTheme, parseTheme } from &#39;./theme.js&#39;;

// Simple validation functions instead of complex class
export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Guards inscriptions from emptiness and excessive length before entering the hall</li>
<li>Prefers early throws with precise messages to speed correction</li>
<li>Trims inputs to remove stray dust from edges</li>
<li>Embraces small functions for readability and targeted responsibility</li>
<li>Lays the groundwork for consistent UX across chambers</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Normalizes inscription, defers to <code class="inline-code">parseTheme</code>, then confirms with <code class="inline-code">isValidTheme</code></li>
<li>Crafts instructive errors by listing <code class="inline-code">getAllThemes</code> keys as a guide rail</li>
<li>Returns a final canonical key that downstream systems can trust</li>
<li>Separates parsing from validation for clarity and testability</li>
<li>Encourages reliable styling across the expedition</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  
  if (input.length &gt; 500) {
    throw new Error(&#39;Project path too long (max 500 characters)&#39;);
  }
  
  if (input.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid characters&#39;);
  }
  
  return input.trim();
}

export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>Resolves missing paths to the current chamber for a sensible default</li>
<li>Rejects dangerous null characters and extreme lengths to protect corridors</li>
<li>Sanitizes displayed inscriptions by removing risky glyphs and collapsing whitespace</li>
<li>Caps length to preserve tidy wall carvings</li>
<li>Complements configuration limits with practical, user-facing safeguards</li>
</ul>
<h2>Helpful Hints</h2>
<ul>
<li>Compare <code class="inline-code">parseTheme</code> flow with <code class="inline-code">validateTheme</code> to see how interpretation and enforcement are separated.</li>
<li>Trace how <code class="inline-code">MAX_FILE_SIZE_MB</code> and <code class="inline-code">MAX_SCAN_DEPTH</code> would influence any analyzer using these constants.</li>
<li>Experiment with input phrases like ‚Äúpyramid ruins‚Äù to predict <code class="inline-code">parseTheme</code> results before validation.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Hark, seeker of wisdom‚Äîby mastering Quest 4: Configuration &amp; Theme System, thou hast inscribed new rites upon the sacred codex and advanced to 3/5 quests (60%), ascending the temple steps with triumphant vigor, let the sanctum‚Äôs torches blaze in thy honor as the glyphs of order and visage align in noble harmony!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>