<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Tome of Themes - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Ancient Algorithms</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Tome of Themes</h1>
<hr>
<p>Buried beneath the crumbling ruins of the Codex Obscurum, ancient tablets whisper of the Tome of Themes‚Äîa sacred manuscript designed to channel the energy of creative expression. The final glyph‚Äîa convoluted depiction of intertwined paths‚Äîpoints adventurers toward unearthing the ancient wisdom behind structured narratives. Within these depths lies the treasure of understanding themes, their intertwined logic, and validations that honor the sacred rituals of choice and clarity.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Glyph of Configuration</strong>: How do constants like <code class="inline-code">LLM_CACHE_TTL</code> and <code class="inline-code">REPOMIX_CACHE_TTL</code> shape the ancient mechanisms of time management across the adventure system?</li>
<li>‚ö° <strong>Thematic Pathways</strong>: How are <code class="inline-code">THEMES</code> constructed and queried to ensure only valid thematic adventures emerge from the Codex Obscurum?</li>
<li>üõ°Ô∏è <strong>Sanctity of Validation</strong>: What safeguards exist in <code class="inline-code">validateAdventureChoice</code> and <code class="inline-code">validateTheme</code> to protect the narrative from improper or corrupted choices?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Explore the foundations of the Codex</h3>
<p>The <code class="inline-code">config.ts</code> file serves as the cornerstone of the adventure system, outlining the constants that govern its behaviors. From API keys to thematic limits, each parameter is a glyph etched in code to fine-tune mechanisms of narrative control and ensure adventurers experience a structured and fair exploration. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Governs time limits for large-scale story data generation, balancing efficiency and complexity.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Configures caching lifespans to reduce redundant data analysis while optimizing performance across the system.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Prevents analysis on overly large files for safety and maintainable deployments, preserving memory constraints.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Decoding the Vision of Themes</h3>
<p>The <code class="inline-code">theme.ts</code> file is the thematic epicenter, housing definitions and single-sourced logic for guiding explorers of the Codex toward specific narrative paths. It ensures consistent retrieval, validation, and formatting processes for each theme, embodying the philosophy of clarity in ancient structure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: Acts as the sacred collection, defining available thematic archetypes including keywords for intuitive user input.</li>
<li><code class="inline-code">parseTheme</code>: Deciphers user input, matching keywords or IDs to their corresponding themes via structured logic.</li>
<li><code class="inline-code">getFormattedThemeOptions</code>: Formats theme data for display, offering adventurers a clear vision of their mystical pathways.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Ritual of Validation</h3>
<p>The <code class="inline-code">input-validator.ts</code> file performs vital checks, ensuring that adventurers approach their journey through the Codex with purity of intent and structured choices. It validates adventure themes, player choices, and paths, keeping sacred narratives unmarred by errors.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Protects the narrative by ensuring every adventurer‚Äôs choice is well-formed and concise.</li>
<li><code class="inline-code">validateTheme</code>: Guards from invalid thematic choices and provides helpful directions toward approved pathways.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Strips offensive or malformed inputs, ensuring artifacts of the Codex are displayed with pristine clarity.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> ensures equilibrium between the intricate demands of story generation and system performance.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> manages secondary systems, allowing reusability while avoiding redundancy in analysis workflows.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> is a safeguard that enables optimal functionality by excluding files that exceed reasonable memory thresholds.</li>
</ul>
<hr>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  },
  CUSTOM: {
    id: 5,
    key: &#39;custom&#39;,
    displayName: &#39;Custom Theme&#39;,
    emoji: &#39;üé®&#39;,
    description: &#39;Design your own adventure! You\&#39;ll be prompted to provide theme name, description, and keywords&#39;,
    keywords: [&#39;custom&#39;, &#39;personalized&#39;, &#39;unique&#39;, &#39;creative&#39;, &#39;personal&#39;]
  }
} as const;
</code></pre>
<ul>
<li><code class="inline-code">THEMES</code> offers a structured directory of thematic options, ensuring explorers have versatile yet narratively consistent avenues to approach Codex mysteries.</li>
<li>With keywords like &quot;ancient&quot; and &quot;pyramid,&quot; the <code class="inline-code">ANCIENT</code> theme connects narrative metaphors directly to archaeological wisdom.</li>
<li><code class="inline-code">CUSTOM</code> invites adventurers to craft their unique paths, showcasing conceptual flexibility within the sacred framework.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  const normalized = input.trim().toLowerCase();
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  return null;
}
</code></pre>
<ul>
<li><code class="inline-code">parseTheme</code> normalizes and parses user input for precision, safeguarding against miscommunication during thematic selection.</li>
<li>Its architecture promotes simplicity, allowing intuitive yet robust matching to retrieve valid thematic paths.</li>
<li>Logical separation ensures invalid themes gracefully return <code class="inline-code">null</code>, preserving the purity of intended narratives.</li>
</ul>
<hr>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  return input.trim();
}
</code></pre>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> guarantees explorers approach the system with concise and purposeful input, preventing accidental disruption.</li>
<li>The safeguards against excessively long choices fortify the Codex against malformed queries or resource-intensive excesses.</li>
<li>Errors are handled gracefully, redirecting users toward meaningful action rather than ambiguity.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  const parsedTheme = parseTheme(input.toLowerCase().trim());
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    throw new Error(&#39;Invalid theme choice&#39;);
  }
  return parsedTheme;
}
</code></pre>
<ul>
<li><code class="inline-code">validateTheme</code> offers robust thematic validation, ensuring adventurer selections align with those inscribed within the Codex.</li>
<li>By leveraging <code class="inline-code">parseTheme</code>, seamless integration of keyword and ID matching is achieved without sacrificing accuracy.</li>
<li>Graceful handling provides users with feedback should they stray outside the bounds of proper thematic selection.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li><code class="inline-code">sanitizeForDisplay</code> ensures clean output for sacred readings from the Codex, stripping unwanted formatting or disruptive characters.</li>
<li>It prevents unintended corruption of displayed content, safeguarding the equilibrium of ancient glyph presentation.</li>
<li>The deliberate truncation limit balances readability with conciseness, preserving the clarity of exploration results.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Compare constants like <code class="inline-code">LLM_REQUEST_TIMEOUT</code> and <code class="inline-code">REPOMIX_CACHE_TTL</code> to better understand their strategic purposes in performance scaling.</li>
<li>Study <code class="inline-code">parseTheme</code> against <code class="inline-code">sanitizeForDisplay</code> to uncover how input normalization differs across thematic validation versus output formatting.</li>
<li>Use <code class="inline-code">getFormattedThemeOptions</code> for a visual representation of thematic clarity, aiding in crafting impactful adventure choices.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the ancient Codex Obscurum and its Algorithmic Obelisk secrets.</p>
<p>By the sacred wisdom of the ancients, thou hast unveiled the mysteries of the Tome of Themes, journeying with the brilliance of a seeker destined for eternal enlightenment‚Äîpress on, for the stars themselves bear witness to thy triumph! ‚≠êüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>