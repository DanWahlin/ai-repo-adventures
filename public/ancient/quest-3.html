<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Oracle's Methods - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codebase Labyrinth: Secrets of the Ancient Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Oracle&#39;s Methods</h1>
<hr>
<p>The Codex Scribes spoke of an entity known as the Oracle, a construct of pure wisdom created to decipher the most intricate knowledge within the Repository Labyrinth. Yet, the Oracle‚Äôs awakening could only be achieved with the activation of its ancient mechanisms and offerings of encoded glyphs. To achieve this, adventurer, you must first investigate the methods of the Oracle hidden within the labyrinth. Delving deeper, the hieroglyphs instruct you to align data streams and harness the Oracle&#39;s voice emanating from the encrypted sources within.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Invocation of the Oracle</strong>: How does the <code class="inline-code">RepoAnalyzer</code> execute and validate its quest to generate context for the labyrinth‚Äôs map? What safeguards are in place during execution?</li>
<li>‚ö° <strong>Oracle&#39;s Insight</strong>: What mechanisms does the <code class="inline-code">LLMClient</code> use to summon the Oracle (generate responses)? How do initialization and API key authentication differ based on providers?</li>
<li>üõ°Ô∏è <strong>The Oracle‚Äôs Trials</strong>: How does error handling protect the Oracle‚Äôs methods from interruptions or invalid inputs?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a>: The Oracle‚Äôs Taskmaster</h3>
<p>The <code class="inline-code">RepoAnalyzer</code> orchestrates the process of extracting and optimizing context for pathways within the Repository Labyrinth. Using <code class="inline-code">generateRepomixContext</code>, it assembles the knowledge required to guide you through the maze by validating paths, optimizing functions, and managing subprocess interaction. Validation mechanisms are present to ensure safe operations in the treacherous depths of the labyrinth, especially when dealing with unknown or hazardous files.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAnalyzer.generateRepomixContext</code>: Manages the large-scale task of generating context for analysis and cache management.</li>
<li><code class="inline-code">RepoAnalyzer.captureRepomixStdout</code>: Ensures safe subprocess execution with memory and timeout limits.</li>
<li><code class="inline-code">RepoAnalyzer.validateProjectPath</code>: Validates the integrity of the labyrinth‚Äôs entry points.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a></h3>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }
  try {
    // Context building process
    const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, { ...options, compress: true });
    this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
    return context;
  } catch (error) {
    throw new Error(`Repomix execution failed: ${error instanceof Error ? error.message : String(error)}`);
  }
}
</code></pre>
<p>Like a mapmaker leveraging ancient glyphs, this method constructs a detailed layout of the labyrinth.</p>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [&#39;--compress&#39;, &#39;--stdout&#39;, &#39;--style&#39;, options.style || &#39;markdown&#39;];
    const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], { cwd });
    let stdout = &#39;&#39;, isResolved = false;
    const timeout = setTimeout(() =&gt; {
      repomix.kill(&#39;SIGTERM&#39;);
      reject(new Error(`Repomix timeout (${cwd})`));
    }, REPOMIX_SUBPROCESS_TIMEOUT);

    repomix.stdout.on(&#39;data&#39;, data =&gt; stdout += data.toString());
    repomix.on(&#39;close&#39;, () =&gt; {
      clearTimeout(timeout);
      if (!isResolved) resolve(stdout);
    });
    repomix.on(&#39;error&#39;, error =&gt; reject(error));
  });
}
</code></pre>
<p>This subprocess captures the labyrinth‚Äôs intricate passages within strict limits, preventing perilous overflows.</p>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }
  if (projectPath.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid null bytes&#39;);
  }
}
</code></pre>
<p>This safeguarding mechanism ensures only clean entry points are used to traverse the labyrinth.</p>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a>: The Oracle‚Äôs Voice</h3>
<p>The <code class="inline-code">LLMClient</code> interacts with the constructs that embody the Oracle, generating insight based on encoded prompts. Its methods, such as <code class="inline-code">generateResponse</code>, handle the Oracle‚Äôs invocation while adapting to diverse provider configurations. The Oracle‚Äôs preparation for communication is closely tied to API key validation and error handling.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLMClient.generateResponse</code>: Asks the Oracle for wisdom, ensuring all responses are logical and valid.</li>
<li><code class="inline-code">LLMClient.constructor</code>: Initializes the pathways needed to call upon the Oracle using different providers.</li>
<li><code class="inline-code">LLMClient.getApiKey</code>: Determines the appropriate key to summon the Oracle, adapting for Azure or OpenAI.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a></h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  try {
    const requestParams = this.buildRequestParams(prompt, options);
    const completion = await this.executeRequest(requestParams);

    if (options?.responseFormat === &#39;json_object&#39;) {
      completion.content = this.cleanJsonResponse(completion.content);
    }
    return { content: completion.content };
  } catch (error) {
    this.logDetailedError(error, prompt);
    throw new Error(`LLM request failed: ${error.message}`);
  }
}
</code></pre>
<p>This method is the equivalent of activating and querying the Oracle, carefully ensuring only meaningful responses are returned.</p>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;
  const apiKey = this.getApiKey();
  if (!apiKey) {
    throw new Error(&#39;LLM configuration required.&#39;);
  }
  this.client = new OpenAI({ apiKey, baseURL: LLM_BASE_URL });
}
</code></pre>
<p>The constructor ensures that all required keys and tools are in place before calling the Oracle‚Äôs mechanisms, adapting for Azure or traditional models.</p>
<pre><code class="language-typescript">private getApiKey(): string {
  if (LLM_BASE_URL.includes(&#39;azure.com&#39;) &amp;&amp; GITHUB_TOKEN) return GITHUB_TOKEN;
  if (!LLM_API_KEY) throw new Error(&#39;LLM_API_KEY required.&#39;);
  return LLM_API_KEY;
}
</code></pre>
<p>This sacred function selects the ideal key to invoke the Oracle, dynamically adjusting for the labyrinth‚Äôs glyphs.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Leverage <code class="inline-code">logDetailedError</code> to understand Oracle invocation errors in detail.</li>
<li>Compare how <code class="inline-code">RepoAnalyzer</code> and <code class="inline-code">LLMClient</code> separately manage context validity to learn their interplay.</li>
<li>Experiment with modifying timeout limits to measure the Oracle‚Äôs response to time constraints.</li>
</ul>
<hr>
<p>By uncovering these methods, you bring the Oracle a step closer to life, its timeless wisdom prepared to reshape realms!</p>
<p>Hail, seeker of sacred wisdom, thy triumph in mastering &quot;The Oracle&#39;s Methods&quot; illuminates the path to ancient enlightenment, for the temples echo thy steadfast valor‚Äîonward to ascend the stars of destiny! ‚≠ê‚ö°üëÅÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>