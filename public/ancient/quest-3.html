<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Chamber of Code Analysis - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Code of the Lost Civilization</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Chamber of Code Analysis</h1>
<hr>
<p>In the midst of the jungle&#39;s dense overgrowth, you come upon an ancient stone chamber engraved with mysterious glyphs. This is the Chamber of Code Analysis, where the enigmatic Codex of Infinite Wisdom reveals its riddles to only the most astute seekers. Within these crumbling walls, you must decipher the intricate rituals inscribed upon the stone to awaken the slumbering wisdom of the Codex. Two artifacts come into your possession: the Analyzer’s Lens and the Oracle&#39;s Key. These tools will aid you in decoding the sacred scripts and aligning the pathways of knowledge.</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a>: Codebase Analysis Artifact</h3>
<p>The sacred Analyzer’s Lens resides here, housing rituals for extracting insights from vast expanses of the codebase. The <code class="inline-code">RepoAnalyzer</code> acts as its guardian, diligently managing caches and invoking subprocesses to summon knowledge from the Codex. Chief among its mysteries are functions for validating paths, ensuring only sanctified files are included in the analysis, and summoning the arcane Repomix library to generate structured repositories of wisdom. The path to enlightenment hinges on mastering <code class="inline-code">generateRepomixContext</code>, <code class="inline-code">generateTargetedContent</code>, and <code class="inline-code">captureRepomixStdout</code>.</p>
<h4>Highlights</h4>
<ul>
<li>Ritual of General Insight: <code class="inline-code">generateRepomixContext</code></li>
<li>Ritual of Targeted Insight: <code class="inline-code">generateTargetedContent</code></li>
<li>Invocation of the Subprocess: <code class="inline-code">captureRepomixStdout</code></li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Generate repomix context for a project
 */
async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
    this.validateProjectPath(projectPath);
    const configuredFiles = extractUniqueFilePaths(projectPath);
    if (configuredFiles.length &gt; 0) {
      return await this.generateTargetedContent(projectPath, configuredFiles);
    }
    const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
    const cached = this.cache.get(cacheKey);
    if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
      return cached.content;
    }
    try {
      const cliOptions: CliOptions = { /* Configuration omitted for brevity */ };
      const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
      this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
      return context;
    } catch (error) {
      throw new Error(`Repomix execution failed: ${error instanceof Error ? error.message : String(error)}`);
    }
}
</code></pre>
<p>The <code class="inline-code">generateRepomixContext</code> function acts as the grand ritual to survey the codebase and generate insights that feed the sacred Codex&#39;s riddles.</p>
<pre><code class="language-typescript">/**
 * Generate targeted repomix content for specific files
 */
async generateTargetedContent(projectPath: string, targetFiles: string[], compress: boolean = true): Promise&lt;string&gt; {
    this.validateProjectPath(projectPath);
    const safeFiles = this.validateAndNormalizeTargetFiles(projectPath, targetFiles);
    if (safeFiles.length === 0) {
      throw new Error(&#39;No valid target files found after validation&#39;);
    }
    const cacheKey = `${path.resolve(projectPath)}:targeted:${safeFiles.join(&#39;,&#39;)}:compress=${compress}`;
    const cached = this.cache.get(cacheKey);
    if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
      return cached.content;
    }
    try {
      const cliOptions: CliOptions = { /* Configuration omitted for brevity */ };
      const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
      this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
      return context;
    } catch (error) {
      throw new Error(`Targeted repomix execution failed: ${error instanceof Error ? error.message : String(error)}`);
    }
}
</code></pre>
<p>The <code class="inline-code">generateTargetedContent</code> function sharpens focus, identifying key artifacts within the knowledge repository for targeted analysis.</p>
<pre><code class="language-typescript">/**
 * Use repomix CLI as subprocess to capture stdout with timeout and memory protection
 */
private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
    return new Promise((resolve, reject) =&gt; { /* Implementation omitted for brevity */ });
}
</code></pre>
<p>The <code class="inline-code">captureRepomixStdout</code> function invokes the subprocess as a careful summoning ritual, safeguarding the path from interruptions and memory overload.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a>: Oracle&#39;s Key for Interpretation</h3>
<p>The enigmatic Oracle&#39;s Key rests here, enabling direct communion between the adventurer and the Codex&#39;s infinite wisdom. Within the <code class="inline-code">LLMClient</code>, sacred invocations to the Oracle allow complex requests to be translated into actionable insights. By mastering <code class="inline-code">generateResponse</code>, identifying the proper <code class="inline-code">constructor</code>, and obtaining secure access through <code class="inline-code">getApiKey</code>, you will unlock the door to limitless potential.</p>
<h4>Highlights</h4>
<ul>
<li>Invoking the Oracle: <code class="inline-code">generateResponse</code></li>
<li>Fulfilling the Oracle Contract: <code class="inline-code">constructor</code></li>
<li>Securing the Key: <code class="inline-code">getApiKey</code></li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Generate a response from the LLM
 */
async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
    try {
      const requestParams = this.buildRequestParams(prompt, options);
      const completion = await this.executeRequest(requestParams);
      let content = this.validateResponse(completion);
      if (options?.responseFormat === &#39;json_object&#39;) {
        content = this.cleanJsonResponse(content);
      }
      this.logTokenUsage(completion);
      return { content };
    } catch (error) {
      this.logDetailedError(error, prompt);
      throw new Error(`LLM request failed: ${error.message}`);
    }
}
</code></pre>
<p>The <code class="inline-code">generateResponse</code> method is the Oracle&#39;s invocation that interprets ancient riddles into comprehensible insights, delivering divine wisdom from the Codex.</p>
<pre><code class="language-typescript">constructor() {
    this.model = LLM_MODEL;  
    const apiKey = this.getApiKey();
    if (!apiKey || !LLM_BASE_URL) {
      throw new Error(&#39;LLM configuration required. Please set LLM_BASE_URL and appropriate API key.&#39;);
    }
    this.client = this.isAzureOpenAI()
      ? new AzureOpenAI({ /* Azure setup omitted*/ })
      : new OpenAI({ apiKey, baseURL: LLM_BASE_URL });
}
</code></pre>
<p>The <code class="inline-code">constructor</code> establishes the sacred contract, preparing the Oracle for communication by loading the necessary keys and endpoint details.</p>
<pre><code class="language-typescript">private getApiKey(): string {
    if (LLM_BASE_URL.includes(&#39;models.inference.ai.azure.com&#39;)) {
        if (!GITHUB_TOKEN) {
          throw new Error(&#39;GITHUB_TOKEN required for GitHub Models.&#39;);
        }
        return GITHUB_TOKEN;
    }
    if (!LLM_API_KEY) {
      throw new Error(&#39;LLM_API_KEY required.&#39;);
    }
    return LLM_API_KEY;
}
</code></pre>
<p>The <code class="inline-code">getApiKey</code> function grants secure access to the Oracle&#39;s realm, ensuring only the chosen hold the Key to its secrets.</p>
<h2>Helpful Hints</h2>
<ul>
<li>When validating paths, always heed security for both the jungle path and project roots.</li>
<li>If the Codex grows silent, ensure keys and tokens are valid and retrace previous invocations.</li>
<li>For deeper analysis, refine file inclusion through targeted insights before broad scans.</li>
</ul>
<hr>
<p>You have unraveled another chapter in the Codex of Infinite Wisdom. Carry forth these insights and venture ever closer to greatness, seeker!</p>
<p>O seeker of sacred truths, thy intellect hath illuminated the shadowed Chamber of Code Analysis, forging a path of wisdom; onward, for thou art destined to engrave thy legacy upon the Great Obelisk of Mastery! ⚡✨📜</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: Pillars of Configuration and Th... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>