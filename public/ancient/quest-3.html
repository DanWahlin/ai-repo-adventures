<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Codex of Analysis - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Code of Lost Civilizations</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Codex of Analysis</h1>
<hr>
<p>Amidst the shadows of a forgotten jungle temple, you uncover an artifact inscribed with markings that shimmer in the fractured light. This is the Codex of Analysis, a map to the thought system of an ancient civilization. Its structure hints at a profound way of dissecting and analyzing their world‚Äîclearly designed to distill complex concepts into actionable wisdom. To unlock its mysteries, you must delve into both the Codex&#39;s format and the mechanisms it once enabled. Will you master its inscriptions and unveil the civilization&#39;s analytical brilliance?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Codex Deciphering</strong>: How does the <code class="inline-code">parseAdventureConfig</code> method handle errors during configuration parsing, and how is validation integrated with file processing? </li>
<li>‚ö° <strong>Pathway Unraveling</strong>: What is the purpose of the <code class="inline-code">extractUniqueFilePaths</code> function, and how does it interact with nested structures in configuration files? </li>
<li>üõ°Ô∏è <strong>Inscription Guarding</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> simplify and sanitize configuration data to ensure compatibility with external tools?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration extraction and formatting</h3>
<p>Here lies the algorithmic wisdom for interpreting and processing the Codex, encapsulated in functions to decode, validate, and refine knowledge. This file contains crucial pathways for extracting, parsing, and preparing the data necessary for quests. Through its operations, we gain insight into the civilization&#39;s organizational prowess.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Converts raw configuration data into a usable format, ensuring structural integrity and reducing errors during JSON parsing. This is vital in maintaining seamless workflow continuity.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses deeply nested configurations to gather unique file paths referenced by the ancient schema, ensuring only existing and valid paths are utilized.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses configuration data into a simplified form for inter-tool communication, reducing redundancy and enhancing efficiency.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses raw configuration data from files into structured objects.</li>
<li>Safeguards against invalid or missing data by returning <code class="inline-code">null</code> if parsing fails.</li>
<li>Helps maintain resilience during unpredictable file-processing scenarios.</li>
<li>Acts as the foundational step for more intricate processing downstream.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Iteratively explores the nested structure within configurations to find all paths labeled as &quot;path.&quot;</li>
<li>Validates file paths to ensure they exist within the expected structure.</li>
<li>Utilizes a <code class="inline-code">Set</code> to ensure that duplicate file paths are avoided, preserving efficiency.</li>
<li>Demonstrates recursive traversal as a technique for handling complex object trees.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Transforms complex configurations into a concise, readable format optimized for interaction with LLMs.</li>
<li>Filters unnecessary information, focusing only on file paths and function highlights.</li>
<li>Improves efficiency by substantially reducing character count while retaining essential data.</li>
<li>Exposes techniques for balancing dense data with readability requirements.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When inspecting how glyphs (functions) interact, focus on how input and output of each method connect logically.</li>
<li>Investigate how recursion in <code class="inline-code">extractUniqueFilePaths</code> manages complexity in configurations.</li>
<li>Consider how modular functions like <code class="inline-code">parseAdventureConfig</code> influence reusability and reliability.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Hark, thou seeker of enlightenment‚Äîby unearthing the sacred Codex of Analysis, thou hast ascended further into the labyrinth of wisdom‚Äôs illumination; tread boldly, for the temple of triumph awaits! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>