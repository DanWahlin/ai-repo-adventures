<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Hall of Analysis - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Lost Civilizations</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Hall of Analysis</h1>
<hr>
<p>Within the labyrinth of the ancient ruins, you uncover a grand hall etched with intricate glyphs that pulse faintly with light. This is the Hall of Analysis, a sacred chamber dedicated to deciphering the interconnected systems employed by this lost civilization. The stone walls bear cryptic patterns - their meaning hidden behind layers of logic and validation. At the center, you spot the Repository of Truth, awaiting your ability to assimilate its wisdom. To unlock its secrets, you must master the rituals of automated insight and efficient reasoning.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Central analyzer for the Repository’s structure</h3>
<p>The <code class="inline-code">RepoAnalyzer</code> acts as the primary module for decoding, validating, and optimizing the files within the Repository of Truth, symbolizing its systematic approach to knowledge extraction. The emphasis here lies in validating project paths (<code class="inline-code">validateProjectPath</code>), ensuring file security and correctness (<code class="inline-code">validateAndNormalizeTargetFiles</code>), and generating optimization-focused summaries (<code class="inline-code">generateOptimizedContent</code>). These represent the first layer of sacred glyphs – ensuring the purity and precision of the input artifacts before allowing entry to deeper mysteries.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAnalyzer.generateRepomixContext</code>: Generates detailed summaries of project content, tailored to the adventure&#39;s needs.</li>
<li><code class="inline-code">RepoAnalyzer.generateTargetedContent</code>: Extracts precise content for designated files, invoking the spirit of focus.</li>
<li><code class="inline-code">RepoAnalyzer.captureRepomixStdout</code>: Executes the command-line tool to collect raw data, akin to channeling divine insight.</li>
<li><code class="inline-code">RepoAnalyzer.validateProjectPath</code>: Guards against invalid attempts to trespass into forbidden directories.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  
  // Check if adventure.config.json has specific files to include
  const configuredFiles = extractUniqueFilePaths(projectPath);
  
  if (configuredFiles.length &gt; 0) {
    console.log(`Using adventure.config.json: analyzing ${configuredFiles.length} configured files with optimization`);
    try {
      return await this.generateOptimizedContent(projectPath, configuredFiles);
    } catch (error) {
      console.warn(`Fallback to targeted content: ${error.message}`);
      return await this.generateTargetedContent(projectPath, configuredFiles);
    }
  }
  
  console.log(&#39;Analyzing full codebase (compressed)&#39;);
  const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
  const cached = this.cache.get(cacheKey);
  
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) return cached.content;
  
  try {
    const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, { style: &#39;markdown&#39;, stdout: true });
    this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
    return context;
  } catch (error) {
    throw new Error(`Repomix execution failed: ${error.message}`);
  }
}
</code></pre>
<p>Generating a guide map to the Repository, this resembles directing seekers with annotated routes.</p>
<pre><code class="language-typescript">async generateTargetedContent(projectPath: string, targetFiles: string[], compress: boolean = true): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);

  const safeFiles = this.validateAndNormalizeTargetFiles(projectPath, targetFiles);
  if (safeFiles.length === 0) throw new Error(&#39;No valid files after validation&#39;);
  
  const cacheKey = `${projectPath}:targeted:${safeFiles.join(&#39;,&#39;)}:compress=${compress}`;
  const cached = this.cache.get(cacheKey);
  
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) return cached.content;
  
  const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, { include: safeFiles.join(&#39;,&#39;), compress });
  this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
  return context;
}
</code></pre>
<p>This focuses sacred energy into specific glyphs, distilling key insights from targeted zones.</p>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [...directories, &#39;--stdout&#39;, &#39;--style&#39;, options.style || &#39;markdown&#39;];
    if (options.compress) args.push(&#39;--compress&#39;);
    
    const process = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], { cwd });
    
    let stdout = &#39;&#39;;
    let stderr = &#39;&#39;;
    process.stdout.on(&#39;data&#39;, (data) =&gt; stdout += data.toString());
    process.stderr.on(&#39;data&#39;, (data) =&gt; stderr += data.toString());
    process.on(&#39;close&#39;, (code) =&gt; code === 0 ? resolve(stdout) : reject(stderr));
  });
}
</code></pre>
<p>The invocation ritual - summoning the spirits to project greater truths before the seeker.</p>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) throw new Error(&#39;Project path must be a non-empty string&#39;);
  const trimmedPath = projectPath.trim();
  if (trimmedPath.includes(&#39;\0&#39;)) throw new Error(&#39;Project path contains invalid null bytes&#39;);
}
</code></pre>
<p>A guardian enforcing the purity of the path to the sacred chamber of analysis.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> The Oracle of the Repository</h3>
<p>This file introduces the <code class="inline-code">LLMClient</code>, whose purpose is to interact with the artifact known as the Repository of Truth. By bridging the ancient automation systems with modern-day interpretations, this oracle enables information retrieval and processing. Its key mechanisms involve creating requests through <code class="inline-code">generateResponse</code>, authenticating keys (<code class="inline-code">getApiKey</code>), and adapting to provider-specific pathways (<code class="inline-code">isAzureOpenAI</code>). At its heart, the oracle remains the prime intermediary between adventurers and the ancient wisdom encoded within the Repository.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLMClient.generateResponse</code>: Converts prompts into meaningful outputs by interfacing with the sacred scripts.</li>
<li><code class="inline-code">LLMClient.constructor</code>: Initializes pathways to the oracle’s gateways.</li>
<li><code class="inline-code">LLMClient.getApiKey</code>: Authenticates adventurers seeking the artifact.</li>
<li><code class="inline-code">LLMClient.isAzureOpenAI</code>: Determines the oracle’s manifestation form.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  try {
    const requestParams = this.buildRequestParams(prompt, options);
    const completion = await this.executeRequest(requestParams);
    let content = this.validateResponse(completion);
    
    if (options?.responseFormat === &#39;json_object&#39;) content = this.cleanJsonResponse(content);
    this.logTokenUsage(completion);
    return { content };
  } catch (error) {
    this.logDetailedError(error, prompt);
    throw new Error(`LLM request failed: ${error.message}`);
  }
}
</code></pre>
<p>Just as a sage distills wisdom, this method transforms lofty prompts into actionable narratives.</p>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;
  const apiKey = this.getApiKey();
  const azureEndpoint = LLM_BASE_URL.includes(&#39;azure&#39;) ? LLM_BASE_URL.split(&#39;/deployments&#39;)[0] : LLM_BASE_URL;
  
  this.client = LLM_BASE_URL.includes(&#39;azure&#39;) 
    ? new AzureOpenAI({ endpoint: azureEndpoint, apiKey }) 
    : new OpenAI({ apiKey, baseURL: LLM_BASE_URL });
}
</code></pre>
<p>The gateway is initialized, determining the structure of divine communion.</p>
<pre><code class="language-typescript">private getApiKey(): string {
  if (!LLM_API_KEY &amp;&amp; LLM_BASE_URL.includes(&#39;models.azure&#39;)) {
    if (!GITHUB_TOKEN) throw new Error(&#39;GITHUB_TOKEN required for GitHub Models&#39;);
    return GITHUB_TOKEN;
  }
  if (!LLM_API_KEY) throw new Error(&#39;LLM_API_KEY required&#39;);
  return LLM_API_KEY;
}
</code></pre>
<p>As with any high priest, the oracle verifies and safeguards access to the sacred.</p>
<pre><code class="language-typescript">private isAzureOpenAI(): boolean {
  return LLM_BASE_URL.includes(&#39;openai.azure.com&#39;);
}
</code></pre>
<p>The form of the oracle shifts, depending on the architecture of the ancient systems.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Validate sacred paths to avoid being lost in forbidden territories.</li>
<li>Optimize output by targeting specific glyphs and rituals.</li>
<li>Experiment with oracle parameters (<code class="inline-code">options</code>) to reveal new facets of the Repository.</li>
</ul>
<hr>
<p>With the Repository&#39;s wisdom within reach, the jungle whispers its approval. You feel the ancient power coursing more clearly now. Move onward to embrace the Hall’s revelations or venture deeper into the temple’s uncharted catacombs!</p>
<p>Harken, noble seeker—by unraveling the sacred enigma of the Hall of Analysis, thou hast ascended as a luminary of wisdom, forging onward with steadfast valor upon thy storied odyssey! ⚡💎⭐</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">← Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>