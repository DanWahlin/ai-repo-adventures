<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Forge of Storytelling - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Codebase of Eternal Treasures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Forge of Storytelling</h1>
<hr>
<p>In the shadow of crumbled colonnades deep within the jungle, you encounter a grand structure resembling an ancient forge‚Äîexcept its walls breathe stories, etched with code-like glyphs. This is the Forge of Storytelling, where legends of quests are crafted from source materials. Shielded by vines and decay, the artifacts within whisper tales of forgotten implementations: tools to mold dynamic adventures from fragmented scripts and methods to decipher encrypted paths into cohesive narratives. Will you uncover the techniques that breathed life into quests long ago?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Artifact Assembly</strong>: How are fragments of raw configuration data transformed into cohesive adventure prompts and quest narratives?  </li>
<li>‚ö° <strong>Narrative Flow</strong>: How does the system ensure quests are structured logically and integrate with themes during runtime generation?  </li>
<li>üõ°Ô∏è <strong>Sanctioned Paths</strong>: What failsafes exist to verify file paths and user input before embedding content into quests?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Loading &amp; Parsing</h3>
<p>Within the hollow corridors of adventure knowledge lies this artifact, essential for extracting details from the mysterious <code class="inline-code">adventure.config.json</code>. This module provides the sacred tools necessary to load, parse, and validate configurations and paths. Its glyphs detail how base data emerges as the backbone for story generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads the raw content of <code class="inline-code">adventure.config.json</code> from the specified project path, ensuring seamless integration and non-fatal errors for missing files.  </li>
<li><code class="inline-code">parseAdventureConfig</code>: Converts raw configuration data into structured objects while guarding against malformed inputs via JSON parsing and validation.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Explores nested objects in the configuration, assembling a list of valid paths by validating their existence in the project directory.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Assembly Engine</h3>
<p>This ancient mechanism is the driving force behind quest execution. It weaves together user input, system themes, and dynamic configurations into playable quests. Its glyphs reveal methods for progress tracking, quest validation, and content generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets the adventure state and constructs quests using both project configurations and LLM-generated narratives while enforcing structural integrity and alignment with themes.  </li>
<li><code class="inline-code">exploreQuest</code>: Handles the selection and execution of quests, including revisiting completed tasks using cached artifacts. Error handling ensures safe navigation through user choices.  </li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Integrates specific file references from configuration data into generated quests, blending ancient storage with new stories.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}

export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}

export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li><strong>Artifact Assembly</strong>: The <code class="inline-code">loadAdventureConfig</code> and <code class="inline-code">parseAdventureConfig</code> functions together handle file reads and structured parsing while ensuring invalid configurations are handled gracefully.  </li>
<li><strong>Sanctioned Paths</strong>: <code class="inline-code">extractUniqueFilePaths</code> ensures only valid paths are referenced, preserving the sanctity of the quest parameters.  </li>
<li><strong>Efficiency Pattern</strong>: Use of <code class="inline-code">Set</code> ensures uniqueness of paths, optimized for memory and performance during recursion.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string, customThemeData?: CustomThemeData): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}

async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}

private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;
  
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;
  
  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;
  
  const configQuestFiles = new Map&lt;string, string[]&gt;();
  for (const configQuest of adventure.quests) {
    if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {
      const filePaths = configQuest.files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
      if (filePaths.length &gt; 0) {
        configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);
      }
    }
  }
  
  return quests.map((quest, index) =&gt; {
    const configQuests = adventure.quests;
    if (index &lt; configQuests.length &amp;&amp; configQuests[index] &amp;&amp; configQuests[index].files) {
      const files = configQuests[index].files
        .filter((f: any) =&gt; f.path)
        .map((f: any) =&gt; f.path);
      if (files.length &gt; 0) {
        return { ...quest, codeFiles: files };
      }
    }

    const questTitleLower = quest.title.toLowerCase();
    for (const [configTitle, files] of configQuestFiles.entries()) {
      if (questTitleLower.includes(configTitle) || configTitle.includes(questTitleLower)) {
        return { ...quest, codeFiles: files };
      }
    }

    return quest;
  });
}
</code></pre>
<ul>
<li><strong>Narrative Flow</strong>: <code class="inline-code">initializeAdventure</code> orchestrates reset, theme application, and quest generation, weaving disparate elements into playable adventures.  </li>
<li><strong>Artifact Assembly</strong>: <code class="inline-code">mergeQuestFilesFromConfig</code> integrates file-specific context into runtime quests, crafting tailored explorations from ancient and generated content.  </li>
<li><strong>Error Recovery</strong>: Fallback pathways ensure missing configurations result in graceful degradation.</li>
</ul>
<hr>
<pre><code class="language-typescript">
</code></pre>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üìú When traversing decoding functions, trace how nested configurations impact dynamic features using recursion.  </li>
<li>üè∫ Investigate caching patterns in <code class="inline-code">exploreQuest</code> for insights on reusability and performance.  </li>
<li>üö© Keep file path validation at the forefront of exploration‚Äîintegrity is the key to unlocking cohesive quests.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>üè∫ With sacred laurels upon thy brow, thou hast emerged triumphant from the Forge of Storytelling, crafting wisdom that gleams like the divine light of Phoebus‚Äîpress onward, bold seeker, for the hallowed path yet beckons! ‚ö°üìú</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>