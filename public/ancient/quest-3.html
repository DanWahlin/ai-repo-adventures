<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Codex of Configuration - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Temple of Forgotten Code</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Codex of Configuration</h1>
<hr>
<p>In the labyrinthine depths of the Pyramid of Patterns lies a library of ancient texts, each scroll filled with cryptic glyphs that whisper secrets of the Codex of Configuration. This revered codex, carefully etched into weathered chambers, contains the rituals to harness the power of organized data. Valiant explorer, you now face a challenge to unlock its wisdom: to delve into how configurations and pathways were structured by the ancient civilization and uncover their sacred techniques of abstraction and validation.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Retrieval Ritual</strong>: How does the system determine if a configuration file exists and load it without causing fatal errors?</li>
<li>‚ö° <strong>Parsing Ceremony</strong>: What happens during the parsing of the configuration, and how is it validated against potential corruption or absence?</li>
<li>üõ°Ô∏è <strong>Pathway Integrity</strong>: How are file paths extracted, validated, and ensured to exist within the defined configuration structure?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Wisdom</h3>
<p>The sacred glyphs within this file unveil the techniques the ancients used for configuration management. Here, you will learn how to retrieve, parse, and validate configuration data stored within the artifact known as <code class="inline-code">adventure.config.json</code>. You will also uncover the secrets of extracting file paths to ensure that configurations point to valid resources. Carefully observing these inscriptions will provide insights into the underlying sacred algorithms.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: This function retrieves raw adventure configuration content from the given project path. It ensures the retrieval process is non-fatal by accounting for missing or unreadable files, a critical safeguard in the pursuit of robust systems.</li>
<li><code class="inline-code">parseAdventureConfig</code>: The dynamic method of converting raw configuration data into a usable object, including safe handling of corrupted or malformed data structures.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: A recursive exploration of the configuration object to uncover and validate all unique file paths referenced within, ensuring pathway integrity.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This function retrieves the configuration file <code class="inline-code">adventure.config.json</code> using the path provided.</li>
<li>It uses <code class="inline-code">readFileIfExists</code>, handling scenarios where the file might be missing or inaccessible by returning <code class="inline-code">null</code>.</li>
<li>Ensures robustness by abstracting away direct filesystem errors, a design pattern that enhances system resilience.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Converts raw JSON data from <code class="inline-code">loadAdventureConfig</code> into a JavaScript object, returning <code class="inline-code">null</code> for errors or empty data.</li>
<li>Introduces a key error-handling mechanism that protects against invalid or malformed JSON content by encapsulating the parsing process in a <code class="inline-code">try-catch</code>.</li>
<li>Acts as a single source of truth for configuration validation, promoting consistency and clarity across processes.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Discovers and validates file paths referenced in the configuration object.</li>
<li>Implements a recursive approach, using a stack to iterate through nested structures. Each node is checked for <code class="inline-code">path</code> fields and validated.</li>
<li>Combats configuration drift by ensuring each referenced file exists in the filesystem.</li>
<li>Leverages JavaScript‚Äôs <code class="inline-code">Set</code> object to store unique values, demonstrating an efficient method for eliminating duplicates.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Take note of the <code class="inline-code">readFileIfExists</code> utility. Its emphasis on resilience shines as a guiding light when engineering fault-tolerant systems.</li>
<li>Observe how <code class="inline-code">parseAdventureConfig</code> centralizes JSON parsing and guards against malformed input. Applying this pattern across projects can enhance consistency.</li>
<li>Focus on how <code class="inline-code">extractUniqueFilePaths</code> validates paths. Consider adopting this approach in scenarios where runtime validations are critical for system integrity.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Hark, noble seeker, thou hast unveiled the sacred Codex of Configuration, advancing thy celestial pilgrimage with valorous wisdom; may thy resolve remain steadfast as thou ascendeth the ancient path toward enlightenment! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>