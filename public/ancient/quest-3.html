<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Chronicle of Legendary Paths - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Codex of the Lost Civilization</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Chronicle of Legendary Paths</h1>
<hr>
<p>The rain-soaked jungle whispers secrets of an age long past, drawing you closer to the towering entrance of the Temple of Infinite Threads. Inside, complex mechanisms guard the Codex&#39;s fragmented wisdom‚Äîarcane gears that only yield to those who understand their intricate design. Seeking to decipher the glyphs and unlock the structure within, you arrive at this new chapter of investigation, where ancient techniques merge with modern code. Your path is set: untangle the hidden pathways of knowledge woven within these files.</p>
<p><strong>Adventure Awaits</strong>: The eternal jungle conceals the Codex treasures‚Äîforge ahead and uncover the wisdom hidden inside!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configuration Alchemy</strong>: How does <code class="inline-code">loadAdventureConfig</code> handle file reading, and what ensures its adaptability for various project structures?</li>
<li>‚ö° <strong>Path Extraction Ritual</strong>: What approach is used by <code class="inline-code">extractUniqueFilePaths</code> to navigate and validate configuration data paths?</li>
<li>üõ°Ô∏è <strong>Codex Interpreter</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> synchronize project context, configuration, and ancient themes for a cohesive system?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Responsible for managing and parsing the Codex‚Äôs core configuration file to dynamically adapt to project needs.</h3>
<p>This file contains functions critical to understanding how the Codex (a JSON config file) interacts with the broader system. These methods scaffold the adventure by accessing, validating, and formatting low-level configuration data. Each glyph-covered line of code offers a new insight into structuring information.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: A straightforward file loader function that dynamically reads configuration data without imposing rigid assumptions. This prevents fatal errors for missing files.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Navigates the Codex hierarchy, validating referenced paths to only return those that exist; ensures efficient exploration.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the configuration into a concise format for integration with advanced systems, reducing redundancy.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Allows the configuration to be safely loaded without crashing if the file is missing.</li>
<li>Uses <code class="inline-code">readFileIfExists</code> to handle unreadable or non-existent files gently.</li>
<li>Ensures the system doesn&#39;t fail during initialization, which is vital for wide-ranging project environments.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Iteratively traverses nested objects to extract <code class="inline-code">path</code> values dynamically.</li>
<li>Removes duplicates using a <code class="inline-code">Set</code> and validates paths by checking if they exist.</li>
<li>Balances thoroughness with performance, ensuring unnecessary paths are filtered out for system integrity.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Adjusts the raw adventure config into a clean structure for downstream systems.</li>
<li>Focuses on compressing information into an LLM-friendly markdown format.</li>
<li>Provides clarity without overwhelming with verbosity, aligning with efficiency and usability goals.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Orchestrates the Codex&#39;s hidden mechanisms, connecting configuration, story generation, and quest execution.</h3>
<p>A central piece of the Codex puzzle, this file handles the interplay between the configuration and the core storyline. It ensures that ancient themes and modern structures intermingle harmoniously. Results here cascade across all chapters of the Codex&#39;s mysteries.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: The initial ritual that sets the context, loads the Codex configuration, and aligns elements to the chosen theme.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Unifies quests and integrates them with the Codex configuration, ensuring alignment.</li>
<li><code class="inline-code">progressPercentage</code>: Adds a metric for explorers charting their progress through the Codex, furthering engagement with the system.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Resets the system&#39;s state and initializes all vital pieces: theme, config, and project context.</li>
<li>Uses external configuration to build a story and ensures alignment between quests and the overarching design.</li>
<li>Enables flexibility while maintaining a clear foundation for further adventure.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>To deepen your understanding, trace how files traverse through <code class="inline-code">loadAdventureConfig</code> to <code class="inline-code">initializeAdventure</code>.</li>
<li>Focus on the interplay between theme selection and config-based quest generation.</li>
<li>Enhance your exploration by testing configurations locally to observe how paths validate dynamically.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries embedded in the Codex of the Lost Civilization and reveal its ultimate power.</p>
<p>O illuminators of sacred wisdom, thou hast traversed the second legendary path with valor, ascending in triumph and etching thy noble deeds into the eternal chronicle of ancient temples ‚≠ê‚ö°üíé!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>