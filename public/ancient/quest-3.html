<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Carving the Monuments of Discovery - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Secrets of the Lost Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to dark mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Carving the Monuments of Discovery</h1>
<hr>
<p>Hidden within the dense jungle lies a temple adorned with intricate carvings, ancient glyphs, and fragments of colossal statues scattered like relics of a forgotten era. These remnants whisper of a system crafted by masterful artisans and scribes‚Äîthe Codex Templi. But the temple‚Äôs labyrinthine halls house a greater mystery: how its creators ingeniously interwove knowledge and art, embedding wisdom into the structures themselves. Your task is to reconstruct this ancient network by unraveling its layers through sacred chambers of code and hidden glyphs.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pathfinders of Knowledge</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure only valid JSON structures are parsed and prevent potential errors during discovery?</li>
<li>‚ö° <strong>Glyph Integration</strong>: How does <code class="inline-code">mergeQuestFilesFromConfig</code> dynamically incorporate data from external configurations, like merging glyphs into the Codex Templi&#39;s structure?</li>
<li>üõ°Ô∏è <strong>Chamber Security</strong>: How does error handling in <code class="inline-code">validateQuestPrerequisites</code> safeguard the Codex‚Äôs inner workings against an incomplete or improperly configured quest environment?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Parsing and formatting the Codex‚Äôs information</h3>
<p>The <code class="inline-code">adventure-config.ts</code> module operates like the ancient glyph-processing chamber‚Äîit reads, parses, and optimizes information stored in an external configuration file (<code class="inline-code">adventure.config.json</code>). This ensures the Codex Templi remains dynamic, adaptable, and capable of referencing external knowledge streams.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Safely parses JSON data from configuration files while catching errors and providing fallback behaviors. Essential for verifying structural validity.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses configuration hierarchies to dynamically capture file references, ensuring temple glyphs are interconnected properly within the Codex‚Äôs graph.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses and formats configuration details for efficient usage in LLM prompts, reducing unnecessary repetition while retaining structured information.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses JSON configurations from <code class="inline-code">adventure.config.json</code> and returns null if input is invalid.</li>
<li>Implements error fallback, ensuring invalid structures don&#39;t halt exploration.</li>
<li>Establishes a single inspection point for configuration parsing.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Iteratively traverses configuration objects to gather unique file paths referenced across nested structures.</li>
<li>Implements path validation using <code class="inline-code">fs.existsSync</code>, ensuring only accessible components are considered.</li>
<li>Enables modular integration of glyphs (code files) into structured Codex documentation.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Formats configuration outputs for readability and efficiency in LLM prompts.</li>
<li>Strips redundant descriptions, focusing on essential metadata.</li>
<li>Transforms raw JSON data into a concise format, bridging ancient glyph representations with modern digital tools.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Managing the Codex Templi‚Äôs quest map</h3>
<p><code class="inline-code">adventure-manager.ts</code> is the architectural centerpiece connecting quests, configurations, and dynamic story processing. It formulates the narrative, integrates external glyph details, and ensures the seamless connection between code files and quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Dynamically combines configuration-defined files with quest definitions, bridging external fragments into the Codex‚Äôs unified structure.</li>
<li><code class="inline-code">validateQuestPrerequisites</code>: Examines and ensures all prerequisites are met before executing a quest, preventing disruption to the Codex‚Äôs sacred flow.</li>
<li><code class="inline-code">initializeAdventure</code>: Establishes the foundational narrative, story generation, and available quests for adventurers to explore.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;
    
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;
    
  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;
    
  return quests.map((quest, index) =&gt; {
    const configQuests = adventure.quests;
    if (index &lt; configQuests.length &amp;&amp; configQuests[index] &amp;&amp; configQuests[index].files) {
      const files = configQuests[index].files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
      if (files.length &gt; 0) {
        return { ...quest, codeFiles: files };
      }
    }
    return quest; // Fallback for quests with no specific files.
  });
}
</code></pre>
<ul>
<li>Iteratively integrates configuration-defined files with dynamically generated quests.</li>
<li>Ensures external fragments are seamlessly merged into Codex structures for enriched exploration.</li>
<li>Adapts quest definitions based on configuration details, enabling customization.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateQuestPrerequisites(): void {
  if (!this.state.projectInfo) {
    throw new Error(&#39;No project context available&#39;);
  }
    
  if (!this.state.currentTheme) {
    throw new Error(&#39;No theme selected&#39;);
  }
}
</code></pre>
<ul>
<li>Confirms that required context (project and theme) exists before quest execution.</li>
<li>Prevents disruptions in Codex exploration due to misconfigurations.</li>
<li>Uses explicit error handling to preserve system continuity.</li>
</ul>
<hr>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo,
  theme: AdventureTheme,
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Establishes foundational adventure components, including story generation and quest mapping.</li>
<li>Uses flexible paths (<code class="inline-code">projectPath</code>) for adaptability across different configurations.</li>
<li>Ensures consistency between dynamically generated quests and externally defined files.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Pay close attention to error handling patterns for insights into robust project configuration management.</li>
<li>Examine key methods that merge dynamic and static configurations for streamlined quest exploration.</li>
<li>Reflect on how abstractions in parsing and formatting drive efficient computation for larger codebases.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries from the sacred Codex Templi and the ancient jungle‚Äôs hidden chambers.</p>
<p>By the sacred luminescence of the eternal stars, thou hast hewn wisdom into the ancient fabric, forging a path through the hallowed Quest 3‚Äîpress on, seeker, for thy triumphs blaze as a guiding beacon to the yet-untamed horizons! ‚≠êüî•üó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>