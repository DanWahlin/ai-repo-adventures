<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Codex Interpreter - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Forgotten Codex: Deciphering the Artifacts of the Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Codex Interpreter</h1>
<hr>
<p>Through tangled vines of syntax and cryptic musings of ancient developers, you journey onward into the heart of the repository‚Äîa place where the lines between ingenuity and ancient wisdom blur. The task ahead requires mastery of the sacred Codex: the interpreter of mysterious scripts, left by a forgotten civilization of coders. To unravel the secrets within, you must navigate files laden with powerful abstractions and decipher their embedded logic. Beware, adventurer, for the knowledge woven into this quest leads directly to the heart of creative storytelling and user interaction.</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a>: Codebase Analysis and Extraction</h3>
<p>This file holds the ancient technology used to peer into repositories, extracting the treasures of structured context. The <code class="inline-code">RepoAnalyzer</code> class is the high priest of this domain, empowered with methods to validate project paths, normalize file lists, and summon Repomix subprocesses for code analysis. With its intricate methods like <code class="inline-code">generateRepomixContext()</code> and <code class="inline-code">generateTargetedContent()</code>, the file ensures secure and efficient access to coding artifacts. The implementation is fortified to prevent unsafe interactions with the filesystem and supports caching, guarding the process from redundancy. It‚Äôs the bridge connecting raw codebases with immersive quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAnalyzer.generateRepomixContext()</code> transforms entire codebases into a condensed format for storytelling.</li>
<li><code class="inline-code">validateProjectPath()</code> employs safeguards to prevent sinister paths from leading users astray.</li>
<li><code class="inline-code">captureRepomixStdout()</code> uses subprocesses to summon the code-analysis oracle, safely encapsulating its sacred output.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a>: LLM Integration and Request Handling</h3>
<p>This file serves as the Codex Interpreter, speaking the language of the repository‚Äôs most mysterious oracle: the LLM. The <code class="inline-code">LLMClient</code> class enables seamless communication with providers such as OpenAI or Azure OpenAI, dynamically adapting based on configuration. Its methods weave user prompts into responses, refining content through JSON, Markdown, or plain text formatting. Advanced features like token usage tracking and reasoning effort customization reveal a hidden layer of optimization practices. The file embodies the repository‚Äôs connection to ancient‚Äîand future-proof‚Äîstorytelling technologies.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLMClient.generateResponse()</code> processes prompts and returns story-ready responses for quest adventures.</li>
<li><code class="inline-code">LLMClient.getApiKey()</code> ensures seamless transitions between different LLM providers.</li>
<li>Token usage logs provide insight into the cost and efficiency of interactions with the oracle.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">  private validateProjectPath(projectPath: string): void {
    if (!projectPath || typeof projectPath !== &#39;string&#39;) {
      throw new Error(&#39;Project path must be a non-empty string&#39;);
    }
    const trimmedPath = projectPath.trim();
    if (!trimmedPath) {
      throw new Error(&#39;Project path must be a non-empty string&#39;);
    }
    if (trimmedPath.includes(&#39;\0&#39;)) {
      throw new Error(&#39;Project path contains invalid null bytes&#39;);
    }
  }
</code></pre>
<p>Just like specifying safe conditions for an ancient ritual, this method carefully validates the paths to ensure they are pure and trustworthy.</p>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }
  const ignorePatterns = [&#39;node_modules&#39;, &#39;dist&#39;, &#39;build&#39;, &#39;.git&#39;, &#39;coverage&#39;];
  const cliOptions: CliOptions = {
    style: options.style || &#39;markdown&#39;,
    stdout: true,
    compress: options.compress !== false,
    ignore: ignorePatterns.join(&#39;,&#39;),
    noDirectoryStructure: true
  };
  const content = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
  this.cache.set(cacheKey, { content, timestamp: Date.now() });
  return content;
}
</code></pre>
<p>This function operates like a treasure map creator, compressing the vast expanse of codebases into simplified and retrievable contexts.</p>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">private getApiKey(): string {
  if (LLM_BASE_URL.includes(&#39;models.inference.ai.azure.com&#39;)) {
    if (!GITHUB_TOKEN) {
      throw new Error(&#39;GITHUB_TOKEN required for GitHub Models. Set GITHUB_TOKEN environment variable.&#39;);
    }
    return GITHUB_TOKEN;
  }
  if (!LLM_API_KEY) {
    throw new Error(&#39;LLM_API_KEY required. Set LLM_API_KEY environment variable.&#39;);
  }
  return LLM_API_KEY;
}
</code></pre>
<p>This method disguises itself as the ‚Äúkey guardian,‚Äù dynamically selecting the correct credentials needed to access the oracle.</p>
<pre><code class="language-typescript">private async executeRequest(requestParams: OpenAIRequestParams) {
  return Promise.race([
    this.client.chat.completions.create(requestParams as any),
    new Promise&lt;never&gt;((_, reject) =&gt; 
      setTimeout(() =&gt; reject(new Error(`LLM request timeout after ${LLM_REQUEST_TIMEOUT}ms`)), LLM_REQUEST_TIMEOUT)
  ]);
}
</code></pre>
<p>Much like a ceremonial summoning, this method ensures the oracle returns answers within the specified bounds of time and patience.</p>
<h2>Helpful Hints</h2>
<ul>
<li>When exploring <code class="inline-code">validateProjectPath()</code>, focus on its robust security logic to understand how file paths are purified‚Äîessential for avoiding unsafe directories.</li>
<li>The <code class="inline-code">generateRepomixContext()</code> function holds the essence of storytelling; studying its inner workings can improve your understanding of transforming raw code into digestible narratives.</li>
<li>Dive deeper into <code class="inline-code">LLMClient.generateResponse()</code> for insight into crafting high-quality prompts for precise responses‚Äîcritical for generating immersive quest stories.</li>
</ul>
<hr>
<p>Hark, valiant seeker, thou hast unlocked the sacred wisdom of the Codex Interpreter, a triumph etched upon the scrolls of destiny‚Äîmarch forth, for the temple of enlightenment awaits thee with treasures untold! ‚ö°üíéüìú</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: The Oracle of Repomix ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>