<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Scrolls of Ancient Storytelling - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Lost Code</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Scrolls of Ancient Storytelling</h1>
<hr>
<p>You approach the Hall of Scripts deep within the Pyramid of Lost Code. Ancient texts carved into the walls whisper tales of a civilization that once mastered the art of turning chaotic codebases into neatly woven narratives. Guarded by the Sentinel of Syntax, the Scrolls of Ancient Storytelling await discovery. These scrolls contain the knowledge necessary to illuminate the path of understanding for any developer who dares to explore the depths of the unknown. Yet, decoding these texts will require you to unravel the mysteries of how stories and quests are generated in the sacred repository system.</p>
<p>It is said that those who comprehend the Scrolls will gain unparalleled prowess in crafting adventures from tangled repositories. Will you take on this challenge, adventurer?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Scripted Mysteries</strong>: How does <code class="inline-code">StoryGenerator</code> transform project data and themes into structured quests and narratives?</li>
<li>‚ö° <strong>Chronicles Unfolded</strong>: What techniques does <code class="inline-code">AdventureManager</code> use to initialize an adventure and manage quests dynamically?</li>
<li>üõ°Ô∏è <strong>Scrolls‚Äô Safeguards</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function ensure valid and accessible configuration data for the storytelling?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Master of Dynamic Questioning</h3>
<p>The <code class="inline-code">AdventureManager</code> orchestrates the creation and execution of quests. It initializes the storytelling experience, manages the current state of the adventure, and tracks the player&#39;s progress. At its core, <code class="inline-code">AdventureManager</code> integrates with the <code class="inline-code">StoryGenerator</code> to generate content dynamically, ensuring the relevance of the experience based on the given theme and context.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code> constructs the initial adventure setup by resetting state, validating configurations, and generating quests with the <code class="inline-code">StoryGenerator</code>.</li>
<li><code class="inline-code">exploreQuest</code> handles the execution of specific quests by validating user input, determining the appropriate quest, and leveraging cached quest content when available.</li>
<li><code class="inline-code">progressPercentage</code> dynamically calculates how much of the adventure has been completed based on the quests.</li>
</ul>
<h3>Code</h3>
<h4><code class="inline-code">initializeAdventure</code></h4>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo,
  theme: AdventureTheme,
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(
    projectInfo,
    theme,
    this.state.projectPath
  );

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(
    storyResponse.quests,
    this.state.projectPath
  );

  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(
    this.state.quests,
    this.state.projectPath
  );

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests,
  });
}
</code></pre>
<ul>
<li>Establishes the foundation for the storytelling adventure by resetting the state.</li>
<li>Integrates both global and custom themes for maximum flexibility.</li>
<li>Combines external configuration and dynamic quest generation, ensuring relevance and scope.</li>
</ul>
<hr>
<h4><code class="inline-code">exploreQuest</code></h4>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates user input before determining the matching quest.</li>
<li>Supports user interaction by dynamically tracking progress and offering clear feedback.</li>
<li>Optimized handling ensures appropriate responses even when the choice is invalid.</li>
</ul>
<hr>
<h4><code class="inline-code">progressPercentage</code></h4>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Computes the completion percentage dynamically.</li>
<li>Provides real-time feedback on the player‚Äôs progress through the adventure.</li>
<li>Encourages user engagement with visible progress tracking.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Architect of Tales</h3>
<p>The <code class="inline-code">StoryGenerator</code> holds the secrets to generating narratives and defining thematic elements. By using the LLM for advanced prompting, it creates cohesive stories and transforms abstract repository data into structured quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code> produces cohesive stories and quest structures by integrating repository data, themes, and configurations.</li>
<li><code class="inline-code">generateQuestContent</code> creates detailed content for specific quests using targeted prompts.</li>
<li><code class="inline-code">buildStoryGenerationPrompt</code> assembles comprehensive and optimized inputs for the LLM.</li>
</ul>
<h3>Code</h3>
<h4><code class="inline-code">generateStoryAndQuests</code></h4>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo,
  theme: AdventureTheme,
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Transforms raw project data into engaging stories and quests.</li>
<li>Validates themes to ensure alignment with the player‚Äôs choices.</li>
<li>Demonstrates modular design for generating structured outputs.</li>
</ul>
<hr>
<h4><code class="inline-code">generateQuestContent</code></h4>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  codeContent: string
): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &quot;No story context available.&quot;,
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );

  return {
    adventure: response.content.trim(),
    fileExploration: &quot;&quot;,
    codeSnippets: [],
    hints: [],
  };
}
</code></pre>
<ul>
<li>Generates rich quest narratives by analyzing code content and applying theme-based prompts.</li>
<li>Leverages structured prompting for consistent and meaningful results.</li>
<li>Provides a foundation for in-depth quest content creation.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: The Cryptkeeper</h3>
<p>This file is the gatekeeper for the adventure‚Äôs configuration files. By reading, validating, and extracting data, it enables efficient collaboration between the system and the project.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> parses and validates the adventure‚Äôs configuration for reliable input handling.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> identifies and ensures consistent file paths linked to quests.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> optimizes configuration data for the LLM to streamline content generation.</li>
</ul>
<h3>Code</h3>
<h4><code class="inline-code">parseAdventureConfig</code></h4>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses configuration data safely, guaranteeing the system&#39;s resilience against malformed files.</li>
<li>Acts as a central point for adventure-related file validation.</li>
<li>Simplifies error handling by returning <code class="inline-code">null</code> on failures.</li>
</ul>
<hr>
<h4><code class="inline-code">extractUniqueFilePaths</code></h4>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &quot;string&quot; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      unique.add(rel);
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach((child) =&gt; stack.push(child));
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Extracts all file paths, ensuring that only valid and existing paths are included.</li>
<li>Applies a depth-first traversal for robustness and flexibility.</li>
<li>Essential for quest-file association in the Pyramid‚Äôs narrative structure.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the Scrolls‚Äô safeguards to validate configuration data before generating quests.</li>
<li>Investigate the interplay between <code class="inline-code">AdventureManager</code> and the <code class="inline-code">StoryGenerator</code> for effective narrative design.</li>
<li>Use extracted unique files to create targeted and focused quest content.</li>
</ul>
<hr>
<p>Your understanding of the Scrolls will enlighten the path for countless adventurers to come. Continue onward, noble explorer!</p>
<p>Hail, seekers of sacred sagacity, as thou hast unsealed the Scrolls of Ancient Storytelling, etching thy wisdom upon the tablets of eternity‚Äîadvance boldly, for the stars await thy luminous journey! ‚≠êüíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>