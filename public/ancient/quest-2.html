<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Engine of Stories - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Secrets of the Codebound Temple</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Engine of Stories</h1>
<hr>
<p>Deep within the labyrinthine passages of the Codebound Temple, you stumble upon an ancient control panel etched with an intricate script. Its legends whisper of the &quot;Engine of Stories,&quot; a mechanism capable of weaving great narratives from the lifeblood of repositories. However, the system lies dormant, its glyphs dim. To awaken its power, you must delve into the arcane constructs of code and decipher the mechanisms that birth tales. Your challenge: repair the narrative engine and unravel its procedural magic.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Activation Mechanisms</strong>: What sequence of operations initializes and executes the narrative generation process?  </li>
<li>‚ö° <strong>Quest Fusion</strong>: How are files specified in the adventure configuration merged into generated quests?  </li>
<li>üõ°Ô∏è <strong>Error Rituals</strong>: How does the system handle missing or corrupted adventure configurations?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Managing the adventure&#39;s lifecycle</h3>
<p>This file houses the <code class="inline-code">AdventureManager</code> class, the heart of the adventure system. It manages initialization, quest selection, and execution workflows. The code reveals how the system orchestrates narrative responses, merges configuration files, and caches quests for efficiency. Additionally, <code class="inline-code">AdventureState</code> is pivotal, maintaining the mutable state during an adventure&#39;s lifecycle.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Orchestrates the initialization of the adventure, including theme configuration, project context, and quest generation.  </li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Integrates external file references from the adventure configuration with generated quest structures.  </li>
<li><code class="inline-code">exploreQuest</code>: Manages user interactions to explore quests, leveraging cached content or generating new details dynamically.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(  
  projectInfo: ProjectInfo,  
  theme: AdventureTheme,  
  projectPath?: string,  
  customThemeData?: CustomThemeData  
): Promise&lt;string&gt; {  
  this.state.reset();  
  this.state.projectInfo = projectInfo;  
  this.state.currentTheme = theme;  
  this.state.projectPath = projectPath || process.cwd();  
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {  
    this.storyGenerator.setCustomTheme(customThemeData);  
  }  
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);  
  
  this.state.title = storyResponse.title;  
  this.state.story = storyResponse.story;  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);  
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);  
  
  return this.formatStoryWithQuests({  
    ...storyResponse,  
    quests: this.state.quests  
  });  
}  
</code></pre>
<ul>
<li><strong>Functionality</strong>: This process initializes all components, including state resets and theme-specific adjustments.  </li>
<li><strong>Key Patterns</strong>: Modular customization allows the dynamic switching of themes via <code class="inline-code">customThemeData</code>.  </li>
<li><strong>Flow Details</strong>: Serves as the entry point for adventure activation.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {  
  if (!projectPath) return quests;  
  
  const config = parseAdventureConfig(projectPath);  
  if (!config || typeof config !== &#39;object&#39;) return quests;  
  
  const adventure = (config as any).adventure;  
  if (!adventure || !Array.isArray(adventure.quests)) return quests;  
  
  const configQuestFiles = new Map&lt;string, string[]&gt;();  
  for (const configQuest of adventure.quests) {  
    if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {  
      const filePaths = configQuest.files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);  
      if (filePaths.length &gt; 0) {  
        configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);  
      }  
    }  
  }  
  
  return quests.map((quest, index) =&gt; {  
    const configQuests = adventure.quests;  
    if (index &lt; configQuests.length &amp;&amp; configQuests[index].files) {  
      const files = configQuests[index].files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);  
      if (files.length &gt; 0) {  
        return { ...quest, codeFiles: files };  
      }  
    }  
    const questTitleLower = quest.title.toLowerCase();  
    for (const [configTitle, files] of configQuestFiles.entries()) {  
      if (questTitleLower.includes(configTitle) || configTitle.includes(questTitleLower)) {  
        return { ...quest, codeFiles: files };  
      }  
    }  
    return quest;  
  });  
}  
</code></pre>
<ul>
<li><strong>Integration Mechanism</strong>: Aligns dynamically generated quests with structured file paths from the adventure configuration.  </li>
<li><strong>Context Use</strong>: Leverages <code class="inline-code">projectPath</code> to locate relevant configurations.  </li>
<li><strong>Pattern Focus</strong>: Uses a fallback heuristic for title-based matching if other patterns fail.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {  
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);  

  if (this.isProgressRequest(sanitizedChoice)) {  
    return this.getProgress();  
  }  

  const quest = this.findQuest(sanitizedChoice);  
  if (!quest) {  
    return this.createNotFoundResult();  
  }  

  return await this.executeQuest(quest);  
}  
</code></pre>
<ul>
<li><strong>Interactivity</strong>: Controls user navigation through valid quest paths.  </li>
<li><strong>Error Handling</strong>: Redirects progress-based requests and offers feedback for unfound titles.  </li>
<li><strong>Process Detailing</strong>: Combines validation, searching, and execution in a single method.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Practical Tip</strong>: Look for where the <code class="inline-code">adventure.config.json</code> integrates with management workflows.  </li>
<li><strong>Exploration Recommendation</strong>: Focus on functions like <code class="inline-code">mergeQuestFilesFromConfig</code> to understand external data import processes.  </li>
<li><strong>Next Steps</strong>: Investigate formatting patterns in <code class="inline-code">story-generator</code> for creating engaging narrative templates.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Through sacred perseverance, thou hast unlocked the hallowed Engine of Stories, forging paths of wisdom anew‚Äîmay the stars bear witness to thy triumphant stride! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>