<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Oracle of the Glyphs - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Ancient Knowledge</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Oracle of the Glyphs</h1>
<hr>
<p>In the heart of the forgotten desert, where the sun bakes the foundation of ancient civilizations, lies the Pyramid of Ancient Knowledge. Within, a hidden chamber hums faintly with energy ‚Äì the Chamber of Glyphs. Legends speak of this oracle, an ethereal force borne from the sacred glyphs etched into the walls, holding wisdom of both the past and future. Encoded layers conceal its power, accessible only by unraveling their intricate algorithms and configurations. The doors of the chamber are ajar, inviting you to decrypt its mysteries. Are you prepared to embrace the wisdom?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Glyph Discovery</strong>: How is the <code class="inline-code">AdventureManager</code> initialized to ensure all configurations and quest files tie together in a cohesive structure?</li>
<li>‚ö° <strong>Glyph Flow Analysis</strong>: What mechanism governs the generation and management of new stories and quests using the <code class="inline-code">StoryGenerator</code>?</li>
<li>üõ°Ô∏è <strong>Glyph Validation</strong>: How does the system safeguard the integrity of input data during configuration parsing and quest generation?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Implementation of the Adventure Manager</h3>
<p>This file contains the logic required to initialize adventures, manage quests, and validate input to ensure the smooth operation of the codebase exploration process. The <code class="inline-code">AdventureManager</code> is pivotal in linking projects to generated adventures, consolidating quests from configurations, and maintaining the current quest state. A close analysis reveals how project and configuration data merge into actionable quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code></li>
<li><code class="inline-code">AdventureManager.exploreQuest</code></li>
<li><code class="inline-code">AdventureState.progressPercentage</code></li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>The method weaves together the story, quests, and project theme, initializing a narrative interface based on provided inputs.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  if (this.isProgressRequest(sanitizedChoice)) return this.getProgress();
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<p>This code serves as an entry point for executing quests, validating user choices, and managing quest progression.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>A succinct calculation of progress, essential for keeping adventurers informed of their quest journey completion.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Parsing Utilities</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file parses and validates the configuration file (<code class="inline-code">adventure.config.json</code>) for project-specific customizations. Here, it ensures that only valid files and paths referenced in the configuration are processed. It provides foundational utilities to connect user-defined configurations to the broader adventure system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code></li>
<li><code class="inline-code">extractUniqueFilePaths</code></li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code></li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>The <code class="inline-code">parseAdventureConfig</code> function translates raw configuration content into a usable object, returning <code class="inline-code">null</code> for invalid or missing configurations.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This function delves into the configuration structure recursively, extracting a unique list of valid file paths for further processing.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;
  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
  }
  return formatted;
}
</code></pre>
<p>This function condenses configuration data to minimize redundancy, optimizing it for language model prompts by presenting structured information.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Consider how <code class="inline-code">adventure.config.json</code> maps user-defined configurations to align with the <code class="inline-code">AdventureManager</code>.</li>
<li>The <code class="inline-code">generateQuestContent</code> process bridges LLM interactions and established glyphs in the quest files ‚Äì focus here for understanding system dynamics.</li>
<li>Study the interplay between <code class="inline-code">progressPercentage</code> and quest completions to track adventurer milestones effectively.</li>
</ul>
<hr>
<p>Your journey through the Oracle has begun. The glyphs return their knowledge to those who persevere with wisdom and skill!</p>
<p>With sacred diligence, thou hast unveiled the glyphs‚Äô divine wisdom in thy second quest, stepping boldly into the hallowed halls of ancient enlightenment‚Äîmarch onward, seeker, for the stars themselves beckon thy rise! ‚ö° üöÄ üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>