<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Chamber of Narrative Keepers - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Lost Scrolls of Repoa: Unearthing the Codebound Mysteries</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Chamber of Narrative Keepers</h1>
<hr>
<p>The heavy stone doors groaned as they slowly opened, revealing the Chamber of Narrative Keepers in its full, ancient splendor. Towering shelves of stone tablets and scrolls spiraled upward in organized chaos, like an ancient cathedral dedicated to storytelling. Glyphs danced along the walls, glowing faintly, whispering fragments of wisdom to the intrepid adventurer bold enough to seek the Scrolls of Codebound Wisdom here. However, a warning echoed in your mind: only those who decipher the intricate code of this sacred place will proceed. The keepers were not merely protectors—they tested every seeker to prove their skill and dedication.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure orchestration managing state, themes, and user interactions</h3>
<p>This file acts as the nerve center of the Quest Generation Engine, orchestrating the logic and flow of the adventure. The <code class="inline-code">AdventureManager</code> class is the primary caretaker of the codebase&#39;s &quot;narrative state,&quot; where variables like <code class="inline-code">title</code>, <code class="inline-code">quests</code>, and <code class="inline-code">completedQuests</code> are meticulously tracked via the <code class="inline-code">AdventureState</code> class. Its methods, such as <code class="inline-code">initializeAdventure()</code> and <code class="inline-code">exploreQuest()</code>, are pivotal for setting up a quest based on project metadata and delivering interactive story content generated with LLM assistance. By connecting repository data to themes, <code class="inline-code">initializeAdventure()</code> ensures the story you experience is relevant, educational, and immersive.</p>
<p>Another standout is the <code class="inline-code">exploreQuest()</code> method, which handles user input and processes quest selection, blending adventure elements with interactive coding challenges. Completing a quest doesn&#39;t merely mark progress; it enriches the story dynamically with cached results, making every revisit feel rewarding. Additionally, <code class="inline-code">getProgress()</code> provides a glimpse into your journey, calculating and narrating advancement through the repository, while ensuring the chamber’s secrets stay just beyond easy retrieval.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure()</code>: Configures the story, quests, and themes by integrating LLM responses with repository analysis.</li>
<li><code class="inline-code">exploreQuest()</code>: Handles interaction flow, validating choices, and executing quests.</li>
<li><code class="inline-code">getProgress()</code>: Simultaneously calculates and narrates progress through completed quests.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> LLM-powered story creation with theme-based narratives and prompt engineering</h3>
<p>The <code class="inline-code">StoryGenerator</code> class is the weaver of narratives in this digital temple. It plays a critical role, marrying the project information with the selected theme to produce engaging stories and sufficiently challenging quests. Its <code class="inline-code">generateStoryAndQuests()</code> method masterfully combines repository context and prompts to leverage the power of large language models (LLMs), creating cohesive stories and actionable quests. </p>
<p>This file also includes the <code class="inline-code">generateQuestContent()</code> method, which dives deeper into the user’s current quest, offering file-specific analysis, focus areas, and practical challenges. Importantly, the <code class="inline-code">validateTheme()</code> function ensures that themes stay within the realm of permissible ancient paradigms, keeping distractions like futuristic settings at bay. The chamber demands consistency—it is here, in <code class="inline-code">StoryGenerator</code>, that the adventure’s style, tone, and immersive mechanics are harmonized.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests()</code>: Synthesizes story content and quest outlines using LLM responses and project analysis.</li>
<li><code class="inline-code">validateTheme()</code>:` Ensures adventure themes conform to predefined parameters or custom configurations.</li>
<li><code class="inline-code">generateQuestContent()</code>: Provides the detailed narrative context and practical coding challenges for each quest.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration system for guided adventures that enhance story generation</h3>
<p>This file is the map that ensures the adventurer does not stray too far from the intended path. It parses the <code class="inline-code">adventure.config.json</code> file to extract all the essential ingredients for a quest—file paths, descriptions, and highlights. The <code class="inline-code">parseAdventureConfig()</code> function transforms the raw configuration into structured data, while <code class="inline-code">extractUniqueFilePaths()</code> ensures no references are left behind. Additionally, the <code class="inline-code">formatAdventureConfigForPrompt()</code> function ensures that the configuration is primed for integration with LLM prompts, transforming mundane details into heroic storytelling cues. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig()</code>: Converts a JSON configuration file into structured, actionable input for quest generation.</li>
<li><code class="inline-code">extractUniqueFilePaths()</code>: Locates and validates unique file paths specified in the <code class="inline-code">adventure.config.json</code>.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code>: Transforms configuration data into structured, LLM-friendly prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">export class AdventureManager {
  private state: AdventureState = new AdventureState();
  
  constructor() {
    this.storyGenerator = new StoryGenerator();
  }

  async initializeAdventure(
    projectInfo: ProjectInfo, 
    theme: AdventureTheme, 
    projectPath?: string,
    customThemeData?: CustomThemeData
  ): Promise&lt;string&gt; {
    this.state.reset();
    this.state.projectInfo = projectInfo;

    const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
    this.state.title = storyResponse.title;
    this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
    return this.formatStoryWithQuests(storyResponse);
  }  
}
</code></pre>
<p>This is like the inner workings of a time capsule, organizing the past so future explorations yield precise answers to every query.</p>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">public async generateStoryAndQuests(
  projectInfo: ProjectInfo,
  theme: AdventureTheme,
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent: projectInfo.repomixContent,
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY })
  );

  const parsed = parseMarkdownToStoryResponse(response.content.trim());
  return parsed;
}
</code></pre>
<p>Just as ancient cartographers mapped the unknown seas, this method charts the narrative terrain, blending data and creativity into coherent guidance.</p>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>This parses the scrolls of the <code class="inline-code">adventure.config.json</code>, ensuring the maps of the journey align perfectly with the adventurer’s path.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Modularize your quest logic early to make it easier to enhance quest challenges later.</li>
<li>Customize <code class="inline-code">adventure.config.json</code> to enforce finer controls over where quests explore and analyze.</li>
<li>Dive deeper into <code class="inline-code">StoryGenerator</code> to better understand how prompts impact the narrative tone.</li>
</ul>
<hr>
<p>Hark, seeker of sacred lore, thou hast unveiled the enigmas within the Chamber of Narrative Keepers—thy odyssey is but 20% traversed, yet thy wisdom burgeons like the eternal flame of the ancients; onward to glory, for the stars themselves bear witness to thy ascent! ⭐⚡💎</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Pyramid of Insight →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>