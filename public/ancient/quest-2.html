<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Pyramid of Quests - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Lost Codex of the Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <p>Here’s the continuation of the ancient-themed narrative journey for Quest 2:</p>
<hr>
<h1>Quest 2: The Pyramid of Quests</h1>
<hr>
<p>Enveloped by the scorching sands of the desert, you venture deeper into the enigmatic Pyramid of Quests. The air grows heavy with the scent of ancient scrolls and secrets buried for centuries. The glyphs on the pyramid’s walls pulse faintly, much like the heartbeat of an ancient beast guarding its treasure. These glyphs hint at the “Architects of Code,” a civilization that intertwined technology with sacred rituals. The Repository’s wisdom lies within, safeguarded by intricate mechanisms and riddles that only the persistent can decipher. With the desert sun waning, you prepare to engage with the pyramid’s trials, where solving challenges illuminates ancient truths about code and structure.</p>
<hr>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure orchestration and quest management</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file serves as the command center, overseeing every aspect of the adventure. Acting as the bridge between the adventurer and the Repository&#39;s secrets, this file orchestrates the flow of quests, stories, and progress tracking. The <code class="inline-code">AdventureManager</code> class houses methods like <code class="inline-code">initializeAdventure()</code> to kick off the thematic journey by preparing the repository’s context and generating quests influenced by a chosen theme. Meanwhile, the <code class="inline-code">exploreQuest()</code> method becomes the adventurer’s guide, ensuring their choices align with the quest&#39;s sacred order. The state is meticulously tracked through the <code class="inline-code">AdventureState</code> class, complete with a progress calculation system (<code class="inline-code">progressPercentage</code>) that fosters transparency. By methodically combining repository analysis with user interaction, this file creates a seamless adventure experience. Within its intricate architecture lies the wisdom of how user-driven systems can marry narrative immersion with technical precision.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure()</code> sets up the codebase context, generates quests, and merges user-defined configurations.</li>
<li><code class="inline-code">exploreQuest()</code> validates user choices, finds the corresponding quest, and executes adventures dynamically.</li>
<li><code class="inline-code">progressPercentage</code> calculates and updates adventure completion progress to track the adventurer’s journey.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig()</code> integrates external quest file configurations into the adventure seamlessly. </li>
<li><code class="inline-code">markQuestCompleted()</code> updates quest status and ensures progress is always synchronized.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration for guided adventures</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file acts as the sacred map within the Pyramid of Quests. It extracts and processes the <code class="inline-code">adventure.config.json</code> file, a critical artifact containing the knowledge of how quests should be structured. With functions like <code class="inline-code">parseAdventureConfig()</code>, the file parses the configuration into actionable data for integration into the adventure flow. Beyond parsing, <code class="inline-code">formatAdventureConfigForPrompt()</code> ensures the configuration is formatted into a structured narrative that can influence the generated story. This file also boasts logic to extract unique file paths (<code class="inline-code">extractUniqueFilePaths</code>) from the configuration, ensuring that the Repository’s secrets remain manageable and relevant to the quest. Carefully fashioned, this file ensures that user-defined guidance shapes the journey, enabling direct collaboration between modern explorers and ancient glyphs. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig()</code> converts user input from raw JSON to an actionable, adventure-ready structure.</li>
<li><code class="inline-code">extractUniqueFilePaths()</code> scans deeply nested structures to identify significant files referenced in the adventure.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code> transforms configuration data into a higher level of abstraction tailored for LLM prompts.</li>
<li>Ensures seamless integration of user-defined adventures into broader narrative arcs.</li>
<li>Provides validation to ensure the configuration won’t break the sanctity of the Repository.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Generating thematic narratives and quests</h3>
<p>The <code class="inline-code">story-generator.ts</code> file stands as the Pyramid’s scribe, endowed with the task of generating compelling narratives and quests. The <code class="inline-code">StoryGenerator</code> class is the LLM whisperer, employing prompts crafted with ancient precision to weave themes like “ancient” into vivid tales and structured adventures. The method <code class="inline-code">generateStoryAndQuests()</code> is the genesis point, building the overarching story and quests from user-provided project data. For more detailed tasks, <code class="inline-code">generateQuestContent()</code> ensures that quests are not only engaging but also deeply rooted in the artifacts (code) they analyze. The file pulls data from the configuration (<code class="inline-code">formatAdventureConfigForPrompt()</code>) to ensure the glyphs (prompts) lead to meaningful outcomes. By guiding the adventurer with tailored quests, this file illuminates the knowledge within lines of code like stars guiding voyagers through the dark desert.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests()</code> synthesizes project data, user inputs, and themes into quests and stories.</li>
<li><code class="inline-code">generateQuestContent()</code> creates custom adventures linked to specific repository segments.</li>
<li><code class="inline-code">removeLLMMetaCommentary()</code> ensures generated narratives are free from unwanted meta commentary for immersive experiences.</li>
<li><code class="inline-code">withTimeout()</code> protects the flow from disruptions, maintaining the sacred rhythm of quest generation.</li>
<li><code class="inline-code">validateTheme()</code> ensures the chosen narrative theme aligns with predefined or custom styles.</li>
</ul>
<hr>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>This function is much like a master architect laying the foundation of an adventure temple, carefully integrating every detail into a harmonious beginning.</p>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>This function is like deciphering ancient hieroglyphs into a readable map, ensuring the explorer has a clear path forward.</p>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string): Promise&lt;StoryResponse&gt; {
  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent: projectInfo.repomixContent || &#39;No repomix content available&#39;,
    adventureGuidance: this.projectPath ? formatAdventureConfigForPrompt(this.projectPath) : &#39;&#39;
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY })
  );

  let cleanContent = response.content.trim();
  if (cleanContent.startsWith(&#39;```markdown&#39;)) {
    cleanContent = cleanContent.replace(/^```markdown\s*/, &#39;&#39;).replace(/\s*```$/, &#39;&#39;);
  }
  
  const parsed = parseMarkdownToStoryResponse(cleanContent);
  StoryResponseSchema.parse(parsed);
  this.currentStoryContent = typeof parsed.story === &#39;string&#39; ? parsed.story : parsed.story.content;
  
  return parsed;
}
</code></pre>
<p>This code acts as the Pyramid’s oracle, taking the adventurer’s theme and repository data to deliver a vision of quests and stories tailored to their journey.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Customize quests based on repository needs by defining specific files or structural guidelines in <code class="inline-code">adventure.config.json</code>.</li>
<li>Refactor repetitive LLM prompt-generation logic by centralizing shared patterns and avoiding duplication.</li>
<li>Explore how <code class="inline-code">mergeQuestFilesFromConfig()</code> seamlessly integrates user-defined configurations for extending quests.</li>
</ul>
<p>Hail, valiant seeker, for thou hast ascended the sacred Pyramid of Quests, unlocking profound wisdom and etching thy name upon the eternal tablets of triumph—continue forth, for the stars favor your journey! ⭐⚡💎</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Cavern of Reflection →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>