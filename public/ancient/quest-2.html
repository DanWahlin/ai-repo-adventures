<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Glyph of Creation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codebase of the Hidden Pyramid</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Glyph of Creation</h1>
<hr>
<p>In the unexplored depths of the Pyramid of Wisdom lies the Glyph of Creation, an artifact rumored to transcribe ideas from mere whispers of thought into structured codes carved into reality. Your mission, brave explorer, is to uncover the ancient mechanisms hidden within these codified chambers. Decipher their patterns, unveil their secrets, and reclaim the profound methodologies this civilization once used to analyze knowledge and craft eternal legends.</p>
<p>Your journey will lead you through corridors of complex adventure systems and sacred configurations, forged with meticulous precision. Choose carefully, for the Glyph demands clarity and wisdom to reveal its sacred truth.</p>
<p><strong>Adventure Awaits</strong> ‚Äì Proceed with vigilance, seeker of knowledge!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Glyph Decoder</strong>: How does <code class="inline-code">AdventureManager</code> merge quest files into configurations based on ancient rules, ensuring alignment with contextual patterns and user inputs?</li>
<li>‚ö° <strong>Ritual Structure</strong>: What techniques are used by <code class="inline-code">StoryGenerator</code> to generate the story and quests themes dynamically, balancing predefined and custom contexts?</li>
<li>üõ°Ô∏è <strong>Sacred Boundaries</strong>: What safeguards and validation mechanisms are employed by <code class="inline-code">AdventureState</code> and <code class="inline-code">AdventureConfig</code> to prevent corruption of ancient records?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> The Master Architect‚Äôs Tool</h3>
<p>This file encapsulates the logic for managing the flow of adventures, linking the civilization&#39;s overarching glyph-based narratives into individual quests. The <code class="inline-code">AdventureManager</code> oversees initialization, user input validation, and dynamic quest execution that form the backbone of your journey through its chambers.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code> initializes the narrative with project information, themes, and quests; merging sacred configurations with generated quests.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code> integrates quest-related files from external configurations into dynamically generated adventures.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code> ensures sacred input from adventurers adheres to ancient validation standards, purifying erroneous entries.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Configuration Glyph</h3>
<p>This file acts as the keystone for loading and parsing adventure-specific configurations. Its runes guide the extraction of file paths and the formatting of content for streamlined exploration. The adventurers rely on its methods to align their journey with the Pyramid&#39;s ancient wisdom.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> decodes the adventure config files into structured entities, supporting dynamic alignment with contextual quests.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> searches for and validates file paths hidden within nested structures, ensuring their sacred legitimacy.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> condenses configuration data into optimized input for further processing, leveraging context without redundancy.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Resets <code class="inline-code">AdventureState</code> to prepare for a new glyph configuration, clearing residual data.</li>
<li>Dynamically merges generated quests with sacred configurations, ensuring alignment between ancient logic and current user contexts.</li>
<li>Enforces constraints like quest count, based on external and predefined glyph rules.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;
  
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;
  
  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;
  
  return quests.map((quest, index) =&gt; {
    if (index &lt; adventure.quests.length &amp;&amp; adventure.quests[index].files) {
      const files = adventure.quests[index].files
        .filter((f: any) =&gt; f.path)
        .map((f: any) =&gt; f.path);
      if (files.length &gt; 0) {
        return { ...quest, codeFiles: files };
      }
    }
    return quest;
  });
}
</code></pre>
<ul>
<li>Adds external file paths from sacred configurations to dynamically generated quests.</li>
<li>Utilizes fallback mechanisms to avoid corruptions stemming from mismatched nodes or invalid configurations.</li>
<li>Ensures the journey&#39;s contexts align with the structural needs of adventuring.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateAndSanitizeChoice(input: string): string {
  try {
    return validateAdventureChoice(input);
  } catch (error) {
    throw new Error(`Invalid adventure choice: ${error instanceof Error ? error.message : &#39;Unknown error&#39;}`);
  }
}
</code></pre>
<ul>
<li>Validates user input with safeguards against corruption or errors, preserving thematic glyph consistency.</li>
<li>Purifies inputs to ensure the structural integrity of chosen quests.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Decodes <code class="inline-code">adventure.config.json</code> files into useable objects, providing foundational glyph configuration data.</li>
<li>Includes safety mechanisms to handle invalid or unreadable glyphs without disrupting flow.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses nested nodes to uncover hidden paths referenced in configuration data, ensuring their authenticity.</li>
<li>Integrates validated sacred paths into the overall glyph exploration journey.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Streamlines configuration content for efficient interfacing with dynamic systems during exploration.</li>
<li>Focuses on code files and quest titles without redundant verbosity.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Focus your investigation on how external configurations blend dynamically with generated quests and themes.</li>
<li>Notice the emphasis placed on validation and error handling, ensuring glyph integrity.</li>
<li>Observe how ancient structures like JSON configurations are optimized for seamless transformations.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Lo, seeker of sacred truths, thou hast unlocked the venerable Glyph of Creation, forging thy path with might akin to the ancients‚Äîpress onward, for the celestial halls await thy triumphant ascension! ‚ö°‚≠êüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>