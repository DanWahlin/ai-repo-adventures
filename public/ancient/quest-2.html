<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Scrolls of Creation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Temple of Code: Unraveling the Lost Algorithms</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Scrolls of Creation</h1>
<hr>
<p>Through a partially uncovered corridor deep within the decayed ruins of the Temple of Code, you stumble upon a chamber lined with shelves of ancient scrolls etched in symbols that glow faintly in the dim light. These are the Scrolls of Creation, said to hold the fundamental patterns of generating adventures and inspiring quests. Only by deciphering the code etched here can you unravel the secrets behind the engine of these ancient adventures.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these sacred questions:</p>
<ul>
<li>üîç <strong>The Engine&#39;s Awakening</strong>: How is the quest generation initialized, and what essential parameters guide its operation?</li>
<li>‚ö° <strong>The Narrative Weaver</strong>: How does the system dynamically generate stories and quests, ensuring the quests align with the selected themes?</li>
<li>üõ°Ô∏è <strong>Sanctity of Configurations</strong>: What mechanisms are employed to validate, parse, and enforce configuration-based guidance for the generated adventures?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: The Heart of Adventure Management</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file orchestrates the creation, exploration, and execution of quests. It acts as the central hub for state management and integrates ancillary components such as the story generator and configuration parser. By resetting the state, initializing adventures, enforcing configurations, and calculating progress, it ensures that every adventurer‚Äôs journey aligns with the ancient rituals embedded in its design.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Initializes the adventure with the provided project context, theme, and optional customization, resetting all necessary state and generating a cohesive story with quests.</li>
<li><code class="inline-code">exploreQuest</code>: Validates the adventurer&#39;s choice, identifies the selected quest, and executes it while caching results for later revisitation.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Incorporates configuration-specified files into the automatically generated quests for alignment with the <code class="inline-code">adventure.config.json</code>.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
    projectInfo: ProjectInfo, 
    theme: AdventureTheme, 
    projectPath?: string,
    customThemeData?: CustomThemeData
  ): Promise&lt;string&gt; {
    // Reset state for new adventure
    this.state.reset();
    this.state.projectInfo = projectInfo;
    this.state.currentTheme = theme;
    this.state.projectPath = projectPath || process.cwd();
    
    // Set custom theme data if provided
    if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
      this.storyGenerator.setCustomTheme(customThemeData);
    }

    // Generate the overall story and quests using LLM
    const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
    
    this.state.title = storyResponse.title;
    this.state.story = storyResponse.story;
    
    // Merge files from adventure config into the generated quests
    this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
    
    // Enforce quest count from adventure.config.json if it exists
    this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

    // Return the story with available quests
    return this.formatStoryWithQuests({
      ...storyResponse,
      quests: this.state.quests
    });
  }
</code></pre>
<ul>
<li>This function initializes the adventure by resetting the state and aligning it with the selected theme. </li>
<li>Custom themes are supported using the <code class="inline-code">setCustomTheme</code> function.</li>
<li>It integrates quests merged from both dynamically generated and configuration-specified files.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
    const sanitizedChoice = this.validateAndSanitizeChoice(choice);
    
    // Check if this is a progress request
    if (this.isProgressRequest(sanitizedChoice)) {
      return this.getProgress();
    }
    
    // Find the quest based on the choice
    const quest = this.findQuest(sanitizedChoice);
    if (!quest) {
      return this.createNotFoundResult();
    }

    // Execute the quest
    return await this.executeQuest(quest);
  }
</code></pre>
<ul>
<li>This function facilitates the exploration of quests.</li>
<li>It dynamically validates user input, matches the choice with a quest based on its ID or title, and executes it.</li>
<li>Results of completed quests are cached for efficient retrieval during revisit.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
    if (!projectPath) return quests;
    
    const config = parseAdventureConfig(projectPath);
    if (!config || typeof config !== &#39;object&#39;) return quests;
    
    const adventure = (config as any).adventure;
    if (!adventure || !Array.isArray(adventure.quests)) return quests;
    
    // Create a map of quest titles to their file paths from the config
    const configQuestFiles = new Map&lt;string, string[]&gt;();
    for (const configQuest of adventure.quests) {
      if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {
        const filePaths = configQuest.files
          .filter((f: any) =&gt; f.path)
          .map((f: any) =&gt; f.path);
        if (filePaths.length &gt; 0) {
          configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);
        }
      }
    }
    
    // Merge the files into the generated quests
    return quests.map((quest, index) =&gt; {
      // Primary matching: by quest order (index)
      const configQuests = adventure.quests;
      if (index &lt; configQuests.length &amp;&amp; configQuests[index] &amp;&amp; configQuests[index].files) {
        const files = configQuests[index].files
          .filter((f: any) =&gt; f.path)
          .map((f: any) =&gt; f.path);
        if (files.length &gt; 0) {
          // Successfully matched files from config
          return { ...quest, codeFiles: files };
        }
      }
      
      // Fallback: try to match quest by title (case-insensitive partial match)
      const questTitleLower = quest.title.toLowerCase();
      for (const [configTitle, files] of configQuestFiles.entries()) {
        if (questTitleLower.includes(configTitle) || configTitle.includes(questTitleLower)) {
          // Successfully matched files via fallback
          return { ...quest, codeFiles: files };
        }
      }
      
      // No specific files found - quest will use general context
      return quest;
    });
  }
</code></pre>
<ul>
<li>This function integrates specific configuration-defined files into quests.</li>
<li>Matching is first handled by quest order, and as a fallback, by quest title.</li>
<li>Ensures that quests align with documented guidance within the Temple‚Äôs scrolls.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When initializing an adventure, ensure that all required parameters, such as <code class="inline-code">projectInfo</code> and <code class="inline-code">theme</code>, are carefully prepared.</li>
<li>Pay attention to how configuration files influence the generated quests. Investigate the <code class="inline-code">adventure.config.json</code> file for further insights.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>O brave seeker, thou hast unlocked the revered Scrolls of Creation, a beacon of ancient wisdom‚Äîstep forth with valor, for thy divine odyssey is but at its genesis! ‚ö°‚≠êüìú</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>