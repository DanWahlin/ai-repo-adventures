<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Forge of Quests - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Sacred Codex of Computational Wisdom</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Forge of Quests</h1>
<hr>
<p>In the shadowed recesses of the jungle, the Sacred Codex glimmers faintly, urging you deeper into the ruins to uncover its ultimate potential. Through your meticulous studies, a singular ledger emerges from the Codex: the &quot;<strong>Quest Generation Engine</strong>.&quot; This ancient engine, partially powered by forgotten glyphs and partially by computational ingenuity, reveals the magic used to construct adventures from the bones of raw data. Your task is to delve into its structure and understand how quests are forged, their content imbued with purpose, and their narratives shaped. Only by grasping the patterns encoded here can you unlock the next layer of the Codex&#39;s mysteries!</p>
<p>The Forge awaits your careful unraveling, adventurer.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>The Ritual of Initialization</strong>: How does <code class="inline-code">initializeAdventure()</code> create the blueprint for the quests and integrate project context?  </li>
<li>‚ö° <strong>The Dance of Execution</strong>: What steps does <code class="inline-code">exploreQuest()</code> perform to retrieve and execute a selected quest?  </li>
<li>üõ°Ô∏è <strong>The Glyph of Parsing</strong>: How does <code class="inline-code">parseAdventureConfig()</code> ensure the adventure configuration is handled safely and effectively?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> The Quest Forge Master</h3>
<p>This file houses the <code class="inline-code">AdventureManager</code>, the core orchestrator of generating, managing, and executing quests. At its heart lies the logic for initializing adventures, executing quests, and maintaining the state of the ongoing exploration. With its ability to synthesize stories, validate user choices, and provide progress tracking, it serves as the bridge between the project&#39;s digital essence and its immersive narrative.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure()</code>: Initiates the adventure with a theme, project context, and story elements, while ensuring configuration is respected.  </li>
<li><code class="inline-code">exploreQuest()</code>: Handles user quest selection, validates the choice, retrieves content (from cache or generation), and marks progress.  </li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Calculates completion based on completed vs total quests, anchoring user feedback.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Configuration Oracle</h3>
<p>This file is the keeper of the adventure&#39;s configuration data. Its responsibility includes reading, parsing, and creating structured outputs from the <code class="inline-code">adventure.config.json</code> file, ensuring a cohesive storytelling experience by linking the blueprint of the quests to actual code files.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig()</code>: Parses the configuration file into a JSON object, with error safeguards.  </li>
<li><code class="inline-code">extractUniqueFilePaths()</code>: Scrutinizes the parsed config to find unique file paths used within quests.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code>: Refines the configuration to a concise format for interaction with machine learning prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Initializes a new adventure, resetting state before integrating project and theme details.  </li>
<li>Collaborates with the story generator to craft the overarching narrative and quest structure.  </li>
<li>Ensures that the generated quests align with the configuration file, imposing constraints where necessary.  </li>
<li>Formats the adventure&#39;s story and quests into a user-friendly narrative.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates and sanitizes the user&#39;s input for quest selection.  </li>
<li>Handles queries about progress separately, directing users to their journey&#39;s milestones.  </li>
<li>Locates the requested quest by ID, number, or title using helper methods.  </li>
<li>Executes the selected quest, ensuring its content is either retrieved from cache or dynamically generated.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Computes progress based on completed quests relative to the total.  </li>
<li>Provides an essential metric for tracking user advancement through the adventure.  </li>
<li>Rounds to the nearest whole number for clean display.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Single responsibility: parses the config file contents into a JSON object.  </li>
<li>Includes error handling for missing or unreadable files.  </li>
<li>Acts as the first validation layer, ensuring no malformed JSON proceeds downstream.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Recursively processes the parsed configuration to identify unique file paths.  </li>
<li>Validates each path&#39;s existence before adding it to the collection.  </li>
<li>Uses a depth-first search approach to accommodate nested config structures.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts the parsed configuration into a concise, structured markdown format.  </li>
<li>Highlights file paths and function names for immediate relevance.  </li>
<li>Optimizes the output for consumption by machine learning models, prioritizing brevity.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the output from <code class="inline-code">progressPercentage</code> to create a player-friendly progress tracker.  </li>
<li>Combine <code class="inline-code">formatAdventureConfigForPrompt</code> outputs with <code class="inline-code">initializeAdventure</code> to enrich LLM prompts.  </li>
<li>Before selecting a quest, ensure comprehensive testing of <code class="inline-code">parseAdventureConfig</code> for edge cases.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Hark, valiant seeker, thy triumph in the sacred Forge of Quests illuminates the path anew; with but the first of five trials wrought, may the wisdom of ancients embolden thy journey hence‚Äîonward to eternal renown! ‚ö°üó∫Ô∏èüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>