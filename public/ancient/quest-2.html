<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Ancient Quest Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Sacred Repository of Wisdom</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Ancient Quest Engine</h1>
<hr>
<p>Among the eternal vines and crumbling stones of the Sacred Repository, you stumble upon a next-level marvel: the Ancient Quest Engine. This enigmatic subsystem served as the lifeblood of the repository, dynamically translating its knowledge into expeditions of mystery and exploration. The inscriptions illuminate that the system leveraged ancient algorithms to curate quests based on themes, weaving tales from the arcane wisdom stored within its data repositories.</p>
<p>The air is thick with the sense of purpose as you trace your hand across the etched glyphs. You must understand the mechanisms that breathe life into this ancient engine ‚Äì from its initialization rituals, to its intricate ability to craft quest adventures, delicately balancing logic and creativity. Let the adventure unfold!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Initialization Rituals</strong>: How does the <code class="inline-code">initializeAdventure</code> function configure the quest engine, and what elements are reset at the start of a new adventure?</li>
<li>‚ö° <strong>Dynamic Inspirations</strong>: How does the <code class="inline-code">mergeQuestFilesFromConfig</code> method integrate additional context to modify generated quests dynamically?</li>
<li>üõ°Ô∏è <strong>Completion Markings</strong>: How is the <code class="inline-code">markQuestCompleted</code> function safeguarding the consistency of quest completion status while connecting with state variables?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Class and methods for managing quest-generation workflows</h3>
<p>The <code class="inline-code">AdventureManager</code> class coordinates how quests are initialized, structured, and executed in the sacred code-adventure system. It embodies the intricate dance between logic and creativity, combining quest validation, progress tracking, and dynamic content retrieval. By delving into this file, you can uncover how modular components like <code class="inline-code">adventure.config.json</code> and targeted quest files are merged into strategic explorations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets adventure state, validates themes, and merges external configuration to dynamically create quests.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Integrates file references from external configurations into existing quest definitions, enhancing thematic storylines.</li>
<li><code class="inline-code">markQuestCompleted</code>: Handles quest completion events and ensures they are accurately reflected across the engine&#39;s internal state.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);

  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This code resets the adventure engine (<code class="inline-code">this.state.reset()</code>) ensuring a clean slate for each new quest configuration.</li>
<li>It supports custom theming by applying <code class="inline-code">setCustomTheme</code> for user-defined quest narratives.</li>
<li>Flexibly integrates further insights from <code class="inline-code">mergeQuestFilesFromConfig</code>, combining predefined elements with dynamically generated content.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;
  
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;
  
  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;
  
  const configQuestFiles = new Map&lt;string, string[]&gt;();
  for (const configQuest of adventure.quests) {
    if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {
      const filePaths = configQuest.files
        .filter((f: any) =&gt; f.path)
        .map((f: any) =&gt; f.path);
      if (filePaths.length &gt; 0) {
        configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);
      }
    }
  }
  
  return quests.map((quest, index) =&gt; {
    const configQuests = adventure.quests;
    if (index &lt; configQuests.length &amp;&amp; configQuests[index] &amp;&amp; configQuests[index].files) {
      const files = configQuests[index].files
        .filter((f: any) =&gt; f.path)
        .map((f: any) =&gt; f.path);
      if (files.length &gt; 0) {
        return { ...quest, codeFiles: files };
      }
    }
  
    const questTitleLower = quest.title.toLowerCase();
    for (const [configTitle, files] of configQuestFiles.entries()) {
      if (questTitleLower.includes(configTitle) || configTitle.includes(questTitleLower)) {
        return { ...quest, codeFiles: files };
      }
    }

    return quest;
  });
}
</code></pre>
<ul>
<li>Dynamically integrates data from external configuration files using the <code class="inline-code">adventure.config.json</code> context.</li>
<li>Ensures that quest mappings remain flexible, accommodating case-sensitive title matches or fallback scenarios.</li>
<li>Highlights modularity in how file references are dynamically assigned during the quest-processing phase.</li>
</ul>
<hr>
<pre><code class="language-typescript">private markQuestCompleted(quest: Quest): void {
  this.state.completedQuests.add(quest.id);
}
</code></pre>
<ul>
<li>This function ensures that once a quest is completed, its ID is recorded persistently within the state object (<code class="inline-code">this.state.completedQuests</code>).</li>
<li>Maintains an accurate, up-to-date record of user progress, directly impacting the engine&#39;s ability to calculate overall completion percentages.</li>
<li>Provides a simple, atomic operation for marking tasks completed, reducing errors in distributed logic.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Begin your exploration with the <code class="inline-code">initializeAdventure</code> method to understand the foundational setup for every quest.</li>
<li>Pay special attention to how <code class="inline-code">mergeQuestFilesFromConfig</code> dynamically enhances quests ‚Äì it&#39;s pivotal to the repository&#39;s adaptability.</li>
<li>Notice how <code class="inline-code">markQuestCompleted</code> operates as a lightweight function, focused on progress integrity.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Hark, noble seeker, thou hast ascended the steps of Quest 2, unlocking the Ancient Quest Engine&#39;s sacred wisdom‚Äîlo, thy journey shines as a beacon upon the celestial temple of progress, 20% forged towards destiny! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>