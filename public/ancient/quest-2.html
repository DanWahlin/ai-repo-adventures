<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Sacred Scroll of Narratives - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Code: An Archaeological Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <p>---BEGIN MARKDOWN---</p>
<h1>Quest 2: The Sacred Scroll of Narratives</h1>
<hr>
<p>Beneath the shadow of the Pyramid of Code, a faint glint of gold catches your eye. A rocky outcropping leads to a forgotten chamber, hidden behind cascading vines. Inside, the air crackles with ancient energy as a single, glowing scroll rests atop a pedestal: the Sacred Scroll of Narratives. It is said that this scroll holds the secrets to crafting compelling tales and orchestrating thrilling adventures. To retrieve this treasure, you must decipher the code that binds its ancient wisdom to the modern era.</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Quest Initialization and Execution Core</h3>
<p>This file orchestrates the journey of the adventurer, managing the state of quests and their seamless transition. It employs key functionalities to initialize adventures (<code class="inline-code">initializeAdventure</code>), validate user choices, and meticulously execute selected quests. Central to this process is the <code class="inline-code">AdventureState</code>, which tracks quest progress, caching content to preserve precious computational energy and memory. The design illuminates a balance between dynamism and structured flow, mirroring the ancient architects&#39; genius in crafting adaptive yet enduring narratives.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Arranges the foundation for the journey, embedding thematic elements and project context.</li>
<li><code class="inline-code">exploreQuest</code>: Handles dynamic quest execution, ensuring prerequisites are met and previous completions are respected.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Offers a snapshot of how far the adventurer has progressed in their quest.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Ancient Configurations and Path Guidance</h3>
<p>This file operates as the unchanging oracle of the adventure, containing the configurations that define the alignment of quests. Through its primary functions—<code class="inline-code">parseAdventureConfig</code>, <code class="inline-code">extractUniqueFilePaths</code>, and <code class="inline-code">formatAdventureConfigForPrompt</code>—it ensures the adventurer’s path is clear, extracting crucial details from the project&#39;s stored wisdom. Its use of a custom JSON parsing approach mirrors the care taken in reading hieroglyphs on temple walls, ensuring every path aligns with the original designers’ intent.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Unveils the encoded wisdom within the adventure configuration file, translating its meaning for broader use.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies and protects valuable file paths, ensuring only authentic artifacts are used in the adventure.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses the configuration into a legible and efficient format to guide later explorations.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>Like the pyramid’s cornerstone, this function establishes the foundational framework needed for your adventure to stand tall.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }
  return await this.executeQuest(quest);
}
</code></pre>
<p>This ensures quests are navigated with precision, like a map guiding you through a labyrinth.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>A compass for the modern adventurer, this utility ensures you always know how far you’ve come and how much further you must go.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>This function acts as the translator, deciphering ancient inscriptions into actionable knowledge.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];
  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }
  return Array.from(unique);
}
</code></pre>
<p>Just as an archaeologist brushes away the soil to find hidden relics, this function uncovers paths to significant files buried within the configuration.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }
  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }
  let formatted = `## Quest Structure\n\n`;
  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;
    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }
    formatted += `\n`;
  }
  return formatted;
}
</code></pre>
<p>This function refines raw observations into a cohesive guide, much like scribing a map for future explorers.</p>
<h2>Helpful Hints</h2>
<ul>
<li>If adjusting quests, ensure <code class="inline-code">adventure.config.json</code> aligns with exploration goals.</li>
<li>Use <code class="inline-code">progressPercentage</code> to visualize milestones and stay motivated.</li>
<li>Leverage <code class="inline-code">extractUniqueFilePaths</code> to protect key configurations and pathways.</li>
</ul>
<hr>
<p>You have glimpsed the brilliance of the Sacred Scroll. Continue forth, for wisdom awaits discovery!</p>
<p>Hark, seeker of wisdom, thou hast unearthed the Sacred Scroll of Narratives, a testament to thy burgeoning mastery—let the temples resound with thy triumph as the annals of destiny illuminate thy path, onward to glory! 🌟📜⚡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">← Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>