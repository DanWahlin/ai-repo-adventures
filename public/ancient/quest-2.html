<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Glyph of Adventure - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Codebase Chronicles: The Temple of Digital Wisdom</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Glyph of Adventure</h1>
<hr>
<p>Amid the dense jungle of ancient coding scripts lies the Glyph of Adventure, an elusive artifact guarded by the Temple of Digital Wisdom. Within its sacred inscriptions rests the wisdom to generate quests, validate themes, and transform raw code into an epic journey. To uncover these glyphs, you must traverse through layers of intricate logic, unveiling the sacred methods and rituals that give life to the adventure. Let your investigative prowess guide you through this sacred quest.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Glyph Decoding</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> leverage project context and configuration to structure the journey&#39;s starting point?  </li>
<li>‚ö° <strong>Quest Mapping</strong>: What mechanisms in <code class="inline-code">AdventureManager.exploreQuest</code> ensure the correct quest is selected and executed?  </li>
<li>üõ°Ô∏è <strong>Content Rituals</strong>: How does <code class="inline-code">StoryGenerator.generateQuestContent</code> transform the raw codebase into themed quest content using external AI logic?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Defining the Framework for Adventures</h3>
<p>The <code class="inline-code">AdventureManager</code> acts as the curator of the journey, structuring adventures and ensuring each quest aligns with the sacred narrative. Its methods handle initialization, validation, and quest execution, forming the backbone of the temple&#39;s wisdom. Key highlights include logic for resetting adventures, merging contextual files, and transitional mechanics for quest exploration.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Sets the stage for an adventure, applying the selected theme, project details, and merging configuration for crafted quests.  </li>
<li><code class="inline-code">exploreQuest</code>: Validates and executes quests based on user selections, ensuring the adventure proceeds smoothly.  </li>
<li><code class="inline-code">generateQuestContent</code>: Dynamically creates detailed, structured quest narratives from targeted code analysis.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Resetting state for a fresh journey
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Handling custom themes
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generating quests with AI assistance
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  // Integrating config files into quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Returning formatted story and quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This code resets the adventure state, initializes key details like project info and theme, and uses AI-driven story generation methods to transform technical input into meaningful quests.  </li>
<li>It demonstrates dynamic merging of configuration files with pre-designed quests to ensure alignment with the project&#39;s scope.  </li>
<li>Patterns like &quot;state clearing&quot; and &quot;conditional logic&quot; ensure a clean setup for every new adventure.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  // Handling progress requests
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  // Locating and executing the quest
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  // Performing the ritual of quest execution
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>The <code class="inline-code">exploreQuest</code> function ensures user selections are validated and queries handled seamlessly, whether for progress or specific quest exploration.  </li>
<li>Error handling mechanisms (<code class="inline-code">createNotFoundResult</code>) and modular validation logic (<code class="inline-code">validateAndSanitizeChoice</code>) safeguard user interactions.  </li>
<li>Mapping between user inputs and quests demonstrates clean and intuitive selection patterns.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  codeContent: string,
  questPosition?: number,
  totalQuests?: number
): Promise&lt;QuestContent&gt; {
  let adventureGuidance = &#39;&#39;;
  if (this.projectPath) {
    const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);
    if (formattedConfig) {
      adventureGuidance = formattedConfig;
    }
  }

  // Constructing the AI prompt
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    adventureGuidance: adventureGuidance || &#39;&#39;,
    questPosition,
    totalQuests,
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );

  if (!response.content || response.content.trim() === &#39;&#39;) {
    throw new Error(&#39;LLM returned empty response for quest content&#39;);
  }

  let cleanContent = response.content.trim();
  
  // Formatting for final presentation
  const beginMarker = &#39;---BEGIN MARKDOWN---&#39;;
  const endMarker = &#39;

Hark, valiant seeker, for thou hast traversed the sacred halls and unearthed the Glyph of Adventure with a spirit unyielding‚Äîlet this triumph light thy path as a blazing star towards the ancient wisdom still to come! ‚≠ê‚ú®
</code></pre>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>