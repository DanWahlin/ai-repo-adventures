<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Glyphmaker's Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Lost Codes</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Glyphmaker&#39;s Engine</h1>
<hr>
<p>Shrouded in the mysteries of an ancient jungle, you uncover the Pyramid of Lost Codes&#39; second layer of secrets: The Glyphmaker&#39;s Engine. Hidden within these walls is a sacred mechanism that ancient scholars once relied on to craft their glyphs and translate the wisdom of civilizations past. However, its gears have fallen silent, buried beneath layers of code and forgotten algorithms. To unlock its wonders, you must navigate a maze of interconnected systems, decipher its methods, and breathe life into the long-dormant engine.</p>
<h2>Quest Objectives</h2>
<p>As you explore the files below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Glyph Blueprint Analysis</strong>: How does the <code class="inline-code">initializeAdventure</code> method establish the foundation of the story and quests?</li>
<li>‚ö° <strong>Execution Circuitry</strong>: How does the <code class="inline-code">exploreQuest</code> function enable quest activation based on user input?</li>
<li>üõ°Ô∏è <strong>Sanctuary Safeguards</strong>: What mechanisms ensure safe parsing of the adventure&#39;s configuration in the <code class="inline-code">parseAdventureConfig</code> function?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Managing quest state and interaction</h3>
<p>This file is at the heart of the Glyphmaker&#39;s Engine, responsible for managing the adventure state, initializing new journeys, and handling the execution of quests. It blends project data and theme into cohesive stories and offers tools for progress tracking, exploration, and data parsing. Investigating core functions reveals how quests transition from abstract concepts into actionable steps, retaining both utility and narrative focus.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: Configures the entire journey, constructing storylines and quests based on project context and selected themes, including custom explorations defined by the user.</li>
<li><code class="inline-code">AdventureManager.exploreQuest</code>: Enables dynamic execution of quests, validating user input and retrieving cached content for previously completed tasks.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Tracks completion progress by calculating the ratio of completed quests versus total quests.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Configures the foundational aspects of an adventure such as story and quest listings based on user-defined parameters.</li>
<li>Demonstrates modular usage of <code class="inline-code">mergeQuestFilesFromConfig</code> and <code class="inline-code">enforceConfigQuestCount</code> to refine quest content based on external configurations.</li>
<li>Highlights thoughtful default handling (<code class="inline-code">process.cwd</code>) and flexibility for custom themes.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) return this.createNotFoundResult();

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Handles user inputs to dynamically activate a quest, ensuring proper sanitation via <code class="inline-code">validateAndSanitizeChoice</code>.</li>
<li>Uses separate methods for <code class="inline-code">findQuest</code> and <code class="inline-code">executeQuest</code> to establish clear responsibilities and modular design.</li>
<li>Contains fallback logic to handle missing quests gracefully (<code class="inline-code">createNotFoundResult</code>).</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Simplifies progress tracking to provide a user-friendly percentage display of completed versus available quests.</li>
<li>Ensures zero division logic safety in cases of empty quest arrays.</li>
<li>Demonstrates concise functional patterns for calculating derived data.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Parsing sacred adventure blueprints</h3>
<p>This file is a decoder of ancient scripting artifacts, often representing stored configurations in JSON format. It parses and interprets project-specific structures, validating file paths and extracting highlights for further exploration. It&#39;s pivotal for ensuring user-defined configurations seamlessly integrate into the Glyphmaker&#39;s Engine.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Safely reads and parses the configuration JSON, ensuring error resilience and validating its structure.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the configuration to extract paths to referenced files for targeted code analysis.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes configurations for human-readable prompts by distilling verbose data into concise summaries.</li>
</ul>
<hr>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Encapsulates JSON parsing within a try-catch block to safeguard against syntax errors or missing configuration files.</li>
<li>Delegates file reading to <code class="inline-code">loadAdventureConfig</code>, adhering to single responsibility principles.</li>
<li>Returns <code class="inline-code">null</code> for invalid input, ensuring robustness without unexpected crashes.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }
  return Array.from(unique);
}
</code></pre>
<ul>
<li>Builds a stack-based traversal mechanism for parsing nested configurations and extracting valid file paths.</li>
<li>Validates file existence via <code class="inline-code">fs.existsSync</code> to ensure accurate data representation.</li>
<li>Implements a <code class="inline-code">Set</code> to guarantee uniqueness and avoid redundancy in file listings.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;
  
  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return &#39;&#39;;
  
  let formatted = `## Quest Structure\n`;
  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\nFiles: ${quest.files.map((f: any) =&gt; f.path).filter(Boolean).join(&#39;, &#39;)}\nFunctions: ${quest.files.flatMap((f: any) =&gt; f.highlights || []).map((h: any) =&gt; h.name).filter(Boolean).join(&#39;, &#39;)}\n\n`;
  }
  return formatted;
}
</code></pre>
<ul>
<li>Reduces verbose configurations into concise summaries to streamline communication with LLMs.</li>
<li>Combines file and function lists under each quest for clearer mappings.</li>
<li>Leverages <code class="inline-code">flatMap</code> and <code class="inline-code">filter</code> for efficient data extraction from nested structures.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <code class="inline-code">progressPercentage</code> method to track how far you&#39;ve progressed ‚Äî it may inspire perseverance in reaching 100% completion.</li>
<li>Look deeper into <code class="inline-code">initializeAdventure</code> as it contains entry points for redefining themes, paths, and settings.</li>
<li>Focus on configuration parsing in <code class="inline-code">parseAdventureConfig</code> to understand integration between user-provided files and generated quests.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>With the completion of Quest 2: The Glyphmaker&#39;s Engine, thou hast unveiled the sacred lore of the ancients, carving thy name into the eternal tablets of wisdom‚Äîpress onward, for the divine stars yet await thy mastery! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>