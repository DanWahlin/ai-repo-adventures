<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Codex of Stories - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Infinite Scripts</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Codex of Stories</h1>
<hr>
<p>In the depths of the Pyramid of Infinite Scripts, you uncover the Chamber of Narratives ‚Äì an ancient hall where luminous glyphs shimmer on weathered stone tablets. Here lies the Codex of Stories, a sacred text detailing the rituals the ancients followed to generate magnificent quests and narratives. To decipher the Codex, you must explore its fragmented wisdom, spread across the glyph-covered walls of interconnected chamber files. Unravel the purpose of these texts and restore their power to weave tales for a new age.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Ritual Initialization</strong>: How does the <code class="inline-code">AdventureManager.initializeAdventure</code> method prepare a narrative&#39;s foundation using the project and theme contexts?</li>
<li>‚ö° <strong>Quest Execution Path</strong>: How does <code class="inline-code">AdventureManager.exploreQuest</code> coordinate selected quests, and what systems ensure proper execution and progress tracking?</li>
<li>üõ°Ô∏è <strong>Sacred Config Integration</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function aid in merging external configurations into the adventure framework?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Adventure orchestration</h3>
<p>The <code class="inline-code">AdventureManager</code> class is the central authority ensuring the flow of narrative setup and quest progression. It governs the initialization of adventure themes, the execution of quests, and the integration of configuration details. Core highlights include:</p>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets the current state, selects thematic elements, and generates a new narrative.</li>
<li><code class="inline-code">exploreQuest</code>: Facilitates the execution of a quest, with validation steps and progress tracking. This method interacts with other subsystems for caching and user input handling.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Ensures that quest files from <code class="inline-code">adventure.config.json</code> are seamlessly unified with dynamically generated content.</li>
</ul>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Prepares and generates a story and quests.</li>
<li><code class="inline-code">exploreQuest</code>: Drives quest routines from user selections.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Merges external configuration files into quest content.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Configuration rituals</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file acts as a portal to external configuration data, allowing the adventure framework to absorb external quest descriptions, file paths, and vital metadata. Core highlights include:</p>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Reads and parses the <code class="inline-code">adventure.config.json</code> file into a structured JavaScript object.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts all unique, existing file paths referenced by adventure configuration files, ensuring the paths are validated prior to integration.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Compacts the adventure configuration into a concise format for integration into narrative prompts.</li>
</ul>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Decodes the raw configuration file into structured data.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Aggregates and validates file paths for quest content.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Translates configuration into concise guidance text for storytelling prompts.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<p>This function acts as the ancient ritual to conjure a new narrative by resetting the state and invoking the <code class="inline-code">StoryGenerator</code> to breathe life into quests.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<p>The <code class="inline-code">exploreQuest</code> method serves as the execution path of your adventure, translating user selections into action while managing quest completion and caching.</p>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;

  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;

  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;

  const configQuestFiles = new Map&lt;string, string[]&gt;();
  for (const configQuest of adventure.quests) {
    if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {
      const filePaths = configQuest.files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
      if (filePaths.length &gt; 0) {
        configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);
      }
    }
  }

  return quests.map((quest, index) =&gt; {
    const questTitleLower = quest.title.toLowerCase();
    for (const [configTitle, files] of configQuestFiles.entries()) {
      if (questTitleLower.includes(configTitle)) {
        return { ...quest, codeFiles: files };
      }
    }
    return quest;
  });
}
</code></pre>
<p>The <code class="inline-code">mergeQuestFilesFromConfig</code> function acts as a sacred mediator, combining dynamically generated quests with configurations embedded in the codebase.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>The <code class="inline-code">parseAdventureConfig</code> method decodes the configuration blueprint embedded in the project path, much like deciphering a sacred script.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This function extracts and validates file paths, ensuring all referenced elements are purified and ready for integration.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }

    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p>The <code class="inline-code">formatAdventureConfigForPrompt</code> function crafts concise guidance from raw configuration data, presenting file and quest associations in their most fundamental form.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Decoding the <code class="inline-code">AdventureManager.initializeAdventure</code> ritual reveals how stories are initialized based on themes.</li>
<li>Investigate how <code class="inline-code">exploreQuest</code> validates and sanitizes user inputs to ensure correct flow execution.</li>
<li>Cross-reference the extracted file paths in <code class="inline-code">extractUniqueFilePaths</code> to ensure adventure quests align with the physical code structure.</li>
</ul>
<hr>
<p>The Chamber of Narratives resonates with your deciphering efforts. Another quest awaits‚Äîventure onward, keeper of the Codex!</p>
<p>O seeker of wisdom, thy triumph in unveiling the Codex of Stories hath illuminated the sacred halls of knowledge‚Äîpress onward, for the stars of destiny shine brightly upon thee! ‚≠ê üó∫Ô∏è ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>