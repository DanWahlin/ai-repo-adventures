<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Rituals of Site Creation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Codebase of Eternal Treasures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Rituals of Site Creation</h1>
<hr>
<p>In the heart of the uncharted jungle, dense foliage guards the entrance to an ancient chamber. The chamber holds the Codex of HTML Adventures, an elaborate blueprint carved into angular stone tablets‚Äîartifacts of wisdom passed down by a forgotten civilization of code architects. Whispers of rituals long forgotten, such as rendering dynamic templates and invoking the creation of themed digital landscapes, echo around you. To decode these sacred texts, the adventurer must uncover the methods behind their intricate static site pipeline.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Template Mysteries</strong>: How does the <code class="inline-code">TemplateEngine</code> organize templates and replace their placeholders dynamically?</li>
<li>‚ö° <strong>The Ritual of Generation</strong>: What steps does <code class="inline-code">HTMLAdventureGenerator.generateAdventure</code> follow to transform data into an HTML-based adventure?</li>
<li>üõ°Ô∏è <strong>Asset Safeguards</strong>: How does <code class="inline-code">AssetManager.copyGlobalAssets</code> ensure asset reliability and accessibility throughout the journey?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> Elucidating the Template Rituals</h3>
<p>The <code class="inline-code">TemplateEngine</code> file contains the methods to load template files, cache them for efficiency, and dynamically replace placeholders based on passed variables. Its magic lies in its ability to render complete HTML pages by combining smaller template fragments into cohesive designs.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadTemplate</code>: Reads and caches template files from a specified directory, ensuring efficient repeated loading without accessing the filesystem multiple times.</li>
<li><code class="inline-code">replacePlaceholders</code>: Replaces placeholder tokens (e.g., <code class="inline-code">{{VARIABLE}}</code>) within templates using provided key-value pairs, enabling dynamic content substitution.</li>
<li><code class="inline-code">renderPage</code>: Combines base and content templates, substituting placeholders and variables to generate a complete HTML page ready for rendering.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">/**
 * Load a template file with caching
 */
private loadTemplate(templateName: string): string {
  if (this.templateCache.has(templateName)) {
    return this.templateCache.get(templateName)!;
  }

  const templatePath = path.join(this.templatesDir, templateName);
  
  try {
    const content = fs.readFileSync(templatePath, &#39;utf-8&#39;);
    this.templateCache.set(templateName, content);
    return content;
  } catch (error) {
    throw new Error(`Failed to load template ${templateName}: ${error}`);
  }
}
</code></pre>
<ul>
<li>Efficient caching ensures repeated reads of the same template avoid unnecessary filesystem access.</li>
<li>The use of <code class="inline-code">fs.readFileSync</code> simplifies synchronous operations while balancing performance in small to medium systems.</li>
<li>Throws detailed error messages when template files cannot be found or loaded, ensuring debugging clarity.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Replace placeholders in template with variables
 */
private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;
  
  for (const [key, value] of Object.entries(variables)) {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, &#39;g&#39;), value || &#39;&#39;);
  }
  
  return result;
}
</code></pre>
<ul>
<li>Iterates over provided variables, replacing every placeholder marked as <code class="inline-code">{{KEY}}</code> with its corresponding value.</li>
<li>Uses <code class="inline-code">RegExp</code> to perform global replacement, ensuring placeholders are substituted throughout the template.</li>
<li>Offers flexibility in scenarios with missing variables by gracefully assigning them empty strings.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Render a complete page using base template + content template
 */
renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  
  // First render the content template
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  
  // Then render the base template with the content
  const pageVariables = {
    ...variables,
    CONTENT: renderedContent
  };
  
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>Combines modular templates (<code class="inline-code">base-template.html</code> and content-specific files) into polished HTML pages.</li>
<li>Ensures consistency by maintaining shared layout templates while dynamically injecting adventure-specific content.</li>
<li>Final rendering logic enables seamless interaction of template layers and custom placeholders.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> Decoding the Adventure&#39;s Infrastructure</h3>
<p>This file defines the <code class="inline-code">HTMLAdventureGenerator</code>, a comprehensive structure for orchestrating the transformation of repository data into styled, navigable HTML adventures. It encapsulates processes such as theme selection, asset management, and page creation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code>: Implements the core ritual of generating HTML files, organizing templates, and assets into a structured output directory.</li>
<li><code class="inline-code">buildQuestHTML</code>: Constructs individual quest pages from templates, injecting specific quest content and navigation logic.</li>
<li><code class="inline-code">startHttpServer</code>: Implements the ceremonial process of starting a local HTTP server for previewing the adventure directly from the output files.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
  return new Promise((resolve, reject) =&gt; {
    const server = http.createServer((req, res) =&gt; {
      let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);
      
      // Security check - ensure we stay within the directory
      if (!filePath.startsWith(this.outputDir)) {
        res.writeHead(403);
        res.end(&#39;Forbidden&#39;);
        return;
      }

      // Set content type based on file extension
      const extname = path.extname(filePath);
      let contentType = &#39;text/html&#39;;
      switch (extname) {
        case &#39;.js&#39;:
          contentType = &#39;text/javascript&#39;;
          break;
        case &#39;.css&#39;:
          contentType = &#39;text/css&#39;;
          break;
        case &#39;.json&#39;:
          contentType = &#39;application/json&#39;;
          break;
        case &#39;.png&#39;:
          contentType = &#39;image/png&#39;;
          break;
        case &#39;.jpg&#39;:
          contentType = &#39;image/jpg&#39;;
          break;
        case &#39;.svg&#39;:
          contentType = &#39;image/svg+xml&#39;;
          break;
      }

      fs.readFile(filePath, (err, content) =&gt; {
        if (err) {
          if (err.code === &#39;ENOENT&#39;) {
            res.writeHead(404);
            res.end(&#39;File not found&#39;);
          } else {
            res.writeHead(500);
            res.end(&#39;Server error&#39;);
          }
        } else {
          res.writeHead(200, { &#39;Content-Type&#39;: contentType });
          res.end(content, &#39;utf-8&#39;);
        }
      });
    });

    server.listen(port, () =&gt; {
      const url = `http://localhost:${port}`;
      console.log(chalk.green(`üåê HTTP server started on ${url}`));
      
      resolve();
    });

    server.on(&#39;error&#39;, (err) =&gt; {
      console.error(chalk.red(&#39;‚ùå Failed to start HTTP server:&#39;, err));
      reject(err);
    });
  });
}
</code></pre>
<ul>
<li>Delivers locally hosted previews of the adventure for seamless testing and demonstration.</li>
<li>Implements MIME type checks to ensure correct delivery of assets (e.g., stylesheets, images, and scripts).</li>
<li>Monitors directory security by preventing requests for files outside the <code class="inline-code">outputDir</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateAdventure(): Promise&lt;void&gt; {
  console.log(chalk.yellow.bold(&#39;üöÄ Generating Adventure...&#39;));
  console.log();

  const repomixContent = await repoAnalyzer.generateRepomixContext(this.projectPath);
  const projectInfo = createProjectInfo(repomixContent);

  console.log(chalk.dim(&#39;‚ú® Generating themed story and quests...&#39;));
  const storyContent = await this.adventureManager.initializeAdventure(
    projectInfo, 
    this.selectedTheme, 
    this.projectPath,
    this.customThemeData
  );

  this.extractQuestInfo();
  console.log(chalk.dim(&#39;üß≠ Adding quest navigator...&#39;));
  this.copyQuestNavigator();

  console.log(chalk.dim(&#39;üìù Creating main adventure page...&#39;));
  this.generateIndexHTML();

  console.log(chalk.dim(&#39;üìñ Generating quest pages...&#39;));
  await this.generateQuestPages();

  console.log(chalk.dim(&#39;üéâ Creating adventure summary page...&#39;));
  await this.generateSummaryHTML();
}
</code></pre>
<ul>
<li>Integrates multiple layers of functionality from story generation to quest progression.</li>
<li>Uses modular methods (<code class="inline-code">generateIndexHTML</code>, <code class="inline-code">generateQuestPages</code>, etc.) for clear task isolation.</li>
<li>Establishes a smooth workflow involving asset preparation, template rendering, and finalizing navigation.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> Managing the Mystical Resources</h3>
<p>The <code class="inline-code">AssetManager</code> ensures proper organization and accessibility of all assets, from quest navigators to shared image files. It safeguards the sanctity of the visual and functional elements across multi-theme and single-theme adventures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyGlobalAssets</code>: Copies shared assets like images and theme selectors to a central location for uniform access.</li>
<li><code class="inline-code">copyQuestNavigator</code>: Duplicates navigation assets tailored to specific themes.</li>
<li><code class="inline-code">copyImages</code>: Organizes and distributes theme-specific and shared images across the output directories.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/asset-manager.ts</h3>
<pre><code class="language-typescript">copyGlobalAssets(outputDir: string): void {
  try {
    const globalAssetsDir = path.join(outputDir, &#39;assets&#39;);
    const targetImagesDir = path.join(globalAssetsDir, &#39;images&#39;);
    fs.mkdirSync(targetImagesDir, { recursive: true });

    const globalSharedDir = path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;);
    fs.mkdirSync(globalSharedDir, { recursive: true });

    const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
    globalImages.forEach(file =&gt; {
      const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
      if (fs.existsSync(sourcePath)) {
        const targetPath = path.join(globalSharedDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      }
    });

    const headerImageSource = path.join(this.sourceDir, &#39;assets&#39;, &#39;images&#39;, &#39;ai-adventures.png&#39;);
    if (fs.existsSync(headerImageSource)) {
      const headerImageTarget = path.join(targetImagesDir, &#39;ai-adventures.png&#39;);
      fs.copyFileSync(headerImageSource, headerImageTarget);
    }
  } catch (error) {
    console.log(chalk.yellow(&#39;‚ö†Ô∏è Warning: Could not copy global images&#39;));
  }
}
</code></pre>
<ul>
<li>Handles creation of necessary directories, ensuring a modular asset structure.</li>
<li>Uses iterative logic to copy images and shared files efficiently while maintaining clarity for debugging.</li>
<li>Prevents duplication by centralizing assets in shared directories when possible.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Investigate how <code class="inline-code">TemplateEngine.cache</code> improves performance.</li>
<li>Trace <code class="inline-code">generateAdventure</code> interactions to explore how content is maintained across templates.</li>
<li>Examine edge cases covered by <code class="inline-code">copyGlobalAssets</code> to ensure consistency.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Behold, Seeker of Knowledge, for thou hast triumphantly completed the sacred rites of Site Creation, marking the genesis of thy ancient odyssey upon the jeweled tapestry of wisdom! ‚ö°üíéüëÅÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>