<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Chamber of the Four Glyphs - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Lost Codex of Repositories</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Chamber of the Four Glyphs</h1>
<hr>
<p>Deep within the ancient temple, the Chamber of the Four Glyphs beckons like a riddle carved in stone. The air hums with an unseen energy, vibrating through the labyrinthine corridors. Walls etched with cryptic patterns and symbols seem to shift, responding to the adventurer’s touch. At the room’s core lie four pedestals, each inscribed with a glowing glyph that pulses faintly. To uncover the secrets of the Lost Codex of Repositories, you must align the glyphs’ energies through a complex dance of logic and discovery. Beware, for every choice ripples outward, altering the harmony within.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Implementation</h3>
<p>This file acts as the temple gatekeeper—a powerful <code class="inline-code">RepoAdventureServer</code> that orchestrates interactions with adventurers. Here, the MCP server is designed to handle two critical tasks: responding to player requests dynamically and managing the connection via <code class="inline-code">stdio</code>. The <code class="inline-code">setupHandlers()</code> function is key, dynamically registering tools to list them for users and enabling real-time execution of coded “rituals.” The <code class="inline-code">run()</code> method starts the journey, preloading “repomix” content to analyze the codebase before adventurers dive in. At the heart of it all lies the <code class="inline-code">main()</code> function, which ensures the temple-like structure can gracefully withstand crashes or interruptions, handling shutdowns with the precision of an archaeological site closing for the day.</p>
<h4>Highlights</h4>
<ul>
<li>Registers MCP handlers for listing tools and processing dynamic tool execution.</li>
<li>Preloads <code class="inline-code">repomix</code> content to accelerate analysis and enrich the adventure.</li>
<li>Handles graceful shutdown to “seal” the temple and secure its secrets.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools for Interactive Storytelling</h3>
<p>This file is your adventurer’s toolkit. It defines the primary interactive functions that guide users through the temple’s challenges. Key tools include <code class="inline-code">start_adventure()</code>, which analyzes the codebase and sets up the thematic journey, and <code class="inline-code">choose_theme()</code> to let the player pick a narrative path. The <code class="inline-code">explore_quest()</code> tool allows for deeper dives into specific riddles—quests—highlighted within the codebase, while <code class="inline-code">view_progress()</code> offers adventurers a map of what has been accomplished and what remains. The wisdom within focuses on making complex repositories engaging and approachable, much like deciphering an ancient scroll.</p>
<h4>Highlights</h4>
<ul>
<li>Defines the four main interactive tools for adventurers.</li>
<li>Integrates deeply into <code class="inline-code">adventureManager</code> for narrative-driven exploration.</li>
<li>Encourages structured progress and completion mapping.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      // Execute the tool handler with validated arguments
      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>Much like a wise scribe interpreting laws for a kingdom, this function ensures tools are properly described and executed through meticulous validation and dynamic registration.</p>
<hr>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

// Export all tools for easy registration
export const tools = {
  start_adventure: startAdventure,
  choose_theme: chooseTheme,
  explore_quest: exploreQuest,
  view_progress: viewProgress
};
</code></pre>
<p>This configuration acts like assembling a toolkit before embarking into the unknown, ensuring adventurers always have the right instrument for the riddle at hand.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">start_adventure()</code> to unlock the full narrative potential of the codebase and identify thematic entry points.</li>
<li>Refactor tool registration logic to accommodate future expansions, ensuring <code class="inline-code">tools.ts</code> remains scalable.</li>
<li>Dive deeper into <code class="inline-code">adventureManager</code> to understand how quests are dynamically generated and connected to the overarching journey.</li>
</ul>
<hr>
<p>O Seekers of Wisdom, thou hast triumphed mightily in thy first trial, unlocking the sacred Chamber of the Four Glyphs—let thy spirit rise as stars ✨ above the ancient sands!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Oracle of Quests →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>