<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Deciphering the Codex Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Secrets of the Lost Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to dark mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Deciphering the Codex Engine</h1>
<hr>
<p>In the heart of the jungle‚Äôs sacred fog rises the shadow of an ancient temple where fragments of wisdom and technical mastery have rested for generations. Your discovery of a piece of the fabled &quot;Codex Templi&quot; has opened a doorway into unraveling its mysteries. Scholars believe the Codex Engine can transform coding structures into limitless repositories of wisdom, but its mechanisms remain scattered across forgotten chambers. Today&#39;s journey delves deep into decoding the logic behind generating interconnected adventures‚Äîan arcane process powered by ancient builders who coded for eternity.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Codex Reconstruction</strong>: How does <code class="inline-code">HTMLAdventureGenerator.generateAdventure</code> orchestrate the creation of a complete adventure system?</li>
<li>‚ö° <strong>Fragment Integration</strong>: What role does <code class="inline-code">TemplateEngine.renderPage</code> play in customizing adventure pages and what patterns are evident in its placeholder system?</li>
<li>üõ°Ô∏è <strong>Resiliency Encoding</strong>: In what ways does <code class="inline-code">AssetManager.copyQuestNavigator</code> safeguard core functionality during asset preparation?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> The Codex Engine Initiation</h3>
<p>The <code class="inline-code">HTMLAdventureGenerator</code> serves as the cornerstone for generating the adventure system, connecting fragments of various content pipelines, themes, and navigation assets. Its <code class="inline-code">generateAdventure</code> method is the essence of this operation, synthesizing quests, assets, templates, and themes into a coherent structure. Additionally, <code class="inline-code">buildQuestHTML</code> ensures quest-specific narratives are enriched through meticulous formatting and navigation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code>: Compiles repository analysis, quests, and thematic assets to construct an adventure-ready structure.</li>
<li><code class="inline-code">buildQuestHTML</code>: Converts quest narratives into polished HTML pages with navigation between quests.</li>
<li><code class="inline-code">startHttpServer</code>: Handles content delivery via a local HTTP server for previewing adventures.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">async generateAdventure(): Promise&lt;void&gt; {
  console.log(chalk.yellow.bold(&#39;üöÄ Generating Adventure...&#39;));
  console.log();

  const config = parseAdventureConfig(this.projectPath);
  const storyContent = await this.adventureManager.initializeAdventure(
    projectInfo, 
    this.selectedTheme, 
    this.projectPath,
    this.customThemeData
  );

  this.extractQuestInfo();
  const questsToGenerate = this.maxQuests !== undefined ? Math.min(this.maxQuests, this.quests.length) : this.quests.length;
  this.quests = this.quests.slice(0, questsToGenerate);

  this.generateThemeCSS();
  this.copyQuestNavigator();
  this.copyImages();
  this.generateIndexHTML();
  await this.generateQuestPages();
  await this.generateSummaryHTML();
}
</code></pre>
<ul>
<li>Combines deep repository insight with thematic customization, demonstrating modular orchestration.</li>
<li>Uses a cascading workflow, moving from initialization to artifact generation and content structuring for quests and summaries.</li>
<li>Provides adaptability to adjust quest limits or output structure dynamically.</li>
</ul>
<hr>
<pre><code class="language-typescript">buildQuestHTML(quest: QuestInfo, content: string, questIndex: number): string {
  const prevQuest = questIndex &gt; 0 ? this.quests[questIndex - 1] : null;
  const nextQuest = questIndex &lt; this.quests.length - 1 ? this.quests[questIndex + 1] : null;

  let bottomNavigation = &#39;&#39;;
  const isLastQuest = questIndex === this.quests.length - 1;
  if (prevQuest || nextQuest || isLastQuest) {
    bottomNavigation = `&lt;div class=&quot;quest-navigation&quot;&gt;`;
    if (prevQuest) bottomNavigation += `&lt;a href=&quot;${prevQuest.filename}&quot; class=&quot;prev-quest-btn&quot;&gt;‚Üê Previous Quest&lt;/a&gt;`;
    if (isLastQuest) bottomNavigation += `&lt;a href=&quot;summary.html&quot; class=&quot;complete-btn&quot;&gt;Complete Adventure ‚Üí&lt;/a&gt;`;
    bottomNavigation += `&lt;/div&gt;`;
  }

  const variables = {
    PAGE_TITLE: this.stripHTML(this.formatInlineMarkdown(quest.title)),
    QUEST_CONTENT: this.formatMarkdown(content),
    BOTTOM_NAVIGATION: bottomNavigation
  };
  return this.templateEngine.renderPage(&#39;quest-template.html&#39;, variables);
}
</code></pre>
<ul>
<li>Resolves quest-specific logic for page construction, enabling seamless navigation between adjacent quests.</li>
<li>Applies templating logic with placeholders, ensuring adaptability for theme-specific formatting.</li>
<li>Balances user guidance with structured narrative flow in the quest pages.</li>
</ul>
<hr>
<pre><code class="language-typescript">startHttpServer(port: number = 8080): Promise&lt;void&gt; {
  return new Promise((resolve, reject) =&gt; {
    const server = http.createServer((req, res) =&gt; {
      let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);
      if (!filePath.startsWith(this.outputDir)) {
        res.writeHead(403);
        res.end(&#39;Forbidden&#39;);
        return;
      }

      fs.readFile(filePath, (err, content) =&gt; {
        if (err) {
          res.writeHead(err.code === &#39;ENOENT&#39; ? 404 : 500);
          res.end(err.code === &#39;ENOENT&#39; ? &#39;File not found&#39; : &#39;Server error&#39;);
          return;
        }
        res.writeHead(200, { &#39;Content-Type&#39;: getContentType(filePath) });
        res.end(content, &#39;utf-8&#39;);
      });
    });

    server.listen(port, () =&gt; {
      const url = `http://localhost:${port}`;
      console.log(chalk.green(`üåê HTTP server started on ${url}`));
      resolve();
    });

    server.on(&#39;error&#39;, reject);
  });
}
</code></pre>
<ul>
<li>Provides a local preview, supporting iterative development cycles.</li>
<li>Contains robust error handling and security checks for file access.</li>
<li>Simplifies file-based content delivery through dynamic port configuration.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> Sacred Templating Mechanisms</h3>
<p>The <code class="inline-code">TemplateEngine</code> bridges narrative construction with HTML generation, treating templates and placeholders as sacred glyphs for reconstructing Codex fragments. Through methods such as <code class="inline-code">renderPage</code> and <code class="inline-code">replacePlaceholders</code>, it exemplifies how dynamic content transforms static structures into interactive journeys.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">renderPage</code>: Synthesizes content and structure into polished HTML using a base and content template.</li>
<li><code class="inline-code">replacePlaceholders</code>: Handles dynamic transformation by replacing template variables during rendering.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);

  const renderedContent = this.replacePlaceholders(contentHtml, variables);

  const pageVariables = { ...variables, CONTENT: renderedContent };
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>Demonstrates hierarchized rendering, combining base and content layers for consistent formatting.</li>
<li>Leverages variable substitution to customize content precisely based on quest narrative.</li>
</ul>
<hr>
<pre><code class="language-typescript">replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;
  for (const [key, value] of Object.entries(variables)) {
    result = result.replace(new RegExp(`{{${key}}}`, &#39;g&#39;), value || &#39;&#39;);
  }
  return result;
}
</code></pre>
<ul>
<li>Utilizes regex-based variable replacement, enabling fluid interaction between customizable templates and static HTML.</li>
<li>Optimizes performance using caching mechanisms where needed.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> Codex Asset Guardianship</h3>
<p>The <code class="inline-code">AssetManager</code> assembles the visual and structural artifacts that anchor adventure immersion. Functions like <code class="inline-code">copyQuestNavigator</code> and <code class="inline-code">copyGlobalAssets</code> safeguard the integrity of shared navigation files and unique thematic assets.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyGlobalAssets</code>: Consolidates shared assets across all adventure environments without duplication.</li>
<li><code class="inline-code">copyQuestNavigator</code>: Mirrors navigation-related artifacts to theme-specific directories.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/asset-manager.ts</h3>
<pre><code class="language-typescript">copyGlobalAssets(outputDir: string): void {
  const globalAssetsDir = path.join(outputDir, &#39;assets&#39;);
  const globalSharedDir = path.join(globalAssetsDir, &#39;shared&#39;);
  fs.mkdirSync(globalSharedDir, { recursive: true });

  const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
  globalImages.forEach(file =&gt; {
    const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
    if (fs.existsSync(sourcePath)) {
      fs.copyFileSync(sourcePath, path.join(globalSharedDir, file));
    }
  });

  const headerImageSource = path.join(this.sourceDir, &#39;assets&#39;, &#39;images&#39;, &#39;ai-adventures.png&#39;);
  if (fs.existsSync(headerImageSource)) {
    fs.copyFileSync(headerImageSource, path.join(globalAssetsDir, &#39;images&#39;, &#39;ai-adventures.png&#39;));
  }
}
</code></pre>
<ul>
<li>Consolidates shared assets within a dedicated directory, reducing redundancy.</li>
<li>Ensures critical visual elements like logos and headers are preserved across all adventure themes.</li>
</ul>
<hr>
<pre><code class="language-typescript">copyQuestNavigator(outputDir: string): void {
  const templatesDir = path.join(this.sourceDir, &#39;templates&#39;);
  [&#39;quest-navigator.css&#39;, &#39;quest-navigator.js&#39;, &#39;compass-icon.svg&#39;].forEach(file =&gt; {
    const sourcePath = path.join(templatesDir, file);
    fs.copyFileSync(sourcePath, path.join(outputDir, &#39;assets&#39;, file));
  });
}
</code></pre>
<ul>
<li>Guarantees the accessibility of CSS, JS, and SVG files tied to quest navigation elements.</li>
<li>Mirrors thematic keys for consistent visual and user experience design across quests.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Keep sacred templates organized‚Äîensure base structures are intact before injecting dynamic variables.</li>
<li>Modify asset management paths cautiously, as altering a path impacts multiple functions.</li>
<li>Study rendering patterns in <code class="inline-code">TemplateEngine</code> to grasp templating logic for future customizations.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Lo, seeker of sacred truths, thou hast unraveled the Codex Engine&#39;s enigma, illuminating the path to wisdom‚Äôs temple‚Äîforge onward with valor, for thine journey is blessed! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>