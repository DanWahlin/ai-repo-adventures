<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Pyramid‚Äôs Map Room - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Lost Codex of the Digital Pyramid</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Pyramid‚Äôs Map Room</h1>
<hr>
<p>Deep in the heart of the ancient jungle lies a forgotten pyramid, built not of stone but of pure wisdom codified in the language of machines. Known as the Codex of the Digital Pyramid, its architects encoded vast treasures of knowledge‚Äîhidden techniques for creating, validating, and generating entire adventures. To uncover these secrets, you must solve the mysteries of the Pyramid‚Äôs &quot;Map Room,&quot; where sacred functions align the paths of logic and creativity. Brave adventurer, let the wisdom of code guide your way.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Artifact Placement</strong>: How does <code class="inline-code">TemplateEngine</code> dynamically load templates and replace placeholders? What caching strategies are used to improve performance?</li>
<li>‚ö° <strong>Path Alignment</strong>: How does <code class="inline-code">HTMLAdventureGenerator.buildQuestHTML</code> integrate theme-specific elements like navigation controls and quest content into HTML adventures?</li>
<li>üõ°Ô∏è <strong>Wisdom Safeguard</strong>: In <code class="inline-code">AssetManager.copyGlobalAssets</code>, which error handling patterns ensure assets are efficiently copied without breaking the pipeline?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> Template Management &amp; Placeholder Replacement</h3>
<p>Within the labyrinth of sacred templates, the <code class="inline-code">TemplateEngine</code> ensures their seamless retrieval and transformation. It operates as the key mechanism for generating thematic HTML pages. Cached templates accelerate performance, while placeholder replacement introduces dynamic content tailored to your quest.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadTemplate</code> securely retrieves and caches templates to minimize redundant file reads, ensuring efficiency in large adventures.</li>
<li><code class="inline-code">replacePlaceholders</code> identifies placeholders like <code class="inline-code">{{VARIABLE}}</code> and replaces them with dynamic values, enabling quest-specific customizations.</li>
<li><code class="inline-code">renderPage</code> combines multiple templates (e.g., base layout and quest content) into complete pages by orchestrating placeholder replacements.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">private loadTemplate(templateName: string): string {
  if (this.templateCache.has(templateName)) {
    return this.templateCache.get(templateName)!;
  }

  const templatePath = path.join(this.templatesDir, templateName);
  
  try {
    const content = fs.readFileSync(templatePath, &#39;utf-8&#39;);
    this.templateCache.set(templateName, content);
    return content;
  } catch (error) {
    throw new Error(`Failed to load template ${templateName}: ${error}`);
  }
}
</code></pre>
<ul>
<li>This function minimizes I/O operations by caching templates.</li>
<li>Errors during file loading are caught, ensuring stability.</li>
<li>Templates are dynamically resolved using <code class="inline-code">path.join</code>, enabling modular organization.</li>
</ul>
<hr>
<pre><code class="language-typescript">private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;
  
  for (const [key, value] of Object.entries(variables)) {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, &#39;g&#39;), value || &#39;&#39;);
  }
  
  return result;
}
</code></pre>
<ul>
<li>Iterates over provided variables to replace placeholders within template content.</li>
<li>Emphasizes modularity; dynamic injection of quest-specific details is achieved through this function.</li>
<li>Uses regex patterns to ensure all placeholder occurrences are replaced.</li>
</ul>
<hr>
<pre><code class="language-typescript">renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  
  const pageVariables = {
    ...variables,
    CONTENT: renderedContent
  };
  
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>Combines modular templates like a foundation and a quest‚Äôs specific content into cohesive HTML pages.</li>
<li>Promotes reusability through placeholder injection into both layout and content templates.</li>
<li>Demonstrates strategy for thematically combining multiple templates.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> Dynamic Adventure Generation</h3>
<p>The <code class="inline-code">HTMLAdventureGenerator</code> weaves thematic quests via the Pyramid‚Äôs map. A key feature is <code class="inline-code">buildQuestHTML</code>, which dynamically constructs quest pages with navigation between adventures, ensuring consistency in design and structure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code> serves as the entry point for orchestrating the codebase analysis and generating the quest system.</li>
<li><code class="inline-code">buildQuestHTML</code> integrates quest-specific content and navigation elements into complete HTML pages.</li>
<li><code class="inline-code">startHttpServer</code> enables local previews by setting up a server for generated adventures.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">async generateAdventure(): Promise&lt;void&gt; {
  console.log(chalk.yellow.bold(&#39;üöÄ Generating Adventure...&#39;));
  
  console.log(chalk.dim(&#39;üìä Analyzing codebase...&#39;));
  const repomixContent = await repoAnalyzer.generateRepomixContext(this.projectPath);
  const projectInfo = createProjectInfo(repomixContent);

  console.log(chalk.dim(&#39;‚ú® Generating themed story and quests...&#39;));
  const storyContent = await this.adventureManager.initializeAdventure(
    projectInfo, 
    this.selectedTheme, 
    this.projectPath,
    this.customThemeData
  );

  this.extractQuestInfo();

  console.log(chalk.dim(&#39;üñºÔ∏è Copying images...&#39;));
  this.copyImages();

  console.log(chalk.dim(&#39;üìù Creating main adventure page...&#39;));
  this.generateIndexHTML();

  console.log(chalk.dim(&#39;üìñ Generating quest pages...&#39;));
  await this.generateQuestPages();

  console.log(chalk.dim(&#39;üéâ Creating adventure summary page...&#39;));
  await this.generateSummaryHTML();
}
</code></pre>
<ul>
<li>Combines repository analysis, story generation, and asset management into a cohesive adventure pipeline.</li>
<li>Illustrates workflow orchestration, ensuring all quest components are generated efficiently.</li>
<li>Modular design allows adaptation to different themes or customizations.</li>
</ul>
<hr>
<pre><code class="language-typescript">private buildQuestHTML(quest: QuestInfo, content: string, questIndex: number): string {
  const prevQuest = questIndex &gt; 0 ? this.quests[questIndex - 1] : null;
  const nextQuest = questIndex &lt; this.quests.length - 1 ? this.quests[questIndex + 1] : null;

  let bottomNavigation = &#39;&#39;;
  const isLastQuest = questIndex === this.quests.length - 1;
  
  if (prevQuest || nextQuest || isLastQuest) {
    let navClass = &#39;quest-navigation quest-navigation-bottom&#39;;
    const hasCompleteButton = isLastQuest;
    
    if (prevQuest &amp;&amp; nextQuest) {
      // Default layout
    } else if (prevQuest &amp;&amp; !nextQuest &amp;&amp; !hasCompleteButton) {
      navClass += &#39; nav-prev-only&#39;;
    } else if (!prevQuest &amp;&amp; nextQuest) {
      navClass += &#39; nav-next-only&#39;;
    }

    bottomNavigation += `
      &lt;div class=&quot;${navClass}&quot;&gt;
        ${prevQuest ? `&lt;a href=&quot;${prevQuest.filename}&quot; class=&quot;prev-quest-btn&quot;&gt;‚Üê Previous&lt;/a&gt;` : &#39;&#39;}
        ${nextQuest ? `&lt;a href=&quot;${nextQuest.filename}&quot; class=&quot;next-quest-btn&quot;&gt;Next ‚Üí&lt;/a&gt;` : &#39;&#39;}
        ${isLastQuest ? `&lt;a href=&quot;summary.html&quot; class=&quot;next-quest-btn complete-btn&quot;&gt;Complete Adventure ‚Üí&lt;/a&gt;` : &#39;&#39;}
      &lt;/div&gt;`;
  }

  const variables = {
    ...this.getCommonTemplateVariables(),
    QUEST_CONTENT: this.formatMarkdown(content),
    BOTTOM_NAVIGATION: bottomNavigation
  };

  return this.templateEngine.renderPage(&#39;quest-template.html&#39;, variables);
}
</code></pre>
<ul>
<li>Dynamically constructs quest pages, incorporating quest content and navigation links.</li>
<li>Shows adaptability for varied navigation configurations (e.g., previous/next).</li>
<li>Highlights modularity by integrating templates and dynamic variables.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> Reliability in Asset Management</h3>
<p>The <code class="inline-code">AssetManager</code> safeguards the Pyramid‚Äôs treasures by ensuring all assets, such as images and CSS files, are copied to their appropriate locations. Its focus on global assets supports multi-theme adventures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyQuestNavigator</code> orchestrates copying of navigation-specific CSS, JS, and SVG assets.</li>
<li><code class="inline-code">copyGlobalAssets</code> handles shared image and header file distribution across themes.</li>
<li><code class="inline-code">copyImages</code> ensures precise placement of theme-specific images for single adventures.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/asset-manager.ts</h3>
<pre><code class="language-typescript">copyGlobalAssets(outputDir: string): void {
  try {
    const globalAssetsDir = path.join(outputDir, &#39;assets&#39;);
    const targetImagesDir = path.join(globalAssetsDir, &#39;images&#39;);
    fs.mkdirSync(targetImagesDir, { recursive: true });

    const globalSharedDir = path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;);
    fs.mkdirSync(globalSharedDir, { recursive: true });
    
    const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
    globalImages.forEach(file =&gt; {
      const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
      if (fs.existsSync(sourcePath)) {
        const targetPath = path.join(globalSharedDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      }
    });

    const headerImageSource = path.join(this.sourceDir, &#39;assets&#39;, &#39;images&#39;, &#39;ai-adventures.png&#39;);
    if (fs.existsSync(headerImageSource)) {
      const headerImageTarget = path.join(targetImagesDir, &#39;ai-adventures.png&#39;);
      fs.copyFileSync(headerImageSource, headerImageTarget);
    }
  } catch (error) {
    console.log(chalk.yellow(&#39;‚ö†Ô∏è Warning: Could not copy global images&#39;));
  }
}
</code></pre>
<ul>
<li>Handles copying of essential shared assets, reducing redundancy in multi-theme adventures.</li>
<li>Error handling ensures graceful fallback if assets cannot be copied.</li>
<li>Supports cohesive branding through shared images like repository icons.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Compare the implementation patterns in <code class="inline-code">HTMLAdventureGenerator</code> for handling quests to <code class="inline-code">TemplateEngine</code> for processing templates‚Äîthey both rely on modular assembly.</li>
<li>Consider the error handling in <code class="inline-code">AssetManager</code>‚Äîhow might caching (seen in <code class="inline-code">TemplateEngine</code>) further improve reliability?</li>
<li>Explore how different components integrate theme-specific functionality to maintain consistency across quests.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Hark, valiant scholar‚Äîby traversing the sacred threshold of the Pyramid‚Äôs Map Room, thou hast unveiled the first jewel of wisdom upon thy noble quest, igniting a beacon of triumph within the temple of ancient mysteries! üíéüó∫Ô∏è‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>