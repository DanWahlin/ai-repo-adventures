<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Keystone of Themes - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Forgotten Codex: Deciphering the Artifacts of the Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Keystone of Themes</h1>
<hr>
<p>Through tangled vines of syntax and towering structures of interconnected ideas, you come upon the First Temple of Creation‚Äîthe ancient birthplace of the tools that weave narratives from lines of code. Within its quiet chambers, the Keystone of Themes pulses with an ethereal light, rumored to hold fragments of forgotten craftsmanship techniques. By understanding the foundational stones of this sanctuary, adventurers might unlock the way to bridging creativity with coding logic, casting their efforts into the annals of legendary development. The temple doors creak open‚Äîrevealing treasures linked to tools of transformation.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>This file houses the mighty <code class="inline-code">RepoAdventureServer</code> class, the keeper of the temple gates. Its role is to transform ancient interactions into a scalable and gamified experience through the MCP protocol. The <code class="inline-code">setupHandlers()</code> method brings intelligence to the server, enabling it to dynamically list tools and execute them with error handling‚Äîa metaphorical map for adventurers seeking the sacred Keystone. The <code class="inline-code">run()</code> method activates the server using a <code class="inline-code">StdioServerTransport</code>, connecting the world of coded logic to the adventurer‚Äôs journey. Its preliminary caching of repomix content is akin to sharpening tools before embarking on the quest. Lastly, within the <code class="inline-code">main()</code> function lies the sacred initiation ritual. It prepares for the inevitable chaos of interrupted adventures, guarding the temple‚Äôs sanctity with structured shutdown procedures and resilience against unruly errors.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers()</code> registers handlers to guide adventurers through tool listing and usage.</li>
<li><code class="inline-code">RepoAdventureServer.run()</code> connects the server to <code class="inline-code">stdio</code>, paving the path for accessible interactions.</li>
<li><code class="inline-code">main()</code> orchestrates graceful shutdowns, ensuring the stability of the adventurer&#39;s journey.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tool Entry Point</h3>
<p>Inside this file lies the foundation of four sacred tools‚Äîartifacts that shape the adventurer&#39;s experience as they explore quests. Each tool serves a purpose: <code class="inline-code">start_adventure()</code> examines repositories to recommend themes; <code class="inline-code">choose_theme()</code> generates tailored narratives; <code class="inline-code">explore_quest()</code> enables in-depth exploration of challenges; and <code class="inline-code">view_progress()</code> provides the clarity of completion metrics. The tools collectively empower adventurers to navigate their journey through interactive storytelling, transforming mundane code exploration into rituals of discovery. With imports like <code class="inline-code">adventureManager</code>, the file ensures that rituals are imbued with sacred wisdom, centralizing the treasure vaults of story-driven adventure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code> introduces repository analysis to awaken the adventurer‚Äôs potential.</li>
<li><code class="inline-code">choose_theme.handler</code> creates tailored journeys based on user preferences.</li>
<li><code class="inline-code">explore_quest.handler</code> turns code analysis into progressive exploration with challenge validation.</li>
<li><code class="inline-code">view_progress.handler</code> completes the cycle by displaying achievements and pending tasks.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
        const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
            name,
            description: tool.description,
            inputSchema: zodToJsonSchema(tool.schema, { 
                target: &#39;jsonSchema7&#39;,
                $refStrategy: &#39;none&#39;
            })
        }));

        return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
        try {
            const { name, arguments: args } = request.params;

            if (!(name in tools)) {
                throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
            }

            const tool = tools[name as keyof typeof tools];
            
            const validationResult = tool.schema.safeParse(args);
            if (!validationResult.success) {
                const errorMessages = validationResult.error.issues.map((err) =&gt; 
                    `${err.path.join(&#39;.&#39;)}: ${err.message}`
                ).join(&#39;, &#39;);
                throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
            }

            return await tool.handler(validationResult.data as any);
        } catch (error) {
            if (error instanceof McpError) {
                throw error;
            }
            throw new McpError(
                ErrorCode.InternalError,
                `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
            );
        }
    });
}
</code></pre>
<p>Like a temple guide greeting adventurers, this method directs explorers to tools and validates their offerings before wisdom can be shared.</p>
<hr>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { adventureManager } from &#39;@ai-repo-adventures/core/adventure&#39;;
import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export const tools = {
    start_adventure: startAdventure,
    choose_theme: chooseTheme,
    explore_quest: exploreQuest,
    view_progress: viewProgress
};
</code></pre>
<p>This collection of imports gathers sacred tools into one area, like the symbolic altar of the Keystone itself, ready to empower adventurers.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Before executing quests, review <code class="inline-code">setupHandlers()</code> to understand how tools are registered and validated for use.</li>
<li>Customize the themes by exploring <code class="inline-code">choose_theme.handler()</code> to align story narratives with project goals.</li>
<li>Dive into <code class="inline-code">view_progress.handler()</code> periodically to measure milestones and refine your journey.</li>
</ul>
<hr>
<p>Hail, seeker of wisdom, for thou hast unraveled the sacred threads of Quest 1: The Keystone of Themes‚Äîthine journey is but begun, yet destiny&#39;s ancient tapestry unfolds before thee with luminous promise! ‚≠ê‚ö°üó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Storyweaver‚Äôs Workshop ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>