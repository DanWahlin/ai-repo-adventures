<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Temple of Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Lost Codex of the Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Temple of Tools</h1>
<hr>
<p>Beneath a brooding sky of amber sands, the adventurers press forward to the mysterious Temple of Tools, an ancient sanctuary hidden deep within the desert’s heart. Carved with glyphs of arcane constructs and cryptic instructions, the temple is believed to hold the Nexus of Knowledge, a repository to summon and master tools as the ancients once did. Their task—decode the glyphs and reignite the forgotten mechanisms—to unlock the temple&#39;s secrets and prove themselves worthy of its unparalleled wisdom.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server protocol implementation that hosts the adventure tools</h3>
<p>This file serves as the foundation for the <code class="inline-code">RepoAdventureServer</code>, which functions as the gateway to the Temple of Tools. Like a ritual master, it establishes the protocol for interaction, determines the tools available to the user, and manages communications. The <code class="inline-code">setupHandlers()</code> method within the <code class="inline-code">RepoAdventureServer</code> class is especially important, as it dynamically registers tools and validates input parameters using schemas, ensuring only properly encoded prayers are sent to the temple’s mechanisms. The <code class="inline-code">run()</code> method is responsible for connecting the <code class="inline-code">StdioServerTransport</code> and performing preemptive tasks like pre-generating repomix content, akin to dusting off ancient maps before embarking on exploration. The <code class="inline-code">main()</code> function is the ceremonial entry point, orchestrating graceful shutdowns and ensuring uninterrupted connectivity.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code>: Registers MCP protocol handlers for tools and validates parameters with Zod schemas.</li>
<li><code class="inline-code">RepoAdventureServer.run</code>: Prepares the environment by connecting <code class="inline-code">StdioServerTransport</code> and warming up repomix content.</li>
<li><code class="inline-code">main</code>: Acts as the entry point, ensuring smooth startup and graceful shutdown.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The 4 main MCP tools that provide the user interface to the adventure system</h3>
<p>This file is the Temple’s altar of offerings, housing the tools that allow adventurers to interact with the ancient narrative. A central piece here is the exportable <code class="inline-code">tools</code> object, which defines the four main tools: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. Each tool comes with a defined handler that links the physical world to fantastical realms by enabling actions like initiating adventures and progressing through quests. The code also re-exports the <code class="inline-code">adventureManager</code>, a keeper of ancient states and progress tracking. By compartmentalizing these tools, the temple ensures maintainability and modularity, much like splitting sacred texts into scrolls for easier study.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Launches analysis of the repository and presents options for the adventure setting.</li>
<li><code class="inline-code">choose_theme.handler</code>: Constructs a user-selected narrative and themed challenges for interaction.</li>
<li><code class="inline-code">explore_quest.handler</code>: Administers specific tasks for advancing through the overarching quest.</li>
<li><code class="inline-code">view_progress.handler</code>: Tracks the pilgrim’s journey, displaying triumphs and challenges yet to be faced.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  private server: Server;

  constructor() {
    this.server = new Server(
      {
        name: &#39;repo-adventure&#39;,
        version: &#39;1.0.0&#39;,
        description: &#39;A gamified MCP server for exploring code repositories through interactive storytelling&#39;
      },
      {
        capabilities: {
          tools: {},
        },
      }
    );

    this.setupHandlers();
  }

  private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, {
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        // Validate arguments using the tool&#39;s Zod schema
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        // Execute the tool handler with validated arguments
        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
  }
}
</code></pre>
<p>Just as the high priests of old would validate and process offerings in sacred ceremonies, this method ensures tools are properly prepared and validated before they can be invoked.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This structure is akin to a traveler’s pack, where each tool is a neatly organized item ready to be used for specific challenges and environments.</p>
<h2>Helpful Hints</h2>
<ul>
<li>When deciphering the <code class="inline-code">setupHandlers()</code> function, notice how the Zod schemas safeguard the tools’ usage, much like a protective spell written to ward off misuse.</li>
<li>Refactoring the tools into their modular definitions (e.g., <code class="inline-code">start_adventure</code> and <code class="inline-code">choose_theme</code>) allows smoother enhancements to features as the adventure system evolves.</li>
<li>To delve deeper, explore how the <code class="inline-code">adventureManager</code> and <code class="inline-code">RepoAnalyzer</code> coordinate in setting up repository context for quests.</li>
</ul>
<hr>
<p>Hark, seeker of sacred knowledge, thou hast unlocked the venerable mysteries of the Temple of Tools—let thy spirit ascend, for this is but the dawn of thy ⭐ storied journey!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Pyramid of Quests →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>