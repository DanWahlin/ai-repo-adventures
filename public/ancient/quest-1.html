<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Pyramid of Storycraft - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Seekers of the Codex</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Pyramid of Storycraft</h1>
<hr>
<p>In the heart of the Great Jungle of Codexia, thick vines partly obscure the entrance to an imposing pyramid. The Pyramid of Storycraft, constructed centuries ago by the ancient scholars, is said to house the secrets of interactive narrative generation. As you step into the sacred halls, faint carvings on the stone walls depict a complex web of HTML generators, asset systems, and templating engines. To unravel the truths encoded within these walls and awaken the Codebase, you must decipher the rituals of adventure creation.</p>
<p>Beware - while the knowledge here gleams like treasure, one misstep in the ancient engineering could collapse your entire static site pipeline. Carry your wits and tools like an archaeologist probing the depths of a lost world.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Ritual of Rendering</strong>: How does the <code class="inline-code">TemplateEngine.renderPage</code> combine a base template and dynamic content to create cohesive HTML pages?</li>
<li>‚ö° <strong>Asset Pilgrimage</strong>: How does the <code class="inline-code">AssetManager.copyGlobalAssets</code> efficiently organize and distribute necessary assets across themes and global templates?</li>
<li>üõ°Ô∏è <strong>Sacred Server Paths</strong>: What mechanisms in <code class="inline-code">HTMLAdventureGenerator.startHttpServer</code> ensure safe and correct file handling, preventing forbidden access or misdirected routing?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> Template Rendering Rituals</h3>
<p>The <code class="inline-code">TemplateEngine</code> handles the fundamental task of converting templates and variables into functioning HTML pages. It provides an abstraction to load, cache, and dynamically replace placeholders within templates. Understanding this file reveals how modular templating allows for the extensibility of the code generation pipeline.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadTemplate</code>: Caches and retrieves templates from the filesystem for reuse, ensuring efficiency in the rendering process.</li>
<li><code class="inline-code">replacePlaceholders</code>: Substitutes placeholders in a template with dynamic variables to generate customized content.</li>
<li><code class="inline-code">renderPage</code>: Combines a content-specific template with a base template, dynamically injecting variables to create complete HTML pages.</li>
</ul>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> The Keeper of Assets</h3>
<p>The <code class="inline-code">AssetManager</code> ensures that all required assets, such as images, shared files, and theme-specific elements, are placed correctly within the output structure. Its role is critical for organizing and maintaining the integrity of the generated site.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyGlobalAssets</code>: Gathers and places shared resources (e.g., global images, CSS) in a consolidated location across themes and quests.</li>
<li><code class="inline-code">copyQuestNavigator</code>: Copies navigational files to theme-specific and root directories, ensuring seamless movement between quests.</li>
<li><code class="inline-code">copyImages</code>: Manages the copying of theme-specific and shared images to appropriate directories within the output.</li>
</ul>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> The Storyweaver</h3>
<p>The <code class="inline-code">HTMLAdventureGenerator</code> orchestrates the entire pipeline, coordinating themes, templates, and assets. Beyond generating the site, it also includes an embedded server for previewing the results locally.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code>: Orchestrates the generation of HTML pages and assets for a single theme, organizing quests and summary pages.</li>
<li><code class="inline-code">generateAllThemes</code>: Enables parallel generation of multiple themes, leveraging shared assets for efficiency across outputs.</li>
<li><code class="inline-code">startHttpServer</code>: Provides a local server for testing the generated site, with safeguards against directory traversal and forbidden file access.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">private loadTemplate(templateName: string): string {
  if (this.templateCache.has(templateName)) {
    return this.templateCache.get(templateName)!;
  }
  const templatePath = path.join(this.templatesDir, templateName);
  try {
    const content = fs.readFileSync(templatePath, &#39;utf-8&#39;);
    this.templateCache.set(templateName, content);
    return content;
  } catch (error) {
    throw new Error(`Failed to load template ${templateName}: ${error}`);
  }
}
</code></pre>
<ul>
<li>Uses a caching mechanism (<code class="inline-code">templateCache</code>) to avoid redundant file I/O operations.</li>
<li>Implements error handling to prevent pipeline breakdown during template loading.</li>
<li>Centralizes template access logic, ensuring a consistent base for all rendering.</li>
</ul>
<hr>
<pre><code class="language-typescript">private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;
  for (const [key, value] of Object.entries(variables)) {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, &#39;g&#39;), value || &#39;&#39;);
  }
  return result;
}
</code></pre>
<ul>
<li>Dynamically replaces placeholders (e.g., <code class="inline-code">{{key}}</code>) with provided values, allowing flexible content injection.</li>
<li>Uses a <code class="inline-code">RegExp</code> to handle multiple instances of the same placeholder.</li>
<li>Ensures undefined variables default to empty strings to prevent rendering errors.</li>
</ul>
<hr>
<pre><code class="language-typescript">renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  const pageVariables = {
    ...variables,
    CONTENT: renderedContent
  };
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>First renders the content template before injecting it into the base page structure, enabling multi-layered templating.</li>
<li>Ensures clean separation between layout (base template) and content (specific template).</li>
<li>Embodies the principle of composition, allowing reusable and modular HTML structure creation.</li>
</ul>
<hr>
<h3>packages/generator/src/cli/asset-manager.ts</h3>
<pre><code class="language-typescript">copyGlobalAssets(outputDir: string): void {
  try {
    const globalAssetsDir = path.join(outputDir, &#39;assets&#39;);
    const targetImagesDir = path.join(globalAssetsDir, &#39;images&#39;);
    fs.mkdirSync(targetImagesDir, { recursive: true });
    const globalSharedDir = path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;);
    fs.mkdirSync(globalSharedDir, { recursive: true });
    const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
    globalImages.forEach(file =&gt; {
      const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
      if (fs.existsSync(sourcePath)) {
        const targetPath = path.join(globalSharedDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      }
    });
  } catch (error) {
    console.log(chalk.yellow(&#39;‚ö†Ô∏è Warning: Could not copy global images&#39;));
  }
}
</code></pre>
<ul>
<li>Focuses on creating directory structures for shared and global assets.</li>
<li>Handles edge cases gracefully, logging warnings to indicate partial success if files are inaccessible.</li>
<li>Promotes redundancy reduction by consolidating assets into shared directories.</li>
</ul>
<hr>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">private async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
  const server = http.createServer((req, res) =&gt; {
    let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);
    if (!filePath.startsWith(this.outputDir)) {
      res.writeHead(403);
      res.end(&#39;Forbidden&#39;);
      return;
    }
    fs.readFile(filePath, (err, content) =&gt; {
      if (err) {
        res.writeHead(err.code === &#39;ENOENT&#39; ? 404 : 500);
        res.end(err.code === &#39;ENOENT&#39; ? &#39;File not found&#39; : &#39;Server error&#39;);
      } else {
        res.writeHead(200, { &#39;Content-Type&#39;: this.getContentType(filePath) });
        res.end(content, &#39;utf-8&#39;);
      }
    });
  });
  await new Promise&lt;void&gt;((resolve) =&gt; server.listen(port, resolve));
}
</code></pre>
<ul>
<li>Includes guards against directory traversal by verifying file paths relative to <code class="inline-code">outputDir</code>.</li>
<li>Differentiates between <code class="inline-code">404</code> (file not found) and <code class="inline-code">500</code> (server error) responses for clearer debugging.</li>
<li>Provides MIME-type handling to serve a variety of files correctly.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Pro Tip</strong>: Modify the <code class="inline-code">base-template.html</code> file to add thematic customizations across all generated pages while retaining modular flexibility.</li>
<li><strong>Exploration Idea</strong>: Investigate how <code class="inline-code">copyQuestNavigator</code> and <code class="inline-code">copyImages</code> enable seamless navigation and unified visual aesthetics in multi-theme generation workflows.</li>
<li><strong>Next Step</strong>: Venture deeper into quest generation by exploring how adventures are organized into structured flows.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Behold, intrepid seeker, thou hast unlocked the sacred hieroglyphs of Storycraft&#39;s pyramid, a triumph worthy of celestial accolades‚Äîjourney forth as the ancient stars illuminate thy path! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>