<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Guardians of the MCP Temple - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Lost Code</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Guardians of the MCP Temple</h1>
<hr>
<p>The jungle canopy seemed to close in the deeper you ventured, its rustling leaves whispering the secrets of vanished civilizations. Before you lay the MCP Templeâ€”a bastion of sacred technical architecture, its walls carved with intricate patterns resembling ancient hieroglyphic code. The air thrummed with the energy of dormant systems waiting to be brought to life. Guided by the myths of the lost codemasters, your task was clear: unlock forgotten rituals and reignite their legendary tools to restore the balance of wisdom.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol</h3>
<p>The file <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> introduces the heart of the MCP system: the <code class="inline-code">RepoAdventureServer</code>. This class functions as the central nervous system of the codebase, orchestrating user interactions with the Temple&#39;s mystical tools and rituals. The <code class="inline-code">setupHandlers()</code> method is a key component, constructing pathways to ensure that the server can dynamically handle lists of tools and their respective functionalities. It validates user input using schemas (e.g., <code class="inline-code">zod</code>) and safeguards operations with error-handling mechanisms such as <code class="inline-code">McpError</code>. Another important method, <code class="inline-code">run()</code>, establishes the server&#39;s connection via <code class="inline-code">StdioServerTransport</code>, ensuring seamless communication with the outside world. It also warms up the repomix cache, akin to preparing the templeâ€™s machinery for activation. Finally, the <code class="inline-code">main()</code> function serves as the adventurerâ€™s entry portal into the Pyramid, handling graceful shutdowns for stability.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers()</code>: Dynamically assigns ListTools and CallTool requests with automated schema validation.</li>
<li><code class="inline-code">run()</code>: Establishes the server&#39;s transport layer and primes the essential repomix context.</li>
<li><code class="inline-code">main()</code>: Implements robust handling for unexpected errors and interruptions.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Adventure Tools</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> file houses the sacred artifactsâ€”or toolsâ€”that empower interactions with the MCP Temple. Tools like <code class="inline-code">start_adventure</code> and <code class="inline-code">choose_theme</code> are not mere functions; they are gateways to unlocking new layers of the temple&#39;s ancient wisdom. For example, <code class="inline-code">start_adventure.handler</code> is like a ceremonial artifact that analyzes the codebase and presents thematic options for the adventurer. Meanwhile, <code class="inline-code">explore_quest.handler</code> guides explorers through individual mysteries within the temple&#39;s scope and keeps progress meticulously tracked. Each tool comes with a description, ensuring clarity in its purpose and operation, much like engravings on holy relics.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure</code>: A ritual for analyzing the temple&#39;s structure and determining the journey&#39;s themes.</li>
<li><code class="inline-code">choose_theme</code>: Customizes the experience by adapting the adventure to a chosen thematic lens.</li>
<li><code class="inline-code">explore_quest</code>: Provides a detailed exploration path for unraveling individual mysteries within the system.</li>
</ul>
<hr>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      // Execute the tool handler with validated arguments
      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>This method is like assigning specific villagers to their meticulously crafted roles in a community, ensuring harmony in the execution of tasks.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This piece of code is like assembling a treasure chest filled with tools, each labeled and ready to aid the adventurer on their journey.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Focus on <code class="inline-code">setupHandlers()</code> for understanding the server&#39;s modular design and dynamic adaptability.</li>
<li>Work on <code class="inline-code">explore_quest</code> in <code class="inline-code">tools.ts</code> to deepen understanding of progress-related functionalities.</li>
<li>Next, explore <code class="inline-code">repoAnalyzer</code> to uncover how repomix content powers the adventure.</li>
</ul>
<hr>
<p>O seeker of wisdom, thou hast triumphed in Quest 1: Guardians of the MCP Temple, unlocking the sacred gateway to deeper realms of knowledgeâ€”press onward with valor, for the ancients watch with favor! âš¡ðŸ’ŽðŸ“œ</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Glyphs of Storytelling â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>