<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Deciphering the Tablet of Interface - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Sacred Chronicles of the Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Deciphering the Tablet of Interface</h1>
<hr>
<p>In the heart of the Temple of Code lies the hallowed Tablet of Interface, an artifact bridging the world of adventurers with the sacred tools of ancient wisdom. Interpreted by the enigmatic Scrolls of Adventure, the tablet holds the key to activating rituals encoded within the temple&#39;s core. As the chosen archaeologist, you must study the inscriptions and unlock this ancient wisdom. Beware ‚Äì only those who master the intricate scripts of the Tablet&#39;s interface can fully honor its secrets.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> Core Server Rituals</h3>
<p>This file is the blueprint for the Temple&#39;s sacred communication hub, the <code class="inline-code">RepoAdventureServer</code>. It serves as the main gateway for those who seek the sanctified tools. Here, three critical rites ‚Äì handler setup, server execution, and graceful shutdown ‚Äì are performed within the server‚Äôs ritual chamber. The <code class="inline-code">setupHandlers</code> function creates dynamic interactions with its tools, allowing the tablet&#39;s guardians to unveil their capabilities. Meanwhile, the <code class="inline-code">run</code> function establishes a sacred channel, enabling the server to connect via the <code class="inline-code">StdioServerTransport</code>, while also invoking the temple&#39;s repository analysis. Lastly, the <code class="inline-code">main</code> function initiates the flow of ancient energies, ensuring harmony in unexpected disruptions.</p>
<h4>Highlights</h4>
<ul>
<li>The <code class="inline-code">setupHandlers</code> function for defining sacred tool registration.</li>
<li>The <code class="inline-code">run</code> function for initiating the ritual of server execution.</li>
<li>The <code class="inline-code">main</code> function for conducting the overall invocation sequence.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      // Execute the tool handler with validated arguments
      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>This is where the chosen tools are summoned by name and their offerings requested. Missteps in the invocation yield warnings from the sacred guardians.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  // Pre-generate repomix content for the current working directory to warm up the cache
  // This happens in the background while waiting for user commands
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>The energy of the temple is channeled through the sacred transporter, establishing a connection where future rituals will unfold.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    
    // Handle graceful shutdown for both signals
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    
    // Handle unhandled promise rejections - log but don&#39;t shutdown during normal operation
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
      // Don&#39;t call gracefulShutdown() here as it may be a recoverable error
    });
    
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>Here, the main invocation not only brings the temple to life but ensures that disturbances, such as ungraceful interferences, are handled with reverence.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Review the schema handlers in <code class="inline-code">setupHandlers</code> for creating new tools.</li>
<li>Explore transport initialization in <code class="inline-code">run</code> to connect to the Temple&#39;s encoded outputs.</li>
<li>Understand the signals handled in <code class="inline-code">main</code> for crafting fail-safe processes.</li>
</ul>
<hr>
<p>The inscriptions shimmer as the Tablet of Interface activates. Your deciphering efforts awaken the tools from the temple&#39;s depths, ready to impart their ancient wisdom. The adventure unravels...</p>
<p>Hail, seeker of wisdom! Through the sacred unraveling of the Tablet of Interface, thou hast awakened ancient insights‚Äîthy journey begins anew with the light of the stars to guide thee forth! ‚≠ê‚ö°üó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: Harnessing the Story Glyphs ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>