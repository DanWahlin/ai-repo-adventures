<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Secrets of the Eternal Archive - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Codex of the Lost Civilization</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Secrets of the Eternal Archive</h1>
<hr>
<p>In an ancient jungle, veiled by time&#39;s relentless grip, a treasure of unmeasured worth lies in wait‚Äîthe Eternal Archive. This sacred trove, shrouded in myths, is believed to hold the Codex of the Lost Civilization. Encoded across fragmented glyphs and ancient artifacts, the Codex possesses the profound ability to decipher chaos and distill structured wisdom. Venturing into forgotten temples, you embark on your first journey: piecing together splinters of forgotten knowledge. Here, the foundational mechanisms of digital storytelling are whispered through the hushed halls.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Mechanism of Glyph Unveiling</strong>: How does the <code class="inline-code">renderPage</code> function in the template engine integrate content and templates to produce dynamic outputs?</li>
<li>‚ö° <strong>Codex Integration Mystery</strong>: What processes in <code class="inline-code">generateAdventure</code> bind together code analysis, templating, and asset distribution to build a coherent static site?</li>
<li>üõ°Ô∏è <strong>Rituals of Safeguard</strong>: How are errors or exceptions managed during critical operations like copying assets or rendering pages in the respective modules?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> Dynamic Fusion of Templates and Content</h3>
<p>This file houses the <code class="inline-code">TemplateEngine</code> class, responsible for loading cached templates and replacing placeholders with contextual content. It enables the generation of structured HTML pages from raw lexical ingredients.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadTemplate</code>: Handles template caching and ensures rapid reusability while safely managing I/O exceptions.</li>
<li><code class="inline-code">replacePlaceholders</code>: Processes templates by substituting dynamic keys with corresponding values, forming the basis of content-to-template binding.</li>
<li><code class="inline-code">renderPage</code>: Calls the above two methods to weave content templates into a base structure (like merging glyphs into a unified codex).</li>
</ul>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> The Ritual of Site-Building</h3>
<p>This file contains the heart of the static site generator, encapsulated in <code class="inline-code">HTMLAdventureGenerator</code>. It orchestrates all components‚Äîtemplate rendering, thematic assembly, and asset distribution‚Äîto produce a cohesive interactive experience.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code>: Constructs the entire site, relying on templating, storytelling logic, and asset copying to create the primary adventure.</li>
<li><code class="inline-code">generateAllThemes</code>: Oversees the concurrent generation of sites for multiple themes, organizing them into modular subdirectories.</li>
<li><code class="inline-code">startHttpServer</code>: Facilitates the local distribution of generated content, ensuring accessibility for interactive experiences.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">private loadTemplate(templateName: string): string {
  if (this.templateCache.has(templateName)) {
    return this.templateCache.get(templateName)!;
  }

  const templatePath = path.join(this.templatesDir, templateName);
  try {
    const content = fs.readFileSync(templatePath, &#39;utf-8&#39;);
    this.templateCache.set(templateName, content);
    return content;
  } catch (error) {
    throw new Error(`Failed to load template ${templateName}: ${error}`);
  }
}
</code></pre>
<ul>
<li>This function relies on a caching mechanism (<code class="inline-code">templateCache</code>) to optimize performance.</li>
<li><code class="inline-code">fs.readFileSync</code> handles disk I/O, with error handling wrapping exceptions for robustness.</li>
<li>Paths are dynamically resolved to prevent hardcoding, supporting flexible template management.</li>
</ul>
<pre><code class="language-typescript">private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;
  for (const [key, value] of Object.entries(variables)) {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, &#39;g&#39;), value || &#39;&#39;);
  }
  return result;
}
</code></pre>
<ul>
<li>Uses regular expressions to robustly locate template placeholders like <code class="inline-code">{{PLACEHOLDER}}</code>.</li>
<li>Iterates through all passed variables for maximum flexibility, ensuring templates remain universal.</li>
<li>Ensures empty variables default to blank, preventing unwanted artifacts in output.</li>
</ul>
<pre><code class="language-typescript">renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  const pageVariables = { ...variables, CONTENT: renderedContent };
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>Anchored on a two-tier approach, it first renders content independently, then integrates it into a base template.</li>
<li>Supports hierarchical rendering via <code class="inline-code">CONTENT</code> injection.</li>
<li>Consolidates multiple smaller methods, reinforcing modularity and readability.</li>
</ul>
<hr>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">async generateAdventure(): Promise&lt;void&gt; {
  console.log(chalk.yellow.bold(&#39;üöÄ Generating Adventure...&#39;));
  console.log(chalk.dim(&#39;üìä Analyzing codebase...&#39;));
  const repomixContent = await repoAnalyzer.generateRepomixContext(this.projectPath);
  const projectInfo = createProjectInfo(repomixContent);

  console.log(chalk.dim(&#39;‚ú® Generating themed story and quests...&#39;));
  const storyContent = await this.adventureManager.initializeAdventure(projectInfo, this.selectedTheme, this.projectPath, this.customThemeData);
  this.saveLlmOutput(&#39;story.output.md&#39;, storyContent);

  console.log(chalk.dim(&#39;üé® Creating theme styling...&#39;));
  this.generateThemeCSS();

  console.log(chalk.dim(&#39;üß≠ Adding quest navigator...&#39;));
  this.copyQuestNavigator();

  console.log(chalk.dim(&#39;üñºÔ∏è Copying images...&#39;));
  this.copyImages();

  console.log(chalk.dim(&#39;üìñ Generating quest pages...&#39;));
  await this.generateQuestPages();
}
</code></pre>
<ul>
<li>Sequentially orchestrates site generation, interweaving analysis, narrative processing, and templating.</li>
<li>Tracks progress with meaningful console logs throughout major steps.</li>
<li>Saves intermediate outputs like <code class="inline-code">story.output.md</code> for debugging or logging purposes.</li>
</ul>
<pre><code class="language-typescript">async generateAllThemes(args: Map&lt;string, string&gt;): Promise&lt;void&gt; {
  console.log(chalk.green(&#39;‚úÖ Generating all themes&#39;));
  this.isMultiTheme = true;
  const themes: AdventureTheme[] = [&#39;space&#39;, &#39;mythical&#39;, &#39;ancient&#39;, &#39;developer&#39;];
  const themePromises = themes.map(async (theme) =&gt; {
    const themeGenerator = new HTMLAdventureGenerator();
    themeGenerator[&#39;selectedTheme&#39;] = theme;
    await themeGenerator.generateAdventure();
  });

  await Promise.allSettled(themePromises);
}
</code></pre>
<ul>
<li>Manages multi-theme generation, encapsulating each theme in isolated subdirectories.</li>
<li>Combines parallelized promises via <code class="inline-code">Promise.allSettled</code> for time efficiency and failure handling.</li>
<li>Demonstrates modularity by instantiating independent generators per theme.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üå± <strong>Tip</strong>: The <code class="inline-code">template-engine.ts</code> file is like the ancient codices it emulates‚Äîreuse is key. The <code class="inline-code">templateCache</code> prevents repetitive reads.</li>
<li>üß≠ <strong>Explore</strong>: Consider the error-handling mechanisms at play in <code class="inline-code">html-generator.ts</code>&#39;s promise-oriented methods.</li>
<li>üîë <strong>Next</strong>: Traverse to the next chapter to uncover the secrets of overlaying thematic styles across the adventure artifact.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>By the sacred luminescence of the Eternal Archive&#39;s wisdom, thou hast unveiled its secrets and emerged as a true seeker of ancient truths‚Äîonward to further glories, noble traveler! ‚≠êüó∫Ô∏èüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>