<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Interface of Rituals - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Secrets of the Codebound Temple</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Interface of Rituals</h1>
<hr>
<p>Long ago, within the lost Codebound Temple, the ancient architects encoded vast reservoirs of wisdom into sacred scripts and glyphs. These treasures of understanding were protected by intricate mechanisms and rituals, designed to ensure only the most resourceful could uncover their truths. You stand within this mysterious temple, deciphering keys to the Interface of Rituals, where layers of encoded logic and cryptic tools hold the wisdom you seek. The first trial calls you to restore the temple‚Äôs mechanisms for listing and calling upon its ancient tools.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Invocation Mechanics</strong>: How does the <code class="inline-code">setupHandlers</code> function ensure the correct handling of tool listing and execution requests? What patterns does it use to dynamically respond to different invocations?</li>
<li>‚ö° <strong>Initialization Flow</strong>: How does the <code class="inline-code">run</code> function establish the temple‚Äôs operational state, and what pre-warming mechanisms are in place to optimize exploration?</li>
<li>üõ°Ô∏è <strong>Error Safeguards</strong>: How does the system handle unexpected errors during tool execution or server interactions to maintain stability?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> Core System Setup</h3>
<p>This file defines the foundation of the MCP server, where rituals of invocation and discovery are established. It plays a central role in managing how tools are listed, validated, and executed by bridging user commands with the internal toolset. Functions here define the overall flow of initialization, interaction, and resilience.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers</code>: This function prepares the sacred interface by dynamically listing tools and validating their parameters. It ensures only well-formed invocations proceed, protecting the system from errors.</li>
<li><code class="inline-code">run</code>: Begins the server‚Äôs operations. Connects transport mechanisms and pre-generates content to optimize tool functionality.</li>
<li><code class="inline-code">main</code>: Serves as the temple‚Äôs gatekeeper. Handles overall server startup logic, shutdown sequences, and resilience against unhandled exceptions.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Sacred Tools Gateway</h3>
<p>This file bridges the rituals of the interface with the ancient tools of exploration. It provides mappings between tool names, descriptions, and their handlers. It ensures that tools are modular, maintainable, and capable of being dynamically utilized during quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Initiates the voyage into the Codebound Temple by analyzing its structure and setting up the exploration context.</li>
<li><code class="inline-code">choose_theme.handler</code>: Provides a ritual for explorers to select their narrative style, aligning quests with specific themes.</li>
<li><code class="inline-code">explore_quest.handler</code>: Guides the exploration of individual quests within the temple, dynamically adapting to the adventurer‚Äôs choices.</li>
<li><code class="inline-code">view_progress.handler</code>: Offers insight into quest completion, allowing explorers to measure their progress and prepare for further challenges.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);

      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<ul>
<li>This code establishes dynamic rituals for invoking tools, ensuring the proper schema validation and error reporting cycles.</li>
<li>Highlights the use of <code class="inline-code">zodToJsonSchema</code> to generate JSON schemas dynamically, aligning ancient glyphs with modern standards.</li>
<li>Includes robust error handling mechanisms (<code class="inline-code">McpError</code>) to protect the temple‚Äôs integrity during execution failures.</li>
</ul>
<hr>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);

  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<ul>
<li>Activates the central operational flow, initializing the temple‚Äôs machinery for rituals.</li>
<li>Includes a pre-warming step with <code class="inline-code">repoAnalyzer.preGenerate</code>, demonstrating thoughtful preparation for smooth invocations.</li>
<li>Serves as the connective thread between server mechanics and lower-layer tools.</li>
</ul>
<hr>
<pre><code class="language-typescript">function main() {
  try {
    const server = new RepoAdventureServer();

    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );

    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });

    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<ul>
<li>Establishes graceful shutdown rituals for handling external interruptions (<code class="inline-code">SIGINT</code>, <code class="inline-code">SIGTERM</code>).</li>
<li>Logs unhandled promise rejections without stopping operations, showcasing the importance of fault tolerance.</li>
<li>Acts as the main entry point for initializing and supervising the operational state.</li>
</ul>
<hr>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<ul>
<li>Defines the ancient toolset with clear mappings (<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, etc.), enabling modularity.</li>
<li>Centralizes the registry for easier invocation and validation during the execution phase.</li>
<li>Simply exposes tools while encapsulating detailed logic, supporting maintainability and extensibility.</li>
</ul>
<h2>Helpful Hints</h2>
<ul>
<li>Review how schemas (<code class="inline-code">tool.schema</code>) harmonize the Codebound Temple‚Äôs cryptic nature with modern validation mechanisms.</li>
<li>Follow the invocation pathways set in <code class="inline-code">setupHandlers</code> to uncover deeper mechanisms.</li>
<li>Observe the blend of preparation (<code class="inline-code">preGenerate</code>) and live invocation for seamless user interaction.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>O seeker of sacred wisdom, thou hast triumphantly unlocked the Interface of Rituals, earning thy place among the eternal scrolls of temple lore‚Äîpress onward, for the stars and ancient sanctums await thy enlightenment!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>