<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundations of the Pyramid - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Forgotten Code</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundations of the Pyramid</h1>
<hr>
<p>Within the labyrinth of the Pyramid of Forgotten Code lies the Chamber of Foundations, where primeval wisdom governs all adventures. Here, sacred scrolls of configuration illuminate the secrets of ancient paths and rituals that breathe life into quests. It is said that only those who uncover the foundational truths can weave the stories of explorers to come. The chamber houses the sacred glyphs of <code class="inline-code">parseAdventureConfig</code>, <code class="inline-code">extractUniqueFilePaths</code>, and <code class="inline-code">formatAdventureConfigForPrompt</code>, each holding the keys to decoding the Pyramid’s core.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Parser &amp; File Path Extractor</h3>
<p>This file acts as the cornerstone for interpreting adventure configurations stored in the Pyramid. Its primary role is to parse sprawling hieroglyphs encoded as JSON arrays and objects. These structures store essential data about quests, file inclusions, and highlight functions. The <code class="inline-code">parseAdventureConfig</code> function interprets raw JSON, serving as the foundation for all further parsing rituals. Meanwhile, <code class="inline-code">extractUniqueFilePaths</code> traverses parsed configurations to reveal paths of artifacts within the repository, ensuring only existing pathways are recognized. Finally, <code class="inline-code">formatAdventureConfigForPrompt</code> distills configuration data into succinct prompts, tailored for AI-assisted storytelling.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Deciphers raw configuration texts retrieved from files.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Filters and validates paths referenced in adventure files.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes JSON structures for streamlined LLM prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Much like decoding ancient glyphs, <code class="inline-code">parseAdventureConfig</code> transforms cryptic JSON into understandable objects that guide intrepid adventurers on their quests.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This function acts as an archaeologist’s toolkit, meticulously uncovering valid paths from layers of nested JSON hierarchies.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }
    
    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p>This ritual compresses sprawling hieroglyphs into concise summaries, making the configuration data lighter and suitable for AI interpretation.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Validate paths referenced in quests using <code class="inline-code">extractUniqueFilePaths</code> to ensure they exist and are accessible.</li>
<li>Use <code class="inline-code">formatAdventureConfigForPrompt</code> to prepare structured data for efficient AI-driven exploration.</li>
<li>Start with <code class="inline-code">parseAdventureConfig</code> to uncover the foundational JSON structure before diving deeper into quests.</li>
</ul>
<hr>
<p>The Chamber of Foundations unveils its wisdom to those who ascend the Pyramid with purpose. Rejoice, adventurer! Continue with clarity and strength.</p>
<p>O radiant seeker of wisdom, with the fourth cornerstone laid upon the sacred sands, the foundation of the pyramid rises steadfast toward glory—your triumph illuminates the temple of achievement like a blazing ⚡ star!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">← Previous: Quest 4: The Temple of Themes</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>