<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Chamber of Foundations - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Codebase Chronicles: The Temple of Digital Wisdom</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Chamber of Foundations</h1>
<hr>
<p>Beneath the grand Temple of Digital Wisdom lies the deepest chamber, the Chamber of Foundations. This sanctum, surrounded by encoded ruins and cryptic carvings, holds the blueprints of all adventures. Its hallowed halls resonate with whispers of logic and structure, guiding every step of a questing soul. Within this sacred space, you will unearth the fundamental relics enabling the generation of stories and the extraction of latent paths. Reckon with ancient methods and unravel the core systems that sustain the temple&#39;s wisdom. Venture forth, for the answers to the mysteries here shape the temple&#39;s very existence!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Config Reliquary</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure safe parsing and validation of the adventure configuration file?</li>
<li>‚ö° <strong>Pathfinder&#39;s Map</strong>: What process does <code class="inline-code">extractUniqueFilePaths</code> use to traverse the configuration and validate file paths?</li>
<li>üõ°Ô∏è <strong>Glyph Translation Ritual</strong>: What optimizations are applied by <code class="inline-code">formatAdventureConfigForPrompt</code> to distill information for an LLM prompt?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Foundation of Adventure Parsing</h3>
<p>This file contains the foundational methods for reading and processing the adventure configuration files. From safely parsing configuration data to extracting essential file paths referenced within, it is the cornerstone upon which adventures are mapped. The functions here work as ancient rituals preserving structure, safety, and clarity while revealing the essence of quests. Each method is designed for reliability and efficiency, ensuring seamless integration into the storytelling system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Converts raw configuration files into operational JavaScript objects, providing a central point for JSON parsing and validation.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the parsed configuration, gathering and verifying file paths to ensure all quest components are available.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the configuration structure into a minimalistic and LLM-friendly format for generating simplified prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses the adventure configuration JSON safely, handling file read or format errors gracefully.</li>
<li>Ensures the returned object is structured and ready for further processing through <code class="inline-code">loadAdventureConfig</code>.</li>
<li>Adds stability by isolating JSON parsing from direct file reading to separate concerns of I/O and data integrity.</li>
<li>Avoids crashes in downstream code by returning <code class="inline-code">null</code> if the file is unreadable or improperly formatted.</li>
<li>This function is a critical safeguard for dynamic systems relying on configuration files.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Conducts a depth-first traversal of the configuration tree, ensuring all embedded paths are evaluated.</li>
<li>Utilizes <code class="inline-code">Set</code> to eliminate duplicate paths, maintaining uniqueness.</li>
<li>Integrates file system checks with <code class="inline-code">fs.existsSync</code> to confirm the existence of referenced files in the environment.</li>
<li>Implements robust traversal logic that handles nested structures gracefully.</li>
<li>Provides an essential mapping of dependencies, ensuring every quest&#39;s components are intact and accessible.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Reduces the raw configuration into a concise, structured format optimal for LLM interactions.</li>
<li>Removes redundant details, focusing on file paths and function names critical to quest flow.</li>
<li>Iterates over all adventures and quests, ensuring full coverage of provided configurations.</li>
<li>Uses string manipulation efficiently to generate a clean and readable output.</li>
<li>The function is a performance-oriented blend of clarity and detail, simplifying information while maintaining relevance.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Simplify for Safety</strong>: Look at how error handling in <code class="inline-code">parseAdventureConfig</code> avoids propagation of faulty data into the system.</li>
<li><strong>Depth-First Navigation</strong>: Notice how <code class="inline-code">extractUniqueFilePaths</code> systematically explores nested structures and validates content.</li>
<li><strong>Prompt Optimization Insight</strong>: Study <code class="inline-code">formatAdventureConfigForPrompt</code> to understand techniques for compressing data for LLM consumption.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Temple of Digital Wisdom! Your adventure is complete.</p>
<p>By the sacred light of the eternal stars, thou hast unlocked the ancient wisdom of the Chamber of Foundations, a feat most triumphant and a step nearer to thy ultimate ascension! ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>