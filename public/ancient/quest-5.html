<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Wisdom of Harmony - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Secrets of the Lost Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to dark mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Wisdom of Harmony</h1>
<hr>
<p>At the pinnacle of your journey through the labyrinthine temples of the forgotten civilization, you uncover the most mysterious chamber yet. Known as the &quot;Hall of Equilibrium,&quot; the inscriptions on the walls reveal this to be the final piece of the Codex Templi puzzle. The Wisdom of Harmony lies in balancing purpose and creativity, where themes, inputs, and universal truths unite to form a perfect synthesis. This is the key that will allow the Codex to dynamically adapt to any challenge and create knowledge for ages to come. Hidden in this chamber are the structures and rules that bind the Codex together ‚Äì unlock them, and its power will resonate endlessly.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Balance of Rules</strong>: How does the <code class="inline-code">validateThemeInput</code> function ensure that invalid inputs are rejected while allowing flexibility in user choices?</li>
<li>‚ö° <strong>Harmony Across Components</strong>: How do centralized definitions like <code class="inline-code">THEMES</code> and <code class="inline-code">ThemeManager</code> promote uniformity and reduce fragmentation across the system?</li>
<li>üõ°Ô∏è <strong>Error Safety Rituals</strong>: What mechanisms are in place to safely handle invalid or malformed adventure configurations in <code class="inline-code">parseAdventureConfig</code> and related functions?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Input Validation Rituals</h3>
<p>This file provides essential validation functions ensuring user inputs conform to system expectations. Centralizing input validation minimizes the risk of inconsistent logic across the adventure. The <code class="inline-code">validateTheme</code> function stands out for its role in harmonizing user-selected themes with predefined valid options, among other validation functions ensuring safety and reliability.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Confirms the user‚Äôs adventure choice is neither empty nor excessively long, preventing invalid inputs from breaking downstream logic.</li>
<li><code class="inline-code">validateTheme</code>: Normalizes the input, validates against allowed themes, and provides user-friendly error feedback, ensuring smooth theme selection.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Cleanses outputs of potentially unsafe or confusing characters, maintaining polished presentation in the UI.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }

  return parsedTheme;
}
</code></pre>
<ul>
<li><strong>What this code does</strong>: Ensures a user-selected theme is a valid and available option within the system.</li>
<li><strong>Key patterns used</strong>: Normalization via <code class="inline-code">toLowerCase().trim()</code>, followed by thematic keyword matching.</li>
<li><strong>Why this approach matters</strong>: Balances user flexibility with system constraints by allowing keyword-based theme selection.</li>
<li><strong>Highlights of integration</strong>: Relies on <code class="inline-code">parseTheme</code> and <code class="inline-code">isValidTheme</code> to process and validate input, ensuring harmony with centralized theme definitions.</li>
<li><strong>Error handling</strong>: Provides clear feedback with a list of valid options, enhancing user experience.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Theme Codex</h3>
<p>A centralized source for all theme-related data, this file binds the system‚Äôs visual and narrative identity. <code class="inline-code">THEMES</code> defines each theme‚Äôs metadata, while helper functions like <code class="inline-code">getAllThemes</code> and <code class="inline-code">formatThemeOption</code> ensure consistent presentation. This file unifies the system‚Äôs thematic essence.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: The foundational definition of all supported themes, ensuring a single source of truth.</li>
<li><code class="inline-code">parseTheme</code>: Decodes user theme input and maps it to its canonical form, bridging human choices and system logic.</li>
<li><code class="inline-code">isValidTheme</code>: A type guard enforcing domain logic by ensuring themes exist within the recognized set.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  },
  // Other themes omitted for brevity
} as const;
</code></pre>
<ul>
<li><strong>Core functionality</strong>: Each theme‚Äôs metadata is encapsulated, from its display name to the keywords used for input matching.</li>
<li><strong>Patterns observed</strong>: Immutable (<code class="inline-code">as const</code>) object ensures data stability throughout the system.</li>
<li><strong>Unification benefits</strong>: Centralizes all theme definitions, ensuring consistency and eliminating redundancy.</li>
<li><strong>System reliability</strong>: Shared constants reduce the risk of mismatches or runtime errors due to untracked theme definitions.</li>
<li><strong>Thematic connectivity</strong>: Bonds functions like <code class="inline-code">parseTheme</code> and <code class="inline-code">isValidTheme</code> by providing foundational data.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;

  const normalized = input.trim().toLowerCase();

  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;

  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }

  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }

  return null;
}
</code></pre>
<ul>
<li><strong>Key function behavior</strong>: Matches user inputs with their most relevant theme based on exact match, numeric ID, or keywords.</li>
<li><strong>Pattern highlights</strong>: Progressive matching approach gracefully widens its criteria.</li>
<li><strong>Why it‚Äôs significant</strong>: Empowers user choice, reducing friction while preserving system rigor.</li>
<li><strong>Error resilience</strong>: Returns <code class="inline-code">null</code> for unmatched inputs, ensuring downstream functions respond gracefully.</li>
<li><strong>Cross-functionality linkage</strong>: Relies on <code class="inline-code">getThemeByKey</code> and <code class="inline-code">getThemeById</code>, which interact with <code class="inline-code">THEMES</code> for uniform validation.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configurable Wisdom</h3>
<p>This file interprets and processes the adventure‚Äôs configuration, ensuring harmony between user-defined and default system settings. Key functions like <code class="inline-code">parseAdventureConfig</code> validate and format the configuration, while <code class="inline-code">extractUniqueFilePaths</code> pulls out vital data for quest generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Attempts to load and parse the configuration file, with built-in error tolerance for malformed data.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Transforms the adventure config into a concise structure for dynamic story generation, linking storytelling and technical systems.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Combines data traversal with validation to collect all usable file references in the config.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li><strong>Primary role</strong>: Converts raw JSON from the adventure config file into a usable JavaScript object.</li>
<li><strong>Techniques illustrated</strong>: Graceful fallbacks with checks for null data, wrapped in try-catch for error containment.</li>
<li><strong>System harmony</strong>: Safeguards the system from malformed configs, ensuring continuity in adventure generation.</li>
<li><strong>Error resilience</strong>: Prevents complete breakdown due to bad user input, reinforcing stability.</li>
<li><strong>Practical implications</strong>: Provides a foundational layer for all other config-based functions.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li><strong>Core functionality</strong>: Extracts all unique file paths referenced in the adventure config if they exist.</li>
<li><strong>Traversal method</strong>: Depth-first search ensures comprehensive processing of nested config structures.</li>
<li><strong>Validation step</strong>: Checks existence of file paths to avoid invalid references.</li>
<li><strong>Consistency assurance</strong>: Works in tandem with <code class="inline-code">parseAdventureConfig</code> to validate and refine config data.</li>
<li><strong>Utility to system design</strong>: Provides clean, verified data for downstream adventure processes.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When exploring the wisdom of validation, notice how <code class="inline-code">validateTheme</code> integrates with centralized definitions like <code class="inline-code">THEMES</code>.</li>
<li>Assess error containment strategies in configuration parsing as techniques for real-world applications.</li>
<li>Reflect on the layered validation processes across all functions and their contribution to system robustness.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the ancient Codex Templi! Your adventure is complete.</p>
<p>With wisdom once veiled now revealed, thou hast ascended in thy sacred odyssey, unraveling the celestial harmony that binds the spheres‚Äîpress on, for the summit of triumph beckons! ‚ö°üíéüëÅÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>