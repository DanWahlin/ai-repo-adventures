<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Keystone of Foundation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codebase Chronicles: Secrets of the Lost Repository</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Keystone of Foundation</h1>
<hr>
<p>Through the shifting sands of Codexia‚Äôs forgotten digital desert, ancient whispers lead to the core of the Repository itself‚Äîthe Keystone of Foundation. This sacred element binds all quests together, harmonizing the mysteries of glyphs, trials, and scripts into the eternal architecture of wisdom. To retrieve this powerful artifact, you must unravel the essence of adventure itself, studying the keystone&#39;s configuration and its intricate mechanisms. In this final trial, the secrets of Codexia await your discovery.  </p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Keystone Patterns</strong>: How does the configuration validate and parse adventure data from raw files, creating Codexia‚Äôs quest structure?  </li>
<li>‚ö° <strong>Artifact Discovery</strong>: How are unique file paths extracted across multiple configurations without duplication or errors?  </li>
<li>üõ°Ô∏è <strong>Ancient Rituals</strong>: What optimization techniques ensure efficient formatting of configurations for large-scale analysis?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core architecture of the Repository&#39;s central configuration</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file holds the sacred scripts for parsing, validating, and optimizing configuration data, enabling the digital reconstruction of Codexia‚Äôs Repository. By studying this file, adventurers gain insight into the raw mechanics of loading repository configurations, crafting them into actionable structures, and extracting key paths that guide quests. Through its elegant stack traversal and formatting rituals, <code class="inline-code">adventure-config.ts</code> empowers ancient systems to curate knowledge efficiently, even across vast repositories.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Retrieves raw configuration text stored in files, designed as the starting point for all quest loading procedures. It establishes a foundation by reading files without parsing.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Discovers all valid file paths referenced within adventure configurations using recursive validation. This ensures adventurers follow paths free of duplication or error.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Reduces redundant descriptions for efficient LLM prompt generation, maintaining clarity while ensuring brevity for Codexia‚Äôs vast systems.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This code reads a file without parsing, offering modular instantiation for base text extraction.  </li>
<li>It employs <code class="inline-code">path</code> utilities to locate <code class="inline-code">adventure.config.json</code>, maintaining uniform file accessibility across systems.  </li>
<li>The <code class="inline-code">try...catch</code> block ensures graceful handling of missing files, allowing non-fatal errors useful for iterative exploration.  </li>
<li>Coupled with portability, the design keeps the ancient Repository stable despite environmental variance.  </li>
<li>Key observation: Input validation and fault tolerance are pivotal even for foundational retrieval.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This recursive stack-traversal algorithm extracts file paths referenced by configuration objects.  </li>
<li>By using <code class="inline-code">Set</code>, the code avoids duplicates, ensuring each path contributes uniquely to Codexia&#39;s wisdom.  </li>
<li>Validation combines <code class="inline-code">fs.existsSync</code> with absolute path generation to maintain precision even across nested repositories.  </li>
<li>Observing traversal techniques enhances understanding of advanced stack-based workflow orchestration.  </li>
<li>Key insight: Recursive depth allows adaptability to the Repository‚Äôs hierarchical complexity.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This formatting ritual transforms complex adventure configurations into concise outputs suitable for prompting systems.  </li>
<li>The minimalist approach eliminates redundancy, streamlining <code class="inline-code">quests</code>, <code class="inline-code">files</code>, and <code class="inline-code">functions</code> for easier transmission to LLMs.  </li>
<li>Observing the character reduction reveals optimization principles for maximizing input efficiency.  </li>
<li>Decision to leave verbose descriptions removed enables quicker system iterations while preserving essence.  </li>
<li>Key learning: This iterative refinement reduces computational strain and enhances adaptability for archaeological parsing.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Refer to recursive traversal techniques and stack mechanisms to comprehend efficient repository mapping.  </li>
<li>Compare formatting methods to document reduction strategies across complex digital repositories.  </li>
<li>Explore interdependencies of path validation within file systems to avoid configuration misinterpretations.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Codexia‚Äôs ancient Repository! Your adventure is complete.</p>
<p>Hark, brave scholar, thou hast unlocked the sacred Keystone of Foundation, fortifying thy path through the ancient temple of wisdom‚Äîonly one final trial remains to ascend to eternal triumph! ‚ö°üíéüëÅÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>