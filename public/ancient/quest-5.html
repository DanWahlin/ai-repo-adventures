<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundation Chamber - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codebase Labyrinth: Secrets of the Ancient Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundation Chamber</h1>
<hr>
<p>The Repository Labyrinth is a testament to the Codex Scribes&#39; ingenuity, and its design speaks to a wisdom predating kingdoms. Hidden deep within is the fabled Foundation Chamber, a sanctum said to contain the instructions that bind the Repository&#39;s machinery together. This quest takes you to the core of the ancient system itself. Your challenge is to understand the mechanisms operating within the Repository‚Äôs foundation through its &quot;adventure-config,&quot; deciphering how the codices may have governed their enigmatic scripts. Beware‚Äîonly those who perceive the patterns beneath the surface will prevail in uncovering the truths concealed here.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Codex Structural Secrets</strong>: How does <code class="inline-code">parseAdventureConfig</code> leverage JSON parsing to extract configuration data, and how are errors gracefully handled during this process? </li>
<li>‚ö° <strong>Path Discovery Ritual</strong>: What patterns in <code class="inline-code">extractUniqueFilePaths</code> allow it to iterate through complex nested data structures and validate file paths effectively? </li>
<li>üõ°Ô∏è <strong>Config Optimization Enigma</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> efficiently condense complex adventure configurations for use in LLMs, and what safeguards are in place to ensure data integrity?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Sacred stewardship of repository configurations</h3>
<p>This file serves as a pillar of the Repository Labyrinth, detailing how configuration files are read, parsed, and formatted. Each function is a mechanism in the great machinery, decoding ancient configurations into actionable structures. By examining how configuration paths are validated and processed, adventurers unlock insights into maintaining the labyrinth&#39;s integrity. Pay particular attention to the interplay of methods that ensure data read from the labyrinth‚Äôs hieroglyphs (file paths) is both accurate and useful for downstream interpretations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: A vital function for reading and validating JSON-based configurations.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts and validates file paths referenced within adventure data structures using a depth-first approach.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Generates a compact representation of configuration data tailored for optimal comprehension.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Much like decrypting a fragile papyrus, this function carefully reads JSON data from configuration files, shielding the system from errors by returning <code class="inline-code">null</code> when issues arise.</p>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>Like an archaeologist sifting through sediment layers, this iterative function walks through nested structures to unearth valid file paths‚Äîensuring only treasures that truly exist on the filesystem become part of the journey.</p>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~1,763 characters (76% reduction)
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths - LLM can see descriptions in actual code
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
    
    // Just function names - LLM can understand purpose from implementation
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }
    
    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p>This function acts as a scribe, condensing sprawling configurations into a compact, legible format‚Äîa ritual of efficiency, ensuring clarity without sacrificing complexity.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <code class="inline-code">parseAdventureConfig</code> function to identify how input errors are handled for critical files.</li>
<li>Observe the iterative stack-based pattern in <code class="inline-code">extractUniqueFilePaths</code> to understand its depth-first traversal mechanism.</li>
<li>Review how <code class="inline-code">formatAdventureConfigForPrompt</code> balances verbosity against succinct data transmission for LLM prompts.</li>
</ul>
<hr>
<p>With a clearer understanding of the Repository‚Äôs foundation, you are prepared to venture deeper into labyrinthine chambers. Onward, truth seeker!</p>
<p>With sacred zeal and tempered wisdom, thou hast unlocked the hallowed Foundation Chamber, the penultimate pillar of thy storied journey‚Äîpress on, oh seeker of ancient truths, for triumph ripens like the golden starfire of dawn!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>