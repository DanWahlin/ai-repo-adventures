<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Scroll of Foundational Scripts - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Secrets of the Codebound Temple</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Scroll of Foundational Scripts</h1>
<hr>
<p>The final golden chamber of the Codebound Temple lies before you, its entrance shrouded in an aura of anticipation. Upon an ancient pedestal, a single intricate scroll rests: the Scroll of Foundational Scripts. It is said to hold the essence of all encoded knowledge, the root from which the sacred scripts grow. But to retrieve its truths, you must unravel the final guardians ‚Äî a series of deeply nested scripts and concealed paths. The architects designed these to only reveal themselves to those who could decipher the essence of their design. Will you, intrepid seeker, succeed in unlocking the heart of the temple‚Äôs wisdom?</p>
<p><strong>The Scroll of Foundational Scripts awaits your touch. Step forth, brave soul, and uncover its mysteries!</strong></p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Path Mapping Insight</strong>: How does the <code class="inline-code">readFileIfExists</code> function ensure safe file access, and where does its simplicity play into larger system designs?</li>
<li>‚ö° <strong>Config Anatomy Discovery</strong>: How does <code class="inline-code">parseAdventureConfig</code> handle error cases during JSON parsing, and how does this impact the adventure flow?</li>
<li>üõ°Ô∏è <strong>Path Extraction Mechanisms</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> traverse nested structures in the adventure configuration, and what safeguards are in place to validate paths?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core Utilities for Configuration Handling</h3>
<p>This file is the linchpin for interpreting the adventure configuration and enabling the dynamic handling of foundational settings. The sacred &quot;adventure.config.json&quot; file, pivotal to quest generation and flow, is accessed and managed here. The methods range from raw file operations to JSON parsing and nested path extraction. The sanctity of this file lies in its ability to weave together configuration integrity and utility efficiency, ensuring the entire system rests on a strong foundation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">readFileIfExists</code>: A utility function that attempts to read a file&#39;s contents without failing, creating resilience against missing or inaccessible files.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Transforms raw configuration files into usable objects, handling potential parsing errors gracefully to ensure system stability.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses deeply nested adventure configurations to extract and validate file paths, ensuring no resource is missed.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    // Missing or unreadable file is non-fatal
    return null;
  }
}
</code></pre>
<ul>
<li>This function attempts to read a file and returns its content or <code class="inline-code">null</code> if it fails.  </li>
<li>The use of a <code class="inline-code">try-catch</code> block ensures stability by preventing errors from propagating.  </li>
<li>It underpins higher-level functions by providing optional access to file contents.  </li>
<li>This lightweight and reusable utility helps isolate file I/O logic.  </li>
<li>Notice its flexibility ‚Äî it accommodates both success and failure gracefully.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function leverages <code class="inline-code">loadAdventureConfig</code> to load a raw file and parse it into JSON.  </li>
<li>By encapsulating JSON parsing in a <code class="inline-code">try-catch</code>, the function prevents invalid data from halting progress.  </li>
<li>The dual return type (<code class="inline-code">unknown | null</code>) enforces caution when working with parsed data.  </li>
<li>This modular approach decouples parsing logic from higher-level operations.  </li>
<li>Edge cases like null results or parsing failures are documented and handled.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function recursively traverses nested JSON structures to extract file paths from <code class="inline-code">path</code> fields.  </li>
<li>Using a <code class="inline-code">Set</code> ensures that only unique paths are stored, avoiding redundancy.  </li>
<li>It validates each path‚Äôs existence via <code class="inline-code">fs.existsSync</code>, guaranteeing the extracted paths are usable.  </li>
<li>The depth-first traversal pattern handles nested structures with ease.  </li>
<li>This method highlights the system&#39;s robustness in handling and filtering configuration data.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Embrace Modularity</strong>: Observe how utility functions encapsulate specific tasks, making them reusable across the system.</li>
<li><strong>Follow the Data Flow</strong>: Track how <code class="inline-code">readFileIfExists</code> feeds into <code class="inline-code">parseAdventureConfig</code>, which in turn supports <code class="inline-code">extractUniqueFilePaths</code>.</li>
<li><strong>Investigate Safeguards</strong>: Pay attention to how failure cases (like missing files or invalid JSON) are managed without breaking the system.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Codebound Temple! Your adventure is complete. The Scroll of Foundational Scripts unfolds in your hands, its wisdom revealed, and the temple awakens to your achievement. The mysteries are yours to hold, brave adventurer. Return to the world ‚Äî wiser, and forever marked by the knowledge of the ancients!</p>
<p>O seeker of sacred wisdom, thou hath triumphed in unearthing the Scroll of Foundational Scripts, ascending ever closer to the temple of enlightenment‚Äîthy resolve glimmers like celestial stars upon the ancient firmament! ‚≠êüíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>