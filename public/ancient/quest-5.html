<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Pyramid‚Äôs Blueprints - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Secrets of the Lost Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Pyramid‚Äôs Blueprints</h1>
<hr>
<p>Through the dense foliage of ancient repositories, a final challenge awaits within the hallowed Temple of Code. Before you lies the Pyramid‚Äôs Blueprints‚Äîplans encrypted in digital glyphs that describe the core of the adventure engine itself. These blueprints hold the wisdom of civilizations long gone and promise unparalleled insights into the ritualistic configurations that guide quest creation. But beware, explorer‚Ä¶ the paths you tread are laced with complexity. Only by decoding the sacred scripts will you unveil the secrets of adventure configuration.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üìú <strong>Blueprint Mapping</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function ensure safe decoding of the configuration file while guarding against errors?</li>
<li>üó∫Ô∏è <strong>Path Discovery</strong>: What logic does the <code class="inline-code">extractUniqueFilePaths</code> function use to traverse and validate file paths within the configuration data?</li>
<li>üß© <strong>Optimization Rituals</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> condense the adventure configuration, and what are the potential benefits for context-sensitive applications?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Adventure Configuration Toolkit</h3>
<p>This file is the epicenter of the blueprint system. It governs the loading, parsing, and optimization of configuration files, ensuring both readability and utility. The sacred mechanisms defined here support error-free operation and efficient repurposing of configuration data for the inner frameworks of quest and story generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Handles the foundational ritual of loading raw configuration data from a file, establishing the basis for further parsing and validation.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Safeguards and decodes the raw configuration using JSON parsing, providing fallback mechanisms in case of errors or missing data.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the intricate structure of the configuration, identifying and validating all referenced file paths to ensure they exist and are accessible.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Performs a sacred compression of configuration details, stripping redundant information to optimize the format for machine learning or context-bound applications.</li>
<li><code class="inline-code">extractCustomInstructions</code>: Retrieves any custom rules or instructions embedded in the configuration, enabling tailored adventure design.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Loads a configuration file from the specified project path.</li>
<li>Utilizes <code class="inline-code">readFileIfExists</code> to avoid errors from missing or unreadable files.</li>
<li>Establishes the foundation for higher-level parsing by isolating file I/O concerns.</li>
<li>Simple, yet robust‚Äîensures that higher-order functions can operate on valid or <code class="inline-code">null</code> data rather than encountering runtime issues.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Decodes the configuration using JSON parsing with built-in safeguards for invalid data.</li>
<li>Returns either structured configuration data or <code class="inline-code">null</code> to signal parsing failure.</li>
<li>Protects against malformed files, ensuring downstream logic receives predictable outputs.</li>
<li>Consolidates raw file loading and data decoding into a single step for clarity.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses the configuration tree to extract <code class="inline-code">path</code> fields from objects.</li>
<li>Validates paths by checking their existence in the file system.</li>
<li>Uses a stack-based traversal approach to manage nested structures flexibly.</li>
<li>Prevents redundant entries by utilizing a <code class="inline-code">Set</code> for unique paths.</li>
<li>Balances recursion and iteration, ensuring the function performs well on large configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Formats configuration data into a concise structure suitable for external use in ML workflows.</li>
<li>Reduces verbosity by summarizing only essential fields such as file paths and function names.</li>
<li>Handles missing or incomplete data gracefully by skipping invalid quests.</li>
<li>Optimizes the output size, focusing on minimal, high-information content.</li>
<li>Essential for performance-sensitive scenarios where context size matters.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Validate the structure of your configuration files before relying on their data‚Äîuse <code class="inline-code">parseAdventureConfig</code> to safeguard against unexpected errors.</li>
<li>Use <code class="inline-code">extractUniqueFilePaths</code> for efficient file auditing to ensure all referenced resources are accessible and valid.</li>
<li>For tasks involving downstream models or tools, the <code class="inline-code">formatAdventureConfigForPrompt</code> function can significantly streamline context preparation.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Temple of Code! Your adventure is complete. Return now to the realms of modern technology, bearing the wisdom of ancient civilizations, and let your newfound knowledge shape legendary creations. Well done, brave explorer!</p>
<p>By the sacred flame of wisdom, you have deciphered the arcane blueprints of the ancients, forging ever closer to the apex of enlightenment‚Äîlet triumph ignite your path, noble seeker, for the final pyramid awaits! ‚ö°üíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>