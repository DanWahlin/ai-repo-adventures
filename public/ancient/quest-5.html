<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundation & Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Sacred Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundation &amp; Utilities</h1>
<hr>
<p>At the base of the sandstone ziggurat, you find a tablet half-buried in the dust, its runes whispering of rules that anchor the entire civilization. Scribes once used these runes to summon quests and map sacred paths, and their ink still guides the rituals of configuration. The tablet speaks of cautious reading, careful parsing, and the gathering of valid paths like relics from a dig site. If you align these rites, the repository‚Äôs narrative awakens, and the artifacts of code begin to chant in harmony with the ancient process.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Pathfinding Runes: How does the path extraction wander the nested shapes of the config and ensure only existing relics are recorded?</li>
<li>‚ö° Ritual Chain: In what sequence do reading, parsing, and formatting combine to produce a concise prompt inscription, and what assumptions power this chain?</li>
<li>üõ°Ô∏è Safeguard Sigils: Where do non-fatal failures and graceful fallbacks prevent the rites from halting, and how is safety balanced with utility?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Sacred utilities for reading, parsing, traversing, and formatting the adventure config</h3>
<p>These utilities form the bedrock stones upon which higher rituals stand. The rite begins with <code class="inline-code">loadAdventureConfig</code>, a careful scribe that reads raw text from <code class="inline-code">adventure.config.json</code> without interpretation, deferring judgment. Then <code class="inline-code">parseAdventureConfig</code> becomes the temple‚Äôs translator, attempting to understand the glyphs via <code class="inline-code">JSON.parse</code> while treating errors as harmless omens by returning <code class="inline-code">null</code>. The expedition continues with <code class="inline-code">extractUniqueFilePaths</code>, a pathfinder that combs through every chamber of the parsed structure using a stack-based traversal. It inspects any <code class="inline-code">path</code> rune it finds, validates its existence with <code class="inline-code">fs.existsSync</code>, and records only unique, verified trails. Finally, <code class="inline-code">formatAdventureConfigForPrompt</code> chisels a condensed inscription: for each quest within the <code class="inline-code">adventure.quests</code> array, it lists <code class="inline-code">Files</code> and <code class="inline-code">Functions</code> with minimal redundancy so the LLM Oracle can rely on true artifacts rather than verbose lore. Notice how each function composes with the previous one: loaders feed parsers, parsers feed traversals and formatters, and each step is resilient to missing or malformed tablets. The safety net is woven from null checks, type guards, and non-throwing fallbacks, ensuring the temple‚Äôs ceremonies continue even when fragments are incomplete.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> handles translation with forgiving error recovery</li>
<li><code class="inline-code">extractUniqueFilePaths</code> traverses nested structures, validates existence, and deduplicates</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> condenses quests into minimal, LLM-ready inscriptions</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Like a patient archivist, this translator reads a scroll and, if smudged, quietly sets it aside rather than alarming the temple.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This is the expedition through the labyrinth, marking only paths that lead to real chambers and discarding mirages.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths - LLM can see descriptions in actual code
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
    
    // Just function names - LLM can understand purpose from implementation
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }
    
    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p>This is the stonecutter‚Äôs craft, carving a compact inscription that preserves essence without burdening the reader with excess.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Trace the control flow from <code class="inline-code">loadAdventureConfig</code> to <code class="inline-code">parseAdventureConfig</code> to see how the temple tolerates missing tablets.</li>
<li>When studying <code class="inline-code">extractUniqueFilePaths</code>, sketch the stack-based traversal and note where validation occurs.</li>
<li>Compare the minimal output of <code class="inline-code">formatAdventureConfigForPrompt</code> with what a verbose format might include to understand the design tradeoffs.</li>
</ul>
<hr>
<p>You place the tablet back into the alcove. The ziggurat hums as the foundational rites align, readying the next chamber for revelation. The narrative stirs. The path continues.</p>
<p>By the sacred fires of the temple, thou hast laid the Foundation &amp; Utilities upon bedrock, ascending to 4 of 5 quests (80%) with triumphant craft, and the oracle declares thy path true‚Äîgo forth, adept, with wisdom anointed and tools consecrated, for the penultimate gate now yawns before thee!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>