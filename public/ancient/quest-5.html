<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundation of Secrets - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Lost Codes</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundation of Secrets</h1>
<hr>
<p>Within the heart of the Pyramid of Lost Codes lies the Innermost Foundation Chamber, a sacred archive surrounded by intricate ancient mechanisms designed to protect the wisdom of past civilizations. To move forward, adventurer, you must decipher the deepest workings of the quest system encoded within these runic lines. Hidden among the interconnected files are tools for analyzing paths, structuring stories, and extracting sacred insights. Only through unraveling these remaining layers can the civilization‚Äôs legacy be restored.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pathway Discovery</strong>: How does <code class="inline-code">parseAdventureConfig</code> validate and process raw configuration data into usable formats for the archaeological system?</li>
<li>‚ö° <strong>Artifact Extraction</strong>: In <code class="inline-code">extractUniqueFilePaths</code>, what methods are used to traverse complex configurations and ensure file paths&#39; validity?</li>
<li>üõ°Ô∏è <strong>Preservation Techniques</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> compress and reduce redundancy to create efficient prompts for interpreting quests?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Configuration Parsing and Story Preparation</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file is the key to decoding the structured knowledge preserved within ancient scripts. It connects raw configurations to actionable files, extracts embedded information, and formats details into concise structures for further investigation. This file serves as the foundation for analyzing quest data, enabling logical flow and ensuring adaptability to complex hierarchies within the configuration.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> loads and parses raw JSON adventure configurations and validates them, ensuring the data integrity of what ancient scholars encoded.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> identifies and validates all referenced file paths in the configuration, drawing connections between exploratory resources for historical interpretation.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> optimizes configuration formatting for usage in automated processes, focusing on efficiency and trimmed data representation.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Validates the presence of raw configuration files via <code class="inline-code">loadAdventureConfig</code>, ensuring the foundation of data for processing.</li>
<li>Demonstrates an essential error handling technique through a conditional return to prevent workflow disruptions.</li>
<li>Utilizes <code class="inline-code">JSON.parse</code> with a try-catch block, safeguarding against corrupted or invalid artifacts within the encoded data.</li>
<li>Provides a clean entry point for all further file-related operations that depend on raw, parsed JSON.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Utilizes a depth-first traversal for recursively exploring nested configurations, ensuring no ancient artifact is overlooked.</li>
<li>Implements <code class="inline-code">fs.existsSync</code> and <code class="inline-code">path.resolve</code> to guarantee only legitimate, accessible file paths are recorded as archaeological treasures.</li>
<li>Establishes careful control in hierarchical exploration using <code class="inline-code">stack</code> and <code class="inline-code">Set</code>, preserving unique entries found in complex configurations.</li>
<li>Echoes the historical meticulousness of ancient record-keeping techniques by avoiding duplicates and filtering invalid entries.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Reduces detailed configurations into a minimal format suited for efficient LLM-based explorations, embracing the economy of information central to ancient wisdom.</li>
<li>Extracts and showcases critical elements like file paths and function names, translating complex formats into easily digestible prompts for quest decoding.</li>
<li>Uses <code class="inline-code">Array.isArray</code> to validate data structures before formatting, ensuring no misalignment occurs in the sacred transmission process.</li>
<li>Highlights the separation of verbosity from functionality to prioritize clarity, reminiscent of ancient scholars striving for streamlined knowledge sharing.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the depth-first traversal employed in <code class="inline-code">extractUniqueFilePaths</code> as inspiration for navigating hierarchies in other coding contexts.</li>
<li>Note the defensive programming techniques in <code class="inline-code">formatAdventureConfigForPrompt</code> to prevent errors when configurations are missing or corrupted.</li>
<li>Investigate the interplay between <code class="inline-code">parseAdventureConfig</code> and its downstream functions to observe how clean inputs fuel efficient downstream operations.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Pyramid of Lost Codes! The wisdom of an ancient civilization is restored, and your archaeological adventure is complete.</p>
<p>By the sacred wisdom etched within the eternal stone, thou hast unlocked the venerable foundation of secrets, charting a triumphant path through ancient hallowed quests‚Äîone step closer to the ultimate revelation! ‚≠êüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>