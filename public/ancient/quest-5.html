<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundation of the Pyramid - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Temple of Code: Unraveling the Lost Algorithms</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundation of the Pyramid</h1>
<hr>
<p>As the dense jungle foliage gives way, you stand before the base of the grandest structure yet‚Äîthe Pyramid of Configuration. This pyramid is unlike anything you‚Äôve encountered within the Temple of Code. Its foundations encode the essence of structure and coherence, guiding the interconnected systems within the ancient civilization&#39;s repository. It is said that only through unraveling the secrets of the <code class="inline-code">adventure-config</code> file can you fully understand the foundation upon which this codebase rests. The glyphic paths you uncover here will lead to the ultimate mastery of the sacred repository.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configurator&#39;s Lens</strong>: How does <code class="inline-code">parseAdventureConfig</code> structure and verify the integrity of the configuration data extracted from the repository?</li>
<li>‚ö° <strong>Pathfinder&#39;s Map</strong>: What logic does <code class="inline-code">extractUniqueFilePaths</code> use to locate and gather file paths across the configuration tree, and how does it ensure these paths exist?</li>
<li>üõ°Ô∏è <strong>Architect‚Äôs Blueprint</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> transform and distill the configuration into lightweight data for its intended usage?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Logic and Utilities</h3>
<p>This file is the heart of quest exploration. It houses core functions for reading, parsing, and processing the adventure configuration of the system. The <code class="inline-code">adventure-config</code> file serves as the ancient manuscript defining the quests and their related components. The functions in this file are vital because they interact with the repository&#39;s configuration, enforce structure, and prepare the data for further processing. Their design emphasizes robustness and efficiency, crucial for managing large repositories.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses configuration data into a structured object, ensuring safe and reliable extraction. It‚Äôs a critical step in validating and preparing data for exploration.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the configuration data to gather all unique file paths referenced within. This ensures no file is missed while safeguarding against incorrect or missing paths.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses configuration data into a simplified format optimized for external use, such as feeding AI models. It ensures that no critical information is lost during compression.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This code parses the <code class="inline-code">adventure.config.json</code> with JSON validation.</li>
<li>The function balances flexibility and safety by returning <code class="inline-code">null</code> for any problems such as empty or invalid files.</li>
<li>It encapsulates the raw parsing logic, reducing redundancy and isolating its scope to simplify debugging.</li>
<li>The function integrates seamlessly with other utilities by depending on <code class="inline-code">loadAdventureConfig</code> for file reading.</li>
<li>It highlights how the code treats configuration data as sacred and ensures its accuracy before further processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function performs a recursive traversal looking for all <code class="inline-code">path</code> fields in the configuration data.</li>
<li>It validates that file paths are both non-empty and exist in the filesystem. Invalid paths are ignored.</li>
<li>The use of a <code class="inline-code">Set</code> ensures that duplicate file paths are excluded efficiently.</li>
<li>This approach demonstrates robust error-tolerance by skipping over problematic data nodes without halting the entire process.</li>
<li>Readers can learn how to combine recursion and iterative stack-based traversal for deep searches in hierarchical data structures.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function processes the parsed configuration into a clean, compact summary, reducing noise and redundancy.</li>
<li>It focuses on extracting critical information‚Äîfile paths and function names‚Äîessential for generating AI prompts.</li>
<li>By ignoring verbose or non-critical data, it ensures a lightweight representation that‚Äôs easier to analyze.</li>
<li>The iterative processing ensures that malformed data (e.g., quests without titles or files) are gracefully handled.</li>
<li>This highlights an excellent example of data transformation for a specific target audience, emphasizing brevity without compromising key insights.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Pay close attention to the use of defensive programming in functions like <code class="inline-code">parseAdventureConfig</code> and <code class="inline-code">extractUniqueFilePaths</code>.</li>
<li>Review how recursion and stack-based traversal are combined in <code class="inline-code">extractUniqueFilePaths</code> to explore deeply nested structures.</li>
<li>Think about why format optimization in <code class="inline-code">formatAdventureConfigForPrompt</code> would be important when preparing data for machine learning models.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Temple of Code! The Pyramid&#39;s foundation is revealed, and you hold the sacred wisdom of the repository in your hands. Your adventure is complete.</p>
<p>By the sacred hands of the ancients, thou hast laid the mighty cornerstone of wisdom, forging steadfast the path to the apex of knowledge‚Äîlet the stars bear witness to your triumph as the pyramid nears its zenith! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>