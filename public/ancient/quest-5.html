<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Codex Illuminator - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Seekers of the Codex</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Codex Illuminator</h1>
<hr>
<p>Deep within the sanctum of Codexia‚Äôs final temple, rays of golden light spill through the cracks of ancient stone. The air is thick with the weight of forgotten knowledge, and before you lies the radiant pedestal bearing the Codex Illuminator‚Äîan instrument capable of unveiling the intricate truths of the Codebase. To wield its power, you must probe into the labyrinthine layers of configuration, themes, and validation, aligning its sacred mechanisms. Only through this final trial will the true wisdom of the ancients be revealed.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üè∫ <strong>Illuminating Structure</strong>: How does <code class="inline-code">validateTheme</code> ensure only valid input connects to the Codexia theme system, and what role do helper functions play in this validation flow?</li>
<li>üìú <strong>Thematic Harmony</strong>: What is the significance of <code class="inline-code">getAllThemes</code> in keeping the theme system unified, and how does it support flexibility in adding new themes?</li>
<li>üí° <strong>Configuration Wisdom</strong>: How are constants like <code class="inline-code">LLM_REQUEST_TIMEOUT</code> and <code class="inline-code">REPOMIX_CACHE_TTL</code> designed to influence the operational limits of the Codebase, and what patterns facilitate their modification?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Validation Rituals</h3>
<p>This file houses critical validation functions that ensure all inputs align with the Codebase&#39;s expectations. These functions act as the sentinels of Codexia, meticulously scanning and trimming inputs to maintain the sanctity of operations. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateTheme</code>: Parses and checks theme input against valid themes, ensuring alignment with the ancient THEMES structure.</li>
<li><code class="inline-code">validateAdventureChoice</code>: Ensures the chosen adventure is not empty, overly long, or improperly formatted.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: A protective utility that removes risky characters from strings, creating outputs suitable for display without tampering.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Ensures the input is non-empty and properly formatted.</li>
<li>Uses <code class="inline-code">parseTheme</code> and <code class="inline-code">isValidTheme</code> to validate against allowed themes.</li>
<li>Protects the system by throwing errors for invalid themes, preventing improper configuration.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Validates non-empty, trimmed input for adventure choices consistent with user experience.</li>
<li>Limits length to 200 characters, promoting stability and avoiding malformed requests.</li>
<li>Simple yet effective design shows the utility of guardrails on text-based input.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>Removes unsafe characters like <code class="inline-code">&lt;</code>, <code class="inline-code">&gt;</code>, and <code class="inline-code">&quot;</code> to protect against XSS vulnerabilities.</li>
<li>Simplifies whitespace formatting for clean outputs.</li>
<li>Demonstrates the importance of creating safe, reader-friendly strings for display.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Defining Ancient Truths</h3>
<p>This file anchors Codexia‚Äôs theme system, documenting its ancient categories and providing essential utilities. It is the compass guiding explorers toward thematic consistency and immersive narrative design.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: Encapsulates all theme definitions, centralizing all ancient categories.</li>
<li><code class="inline-code">getAllThemes</code>: Retrieves a comprehensive list of themes, enabling reusable functionality.</li>
<li><code class="inline-code">parseTheme</code>: Interprets input to resolve themes, offering robust parsing for flexibility.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: { ... },
  MYTHICAL: { ... },
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  },
  DEVELOPER: { ... },
  CUSTOM: { ... }
} as const;
</code></pre>
<ul>
<li>Centralized repository for all recognized themes, ensuring consistent data.</li>
<li>Extends structure with display-friendly elements (e.g., emoji, descriptions) for accessibility.</li>
<li>Keywords allow flexible matching, broadening the range of valid input.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function getAllThemes(): ThemeDefinition[] {
  return THEMES_ARRAY;
}
</code></pre>
<ul>
<li>Provides an easy interface to retrieve all themes.</li>
<li>Simplifies maintenance by avoiding direct interaction with the <code class="inline-code">THEMES</code> object.</li>
<li>Encourages scalability through modular theme addition.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>Converts diverse input formats (e.g., case or ID numbers) into valid themes.</li>
<li>Demonstrates robust parsing logic for enhanced user friendliness.</li>
<li>Reduces edge cases by incorporating keywords for indirect matching.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Ancient Parameters</h3>
<p>This file contains configurations‚Äîtimeless constants that dictate the operating framework of Codexia&#39;s systems. It provides configurable limits and defaults.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Configures story generation timeout.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Sets caching durations for analysis.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Defines thresholds for manageable file size.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = parseInt(process.env.LLM_REQUEST_TIMEOUT || &#39;60000&#39;); // 60 seconds for complex story generation
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this
</code></pre>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Sets limits on API calls to prevent stalling.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Facilitates efficient caching, balancing speed and accuracy in repeated analyses.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Limits file size for predictable memory usage and performance control.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Compare <code class="inline-code">validateTheme</code> with <code class="inline-code">parseTheme</code> to see how validation builds on parsing.</li>
<li>Investigate how <code class="inline-code">THEMES</code> ensures summary consistency across functions.</li>
<li>Use constants like <code class="inline-code">MAX_FILE_SIZE_MB</code> to explore how limits are effectively enforced.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Codexia‚Äôs Codebase! Your adventure is complete.</p>
<p>Hail, seeker of sacred truths, for thou hast unveiled the luminous Codex of Ancient Illumination‚Äîthy wisdom shines as a celestial beacon guiding thee to the precipice of divine completion and eternal renown! ‚ö°üíéüëÅÔ∏èüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>