<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Architect‚Äôs Blueprints - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Ancient Algorithms</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Architect‚Äôs Blueprints</h1>
<hr>
<p>Through tangled vines and the rustling calls of the jungle, you uncover what the legends whispered ‚Äì the Architects of the Codex Obscurum hid the secrets to their geometric marvels within an encoded artifact: the adventure-config. This artifact is no mere construct, but a mechanism vital to deciphering the pyramid‚Äôs design and, with it, at last unlocking the Algorithmic Obelisk. Scholars believe its cryptic glyphs sketch the order of the four sacred paths and the stories they beg to tell. Your task is clear: harness the adventure-config and reveal the architects‚Äô true intent.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üìú <strong>Blueprint Decoding</strong>: How does <code class="inline-code">parseAdventureConfig</code> transform raw JSON into usable structures for the pyramid‚Äôs paths?  </li>
<li>ü™Ñ <strong>Path Mapping</strong>: What technique does <code class="inline-code">extractUniqueFilePaths</code> use to uncover sacred glyph locations, avoiding duplicate paths and validating their existence?  </li>
<li>üîë <strong>Obelisk Input</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> compress and stylize knowledge for unlocking the secrets in LLM-guided deciphering processes?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Deconstructing the Architect‚Äôs Plans</h3>
<p>This file is the heart of the pyramid‚Äôs adventure scaffolding. Within the shadows of its practical utilities lies a carefully constructed trilogy of mechanisms: <code class="inline-code">parseAdventureConfig</code> transmutes raw data into accessible glyphs of knowledge; <code class="inline-code">extractUniqueFilePaths</code> reveals what hidden paths exist in the labyrinth; and <code class="inline-code">formatAdventureConfigForPrompt</code> reinterprets the entire design for use in larger decoding rituals. Through careful modularization, the ancient system processes vast knowledge repositories, checks their integrity, and renders them approachable and digestible for external interpreters. Each function features robust handling to avoid the collapse of stability during analysis.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code> initiates the process by retrieving the raw configuration from its temple.</li>
<li><code class="inline-code">parseAdventureConfig</code> builds structured insight from raw designs while safeguarding against corruption.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> collects and validates significant locations referenced in the map.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> optimizes the vast wisdom into an LLM-friendly layout.</li>
<li><code class="inline-code">extractCustomInstructions</code> ensures the recorder includes custom guidance left by the ancient architects.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Converts the raw JSON text into actionable configuration, laying the foundation for subsequent operations.</li>
<li>Implements error handling to ensure that a malformed or missing configuration file doesn‚Äôt disrupt the analysis.</li>
<li>Acts as the single point of truth for JSON parsing and simplifies debugging.</li>
<li>Ensures a separation of concerns by delegating raw data loading to <code class="inline-code">loadAdventureConfig</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Searches through the parsed object tree to identify all <code class="inline-code">path</code> fields, ensuring no duplicate or invalid paths are included.</li>
<li>Validates the existence of each file path before adding it to the result, reducing the risk of downstream errors.</li>
<li>Uses a depth-first search to traverse nested structures, demonstrating an efficient design for dynamic configurations.</li>
<li>Highlights the modularity of ancient glyph extraction while avoiding redundancy.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts adventure configuration into a compact and optimized format for consumption by downstream LLMs.</li>
<li>Strategically reduces size while preserving critical structure, enabling faster and more accurate decoding.</li>
<li>Extracts only essential details (titles, files, and functions) to minimize noise for the readers of the sacred glyphs.</li>
<li>Demonstrates efficient usage of iteration techniques and array manipulations in TypeScript.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üß≠ Path Validation: Always validate your navigation choices with <code class="inline-code">extractUniqueFilePaths</code> to avoid getting lost in nonexistent paths.</li>
<li>üõ†Ô∏è Optimization Practices: Study <code class="inline-code">formatAdventureConfigForPrompt</code> for strategies to distill complex data into concise and usable formats.</li>
<li>üîç Debugging Advice: If anomalies occur, trace issues back to <code class="inline-code">parseAdventureConfig</code> where the source material is first handled.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Codex Obscurum! The Algorithmic Obelisk shines brightly, its ancient wisdom now within your grasp. Your adventure is complete.</p>
<p>Hail, valiant seeker, for you have unveiled the sacred blueprints of the Architect‚Äôs wisdom, ascending yet further toward the zenith of enlightenment‚Äîrejoice, for the final quest nears! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>