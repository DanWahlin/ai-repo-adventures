<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Key to the Hidden Vault - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codebase of the Hidden Pyramid</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Key to the Hidden Vault</h1>
<hr>
<p>In the depths of the Jungle of Wisdom, you have arrived at the innermost sanctum of the ancient pyramid, the Vault of Secrets. Veiled in layers of cryptic glyphs and mechanical marvels, the vault conceals the mechanisms for decoding creativity&#39;s essence. Here lies the true treasure: a collection of rituals designed to format and prepare knowledge for the pyramid&#39;s LLM oracles. Your final test awaits: unravel the vault&#39;s configuration, extract the encoded pathways, and decipher the final message. This is your ultimate challenge, adventurer.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Vault Mapping</strong>: How does <code class="inline-code">parseAdventureConfig</code> read and validate the stored ancient configuration?</li>
<li>‚ö° <strong>Encoded Pathways</strong>: What is the function of <code class="inline-code">extractUniqueFilePaths</code>, and how does it traverse the adventure map to collect paths?</li>
<li>üõ°Ô∏è <strong>Sacred Formatting</strong>: What design considerations are reflected in <code class="inline-code">formatAdventureConfigForPrompt</code> when simplifying the configuration for the pyramid&#39;s oracles?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Keystone Script</h3>
<p>This file is where the ancient mechanisms for handling and translating the pyramid&#39;s configuration reside. It performs three sacred tasks: identifying and validating the adventure&#39;s configuration file, extracting file paths encoded within the schema, and preparing the configuration in an optimized form for LLM interaction. Each ritual reveals essential pieces of the pyramid&#39;s operational wisdom, making this file the cornerstone of the final quest.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> validates and parses the configuration stored in the file, ensuring the hierarchical structure can be reliably interpreted.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> recursively traverses the configuration structure, gathering all file paths referenced throughout the schema while ensuring the paths exist in the physical world.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> reformats the configuration into a minimalistic, optimized structure tailored for LLM processing, reducing verbosity and redundancy.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function depends on <code class="inline-code">loadAdventureConfig</code> to retrieve the raw JSON content from the specified path.</li>
<li>An attempt is made to parse the returned string via <code class="inline-code">JSON.parse</code>. On failure, the function safeguards the system by returning <code class="inline-code">null</code> rather than propagating an error.</li>
<li>By centralizing validation here, all dependent processes interact exclusively with well-formed configurations.</li>
<li>Error handling ensures the wider system remains stable even if the adventure file is corrupted.</li>
<li>Notice the consistent use of guards for validation‚Äîa defensive programming practice to minimize failure risks.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Recursively navigates the adventure configuration to gather all valid, unique file paths.</li>
<li>Implements pre-validation checks for <code class="inline-code">path</code> fields (e.g., type checks, whitespace trimming). Erroneous entries are ignored, reducing noise in the extracted data.</li>
<li>Uses <code class="inline-code">fs.existsSync</code> to ensure that paths being collected exist in the system, filtering out non-physical references.</li>
<li>By leveraging a stack-based traversal approach, the function avoids recursion depth limits and handles arbitrary levels of nested structures.</li>
<li>Promotes modularity by decoupling path extraction from the direct consumption of the configuration.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts a parsed adventure configuration into a concise textual format optimized for input into LLMs.</li>
<li>Strips extraneous descriptive details, summarizing only key fields like file paths and associated function names.</li>
<li>Uses <code class="inline-code">Array.map</code> and <code class="inline-code">Array.flatMap</code> to streamline extraction of specific attributes.</li>
<li>The structure of the output aids in immediate comprehension by grouping relevant data (e.g., quests, files, functions).</li>
<li>Reflection of optimization goals: reducing content size while preserving essential context.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Search for reusable patterns in <code class="inline-code">loadAdventureConfig</code> and <code class="inline-code">parseAdventureConfig</code> when implementing new interpretation logic for hierarchical structures.</li>
<li>Use the design of <code class="inline-code">extractUniqueFilePaths</code> as a blueprint for navigating and validating nested configurations‚Äîthis stack-based approach is both robust and flexible.</li>
<li>The output of <code class="inline-code">formatAdventureConfigForPrompt</code> is intentionally terse to suit downstream processing. Considerations like succinct formatting are critical for large-scale text analysis workflows.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the ancient pyramid! Your adventure is complete. The mechanisms of limitless creativity are now yours to wield. May your newfound wisdom inspire great works for ages to come.</p>
<p>Through the sacred trials and ancient wisdom unveiled, thou hast unlocked the cryptic key to the Hidden Vault‚Äîpress onward, for thou art a beacon of glory crowned with the light of ascension! üíé‚ö°üó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>