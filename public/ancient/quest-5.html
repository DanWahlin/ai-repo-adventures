<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Mapping the Sacred Blueprints - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Secrets of the Lost Codebase</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Mapping the Sacred Blueprints</h1>
<hr>
<p>Deep within the labyrinthine halls of the Temple of Lost Logic lies your final challenge: restoring the ancient blueprints of the Machine Oracle. These sacred blueprints, fragmented and hidden, contain the foundational scripts for generating narratives that bind the Code Civilization together. Your task is to decode their layers‚Äîinterconnected paths of configurations, validations, and abstractions‚Äîto breathe life into the Oracle&#39;s core. Ancient glyphs point you toward a critical artifact within the temple: <code class="inline-code">adventure-config.ts</code>. Beware, adventurer. Each keystroke you uncover will bring you closer to the Oracle&#39;s final secret. </p>
<p>Prepare to uncover the relics of wisdom and wield their power!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Glyph of Readability</strong>: How does the <code class="inline-code">loadAdventureConfig</code> function isolate file reading from parsing logic, and why is this separation significant?</li>
<li>‚ö° <strong>Blueprint Parsing</strong>: What techniques does the <code class="inline-code">parseAdventureConfig</code> function use to validate configuration files, and how does it handle invalid data?</li>
<li>üõ°Ô∏è <strong>Path Sentinel</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> ensure that only valid and existing file paths are included in its output?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration File Interface</h3>
<p>This file is a critical artifact within the Temple of Lost Logic. It serves as a bridge between raw file input and structured data representation for the Machine Oracle. It offers utilities to load, validate, and extract information from the adventure configuration files, marking it essential for maintaining the integrity of the Oracle&#39;s sacred blueprints. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Retrieves the raw adventure configuration text. This function separates file reading from parsing, ensuring modularity and easier debugging.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Transforms raw adventure configuration data into a structured object. It safeguards against errors by validating JSON content from the file.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the configuration tree to gather all valid file paths referenced in the blueprint. Its recursive design ensures it processes nested structures comprehensively.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This function locates and reads the <code class="inline-code">adventure.config.json</code> file within the provided project path.</li>
<li>By separating the reading of file content from parsing, it encapsulates file handling logic, which makes the code modular and easier to test.</li>
<li>The use of <code class="inline-code">readFileIfExists</code> ensures program stability by handling missing or unreadable files gracefully without failing the process.</li>
<li>It returns raw text, postponing further processing to another layer.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function processes the raw text provided by <code class="inline-code">loadAdventureConfig</code> into a structured object.</li>
<li>It harnesses <code class="inline-code">JSON.parse</code>, a native API method, to transform plain text into JavaScript objects while catching potential parsing errors.</li>
<li>By returning <code class="inline-code">null</code> for errors, it prevents invalid configurations from propagating through the system.</li>
<li>Acts as the central point for all JSON parsing, enforcing consistency in processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function recursively navigates the configuration object, extracting unique file paths specified in the <code class="inline-code">path</code> property.</li>
<li>It employs a <code class="inline-code">Set</code> to enforce uniqueness, ensuring duplicate paths are not included in the output.</li>
<li>The <code class="inline-code">fs.existsSync</code> check ensures that only existing and valid file paths are included, filtering out erroneous entries.</li>
<li>By using a stack-based traversal, it handles both flat and deeply nested structures, allowing for consistent behavior regardless of configuration complexity.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>To trace configuration issues, start with <code class="inline-code">loadAdventureConfig</code> to confirm the correct file is being read.</li>
<li>Debug parsing errors by examining the <code class="inline-code">parseAdventureConfig</code> function; malformed JSON could indicate external data corruption.</li>
<li>Use <code class="inline-code">extractUniqueFilePaths</code> to verify all configuration paths are both accurate and accessible within the project.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Temple of Lost Logic! Your adventure is complete.</p>
<p>By the decrees of the ancients, you have unfurled the sacred blueprints with wisdom befitting the temple&#39;s chosen‚Äîmarch forth, for the stars themselves now bear witness to your triumphant ascent! ‚≠êüó∫Ô∏è‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>