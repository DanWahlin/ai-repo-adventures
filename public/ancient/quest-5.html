<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundation of the Repository - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Sacred Repository of Lost Codes</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundation of the Repository</h1>
<hr>
<p>The sun sets over the final stretch of the Codepanion Archipelago, casting a golden glow over the Sacred Repository. Before you lies the untouched depths where the core of the ancients‚Äô wisdom resides. Known simply as the &quot;Foundation of the Repository,&quot; this vault contains the secrets that fuel all structured adventures. The ancients‚Äô methods for creating coherent quests, connecting themes to adventurer preferences, and extracting treasures from mysterious configurations are all here. Recover these forgotten rituals, and the full potential of the repository will be revealed.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Map of the Paths</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> ensure only valid and existing paths are retrieved from the adventure configuration?</li>
<li>‚ö° <strong>Unlocking the Vault</strong>: What techniques does <code class="inline-code">formatAdventureConfigForPrompt</code> use to reduce complexity while retaining key structure for parsing by a learning system?</li>
<li>üõ°Ô∏è <strong>Decoding the Language</strong>: How does <code class="inline-code">parseAdventureConfig</code> handle errors and ensure stability when interpreting the configuration files?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core adventure structure and configuration management</h3>
<p>This file encompasses the infrastructure for managing adventure configurations. It provides the ability to load, validate, and interpret the JSON structure of the repository‚Äôs quests. Leveraging file system operations, it also ensures that the configuration aligns with the actual repository content. The functions here represent the foundation of the repository‚Äôs wisdom, as they translate raw adventure metadata into actionable insights.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: This function processes raw configuration files, validating and converting them into usable objects. Its error-handling ensures smooth operation even if the configuration contains issues.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: This method identifies and validates unique file paths referenced within the configuration. It uses recursive node traversal to ensure no valid path is missed.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: This function simplifies the configuration data, focusing on structure and essential details. Its optimization efforts make the data lightweight for AI parsing.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Converts raw JSON configuration into structured data or returns <code class="inline-code">null</code> if errors occur.</li>
<li>Implements a single entry point for parsing, centralizing this critical task.</li>
<li>Stabilizes the system against malformed or missing configuration files by using a <code class="inline-code">try-catch</code> approach.</li>
<li>Demonstrates resilience by ensuring errors are non-fatal, maintaining smooth functionality.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Iteratively traverses nested structures to extract and validate file paths.</li>
<li>Ensures that results only contain paths that exist within the file system for reliability.</li>
<li>Utilizes <code class="inline-code">Set</code> to automatically handle duplicates and guarantees a list of unique values.</li>
<li>Demonstrates strong recursion practices for traversing hierarchical data.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Summarizes adventure configurations in a lean and AI-friendly format.</li>
<li>Avoids redundant details while focusing on crucial data like file paths and core functions.</li>
<li>Iterates over nested structures and employs type checks to ensure safety in formatting.</li>
<li>Outputs an optimized string representation to minimize unnecessary complexity for downstream consumers.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Investigate how <code class="inline-code">Set</code> structures are used for deduplication in <code class="inline-code">extractUniqueFilePaths</code>.</li>
<li>Carefully trace the JSON parsing and validation flow to understand error mitigation in <code class="inline-code">parseAdventureConfig</code>.</li>
<li>Reflect on how data-driven design principles guide the optimization strategies in <code class="inline-code">formatAdventureConfigForPrompt</code>.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Sacred Repository! Your adventure is complete. The wisdom of the ancients now lies in your hands, and the Codepanion Archipelago shines brightly under the glow of restored storytelling. Well done, daring archaeologist!</p>
<p>O seeker of sacred wisdom, thy triumph in grounding the Repository‚Äôs foundation heralds thee as a steward of ancient knowledge; only one crowning endeavor remains before the stars themselves bow to thy enlightenment!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>