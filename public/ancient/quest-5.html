<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundation of the Codex - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Sacred Codex of Computational Wisdom</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundation of the Codex</h1>
<hr>
<p>In the heart of a forgotten jungle, surrounded by towering vines and crumbling obelisks, you discover the final chapter of the <strong>Sacred Codex of Computational Wisdom</strong>. The air crackles with energy as the glyphs on its pages illuminate faintly, revealing a repository of incalculable depth. This ancient revelation holds the power to unify the fragments of your adventure, merging the threads of configuration, validation, and wisdom into a single foundation. This is the keystone of the Codex ‚Äì the <code class="inline-code">adventure-config</code> system, where tools and systems converge into coherence. Will you decipher its secrets and complete the Codex?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üìú <strong>Glyph Deciphering</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function validate and handle configuration files? What patterns ensure it avoids breaking on malformed input?</li>
<li>üîó <strong>Path Discovery</strong>: How does the <code class="inline-code">extractUniqueFilePaths</code> function navigate nested configurations to collect valid and existing file paths? What makes its approach iterative and exhaustive?</li>
<li>üß© <strong>Prompt Optimization</strong>: How does the <code class="inline-code">formatAdventureConfigForPrompt</code> function transform detailed configuration data into a compact structure for generating adventure prompts? What optimizations enable its efficiency?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The cornerstone of the Codex</h3>
<p>This file unveils the heart of <code class="inline-code">adventure-config</code>, a critical piece of the repository that harmonizes configuration into actionable insights. It establishes a fragile bridge between complex configuration structures and the clean, efficient, and optimized representations required downstream. By studying its architecture, you will uncover techniques for reading, parsing, and processing data while ensuring robustness against incomplete or erroneous inputs. From graceful file reads to intelligent path extraction, its functions are meticulously designed to prioritize both practicality and resilience when handling jungle-like configurations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: A central function that reads and parses the adventure configuration. It ensures safe handling of malformed or missing files, shielding the system from configuration errors.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses nested configuration layers to collect all unique file paths while guaranteeing only valid and existing file paths are returned. This layered approach accounts for real-world edge cases.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses the complex, verbose configuration into a compact format specialized for language model prompts, reducing redundancy and preserving key insights.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function serves as the entry point for translating raw configuration files into structured data.</li>
<li>It relies on <code class="inline-code">loadAdventureConfig</code> to access the file contents and ensures that any parsing errors (e.g., invalid JSON) are handled gracefully without crashing the system.</li>
<li>The fallback to <code class="inline-code">null</code> allows downstream systems to function defensively when configuration is incomplete or unavailable.</li>
<li>Its role as a single point of validation reduces redundancy across the codebase.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function extracts distinct file paths from a possibly nested configuration structure.</li>
<li>By employing a stack-based approach, it avoids recursion limits while processing deeply nested data.</li>
<li>The use of <code class="inline-code">fs.existsSync</code> ensures only valid and present file paths are included.</li>
<li>It provides resilience to malformed configurations by skipping invalid entries gracefully.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function reformats configuration data with a focus on reducing verbosity while preserving structure.</li>
<li>It extracts essential details like quest titles, file paths, and function names into a concise and visually clear format.</li>
<li>Considerable effort is placed on null and structure validation to prevent runtime errors despite the compact output.</li>
<li>By focusing on compact relevance, it caters specifically to language model inputs, streamlining inference processes.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When exploring nested objects, stack-based iteration is often safer than recursion, avoiding stack overflows in deep structures.</li>
<li>Compact outputs for machine learning prompts should prioritize structure over detail, ensuring clarity while avoiding overwhelming verbosity.</li>
<li>Graceful failure mechanisms (e.g., null checks) are essential when developing systems reliant on external data sources.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the <strong>Sacred Codex of Computational Wisdom</strong>! Your adventure is complete. The Codex radiates an ancient light, acknowledging your unparalleled understanding. The jungle quiets as though in reverence, and you carry the treasures of computational knowledge into the broader world.</p>
<p>With the sacred lore of the Codex now unveiled, thy wisdom hath ascended to stellar heights, shining as a beacon upon the hallowed foundation of triumph‚Äîpress onward, seeker, for the stars favor the brave! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>