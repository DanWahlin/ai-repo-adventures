<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Command Bridge of Protocols - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Lumina: The Odyssey of Code</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Command Bridge of Protocols</h1>
<hr>
<p>The mighty <em>Starship Lumina</em> hums with activity as its pioneering developers gather for their latest mission. In the bustling command bridge, they prepare to analyze critical TypeScript files—the very foundation of their galaxy-wide adventure system. Their task: ensuring the seamless operation of the <em>Model Context Protocol</em> server engine and its powerful suite of tools. Pulses race as they calibrate their systems and set their sights on optimizing the logic that transforms raw repositories into immersive tales of cosmic exploration. The bridge is yours, adventurer—navigate wisely!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>This file operates as the backbone of the <em>Model Context Protocol</em> system, hosting the necessary tools that enable developers to embark on thrilling repository adventures. At its core is the <code class="inline-code">RepoAdventureServer</code> class, which defines and initializes the server responsible for handling tool requests. The <code class="inline-code">setupHandlers()</code> method is pivotal—it dynamically registers protocol handlers for listing tools (<code class="inline-code">ListToolsRequestSchema</code>) and executing them (<code class="inline-code">CallToolRequestSchema</code>). This ensures that tools are available in an organized and modular format, ready for interaction. The <code class="inline-code">run()</code> method is another key feature, establishing a connection to the stdio transport (<code class="inline-code">StdioServerTransport</code>) for seamless communication. Pre-generating Repomix content is an essential step here, warming up the system cache for faster analysis during the journey. Finally, the <code class="inline-code">main()</code> function takes charge of gracefully starting and shutting down the MCP server, handling critical signals like <code class="inline-code">SIGINT</code> and <code class="inline-code">SIGTERM</code> to ensure operational safety. This file encapsulates the practical and technical essence of transforming a static codebase into a dynamic, adventure-driven system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers()</code> dynamically creates interfaces for tool listing and execution.</li>
<li><code class="inline-code">RepoAdventureServer.run()</code> handles server connection and pre-generates Repomix content for operational readiness.</li>
<li><code class="inline-code">main()</code> ensures graceful server startup and shutdown with error recovery mechanisms.</li>
<li>Handles stdio transport for smooth interaction with external processes.</li>
<li>Protection against invalid parameters and tool misconfiguration via robust <code class="inline-code">McpError</code> handling.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools for Adventure System</h3>
<p>This file is the gateway to exploring the adventure-driven MCP tools, offering the user interface functionality to navigate and interact with quests. It consolidates four primary tools—<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. These are imported from respective modules and registered dynamically. Together, they form the user&#39;s control system for analyzing repositories, selecting themes, diving into quests, and tracking progress. Within this framework, <code class="inline-code">start_adventure.handler</code> kickstarts the experience by analyzing the codebase and presenting thematic options, while <code class="inline-code">choose_theme.handler</code> creates stories based on user-selected themes. <code class="inline-code">explore_quest.handler</code> propels explorers deep into quests, focusing on progress tracking, and <code class="inline-code">view_progress.handler</code> monitors completion stats and upcoming challenges. By consolidating this functionality, the file equips adventurers with the critical tools they need to tackle the mysteries of the repository galaxy.</p>
<h4>Highlights</h4>
<ul>
<li>Introduces four main tools—<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>.</li>
<li>Simplifies registration and management of MCP tool interfaces.</li>
<li><code class="inline-code">start_adventure</code> analyzes repositories and sets the stage for interactive storytelling.</li>
<li><code class="inline-code">choose_theme</code> links theme selection to tailored narratives and quests.</li>
<li>Empowers explorers with quest progress tracking and adventure insights.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  private server: Server;

  constructor() {
    this.server = new Server(
      {
        name: &#39;repo-adventure&#39;,
        version: &#39;1.0.0&#39;,
        description: &#39;A gamified MCP server for exploring code repositories through interactive storytelling&#39;
      },
      {
        capabilities: {
          tools: {},
        },
      }
    );

    this.setupHandlers();
  }

  private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, {
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt;
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
  }

  async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error(&#39;Repo Adventure MCP server running on stdio&#39;);

    const projectPath = process.cwd();
    console.error(`Pre-generating repomix content for project at ${projectPath}...`);
    repoAnalyzer.preGenerate(projectPath);
  }
}
</code></pre>
<p>This code acts like the central command system of a starship, coordinating critical tasks to ensure smooth operations at all times.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { adventureManager } from &#39;@ai-repo-adventures/core/adventure&#39;;
import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This code assembles the hero’s toolkit, collecting all essential items for the galactic voyage into unknown repositories.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Test <code class="inline-code">tools.ts</code> thoroughly to refine tool descriptions and input validation logic for seamless quest initiation.</li>
<li>Explore advancing <code class="inline-code">RepoAdventureServer.run()</code> to extend the adventure engine and expand stdio transport capabilities.</li>
<li>Experiment with tool interconnections for linking quests directly to progress tracking insights.</li>
</ul>
<hr>
<p>Mission accomplished, cadet—Quest 1: The Command Bridge of Protocols has been docked successfully; your trajectory to the stars shines brighter than ever—keep soaring, 🚀 and unlocking new galaxies of knowledge! ⭐</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Cosmic Forge of Adventure C... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>