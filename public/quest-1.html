<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚔️ Quest 1: The Forge of Adventure (Tools and Commands) - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <script>
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">⚔️ Realm of Enchanted Code: The Quest for the Eternal Compiler</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1><span class="header-prefix">⚔️ Quest 1:</span> The Forge of Adventure (Tools and Commands)</h1>
<hr>
<p>In the Kingdom of Codoria, amidst valleys of shimmering algorithms and forests woven with procedural paths, a new calling arises. You have ventured into the cavernous halls of the Mystic Forge, a fabled repository where enchanted tools and ancient scripts are stored. Before you lies the challenge of mastering Codoria’s sacred Tools—arcane commands that enable adventurers to navigate the kingdom’s magical architecture. Beware, for each tool requires not just skill, but also wisdom gleaned from ancient scrolls of code!</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/mcp-repo-adventure/blob/main/src/tools/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/tools/tools.ts</code></a>: The Forge of Adventure Tools</h3>
<p>This file serves as the central hub for Codoria&#39;s enchanted tools, forging them together into a unified arsenal. It provides access to four core tools—<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>—each of which wields unique magical properties to guide adventurers through their journeys. By importing these utilities from their respective tomes, it organizes them into a cohesive system for easier integration into Codoria’s sprawling infrastructure. Notably, this file also acts as the keeper of the adventure manager, a wise steward that preserves and tracks the state of each quest.</p>
<p>The tools themselves carry out essential rituals in the land of Codoria: from initiating new adventures to tracking progress. This file demonstrates Codoria’s reliance on modular enchantments, where each function is like a fragment of an ancient runestone, focusing on maintainability and flexibility. The power of this script lies in its adaptability—it exports each tool independently while also amalgamating them into a unified spellbook (<code class="inline-code">tools</code>).</p>
<h4>Highlights</h4>
<ul>
<li>The file imports the <code class="inline-code">adventureManager</code>, storing the current state of the quest for all tools.</li>
<li>Exports the four primary tools (<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, <code class="inline-code">view_progress</code>), making them modular and reusable.</li>
<li>Combines all tools into a single export (<code class="inline-code">tools</code>) for simpler access across the codebase.</li>
</ul>
<h3><a href="https://github.com/danwahlin/mcp-repo-adventure/blob/main/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/server.ts</code></a>: The Keeper of Connections</h3>
<p>The <a href="https://github.com/danwahlin/mcp-repo-adventure/blob/main/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/server.ts</code></a> file is the beating heart of Codoria’s interactive system. Known as the RepoAdventureServer, this file connects mortal users to the magical underpinnings of the adventure system. The <code class="inline-code">setupHandlers</code> function acts as the server’s brain, registering critical handlers for listing tools or executing quests. These handlers ensure that each user request is carefully validated and routed to the appropriate utility, communicating with the enchanted tools hosted in the Forge. Meanwhile, the <code class="inline-code">run</code> function plays the role of a herald, broadcasting the server’s readiness and pre-generating Codoria&#39;s repository context for quick accessibility.</p>
<p>The file’s <code class="inline-code">main</code> section is resilient, much like a seasoned knight in battle. It sets up safeguards against unsought disruptions, such as interruptions or promise rejections, ensuring the server endures through adversities. With its structured logic and robust error handling, <a href="https://github.com/danwahlin/mcp-repo-adventure/blob/main/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/server.ts</code></a> ensures that Codoria’s adventure network remains reliable for any hero eager to explore its wonders.</p>
<h4>Highlights</h4>
<ul>
<li>Registers dynamic handlers in <code class="inline-code">setupHandlers</code> for tool listing and execution.</li>
<li>Pre-generates repomix content in <code class="inline-code">run</code> to reduce load times during user interaction.</li>
<li>Implements graceful shutdown processes and error recovery in the <code class="inline-code">main</code> function.</li>
</ul>
<h2>Code</h2>
<h3>src/tools/tools.ts</h3>
<pre><code class="language-typescript">import { adventureManager } from &#39;../adventure/state.js&#39;;
import { startAdventure } from &#39;./start-adventure.js&#39;;
import { chooseTheme } from &#39;./choose-theme.js&#39;;
import { exploreQuest } from &#39;./explore-quest.js&#39;;
import { viewProgress } from &#39;./view-progress.js&#39;;

// Export the shared adventure manager for tools that need it
export { adventureManager };

// Re-export tools with MCP naming convention
export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

// Export all tools for easy registration
export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>The tools here act as mystical scrolls within a spellcaster’s grimoire, each one designed to perform an essential function in the larger quest.</p>
<h3>src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
    // Dynamic tool listing
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    // Dynamic tool execution
    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        // Validate arguments using the tool&#39;s Zod schema
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        // Execute the tool handler with validated arguments
        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
  }
</code></pre>
<p>This code is the master of ceremonies, ensuring every request is properly interpreted, validated, and executed.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use modular tools like those from <a href="https://github.com/danwahlin/mcp-repo-adventure/blob/main/src/tools/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/tools/tools.ts</code></a> to keep your code flexible and reusable across different contexts.</li>
<li>Study the <code class="inline-code">setupHandlers</code> function in <a href="https://github.com/danwahlin/mcp-repo-adventure/blob/main/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">src/server.ts</code></a> to better understand how user input is carefully validated and routed to appropriate commands.</li>
<li>Explore the Zod schema examples to dive deeper into elegant input validation for your own projects.</li>
</ul>
<hr>
<p>Huzzah, noble hero, you have forged your path through the sacred Forge of Adventure, wielding tools and commands with the might of a blazing phoenix—your journey has only begun, yet the realm trembles with the promise of your destined glory!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: 🛡️ Quest 2: The Chronicles of Questing ... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/mcp-repo-adventure" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>