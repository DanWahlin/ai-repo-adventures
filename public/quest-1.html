<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: MCP Command Deck: Controlling the Galactic Interface - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Operation Starlight: Mapping the Galactic Code Nexus</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: MCP Command Deck: Controlling the Galactic Interface</h1>
<hr>
<p>Deep within the command deck of the <em>Prometheus Array</em>, a brilliant glow emanates from the Experimental Code Nexus. The MCP system hums with energy as connection sequences pulse across the deck&#39;s monitors. Your mission: synchronize rogue signal pathways and bring order to the chaos destabilizing the Galactic Interface. But the mysteries of the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> and <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> files hold the key‚Äîdecoding protocols and understanding tools that power your journey through the fragmented archives. The stars await your command, adventurer!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server protocol implementation that hosts the adventure tools</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> file is the heart of the MCP framework powering the <em>Prometheus Array&#39;s</em> interactive server. It defines the <code class="inline-code">RepoAdventureServer</code> class, which handles incoming signals from the command deck and processes requests to list or execute various tools. Its <code class="inline-code">setupHandlers()</code> method configures dynamic responses using schemas, ensuring tools can expand without hardcoding. In addition, <code class="inline-code">run()</code> connects the server to its stellar transport system‚Äîusing <code class="inline-code">StdioServerTransport</code> to integrate command signals. The file also features robust error handling in the <code class="inline-code">main()</code> function for seamless shutdown during galactic turbulence. As a bonus, the <code class="inline-code">repoAnalyzer.preGenerate()</code> warms up adventures for faster discovery. Think of this file as the central processing unit of a cosmic spaceship, coordinating all internal systems while preparing the vessel for trans-galactic exploration.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers()</code> dynamically handles <code class="inline-code">ListToolsRequestSchema</code> and <code class="inline-code">CallToolRequestSchema</code> queries.</li>
<li><code class="inline-code">run()</code> integrates <code class="inline-code">StdioServerTransport</code> for seamless command communication between protocols.</li>
<li>Handles graceful shutdown signals (<code class="inline-code">SIGINT</code>, <code class="inline-code">SIGTERM</code>) for stellar resilience during interruptions.</li>
<li>Includes logic to warm up the repomix cache in readiness for user-led exploration.</li>
<li>Error recovery mechanisms ensure the server survives unexpected promise rejections.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The 4 MCP tools offering interactive adventure capabilities</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> file serves as the interface linking user commands to the MCP tools themselves. It begins with the orchestration of four specialized tools: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. These tools provide the user with exploratory power, from analyzing repositories to customizing thematic narratives and diving into quests. The tools are exported individually for easy registration within the MCP framework, simplifying their organization while remaining modular for future customization. Beyond its practical use, the file portrays the tools as celestial instruments, each designed to decode the fragmented archives within the ship‚Äôs reach. Think of this file as a cosmic toolkit designed for precision adjustments amid the chaos of interstellar challenges.</p>
<h4>Highlights</h4>
<ul>
<li>Includes <code class="inline-code">start_adventure</code>, enabling repository analysis with theme presentation capabilities.</li>
<li>Exports <code class="inline-code">choose_theme</code> to inject user preferences into the adventure generation engine.</li>
<li>Enables quest deep-dives with <code class="inline-code">explore_quest</code>, facilitating encrypted repository exploration.</li>
<li>Links progress visibility through the <code class="inline-code">view_progress</code> tool, mapping completed and pending quests.</li>
<li>Organized modularly so tools can adapt with ease to new galactic challenges.</li>
</ul>
<hr>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, {
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(ErrorCode.InternalError, `Tool execution failed: ${error.message}`);
    }
  });
}
</code></pre>
<p>This code dynamically registers command handlers for tools and validates user inputs like a cosmic dispatcher ensuring the right modules process incoming navigation signals.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { adventureManager } from &#39;@ai-repo-adventures/core/adventure&#39;;
import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This code organizes tools into a unified export, akin to an intergalactic toolkit prepared to decode the mysteries of stellar archives through intuitive user commands.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>The <code class="inline-code">setupHandlers()</code> function in <code class="inline-code">server.ts</code> is a great starting point for understanding how tools interact with incoming user queries and schemas.</li>
<li>Refactor or extend <code class="inline-code">tools.ts</code> if you want to add additional tools to enrich the adventure experience‚Äîjust follow the modular format.</li>
<li>Dive into <code class="inline-code">start_adventure.handler</code> next; it decodes repositories, opening new narrative possibilities and setting the stage for stellar quests.</li>
</ul>
<hr>
<p>Stellar breakthrough, Cadet‚ÄîQuest 1 complete: you&#39;ve mastered the MCP Command Deck and taken the first giant leap into the control center of the galactic interface! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: Stellar Forge: Shaping the Ques... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>