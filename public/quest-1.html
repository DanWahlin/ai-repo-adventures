<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Commanding the MCP Control Deck - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Adventure: Navigating the Codebase Nebula</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Commanding the MCP Control Deck</h1>
<hr>
<p>The crew of the Starship <em>Code Voyager</em> is buzzing with excitement as they approach their next challenge: taking command of the MCP Control Deck. The sprawling, labyrinthine protocols of the MCP server must be deciphered, configured, and coordinated for optimal performance. Your task is to bring the <em>Repomix Navigator</em> online and unlock the secrets hidden deep within the code. With precision tools and the collective ingenuity of the crew, this adventure will push the boundaries of what the <em>Code Voyager</em> can achieve. Danger is never far behind in the <strong>Codebase Nebula</strong>‚Äîprepare yourself!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server implementation for tool hosting and execution</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> file is the backbone of the MCP server, orchestrating tool registrations, user interaction, and system functionality. This file initializes the <code class="inline-code">RepoAdventureServer</code>, which is the engine powering our adventure system. Notable components include <code class="inline-code">setupHandlers()</code>, where request handlers are defined, and <code class="inline-code">run()</code>, the method responsible for connecting to the transport system and beginning pre-generation of content telemetry. Another critical section is the <code class="inline-code">main()</code> function, the entry point for the entire system, featuring robust shutdown handling to preserve system integrity across unexpected terminations.</p>
<p>The file leverages the <code class="inline-code">Server</code> class from the MCP SDK to construct a gamified interface. The <code class="inline-code">setupHandlers()</code> method dynamically lists tools such as <code class="inline-code">start_adventure</code> and <code class="inline-code">explore_quest</code>, using schemas to validate input. <code class="inline-code">run()</code> is where the action truly begins as the MCP server connects to the standard I/O server, enabling interaction pipelines. With thoughtful design, the <code class="inline-code">main()</code> function ensures smooth integration, even during unforeseen system-wide exceptions. </p>
<h4>Highlights</h4>
<ul>
<li>The <code class="inline-code">setupHandlers()</code> method defines dynamic behavior for registering and calling tools.</li>
<li><code class="inline-code">run()</code> connects to <code class="inline-code">stdio</code> transport and triggers pre-generation of telemetry content.</li>
<li>The <code class="inline-code">main()</code> function handles graceful shutdowns and unhandled promise rejections gracefully.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Repository exploration tools for the MCP server</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> file is your Swiss Army knife for navigating the codebase. It centralizes the logic for MCP&#39;s interactive tools: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. Each tool comes equipped with handlers that provide a purposefully gamified means of exploring repositories and tracking progress. This modular design makes managing the adventure both intuitive and scalable.</p>
<p>Using this file, the MCP creates a toolkit tailored to codebase exploration. For example, <code class="inline-code">start_adventure</code> analyzes the repository and invites the user to embark on a themed journey, while <code class="inline-code">explore_quest</code> dives deep into specific tasks within that journey. Moreover, the file globally exports the <code class="inline-code">adventureManager</code>, a shared instance intended to ensure seamless state synchronization across tools. MCP defines each tool with strict type-safe schemas and descriptions, allowing for user-friendly input validation and error reporting.</p>
<h4>Highlights</h4>
<ul>
<li>Four core MCP tools (<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, <code class="inline-code">view_progress</code>) assembled in one file.</li>
<li>Exports <code class="inline-code">adventureManager</code> for centralized state management across tools.</li>
<li>Provides clear, Zod-powered schemas for error-free user interactions.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  private server: Server;

  constructor() {
    this.server = new Server(
      {
        name: &#39;repo-adventure&#39;,
        version: &#39;1.0.0&#39;,
        description: &#39;A gamified MCP server for exploring code repositories through interactive storytelling&#39;
      },
      {
        capabilities: {
          tools: {},
        },
      }
    );

    this.setupHandlers();
  }

  private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      ...
    });
  }

  async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
    repoAnalyzer.preGenerate(process.cwd());
  }
}
</code></pre>
<p>The <code class="inline-code">RepoAdventureServer</code> is like the captain of a ship, coordinating every crew member and ensuring smooth operations across the vessel.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

// Export all tools for easy registration
export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This file is like a toolkit designed for astronauts, containing specialized tools for each step of exploration in the Codebase Nebula.</p>
<h2>Helpful Hints</h2>
<ul>
<li>To easily extend functionality, consider adding new handlers to <code class="inline-code">setupHandlers()</code> for more dynamic responses.</li>
<li>Refactor tools to use dependency injection in case you need environment-specific differences like testing vs production.</li>
<li>Look into the schemas defined for tools to understand how to create additional intuitive interfaces for exploration.</li>
</ul>
<hr>
<p>Stellar work, Cadet‚Äîyour mastery of the MCP Control Deck launches this mission onto a warp-speed trajectory toward cosmic success! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Quest Engine‚Äôs Galactic Cor... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>