<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Activating the MCP Command Deck - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Galactic Odyssey: The Codebase Chronicles</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Activating the MCP Command Deck</h1>
<hr>
<p>The stars shimmer like a curtain of decompiled binaries beyond the viewport of <em>The Codex Voyager</em>. Inside the bustling command deck, signals pulse through the MCP system like veins in a neural network. The mission is clear: activate the starship‚Äôs MCP (Model Context Protocol) Command Deck. Doing so requires booting up complex modules, setting handlers for interstellar requests, and preparing the machinery to decode the galaxy‚Äôs chaotic codebase. With your hands gripping the navigation console, the fate of coding adventures across the universe rests in your ability to orchestrate the MCP tools.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Command Deck Bootstrapping</h3>
<p>The file <code class="inline-code">server.ts</code> is your mission‚Äôs heart, responsible for rallying the ship‚Äôs MCP infrastructure. With the <code class="inline-code">RepoAdventureServer</code> class at its core, this script ensures the foundational protocols for syncing MCP tools, handling interstellar command requests, and delivering seamless user interaction. The method <code class="inline-code">setupHandlers()</code> is a critical touchpoint‚Äîit maps MCP protocol messages such as <code class="inline-code">ListTools</code> and <code class="inline-code">CallToolRequest</code> to the appropriate handlers. Think of it as programming the MCP deck‚Äôs translator to interpret galactic commands into actionable operations. </p>
<p>Another key method, <code class="inline-code">run()</code>, connects the system to the <code class="inline-code">StdioServerTransport</code>, ensuring the starship can receive orders from distant clients while simultaneously warming up the Repomix engine for faster responses. This pre-generation step scans the current repository, like activating a ship‚Äôs sensors to map an unexplored cosmic sector. The <code class="inline-code">main()</code> function, the program&#39;s lynchpin, weaves together error-handling mechanisms and graceful shutdown protocols. It‚Äôs the mission control sequence that ensures a safe launch, even in the face of unexpected turbulence.</p>
<h4>Highlights</h4>
<ul>
<li>The <code class="inline-code">setupHandlers()</code> method configures MCP protocol support for tool invocation.</li>
<li><code class="inline-code">run()</code> connects the MCP server transport to establish communication with clients.</li>
<li>The <code class="inline-code">main()</code> function centralizes server startup, shutdown, and error handling.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The MCP Navigation Toolkit</h3>
<p>The file <code class="inline-code">tools.ts</code> arms your starship with its navigation toolkit‚Äîtools for analyzing repositories and guiding users through adventures. Here, the <code class="inline-code">tools</code> object represents a catalog of utilities such as <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. Each encapsulates specific tasks to support interactive adventures, from scanning codebases to generating unique stories. These tools are not merely operational‚Äîthey‚Äôre individually integrated through the <code class="inline-code">adventureManager</code> to ensure they work cohesively.</p>
<p>For instance, the <code class="inline-code">start_adventure</code> tool kicks off the adventure by analyzing the repository and enabling branching paths for exploration. Similarly, <code class="inline-code">choose_theme</code> transforms mundane analysis into delightful narrative by generating stories and themes. <code class="inline-code">explore_quest</code> is your per-quest engine, while <code class="inline-code">view_progress</code> ensures users track adventure milestones. Together, these tools operate like a stellar navigation console, providing every function an aspiring captain needs to command their coding odyssey.</p>
<h4>Highlights</h4>
<ul>
<li>The <code class="inline-code">tools</code> object consolidates key functionalities like <code class="inline-code">start_adventure</code> and <code class="inline-code">explore_quest</code>.</li>
<li>Tools interact via the centralized <code class="inline-code">adventureManager</code> object for unified control.</li>
<li>Prepares the MCP navigation suite to support gamified repository exploration.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];

      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>This code sets up interstellar communication protocols to handle incoming navigation commands from the crew effectively.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This concise object acts as the starship‚Äôs all-in-one navigation panel, containing tools for every phase of the adventure.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Investigate <code class="inline-code">setupHandlers()</code> in <code class="inline-code">server.ts</code> to understand the backbone of MCP command routing.</li>
<li>Explore each tool&#39;s inner workings in <code class="inline-code">tools.ts</code> to master their specific use cases and interconnectedness.</li>
<li>Extend tool capabilities by adding functions to the <code class="inline-code">tools</code> object and linking them to the <code class="inline-code">adventureManager</code>.</li>
</ul>
<hr>
<p>Mission accomplished, Commander: the MCP Command Deck is online, propelling your starship of knowledge into uncharted galaxies‚Äîstellar work! ‚≠êüöÄüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: Decoding the Quest Generation E... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>