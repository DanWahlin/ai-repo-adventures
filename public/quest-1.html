<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öôÔ∏è Quest 1: The Castle Keep of Server Guardians - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <script>
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">üè∞ Realm of Enchanted Code: The Quest for the Mystic Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1><span class="header-prefix">‚öôÔ∏è Quest 1:</span> The Castle Keep of Server Guardians</h1>
<hr>
<p>The adventurer stood before the majestic Castle Keep, the heart of the Server Guardians&#39; domain. The golden gates gleamed with runes of protection, whispering of hidden protocols and ancient tools that governed the enchanted repository. To fulfill the prophecy, the adventurer must decode the secrets of this keep‚Äîconstructing bridges between the magical tools and understanding the sacred mechanisms running the kingdom. Every spell cast here would ripple through the land, shaping the destiny of Repomiria.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>This file is the very blueprint of the Castle Keep itself, housing the structure for hosting adventure tools through the Model Context Protocol (MCP). It defines the <strong>RepoAdventureServer</strong> class, which acts as the keeper of this enchanted realm. The file includes critical functions that set up handlers for tool management, ensure graceful communication through the castle‚Äôs &quot;stdio&quot; transport system, and prep the keep for adventurer interactions. By defining handlers for listing and executing tools, the file allows essential components like <em>start_adventure</em> and <em>explore_quest</em> to shine. Key methods include <code class="inline-code">setupHandlers</code>, which registers the tools&#39; magical scripts, and <code class="inline-code">run</code>, which activates the enchanted server, preparing it for adventurers. The entry point <code class="inline-code">main</code> ensures the keep handles various signals‚Äîlike unexpected bursts of chaos (errors)‚Äîand gracefully shuts down when the quest ends.</p>
<h4>Highlights</h4>
<ul>
<li>Registers handlers for listing tools and invoking them dynamically.</li>
<li>Initiates stdio-based server communication.</li>
<li>Handles graceful shutdown and pre-generation of codebase content.</li>
</ul>
<h3><span class="header-prefix">src/tools/tools.ts:</span> MCP Adventure Tools</h3>
<p>This file is filled with the mystical scripts that power adventuring magic. It introduces the main enchanted tools: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>, each one a cornerstone of the adventurer&#39;s journey. These tools allow brave heroes to analyze the repository, choose a theme, explore a quest, and track their progress. By importing supporting components such as <em>adventureManager</em>, the file ensures that these tools integrate seamlessly with the enchanted repository. Each tool works like a spell scroll‚Äîrequiring specific &quot;schemas&quot; (ingredients) to validate the adventurer‚Äôs input before unleashing its magic. </p>
<h4>Highlights</h4>
<ul>
<li>Centralizes the main tools for repository exploration.</li>
<li>Re-exports tools in a structured manner for easy integration.</li>
<li>Provides an interactive gateway for magical scripting.</li>
</ul>
<h2>Code</h2>
<h3>src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
    // Dynamic tool listing
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    // Dynamic tool execution
    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        // Validate arguments using the tool&#39;s Zod schema
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        // Execute the tool handler with validated arguments
        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
  }
</code></pre>
<p>Just like a royal steward, it ensures that only validated requests from adventurers are processed and forwarded to the enchanted tools.</p>
<h3>src/tools/tools.ts</h3>
<pre><code class="language-typescript">// Export the shared adventure manager for tools that need it
export { adventureManager };

// Re-export tools with MCP naming convention
export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;


// Export all tools for easy registration
export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This acts like an adventurer&#39;s toolkit, packaging all the spell scrolls needed for a journey into one cohesive bundle.</p>
<h2>Helpful Hints</h2>
<ul>
<li><p>Practical tips or key insights:</p>
<ul>
<li>The server setup logic enables flexibility when adding or modifying tools.</li>
</ul>
</li>
<li><p>Recommendations for related code exploration or refactoring:
Explore <code class="inline-code">repoAnalyzer</code> for better caching infrastructure next debugging freezes .</p>
</li>
</ul>
<p>üè∞ Hail, valiant hero, for you have conquered the Castle Keep of Server Guardians, claiming your place among the stars of legend and igniting the beacon of progress on this grand odyssey!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: üíé Quest 2: The Codemancer‚Äôs Spellbook o... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>