<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒ  Quest 1: Command Deck Protocols - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <script>
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>
    <!-- Animated background SVG -->
    <div class="animated-background">
        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" style="position: absolute; top: 0; left: 0; z-index: -2; opacity: 0.6;">
            <defs>
                <linearGradient id="spaceGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#64ffda" stop-opacity="0.8"/>
                    <stop offset="50%" stop-color="#82b1ff" stop-opacity="0.6"/>
                    <stop offset="100%" stop-color="#7c4dff" stop-opacity="0.4"/>
                </linearGradient>
                <linearGradient id="ancientGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#ffd700" stop-opacity="0.8"/>
                    <stop offset="50%" stop-color="#ff8c00" stop-opacity="0.6"/>
                    <stop offset="100%" stop-color="#8b4513" stop-opacity="0.4"/>
                </linearGradient>
                <linearGradient id="mythicalGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#9370db" stop-opacity="0.8"/>
                    <stop offset="50%" stop-color="#da70d6" stop-opacity="0.6"/>
                    <stop offset="100%" stop-color="#4b0082" stop-opacity="0.4"/>
                </linearGradient>
                <radialGradient id="planetGradient" cx="30%" cy="30%" r="70%">
                    <stop offset="0%" stop-color="#64b5f6"/>
                    <stop offset="50%" stop-color="#1976d2"/>
                    <stop offset="100%" stop-color="#0d47a1"/>
                </radialGradient>
                <radialGradient id="moonGradient" cx="40%" cy="40%" r="60%">
                    <stop offset="0%" stop-color="#e0e0e0"/>
                    <stop offset="70%" stop-color="#9e9e9e"/>
                    <stop offset="100%" stop-color="#424242"/>
                </radialGradient>
                <linearGradient id="spaceshipGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#90caf9"/>
                    <stop offset="50%" stop-color="#64b5f6"/>
                    <stop offset="100%" stop-color="#1976d2"/>
                </linearGradient>
                <filter id="glow">
                    <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                    <feMerge> 
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>

            <!-- Space Adventure Animation -->
            <g class="space-theme" style="display: var(--space-display, block);">
                
                <!-- Background Stars - MUCH MORE VISIBLE -->
                <g class="stars">
                    <circle cx="5%" cy="15%" r="8" fill="#ffffff" opacity="0.9">
                        <animate attributeName="opacity" values="0.6;1;0.6" dur="3s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="12%" cy="25%" r="6" fill="#64ffda" opacity="0.8">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="4s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="25%" cy="10%" r="10" fill="#82b1ff" opacity="0.9">
                        <animate attributeName="opacity" values="0.6;1;0.6" dur="5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="35%" cy="30%" r="5" fill="#ffffff" opacity="0.7">
                        <animate attributeName="opacity" values="0.4;0.9;0.4" dur="6s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="45%" cy="8%" r="7" fill="#7c4dff" opacity="0.8">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="3.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="55%" cy="20%" r="6" fill="#64ffda" opacity="0.7">
                        <animate attributeName="opacity" values="0.4;0.9;0.4" dur="4.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="65%" cy="35%" r="9" fill="#ffffff" opacity="0.8">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="5.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="15%" cy="85%" r="7" fill="#82b1ff" opacity="0.8">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="4s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="30%" cy="90%" r="8" fill="#7c4dff" opacity="0.7">
                        <animate attributeName="opacity" values="0.4;0.9;0.4" dur="6s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="50%" cy="85%" r="6" fill="#ffffff" opacity="0.8">
                        <animate attributeName="opacity" values="0.5;1;0.5" dur="3s" repeatCount="indefinite"/>
                    </circle>
                </g>

                <!-- Distant Galaxy - MUCH MORE VISIBLE -->
                <ellipse cx="75%" cy="25%" rx="40" ry="20" fill="none" stroke="url(#spaceGradient)" stroke-width="3" opacity="0.8">
                    <animateTransform attributeName="transform" type="rotate" 
                        values="0 75 25; 360 75 25" dur="120s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.6;1;0.6" dur="8s" repeatCount="indefinite"/>
                </ellipse>

                <!-- Planet System (Right Side Outside Content) - MUCH BIGGER AND MORE VISIBLE -->
                <g class="planet-system" transform="translate(1400, 400)">
                    <!-- Planet -->
                    <circle cx="0" cy="0" r="60" fill="url(#planetGradient)" filter="url(#glow)" opacity="0.9">
                        <animate attributeName="opacity" values="0.8;1;0.8" dur="4s" repeatCount="indefinite"/>
                    </circle>
                    <!-- Planet surface details -->
                    <circle cx="-20" cy="-15" r="10" fill="#4a90e2" opacity="0.8"/>
                    <circle cx="15" cy="20" r="15" fill="#357abd" opacity="0.7"/>
                    <circle cx="-8" cy="30" r="8" fill="#4a90e2" opacity="0.9"/>
                    
                    <!-- Moon orbit path (visible for debugging) -->
                    <circle cx="0" cy="0" r="100" fill="none" stroke="#64ffda" stroke-width="1" opacity="0.3"/>
                    
                    <!-- Moon -->
                    <g class="moon">
                        <circle cx="100" cy="0" r="20" fill="url(#moonGradient)" filter="url(#glow)" opacity="0.9">
                            <animate attributeName="opacity" values="0.7;1;0.7" dur="3s" repeatCount="indefinite"/>
                        </circle>
                        <!-- Moon craters -->
                        <circle cx="105" cy="-5" r="4" fill="#666" opacity="0.6"/>
                        <circle cx="95" cy="5" r="3" fill="#666" opacity="0.5"/>
                        
                        <!-- Moon orbital animation -->
                        <animateTransform attributeName="transform" type="rotate" 
                            values="0 0 0; 360 0 0" dur="20s" repeatCount="indefinite"/>
                    </g>
                </g>

                <!-- Spaceship Journey - MUCH BIGGER AND MORE VISIBLE -->
                <g class="spaceship">
                    <!-- Spaceship body -->
                    <g>
                        <ellipse cx="0" cy="0" rx="30" ry="10" fill="url(#spaceshipGradient)" filter="url(#glow)" opacity="0.9"/>
                        <!-- Spaceship details -->
                        <rect x="-20" y="-3" width="40" height="6" fill="#82b1ff" opacity="0.9"/>
                        <circle cx="-15" cy="0" r="4" fill="#64ffda" opacity="1"/>
                        <circle cx="15" cy="0" r="3" fill="#ff6b6b" opacity="0.9"/>
                        
                        <!-- Engine glow -->
                        <ellipse cx="-30" cy="0" rx="8" ry="5" fill="#64ffda" opacity="0.8">
                            <animate attributeName="opacity" values="0.5;1;0.5" dur="0.5s" repeatCount="indefinite"/>
                        </ellipse>
                        
                        <!-- Human figure in spaceship -->
                        <g class="human" transform="translate(5, 0)">
                            <circle cx="0" cy="-3" r="3" fill="#ffcc99" opacity="0.9"/> <!-- Head -->
                            <rect x="-2" y="0" width="4" height="6" fill="#4a90e2" opacity="0.9"/> <!-- Body -->
                        </g>
                        
                        <!-- Spaceship trail -->
                        <ellipse cx="-40" cy="0" rx="15" ry="3" fill="#64ffda" opacity="0.4">
                            <animate attributeName="opacity" values="0.2;0.6;0.2" dur="1s" repeatCount="indefinite"/>
                        </ellipse>
                    </g>
                    
                    <!-- Journey Animation (60 second cycle) -->
                    <animateTransform attributeName="transform" type="translate"
                        values="100 400; 100 400; 500 400; 600 400; 600 400; 500 400; 100 400; 100 400"
                        dur="60s" repeatCount="indefinite"/>
                    
                    <!-- Opacity for fade out effect -->
                    <animate attributeName="opacity" 
                        values="0;1;1;1;1;1;1;0" 
                        dur="60s" repeatCount="indefinite"/>
                </g>

                <!-- Spaceship Trail Effect - MORE VISIBLE -->
                <g class="spaceship-trail">
                    <path d="M 100 400 Q 300 250 500 400" stroke="url(#spaceGradient)" stroke-width="5" 
                          fill="none" opacity="0.8" stroke-dasharray="10,10">
                        <animate attributeName="stroke-dashoffset" values="0;-20" dur="1s" repeatCount="indefinite"/>
                        <animate attributeName="opacity" 
                            values="0;0;0.8;1;0.8;0;0;0" 
                            dur="60s" repeatCount="indefinite"/>
                    </path>
                </g>

            </g>

            <g class="ancient-theme" style="display: var(--ancient-display, none);">
                <polygon points="10,20 20,20 15,10" fill="url(#ancientGradient)" opacity="0.4" 
                         transform="translate(50, 200)">
                    <animateTransform attributeName="transform" type="translate" 
                        values="50,200; 80,160; 50,200" dur="12s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.2;0.6;0.2" dur="8s" repeatCount="indefinite"/>
                </polygon>
                <rect x="640" y="240" width="8" height="8" fill="url(#ancientGradient)" opacity="0.3"
                      transform="rotate(45, 644, 244)">
                    <animateTransform attributeName="transform" type="rotate" 
                        values="45 644 244; 405 644 244; 45 644 244" dur="20s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.3;0.7;0.3" dur="6s" repeatCount="indefinite"/>
                </rect>
                <circle cx="20%" cy="70%" r="4" fill="none" stroke="url(#ancientGradient)" 
                        stroke-width="2" opacity="0.4">
                    <animate attributeName="r" values="4;6;4" dur="10s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.2;0.5;0.2" dur="7s" repeatCount="indefinite"/>
                </circle>
            </g>

            <g class="mythical-theme" style="display: var(--mythical-display, none);">
                <path d="M 15,25 L 18,22 L 21,25 L 18,28 Z M 15,25 L 12,22 L 15,19 L 18,22 Z" 
                      fill="url(#mythicalGradient)" opacity="0.5" transform="translate(80, 240)">
                    <animateTransform attributeName="transform" type="rotate" 
                        values="0 98 258; 360 98 258; 0 98 258" dur="8s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.3;0.8;0.3" dur="4s" repeatCount="indefinite"/>
                </path>
                <path d="M 5,10 L 7,8 L 9,10 L 7,12 Z" fill="url(#mythicalGradient)" 
                      opacity="0.4" transform="translate(600, 160)">
                    <animateTransform attributeName="transform" type="translate" 
                        values="600,160; 624,120; 600,160" dur="6s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.2;0.7;0.2" dur="3s" repeatCount="indefinite"/>
                </path>
                <circle cx="25%" cy="75%" r="3" fill="url(#mythicalGradient)" opacity="0.4">
                    <animate attributeName="r" values="3;6;3" dur="5s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" values="0.3;0.8;0.3" dur="4s" repeatCount="indefinite"/>
                </circle>
            </g>
        </svg>
    </div>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">ðŸš€ Starship Polaris: Navigators of the Code Nebula</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1><span class="header-prefix">Quest 1:</span> Command Deck Protocols ðŸŒ </h1>
<hr>
<p>With the Starship Polarisâ€™ command deck humming quietly, your crew prepares to engage the critical systems that will guide your expedition through the Code Nebula. Every protocol activated aboard represents a gateway to new cosmic insights into the tangled clusters of stellar code that await. Your first mission calibrates the MCP server â€” the missionâ€™s core AI â€” setting the foundation for all adventures to come. As you navigate through the startup sequence, detecting and registering exploration tools, you feel the pulse of the nebulaâ€™s data pressure building. Ready your consoles: your voyage from uncertainty to mastery begins with commanding these protocols into seamless orchestration.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">src/server.ts:</span> MCP server protocol implementation that hosts the adventure tools</h3>
<p>This file is the heartbeat of Starship Polarisâ€™ onboard MCP server, orchestrating the interactive adventure tools that let the crew explore the Code Nebula. The <code class="inline-code">RepoAdventureServer</code> class sets up handlers for protocol messages that list available tools and execute them on demand. These handlers act like air traffic controllers, directing input streams and safeguarding against unknown commands or invalid parameters with precision and grace. The <code class="inline-code">run</code> method brings the entire MCP server online, connecting it through the stdio transport and quietly warming the repomix engines â€” analogous to pre-heating scanners before entering an asteroid belt. The file also includes a thoughtful <code class="inline-code">main</code> routine that manages graceful shutdown on command and robust error management, ensuring the mission remains unshaken even when unexpected cosmic storms (unhandled exceptions) arise. The robustness of this file underpins the entire exploration experience, providing a reliable command deck for crew interactions.</p>
<h4>Highlights</h4>
<ul>
<li>Registers MCP protocol handlers for listing tools and executing missions</li>
<li>Connects stdio transport and pre-generates repomix content for efficiency</li>
<li>Implements graceful shutdown and unhandled rejection safety controls</li>
</ul>
<h3><span class="header-prefix">src/tools/tools.ts:</span> The 4 main MCP tools providing the user interface to the adventure system</h3>
<p>This module serves as the core toolkit repository aboard Polaris, offering the primary means for interfacing with the MCP adventure system. Here, four versatile tools â€” <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code> â€” are defined and neatly re-exported, ready for dispatch at the crewâ€™s command. The tools correspond to the key phases of an interstellar exploration: ignition, destination selection, mission execution, and voyage tracking. By composing these tools in a centralized file, the architecture evokes a starshipâ€™s command panel where each button triggers a fundamental operation tied intricately to the nebulaâ€™s mysteries. The tight integration between the tools and the <code class="inline-code">adventureManager</code> ensures synchronized state updates, reflecting the crewâ€™s real-time progress amidst the nebulaâ€™s challenges.</p>
<h4>Highlights</h4>
<ul>
<li>Exports core adventure tools mapped to platform operations</li>
<li>Maintains shared adventure state via <code class="inline-code">adventureManager</code></li>
<li>Organizes tools for modular registration and interaction</li>
</ul>
<h3><span class="header-prefix">src/adventure/adventure-manager.ts:</span> Adventure orchestration managing state, themes, and user interactions</h3>
<p>The adventure manager is the Polarisâ€™ onboard navigation AI responsible for steering through the code nebulaâ€™s layered mysteries. Its initialization sequence sets the adventureâ€™s thematic course, embedding project data and repomix content into the mission logs. When a crew member explores a quest, this module validates their thematic choices like mission directives and orchestrates content delivery tailored to specified files or full contexts. It tracks progress, like a navigation system charting traveled star routes, computing percentages that reveal how far the crew has ventured. This stateful system harmonizes user inputs, content generation, and progress visualization, ensuring the crew is always aware of their cosmic progress towards reigning mastery over code and star maps alike.</p>
<h4>Highlights</h4>
<ul>
<li>Initializes adventure with project context and theme-based stories</li>
<li>Validates user choices and manages targeted content generation</li>
<li>Tracks and reports completion percentage of adventures</li>
</ul>
<h3><span class="header-prefix">src/adventure/story-generator.ts:</span> LLM-powered story creation with theme-based narratives and prompt engineering</h3>
<p>In this module, the imaginative currents of artificial intelligence breathe life into the Polarisâ€™ cosmic narrative. Using advanced LLM prompt engineering, the story generator crafts thematic adventures and vivid narratives brimming with space exploration metaphors. It composes structured JSON responses describing quests as celestial tasks, encouraging immersive exploration of the codebase like navigating star systems and decoding alien transmissions. The generatorâ€™s ability to tailor prompts with theme guidelines ensures consistent and evocative language, turning technical details into memorable cosmic stories. Additionally, it assembles adventure content that includes code snippets and exploration hints, bridging the technical and narrative seamlessly for an engaging learning experience.</p>
<h4>Highlights</h4>
<ul>
<li>Generates complete story and adventure lists using LLM with JSON structure</li>
<li>Builds detailed prompts following space-themed storytelling guidelines</li>
<li>Produces adventure content rich in coded examples and exploratory missions</li>
</ul>
<h3><span class="header-prefix">src/shared/adventure-config.ts:</span> Configuration system for guided adventures that enhance story generation</h3>
<p>The adventure configuration module acts like Polarisâ€™ mission control parameters, containing files such as <code class="inline-code">adventure.config.json</code> that provide crucial guidance for the narrative engine. This config system allows captains of the mission to set preferred directives, spotlight specific files or functions, and tailor the adventure flow to the precise coordinates of the code universe. By formatting configurations for LLM prompts, the module ensures the AIâ€™s storytelling is aligned with mission objectives and starship policies. Extracting function and file highlights produces workshop-style missions, helping the crew focus on luminary features amidst the nebulaâ€™s vast code clusters.</p>
<h4>Highlights</h4>
<ul>
<li>Loads and manages adventure guidance from configuration files</li>
<li>Formats config data for injection into LLM story generation prompts</li>
<li>Extracts key highlights for spotlighted files and functions during quests</li>
</ul>
<h3><span class="header-prefix">src/analyzer/repo-analyzer.ts:</span> Repomix integration for codebase analysis and targeted content extraction</h3>
<p>This critical file embodies Polarisâ€™ cosmic scanner and data synthesizer â€” the repomix analyzer. Charged with generating comprehensive or pinpoint-targeted context, it validates project paths like scanning warp routes for safe passage. By invoking the repomix CLI subprocess and capturing its structured output, the analyzer transforms raw data into actionable star maps, which the crew can explore interactively. Cache mechanisms optimize repeated scans, ensuring swift navigation on re-entry missions. This module effectively translates terrestrial codebases into stellar formations ripe for exploration, unlocking secrets hidden within the fabric of digital space.</p>
<h4>Highlights</h4>
<ul>
<li>Generates full or targeted repomix-based project context with caching</li>
<li>Validates paths to avoid dangerous or system-level explorations</li>
<li>Captures and parses repomix CLI output for structured codebase data</li>
</ul>
<h3><span class="header-prefix">src/llm/llm-client.ts:</span> Multi-provider LLM integration supporting OpenAI, Azure OpenAI, and GitHub Models</h3>
<p>Here resides the communication hub between Polaris and the universe of LLM providers. The client handles requests with timeout protections, serving as the starshipâ€™s relay to various AI constellations including OpenAI and GitHub-hosted models. It automatically detects provider types, configures API clients accordingly, and fetches the right credentials without human intervention. This module ensures a smooth, secure connection to the cosmic language engines powering Polarisâ€™ narrative and knowledge extraction capabilities, enabling timely and formatted responses critical for real-time mission dialogs.</p>
<h4>Highlights</h4>
<ul>
<li>Manages multi-provider LLM API key handling and client setup</li>
<li>Supports timeout for request reliability during cosmic data exchanges</li>
<li>Formats responses into JSON for structured mission communication</li>
</ul>
<h3><span class="header-prefix">src/shared/config.ts:</span> Central configuration for timeouts, limits, and environment settings</h3>
<p>Serving as Polarisâ€™ system-wide constants, this module defines operational thresholds like LLM request timeouts and repomix cache time-to-live. These parameters govern the mission systemsâ€™ responsiveness and memory footprint, preventing overloads during intense exploratory bursts. File size restrictions guard against black holes of data that could destabilize the navigation systems. By centralizing these variables, the starship maintains a balanced workflow calibrated for efficiency and stability in the depths of the Code Nebula.</p>
<h4>Highlights</h4>
<ul>
<li>Configures timeouts and cache limits for adventure tools and LLM integrations</li>
<li>Defines maximum file sizes to avoid memory-intensive operations</li>
<li>Centralizes environment settings for consistent mission parameters</li>
</ul>
<h3><span class="header-prefix">src/shared/theme.ts:</span> Theme definitions and validation for space, medieval, and ancient themes</h3>
<p>This thematic core offers Polaris a selection of immersive expedition styles. It lists preset themes with starship-relevant vocabulary and display metadata, enabling crews to choose their narrative costume for adventure. Validation logic ensures user input aligns with predefined themes, maintaining consistent storytelling across the journey. By presenting themes as selectable galaxies, this module enriches user engagement and personalizes the adventureâ€™s cosmic flavor.</p>
<h4>Highlights</h4>
<ul>
<li>Provides built-in themes with vocabulary and descriptive metadata</li>
<li>Validates theme input through name and keyword recognition mechanisms</li>
<li>Supports dynamic listing of available themes to user interfaces</li>
</ul>
<h3><span class="header-prefix">src/shared/input-validator.ts:</span> Security and input validation preventing injection attacks</h3>
<p>Safety is paramount on Polaris, and this module serves as the shipâ€™s defense grid against malicious commands. It sanitizes user input to validate adventure choices against approved mission parameters. It prevents unauthorized path explorations or escape attempts beyond the starshipâ€™s authorized code space. Acting like a cosmic firewall, the validator preserves the integrity and purity of every command the crew submits, safeguarding the missionâ€™s success and data sanctity.</p>
<h4>Highlights</h4>
<ul>
<li>Whitelist validation of user adventure selections</li>
<li>Path validation to restrict unsafe filesystem access</li>
<li>Centralized input validation utilities ensuring mission security</li>
</ul>
<h3><span class="header-prefix">src/shared/types.ts:</span> Core data structures and interfaces used throughout the system</h3>
<p>Defining the missionâ€™s data schematics, this module catalogs fundamental structures like ProjectInfo, Adventure, and AdventureContent. These interfaces dictate how codebase snapshots, narrative quests, and exploration hints are recorded and exchanged across Polarisâ€™ systems. By providing clear blueprints, it ensures that every data packet navigating the MCP channels is comprehensible, consistent, and ready for immediate execution by crew consoles.</p>
<h4>Highlights</h4>
<ul>
<li>Defines essential interfaces for project metadata and adventure flow</li>
<li>Standardizes content and snippets format for interactive missions</li>
<li>Supports downstream components with robust typing for reliability</li>
</ul>
<h3><span class="header-prefix">src/shared/error-handling.ts:</span> Comprehensive error management with context and structured error types</h3>
<p>Polaris sails through unpredictable cosmic currents, and this file installs a tranquil error management protocol. It provides tailored error classes for distinct mission failuresâ€”from file system misreads to AI generation breakdownsâ€”enabling precise recovery strategies. Detailed contextual error messages alert mission control while preserving the crewâ€™s focus on exploration. This structured error handling acts like the starshipâ€™s emergency protocols, allowing controlled responses during unforeseen anomalies.</p>
<h4>Highlights</h4>
<ul>
<li>Defines error classes for analysis, story generation, and user interaction errors</li>
<li>Includes contextual information for targeted diagnostics</li>
<li>Structured approach aids graceful error recovery and user notification</li>
</ul>
<h3><span class="header-prefix">src/utils/zod-to-json-schema.ts:</span> Schema conversion utility for MCP tool registration and validation</h3>
<p>Fueling the interoperability of Polarisâ€™ MPC tools, this utility converts complex Zod validation schemas into JSON Schema 7 format. This ensures that all tool inputs and outputs can be explicitly verified across system boundaries, facilitating seamless communication and error detection. By acting as a translation engine between validation dialects, this utility helps maintain consistent starship-wide protocol adherence and user input sanity checks.</p>
<h4>Highlights</h4>
<ul>
<li>Converts Zod schemas to JSON Schema 7 for protocol registration</li>
<li>Ensures input validation integration with MCP protocol standards</li>
<li>Supports dynamic tool registration and client tool listing interfaces</li>
</ul>
<h2>Code</h2>
<h3>src/server.ts</h3>
<pre><code class="language-typescript">#!/usr/bin/env node

import { Server } from &#39;@modelcontextprotocol/sdk/server/index.js&#39;;
import { StdioServerTransport } from &#39;@modelcontextprotocol/sdk/server/stdio.js&#39;;
import {
  CallToolRequestSchema,
  ErrorCode,
  ListToolsRequestSchema,
  McpError,
} from &#39;@modelcontextprotocol/sdk/types.js&#39;;
import { tools } from &#39;./tools/tools.js&#39;;
import { zodToJsonSchema } from &#39;zod-to-json-schema&#39;;
import { repoAnalyzer } from &#39;./analyzer/repo-analyzer.js&#39;;

class RepoAdventureServer {
  private server: Server;

  constructor() {
    this.server = new Server(
      {
        name: &#39;repo-adventure&#39;,
        version: &#39;1.0.0&#39;,
        description: &#39;A gamified MCP server for exploring code repositories through interactive storytelling&#39;
      },
      {
        capabilities: {
          tools: {},
        },
      }
    );

    this.setupHandlers();
  }

  private setupHandlers() {
    // Dynamic tool listing
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    // Dynamic tool execution
    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        // Validate arguments using the tool&#39;s Zod schema
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        // Execute the tool handler with validated arguments
        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
  }

  async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
    
    // Pre-generate repomix content for the current working directory to warm up the cache
    // This happens in the background while waiting for user commands
    const projectPath = process.cwd();
    console.error(`Pre-generating repomix content for project at ${projectPath}...`);
    repoAnalyzer.preGenerate(projectPath);
  }
}

function gracefulShutdown() {
  console.error(&#39;\nShutting down MCP server...&#39;);
  try {
    repoAnalyzer.cleanup();
  } catch (e) {
    console.error(&#39;Cleanup error:&#39;, e);
  }
  process.exit(0);
}

async function main() {
  try {
    const server = new RepoAdventureServer();
    
    // Handle graceful shutdown for both signals
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    
    // Handle unhandled promise rejections - log but don&#39;t shutdown during normal operation
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
      // Don&#39;t call gracefulShutdown() here as it may be a recoverable error
    });
    
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}

main().catch((error) =&gt; {
  console.error(&#39;Unhandled error:&#39;, error);
  process.exit(1);
});
</code></pre>
<p>This code is like the central command system of the Starship Polaris, managing the communications between the crewâ€™s commands and the shipâ€™s critical adventure tools while keeping everything running smoothly even in the face of unexpected cosmic interference.</p>
<h3>src/tools/tools.ts</h3>
<pre><code class="language-typescript">/**
 * MCP Repo Adventure Tools - Main Entry Point
 * 
 * These tools provide an interactive, gamified way to explore and understand codebases.
 * The typical flow is:
 * 1. start_adventure - Analyzes the codebase and presents theme options
 * 2. choose_theme - Generates a custom story and quests based on the selected theme
 * 3. explore_quest - Explores individual quests (can be called multiple times)
 * 4. view_progress - Check completion status and see remaining quests
 * 
 * Each tool has detailed descriptions to help MCP clients understand when to use them
 * rather than relying on their base LLM for responses.
 * 
 * Tools are now organized in separate files for better maintainability.
 */

import { adventureManager } from &#39;../adventure/state.js&#39;;
import { startAdventure } from &#39;./start-adventure.js&#39;;
import { chooseTheme } from &#39;./choose-theme.js&#39;;
import { exploreQuest } from &#39;./explore-quest.js&#39;;
import { viewProgress } from &#39;./view-progress.js&#39;;

// Export the shared adventure manager for tools that need it
export { adventureManager };

// Re-export tools with MCP naming convention
export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;


// Export all tools for easy registration
export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This module is like the starshipâ€™s controls panel where each button triggers a key mission tool, enabling the crew to navigate and analyze the cosmic code nebula with precision and coordination.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Keep an eye on the MCP serverâ€™s lifecycle events and error handling to ensure seamless user experiences in future quests.</li>
<li>Exploring <code class="inline-code">adventureManager</code> and <code class="inline-code">story-generator</code> next will deepen understanding of how narrative and quest content are dynamically created.</li>
<li>Consider reviewing repomix integration in <code class="inline-code">repo-analyzer.ts</code> to learn how real-time code exploration parallels cosmic scanning techniques.</li>
</ul>
<p>Stellar work, Cadet! Youâ€™ve successfully navigated the Command Deck Protocols and set your mission on course for cosmic mastery!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: ðŸš¦ Quest 2: Astro-Quest Engine â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/mcp-repo-adventure" target="_blank" rel="noopener noreferrer" class="repo-link">MCP Repo Adventure</a>
        </div>
    </footer>
</body>
</html>