<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Bridge of the MCP: Orchestrating the Protocols of Space Travel - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Cosmos of QuestCode: A Galactic Odyssey</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Bridge of the MCP: Orchestrating the Protocols of Space Travel</h1>
<hr>
<p>The <em>SS Refactoria</em> hummed gently as it ascended into the digital ether toward the next repository cluster. Commander Zyla adjusted her visor, scanning the galactic star charts glimmering on the main console. Their mission: synchronize the interstellar mechanics of the <em>ModelContext Protocol Server</em> (MCP) to navigate new frontiers in repository-driven storytelling. The stakes were stellar—align the chaotic systems of the MCP and shape tools that could launch developers into endless orbits of innovation. Somewhere within this complex code nebula lay answers, but they would have to decode it, one quantum protocol at a time.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server protocol implementation that hosts the adventure tools</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> file is the starship’s command bridge, orchestrating the flow of MCP tool requests while maintaining system stability under the load of cosmic exploration. The file begins by defining the <code class="inline-code">RepoAdventureServer</code> class, which encapsulates the core MCP functionalities. Key methods within this class include <code class="inline-code">setupHandlers()</code>—a dynamic mechanism for registering and validating protocol handlers for tools—and <code class="inline-code">run()</code>, which connects the server’s transport stream and pre-generates code analysis content with the <code class="inline-code">repoAnalyzer</code>. The file also contains the <code class="inline-code">main()</code> function, the server’s launch sequence, initializing shutdown safety protocols for smooth landings in turbulent runtime atmospheres.</p>
<p>In the galaxy of technical detail, <code class="inline-code">setupHandlers()</code> is the powerhouse responsible for dynamically listing tools like <code class="inline-code">start_adventure</code> and executing them only after strict input validation. The <code class="inline-code">run()</code> method stands out as a preparatory phase for activating the ship’s systems, ensuring the MCP server is ready to receive commands when connected to its primary <code class="inline-code">stdio</code> transport. This file is emblematic of a meticulously constructed craft, designed for both flexibility and resilience during exploration.</p>
<h4>Highlights</h4>
<ul>
<li>Registers tool handling protocols dynamically via <code class="inline-code">setupHandlers()</code>.</li>
<li>Safeguards runtime execution with error handling in <code class="inline-code">main()</code>.</li>
<li>Pre-generates <code class="inline-code">repomix</code> data for smooth operational readiness.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Interface for MCP tools enabling interactive storytelling</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> file serves as the mission toolkit for embarking on the cosmic storytelling adventure. This file exports the core MCP tools—<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. These tools represent phases of the quest and are designed to engage users step by step. For instance, <code class="inline-code">start_adventure.handler</code> exists to analyze repositories and prepare engaging themes to explore, while <code class="inline-code">explore_quest.handler</code> enables a deeper dive into individual tasks, tracking progress as explorers navigate their way across the narrative.</p>
<p>Each tool is meticulously defined with handlers that transform complex technical operations into comprehensible user journeys. The orchestration of interaction heavily relies on the <code class="inline-code">adventureManager</code>, ensuring these tools integrate with larger systems across the server. Overall, this file ensures that users are equipped with the right “instruments” for their exploratory mission.</p>
<h4>Highlights</h4>
<ul>
<li>Contains all MCP tools as independent handlers for seamless modularity.</li>
<li>Utilizes <code class="inline-code">adventureManager</code> to bridge tools with greater adventure logic.</li>
<li>Exports tools in a unified structure to simplify MCP server registration.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  private server: Server;

  constructor() {
    this.server = new Server(
      {
        name: &#39;repo-adventure&#39;,
        version: &#39;1.0.0&#39;,
        description: &#39;A gamified MCP server for exploring code repositories through interactive storytelling&#39;
      },
      {
        capabilities: {
          tools: {},
        },
      }
    );

    this.setupHandlers();
  }

  private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
  }

  async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
    
    const projectPath = process.cwd();
    console.error(`Pre-generating repomix content for project at ${projectPath}...`);
    repoAnalyzer.preGenerate(projectPath);
  }
}
</code></pre>
<p>This code is like a spaceport control tower that ensures all incoming and outgoing flights (or tools) are validated, cleared, and ready to soar.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { adventureManager } from &#39;@ai-repo-adventures/core/adventure&#39;;
import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export { adventureManager };

export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This file acts as the explorer’s toolkit, ensuring every tool needed on the cosmic journey is at arm’s reach, neatly packed and ready to deploy.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Familiarize yourself with <code class="inline-code">setupHandlers()</code> logic to understand how requests are validated and processed dynamically.</li>
<li>Delve into <code class="inline-code">start_adventure.handler</code> for insights into how repositories are analyzed for adventure themes.</li>
<li>Explore the connection between <code class="inline-code">adventureManager</code> and tools—it’s the glue that binds overarching logic to individual functionalities.</li>
</ul>
<hr>
<p>Congratulations, Star Voyager! You’ve completed Quest 1 and charted the cosmic protocols, igniting the thrusters for your stellar journey through the uncharted universe—keep shining like a supernova! 🚀⭐📡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Adventure Drive: Mapping th... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>