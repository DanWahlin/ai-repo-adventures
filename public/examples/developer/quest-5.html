<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration & Theme System - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Developer's Guide to AI Repository Adventures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Configuration and Theme System</h1>
<hr>
<p>You find yourself in the Configuration Nexus, where the core settings and theme definitions of the system reside. This is the heart of adaptability, where the adventure engine configures itself to meet the needs of any project. Themes are the language of immersion, and configuration ensures the engine operates within its defined limits. As you explore this area, you will uncover how the system validates inputs, manages themes, and enforces operational constraints.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>Centralized Configuration</strong>: How the system uses a single source of truth for timeouts, limits, and validation.</li>
<li>üîç <strong>Theme Management</strong>: How themes are defined, parsed, and applied dynamically to adventures.</li>
<li>‚ö° <strong>Input Validation</strong>: How user inputs are sanitized and validated to ensure system integrity and security.</li>
<li>üí° <strong>Custom Adventure Configurations</strong>: How project-specific configurations are loaded and processed.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/config.ts</code></a></h3>
<p>This file centralizes all configuration settings for the adventure system, including timeouts, limits, and environment variables. It ensures that all components operate within predefined constraints and provides a single source of truth for system-wide settings.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Defines the maximum time allowed for LLM requests, ensuring system responsiveness.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Specifies the cache duration for repository analysis results, optimizing performance.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Sets a limit on file size to prevent memory issues during analysis.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = parseInt(process.env.REPO_ADV_LLM_REQUEST_TIMEOUT || &#39;60000&#39;); // 60 seconds
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPO_ADV_REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues
</code></pre>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> ensures that requests to the LLM do not hang indefinitely, maintaining a responsive system.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> reduces redundant computations by caching analysis results for reuse.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> prevents large files from overwhelming the system, focusing resources on manageable inputs.</li>
<li>These settings demonstrate the importance of configurable limits in scalable systems.</li>
<li>Environment variables allow developers to adjust these values without modifying the code.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a></h3>
<p>This file defines the themes available in the system, providing a consistent structure for theme-related data. It includes utility functions for theme retrieval, validation, and formatting.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: A centralized object defining all available themes, including their metadata.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L88" target="_blank" rel="noopener noreferrer"><code class="inline-code">isValidTheme</code></a>: Validates if a given theme string is recognized by the system.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a>: Parses user input to match a theme based on keywords, IDs, or exact keys.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases...&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms...&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;castle&#39;]
  },
  // Other themes omitted for brevity
} as const;
</code></pre>
<ul>
<li><code class="inline-code">THEMES</code> provides a structured definition for all themes, ensuring consistency across the system.</li>
<li>The <code class="inline-code">id</code>, <code class="inline-code">key</code>, <code class="inline-code">displayName</code>, and <code class="inline-code">emoji</code> fields make themes easy to identify and display.</li>
<li>Keywords allow for flexible user input matching, enhancing usability.</li>
<li>This structure simplifies the addition of new themes by adhering to a clear schema.</li>
<li>Centralization reduces the risk of inconsistencies in theme-related operations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  const normalized = input.trim().toLowerCase();
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> demonstrates robust input handling by normalizing and validating user input.</li>
<li>Exact matches, numeric IDs, and keyword searches provide multiple ways to identify a theme.</li>
<li>This function ensures that invalid inputs are gracefully rejected, maintaining system integrity.</li>
<li>The use of <code class="inline-code">THEMES_ARRAY</code> decouples the logic from the <code class="inline-code">THEMES</code> object, promoting modularity.</li>
<li>Parsing logic is extensible, making it easy to support additional input formats.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a></h3>
<p>This file provides utility functions for validating user inputs, ensuring that all data entering the system is sanitized and conforms to expected formats.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a>: Ensures that the selected theme is valid and recognized by the system.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L9" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateAdventureChoice</code></a>: Validates user choices for adventure selection, enforcing length constraints.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L37" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateProjectPath</code></a>: Sanitizes and validates the project path to prevent security issues.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a> ensures that only recognized themes are used, preventing invalid configurations.</li>
<li>The use of <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> integrates parsing and validation seamlessly.</li>
<li>Error messages provide helpful feedback, improving the user experience.</li>
<li>This function highlights the importance of input validation in preventing invalid state propagation.</li>
<li>By normalizing input, the function ensures case-insensitivity and trims unnecessary whitespace.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  
  if (input.length &gt; VALIDATION_MAX_PATH_LENGTH) {
    throw new Error(`Project path too long (max ${VALIDATION_MAX_PATH_LENGTH} characters)`);
  }
  
  if (input.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid characters&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L37" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateProjectPath</code></a> ensures that paths are sanitized and free of invalid characters.</li>
<li>The fallback to <code class="inline-code">process.cwd()</code> provides a sensible default for missing inputs.</li>
<li>Length constraints prevent excessively long paths that could cause errors.</li>
<li>The use of <code class="inline-code">\0</code> checks protects against null byte injection attacks, enhancing security.</li>
<li>This function demonstrates the importance of robust input handling in file-based systems.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <code class="inline-code">THEMES</code> object as a reference when adding new themes to ensure consistency.</li>
<li>Study how <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> handles flexible input matching to improve user experience in your own projects.</li>
<li>Review the error messages in <code class="inline-code">input-validator.ts</code> to understand how to provide actionable feedback to users.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><p><strong>Add a New Theme</strong>: Create a new theme called &quot;Cyberpunk&quot; with futuristic elements. Add it to <code class="inline-code">THEMES</code> and ensure it is recognized by <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a>. Test its integration by running the system.</p>
<ul>
<li>Example: Use <code class="inline-code">keywords</code> like &quot;cyber&quot;, &quot;neon&quot;, and &quot;futuristic&quot; for input matching.</li>
</ul>
</li>
<li><p><strong>Enhance Validation</strong>: Modify <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a> to suggest the closest matching valid theme when an invalid input is provided. Implement a simple string similarity algorithm for this purpose.</p>
</li>
<li><p><strong>Custom Configuration</strong>: Modify <code class="inline-code">adventure.config.json</code> to include a custom theme and validate its integration. Add unique keywords and test how it interacts with <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a>.</p>
</li>
</ol>
<hr>
<p>You have mastered all the secrets of configuration and theme systems! Your adventure is complete.</p>
<p>Congratulations on successfully deploying the Configuration &amp; Theme System‚Äîyour codebase just leveled up to 80% completion efficiency; keep refactoring brilliance and shipping excellence! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>