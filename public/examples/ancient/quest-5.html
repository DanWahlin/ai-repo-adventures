<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Codex of Themes and Validation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Sacred Repository of Ancient Adventures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Codex of Themes and Validation</h1>
<hr>
<p>Within the Sacred Repository lies the Codex of Themes and Validation, a cornerstone of ancient wisdom guiding the civilization‚Äôs mastery of structured design and error prevention. Hidden within glyphs and inscriptions, this codex reveals the secrets to ensuring harmony between user input and system configuration. As you approach the Codex, the jungle‚Äôs dense foliage gives way to towering stone pillars, each etched with intricate patterns representing validation rules and theme definitions. The ancient mechanisms hum with energy, awaiting your command to unlock their knowledge.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>Theme Management</strong>: How centralized definitions enable consistent and extensible theme handling across the system.</li>
<li>üîç <strong>Input Validation</strong>: Techniques for sanitizing and validating user inputs to ensure system reliability and security.</li>
<li>‚ö° <strong>Configuration Design</strong>: How environment variables and constants shape the system‚Äôs behavior and scalability.</li>
<li>üí° <strong>File Parsing</strong>: Efficient methods for extracting and processing structured data from configuration files.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a></h3>
<p>The Codex of Themes encapsulates the civilization‚Äôs understanding of structured design, defining the foundation for all adventure themes. This file centralizes theme definitions and provides utility functions for accessing, validating, and formatting themes. Its design ensures consistency across the system while allowing for extensibility through custom themes.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L74" target="_blank" rel="noopener noreferrer"><code class="inline-code">getThemeById</code></a>: Retrieves theme details using a numeric ID, showcasing a simple lookup mechanism.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L88" target="_blank" rel="noopener noreferrer"><code class="inline-code">isValidTheme</code></a>: Validates whether a given theme exists, ensuring only supported themes are used.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a>: Parses user input to determine the corresponding theme, using keywords and normalization techniques.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L120" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatThemeOption</code></a>: Formats theme details for display, combining metadata into a readable string.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L125" target="_blank" rel="noopener noreferrer"><code class="inline-code">getFormattedThemeOptions</code></a>: Generates a list of all available themes, sorted and formatted for easy selection.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function getThemeById(id: number): ThemeDefinition | null {
  return THEMES_ARRAY.find(theme =&gt; theme.id === id) || null;
}
</code></pre>
<ul>
<li>Provides a direct lookup for themes based on their numeric ID, ensuring quick access without complex mappings.</li>
<li>Demonstrates a simple iteration pattern using <code class="inline-code">Array.find</code>, avoiding unnecessary complexity.</li>
<li>Ensures null safety by returning <code class="inline-code">null</code> when the ID does not match any theme.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>Combines multiple parsing techniques to handle diverse user inputs, including exact matches, numeric IDs, and keyword-based detection.</li>
<li>Uses normalization to ensure input consistency, reducing errors from case sensitivity or whitespace.</li>
<li>Demonstrates robust fallback logic, prioritizing user-friendly input handling.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a></h3>
<p>This file represents the ancient civilization‚Äôs dedication to safeguarding the integrity of their systems. It contains validation rules that ensure user inputs conform to expected formats, protecting the repository from chaos and corruption. The functions here are simple yet powerful, embodying the principles of defensive programming.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L9" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateAdventureChoice</code></a>: Ensures user choices are not empty and within acceptable length limits.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a>: Validates theme inputs against supported themes, providing clear error messages for invalid entries.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L37" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateProjectPath</code></a>: Sanitizes and checks the validity of project paths, preventing injection attacks.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L53" target="_blank" rel="noopener noreferrer"><code class="inline-code">sanitizeForDisplay</code></a>: Removes unsafe characters and trims inputs for safe display, preventing XSS vulnerabilities.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; VALIDATION_MAX_CHOICE_LENGTH) {
    throw new Error(`Choice too long (max ${VALIDATION_MAX_CHOICE_LENGTH} characters)`);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Ensures user choices are meaningful by rejecting empty or excessively long inputs.</li>
<li>Demonstrates defensive programming by throwing errors for invalid inputs, guiding users to correct their mistakes.</li>
<li>Uses <code class="inline-code">trim</code> to remove extraneous whitespace, ensuring clean data processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Validates theme inputs by leveraging <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> and <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L88" target="_blank" rel="noopener noreferrer"><code class="inline-code">isValidTheme</code></a>, ensuring only supported themes are accepted.</li>
<li>Provides detailed error messages, enhancing user experience by listing valid options.</li>
<li>Highlights the importance of normalization and keyword matching in user input handling.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/config.ts</code></a></h3>
<p>The Codex of Configuration governs the system‚Äôs behavior, defining critical constants and environment variables. This file ensures scalability and adaptability by centralizing configuration settings, allowing the system to respond dynamically to varying conditions.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Defines the timeout for LLM requests, balancing responsiveness and complexity.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Sets limits on file sizes to prevent memory exhaustion during analysis.</li>
<li><code class="inline-code">IGNORE_PATTERNS</code>: Specifies directory patterns to exclude during scanning, focusing analysis on relevant files.</li>
<li><code class="inline-code">DEFAULT_THEME</code>: Establishes the fallback theme, ensuring continuity when no theme is specified.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = parseInt(process.env.REPO_ADV_LLM_REQUEST_TIMEOUT || &#39;60000&#39;);
</code></pre>
<ul>
<li>Configures the timeout for LLM requests, ensuring the system remains responsive even during complex operations.</li>
<li>Demonstrates the use of environment variables for dynamic configuration, enabling flexibility across deployments.</li>
<li>Provides a default value to ensure stability when the environment variable is not set.</li>
</ul>
<hr>
<pre><code class="language-typescript">export const IGNORE_PATTERNS = [
  &#39;node_modules&#39;,
  &#39;.git&#39;,
  &#39;.next&#39;,
  &#39;.nuxt&#39;,
  &#39;dist&#39;,
  &#39;build&#39;,
  &#39;coverage&#39;,
  &#39;.nyc_output&#39;,
  &#39;logs&#39;,
  &#39;*.log&#39;,
  &#39;.env&#39;,
  &#39;.DS_Store&#39;,
  &#39;Thumbs.db&#39;,
] as const;
</code></pre>
<ul>
<li>Specifies directories and file patterns to ignore during analysis, optimizing resource usage and focusing on source code.</li>
<li>Demonstrates the use of constants to maintain readability and prevent accidental modifications.</li>
<li>Ensures compatibility across different environments by including common patterns like <code class="inline-code">.git</code> and <code class="inline-code">node_modules</code>.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Study how <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> uses multiple approaches to handle diverse user inputs, ensuring robust theme selection.</li>
<li>Notice the defensive programming techniques in <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L9" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateAdventureChoice</code></a> and <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a>, which safeguard system integrity.</li>
<li>Explore the configuration constants in <code class="inline-code">config.ts</code> to understand how environment variables shape system behavior.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><p><strong>Add a New Theme</strong>: Extend the <code class="inline-code">THEMES</code> object with a custom theme. Define its keywords and test the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> function to ensure it correctly identifies the new theme.</p>
<ul>
<li>Example: Add a &quot;Cyberpunk&quot; theme with keywords like &quot;neon&quot; and &quot;future&quot;.</li>
</ul>
</li>
<li><p><strong>Trace Validation Flow</strong>: Add console.log statements in <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a> to observe how the input is normalized, parsed, and validated. Test with various inputs to understand the complete validation lifecycle.</p>
</li>
<li><p><strong>Modify Configuration Defaults</strong>: Change the <code class="inline-code">MAX_FILE_SIZE_MB</code> constant to a smaller value and observe how the system responds to large files during analysis. This will help you understand the impact of configuration limits.</p>
</li>
</ol>
<hr>
<p>You have mastered all the secrets of the Sacred Repository! Your adventure is complete.</p>
<p>Hail, seeker of sacred wisdom, for thou hast unearthed the Codex of Themes and Validation, carving thy name upon the eternal pillars of enlightenment‚Äîpress onward, for the final veil of truth awaits thee! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>