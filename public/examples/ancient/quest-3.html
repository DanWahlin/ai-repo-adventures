<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Scrolls of Quest Creation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Sacred Repository of Ancient Wisdom</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Ritual of Adventure Creation</h1>
<hr>
<p>In the shadow of an ancient pyramid, you uncover a hidden chamber adorned with glyphs that describe the sacred process of crafting adventures. The glyphs detail how the ancients used structured rituals to transform codebases into immersive journeys. As you delve deeper, you find three scrolls containing the secrets of adventure initialization, quest exploration, and story generation. Each scroll holds key insights into the mechanisms that bring adventures to life. The air is thick with anticipation as you prepare to unlock their wisdom.  </p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:  </p>
<ul>
<li>üéØ <strong>Adventure Initialization</strong>: How adventures are initialized with project context and theme selection.  </li>
<li>üîç <strong>Quest Exploration Logic</strong>: The mechanics for validating, executing, and caching quests in dynamic systems.  </li>
<li>‚ö° <strong>Story Generation Patterns</strong>: How LLM-powered story creation integrates with structured prompts and chunked content.  </li>
<li>üí° <strong>Config Integration</strong>: How adventure configuration files influence quest generation and content optimization.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<p>The <code class="inline-code">AdventureManager</code> class is the cornerstone of adventure creation, orchestrating the initialization, quest execution, and progress tracking. It integrates project-specific data, theme selection, and quest generation into a cohesive flow. The methods within demonstrate the application of caching, validation, and dynamic content generation powered by LLMs.  </p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L59" target="_blank" rel="noopener noreferrer"><code class="inline-code">initializeAdventure</code></a>: Resets state, sets project context, selects theme, and generates quests using LLMs.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L109" target="_blank" rel="noopener noreferrer"><code class="inline-code">exploreQuest</code></a>: Validates user input, retrieves cached quest data, or generates new content dynamically.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Handles chunked content processing, optimizing LLM calls for large codebases.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L456" target="_blank" rel="noopener noreferrer"><code class="inline-code">getProgress</code></a>: Calculates completion percentage and formats progress updates for user feedback.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L370" target="_blank" rel="noopener noreferrer"><code class="inline-code">mergeQuestFilesFromConfig</code></a>: Integrates configuration-defined file paths into generated quests.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async initializeAdventure(  
  projectInfo: ProjectInfo,  
  theme: AdventureTheme,  
  projectPath?: string,  
  customThemeData?: CustomThemeData  
): Promise&lt;string&gt; {  
  this.state.reset();  
  this.state.projectInfo = projectInfo;  
  this.state.currentTheme = theme;  
  this.state.projectPath = projectPath || process.cwd();  

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {  
    this.storyGenerator.setCustomTheme(customThemeData);  
  }  

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);  

  this.state.title = storyResponse.title;  
  this.state.story = storyResponse.story;  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);  
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);  

  return this.formatStoryWithQuests({  
    ...storyResponse,  
    quests: this.state.quests  
  });  
}  
</code></pre>
<ul>
<li>Resets the adventure state for new initialization, ensuring clean slate for each session.  </li>
<li>Integrates project-specific context and theme selection, enabling dynamic story creation.  </li>
<li>Merges configuration-defined files into quests for enhanced customization.  </li>
<li>Demonstrates dependency injection for custom themes, allowing extensibility.  </li>
<li>Shows how LLM-generated story and quest data is structured and formatted.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {  
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);  

  if (this.isProgressRequest(sanitizedChoice)) {  
    return this.getProgress();  
  }  

  const quest = this.findQuest(sanitizedChoice);  
  if (!quest) {  
    return this.createNotFoundResult();  
  }  

  return await this.executeQuest(quest);  
}  
</code></pre>
<ul>
<li>Validates user input to ensure safe and accurate quest selection.  </li>
<li>Handles progress requests separately, providing real-time updates.  </li>
<li>Implements flexible quest retrieval logic, supporting ID, title, or numeric selection.  </li>
<li>Demonstrates robust error handling with fallback results for invalid choices.  </li>
<li>Integrates caching to optimize performance for completed quests.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<p>The <code class="inline-code">StoryGenerator</code> class is responsible for creating immersive narratives and quests using LLMs. It employs structured prompts, chunked content processing, and fallback mechanisms to ensure reliable and engaging story generation.  </p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L299" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateStoryAndQuests</code></a>: Generates the initial story and quest structure based on project analysis and theme.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Processes codebase content in chunks, optimizing LLM calls for large projects.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L524" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractMarkdownContent</code></a>: Cleans and extracts usable markdown content from LLM responses.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L431" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateCompletionSummary</code></a>: Creates summary content for completed quests, reinforcing progress.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a>: Ensures the selected theme is valid, defaulting to safe options when necessary.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {  
  this.currentProject = projectInfo;  
  this.projectPath = projectPath;  

  const validatedTheme = this.validateTheme(theme);  
  return await this.generateWithLLM(projectInfo, validatedTheme);  
}  
</code></pre>
<ul>
<li>Sets the project context and validates the selected theme to ensure compatibility.  </li>
<li>Demonstrates the integration of project-specific data with theme-driven story generation.  </li>
<li>Highlights the use of LLMs for dynamic content creation based on real codebase analysis.  </li>
<li>Ensures fallback mechanisms are in place for invalid or missing themes.  </li>
<li>Provides a streamlined interface for generating story and quest data.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {  
  const { quest, theme, chunkResult, questPosition, totalQuests } = config;  
  let adventureGuidance = &#39;&#39;;  
  let customInstructions = &#39;&#39;;  

  if (this.projectPath) {  
    const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);  
    if (formattedConfig) {  
      adventureGuidance = formattedConfig;  
    }  
  }  

  if (chunkResult.chunks.length === 1) {  
    const prompt = loadQuestContentPrompt({  
      theme,  
      adventureTitle: quest.title,  
      codeContent: chunkResult.chunks[0].content,  
      storyContent: this.currentStoryContent || &#39;No story context available.&#39;,  
      adventureGuidance: adventureGuidance || &#39;&#39;,  
      questPosition,  
      totalQuests  
    });  

    const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST, context: &#39;quest content&#39; });  
    return { adventure: response.content.trim() };  
  }  
}  
</code></pre>
<ul>
<li>Handles chunked content processing, enabling efficient handling of large codebases.  </li>
<li>Integrates formatted configuration data into quest generation for enhanced context.  </li>
<li>Demonstrates the use of structured prompts to guide LLM responses.  </li>
<li>Provides fallback mechanisms for missing or incomplete story context.  </li>
<li>Ensures consistent formatting and validation of generated content.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<p>This file manages the adventure configuration, extracting relevant data and formatting it for LLM prompts. It ensures that adventure settings influence quest generation effectively.  </p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L19" target="_blank" rel="noopener noreferrer"><code class="inline-code">loadAdventureConfig</code></a>: Reads the raw adventure configuration file from the project path.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L41" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractUniqueFilePaths</code></a>: Identifies and validates file paths referenced in the configuration.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a>: Formats configuration data for optimized LLM usage.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L28" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseAdventureConfig</code></a>: Parses and validates configuration data, ensuring safe usage.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L111" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractCustomInstructions</code></a>: Retrieves custom instructions for personalized adventure generation.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {  
  const parsed = parseAdventureConfig(projectPath);  
  if (!parsed || typeof parsed !== &#39;object&#39;) {  
    return &#39;&#39;;  
  }  

  const adventure = (parsed as any).adventure;  
  if (!adventure || !Array.isArray(adventure.quests)) {  
    return &#39;&#39;;  
  }  

  let formatted = `## Quest Structure\n`;  

  for (const quest of adventure.quests) {  
    if (!quest.title || !Array.isArray(quest.files)) continue;  

    formatted += `### ${quest.title}\n`;  
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);  
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;  
  }  

  return formatted;  
}  
</code></pre>
<ul>
<li>Formats configuration data into a markdown structure suitable for LLM prompts.  </li>
<li>Eliminates redundant descriptions, focusing on essential data for quest generation.  </li>
<li>Demonstrates efficient parsing and validation techniques.  </li>
<li>Highlights the importance of structured data for optimizing LLM responses.  </li>
<li>Ensures configuration-defined quests integrate seamlessly with generated content.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Ensure your adventure configuration file is properly formatted to avoid errors during quest generation.  </li>
<li>Use chunking for large codebases to optimize LLM performance and reduce latency.  </li>
<li>Validate user input carefully to prevent invalid quest selections or progress requests.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:  </p>
<ol>
<li><p><strong>Add Custom Theme</strong>: Create a new custom theme with unique keywords and integrate it into the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L59" target="_blank" rel="noopener noreferrer"><code class="inline-code">initializeAdventure</code></a> method. Observe how the story adapts to your custom settings.  </p>
</li>
<li><p><strong>Trace Quest Execution</strong>: Add logging statements to <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L109" target="_blank" rel="noopener noreferrer"><code class="inline-code">exploreQuest</code></a> and trace the flow from user input to quest generation. Analyze how caching improves performance for completed quests.  </p>
</li>
<li><p><strong>Optimize Config Format</strong>: Modify <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a> to include additional metadata, such as quest difficulty levels. Observe how this influences LLM responses during story generation.</p>
</li>
</ol>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Sacred Repository.</p>
<p>Hark, seeker of wisdom, thou hast unlocked the sacred Scrolls of Quest Creation, etching thy name upon the annals of enlightenment‚Äîpress onward, for the temple of mastery awaits thy triumphant return! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>