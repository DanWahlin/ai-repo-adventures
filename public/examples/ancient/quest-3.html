<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Engine of Mythic Quests - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Sacred Repository of Knowledge</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Engine of Mythic Quests</h1>
<hr>
<p>In the heart of a forgotten jungle, you uncover the ruins of an ancient civilization. Within the crumbling walls of a sacred repository lies a powerful mechanism: the Engine of Mythic Quests. This ancient device, powered by intricate TypeScript carvings and mystical algorithms, is said to transform raw project data into immersive adventures. To unlock its secrets, you must navigate interconnected chambers of logic, decipher the glyphs of configuration, and harness the energy of its story-forging core.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>Quest State Management</strong>: How the <code class="inline-code">AdventureManager</code> tracks progress and orchestrates quest execution.</li>
<li>üîç <strong>Dynamic Story Generation</strong>: How <code class="inline-code">StoryGenerator</code> uses modular prompts and LLM responses to create engaging narratives.</li>
<li>‚ö° <strong>Configuration Parsing</strong>: How <code class="inline-code">adventure-config.ts</code> integrates project-specific data into the quest pipeline.</li>
<li>üí° <strong>Content Optimization</strong>: Techniques for chunking large data for efficient processing by LLMs.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<p>The <code class="inline-code">AdventureManager</code> is the central architect of the mythic quest engine. It initializes adventures, manages state, and executes quests by combining project data with generated narratives. This file exemplifies how state management and modular design enable a seamless user experience while maintaining flexibility for different project structures.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L59" target="_blank" rel="noopener noreferrer"><code class="inline-code">initializeAdventure</code></a>: Sets up the adventure by analyzing the project, selecting a theme, and generating quests.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L109" target="_blank" rel="noopener noreferrer"><code class="inline-code">exploreQuest</code></a>: Handles user-selected quests, validates input, and retrieves or generates quest content dynamically.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Processes project data, optimizes it into chunks, and integrates it into the quest narrative.</li>
<li><code class="inline-code">progressPercentage</code>: A getter that calculates the percentage of completed quests for progress tracking.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This code initializes the adventure by resetting the state and generating a story and quests based on the project&#39;s context.</li>
<li>Custom themes are supported by passing additional data to the <code class="inline-code">StoryGenerator</code>.</li>
<li>Configuration files are integrated to ensure the quests align with predefined structures.</li>
<li>The modular design allows easy expansion of themes and quest definitions.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates user input to ensure safe and consistent quest selection.</li>
<li>Supports progress tracking through a &quot;view progress&quot; option.</li>
<li>Dynamically executes the selected quest, showcasing modular and reusable logic.</li>
</ul>
<hr>
<pre><code class="language-typescript">private get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Calculates the completion percentage using basic arithmetic.</li>
<li>Demonstrates a clean and readable getter for state tracking.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<p>The <code class="inline-code">StoryGenerator</code> is the creative force behind the mythic quests. It leverages LLMs to transform raw project data into compelling stories and quests, ensuring a seamless blend of narrative and technical exploration.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L299" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateStoryAndQuests</code></a>: Creates the overarching story and quest list based on project analysis.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Breaks down project data into manageable chunks and integrates it into quests using LLM prompts.</li>
<li><code class="inline-code">processChunkedQuestContent</code>: Handles multi-part data processing for large repositories.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L697" target="_blank" rel="noopener noreferrer"><code class="inline-code">removeLLMMetaCommentary</code></a>: Cleanses LLM-generated content of unnecessary commentary for polished results.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Initiates the story and quest generation process by validating the theme and invoking the LLM.</li>
<li>Simplifies complex logic into a single, reusable method.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const { quest, theme, chunkResult, questPosition, totalQuests } = config;

  if (chunkResult.chunks.length === 1) {
    const prompt = loadQuestContentPrompt({
      theme,
      adventureTitle: quest.title,
      codeContent: chunkResult.chunks[0].content,
      questPosition,
      totalQuests
    }) + this.QUEST_FORMAT_INSTRUCTIONS;

    const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST });
    return { adventure: response.content.trim(), fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };
  } else {
    return await this.processChunkedQuestContent(quest, theme, chunkResult);
  }
}
</code></pre>
<ul>
<li>Handles single-chunk and multi-chunk quest content generation with modular logic.</li>
<li>Uses LLM prompts dynamically tailored to the quest and theme.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async processChunkedQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  chunkResult: ChunkResult
): Promise&lt;QuestContent&gt; {
  let accumulatedContent = &#39;&#39;;

  for (const chunk of chunkResult.chunks) {
    const prompt = `You are continuing to generate quest content for &quot;${quest.title}&quot; with a ${theme} theme.
    ${chunk.content}`;

    const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST });
    accumulatedContent += response.content.trim();
  }

  return { adventure: accumulatedContent, fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };
}
</code></pre>
<ul>
<li>Processes large data sets in chunks to ensure efficient LLM usage.</li>
<li>Accumulates responses into a cohesive narrative.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<p><code class="inline-code">adventure-config.ts</code> bridges the gap between project-specific data and the quest system by parsing configuration files and extracting relevant details for quest generation.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L28" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseAdventureConfig</code></a>: Reads and parses the <code class="inline-code">adventure.config.json</code> file into a usable object.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a>: Optimizes configuration data for use in LLM prompts.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L41" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractUniqueFilePaths</code></a>: Collects all file paths referenced in the configuration for targeted content generation.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses the configuration file safely, handling missing or invalid JSON gracefully.</li>
<li>Centralizes JSON parsing logic for reuse across the system.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return &#39;&#39;;

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\nFiles: ${quest.files.map((f: any) =&gt; f.path).join(&#39;, &#39;)}\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts configuration data into a concise format for LLM prompts.</li>
<li>Reduces redundancy while preserving critical information.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      unique.add(node.path.trim());
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    stack.push(...children);
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Extracts and de-duplicates all file paths referenced in the configuration.</li>
<li>Supports targeted content generation by identifying key project files.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Explore how the <code class="inline-code">AdventureManager</code> leverages state management for seamless quest transitions.</li>
<li>Study the chunking logic in <code class="inline-code">StoryGenerator</code> to understand how it optimizes large data sets for LLM processing.</li>
<li>Review the configuration parsing methods to see how project-specific data integrates with the quest engine.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><strong>Extend Quest Content</strong>: Modify the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a> method to include additional metadata (e.g., tags or difficulty levels) in the quest narrative. Test how this impacts the generated content.</li>
<li><strong>Custom Config Parsing</strong>: Add a new field to <code class="inline-code">adventure.config.json</code> (e.g., &quot;quest difficulty&quot;) and update <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L28" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseAdventureConfig</code></a> to extract and use this data in quest generation.</li>
<li><strong>Optimize Chunk Handling</strong>: Experiment with the chunk size in <code class="inline-code">StoryGenerator</code> to see how it affects LLM response quality and processing time.</li>
</ol>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of this ancient repository.</p>
<p>By the sacred flame of wisdom and the hallowed halls of ancient triumph, thou hast unlocked the Engine of Mythic Quests, forging onward with valor through realms untold‚Äîmay thy journey shine ever brighter like the jewel of the cosmos! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>