<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Enchanted Themekeeper - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Repository Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Enchanted Themekeeper</h1>
<hr>
<p>In the heart of Codoria‚Äôs mystical castle lies the chamber of the Enchanted Themekeeper, a magical entity that controls the aesthetic and thematic essence of the Codex of Adventures. The Themekeeper weaves the visual and narrative threads of each quest, ensuring that every adventure resonates with its chosen theme. As the brave adventurer, your task is to master the art of theme manipulation, learning how the kingdom‚Äôs themes are crafted, validated, and brought to life. Unlock these secrets to harmonize your quests with Codoria‚Äôs mythical tapestry.  </p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:  </p>
<ul>
<li>üéØ <strong>Theme System Design</strong>: How themes are defined, validated, and selected dynamically.  </li>
<li>üîç <strong>CSS Integration</strong>: How theme-specific assets are combined to create cohesive visual styles.  </li>
<li>‚ö° <strong>Adventure Configuration</strong>: How quest-specific configurations are parsed and utilized for dynamic storytelling.  </li>
<li>üí° <strong>Input Validation</strong>: Techniques for ensuring user inputs align with expected formats and constraints.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a></h3>
<p>This file serves as the central repository for all theme-related data in the Codex of Adventures. It defines the structure of themes, provides helper functions for validation and retrieval, and enables dynamic theme parsing based on user input. The file ensures consistency across the adventure system by centralizing theme logic.  </p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L74" target="_blank" rel="noopener noreferrer"><code class="inline-code">getThemeById</code></a>: Retrieves a theme by its unique numeric ID, ensuring quick lookup.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a>: Dynamically matches user input to a valid theme using keywords, IDs, or exact matches.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L125" target="_blank" rel="noopener noreferrer"><code class="inline-code">getFormattedThemeOptions</code></a>: Generates a user-friendly list of all themes, complete with emojis and descriptions.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function getThemeById(id: number): ThemeDefinition | null {
  return THEMES_ARRAY.find(theme =&gt; theme.id === id) || null;
}
</code></pre>
<ul>
<li>This function enables quick retrieval of themes by numeric ID, simplifying user input handling.  </li>
<li>It ensures a consistent lookup process by leveraging the pre-defined <code class="inline-code">THEMES_ARRAY</code>.  </li>
<li>Returning <code class="inline-code">null</code> for invalid IDs prevents runtime errors and ensures graceful handling of invalid inputs.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>This function dynamically matches user input to a theme using multiple strategies (exact match, ID, or keywords).  </li>
<li>It ensures flexibility by allowing users to select themes using natural language or numeric IDs.  </li>
<li>The fallback to keyword matching enhances user experience by accommodating partial or descriptive inputs.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function getFormattedThemeOptions(): string {
  return getAllThemes()
    .sort((a, b) =&gt; a.id - b.id)
    .map(formatThemeOption)
    .join(&#39;\n&#39;);
}
</code></pre>
<ul>
<li>This function creates a formatted list of theme options for display in user interfaces.  </li>
<li>Sorting themes by ID ensures a predictable and intuitive order.  </li>
<li>The use of emojis and descriptions enhances readability and engagement.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/generator/src/cli/theme-manager.ts</code></a></h3>
<p>The <code class="inline-code">ThemeManager</code> class handles the generation of CSS and assets for each theme. It ensures that every theme is visually distinct and cohesive, managing assets such as icons and logos. This file highlights how themes transition from conceptual definitions to tangible visual elements.  </p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L58" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateThemeCSS</code></a>: Combines multiple CSS files into a single file for a selected theme.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L40" target="_blank" rel="noopener noreferrer"><code class="inline-code">isLightTheme</code></a>: Determines whether a theme requires dark or light assets based on its visual style.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L81" target="_blank" rel="noopener noreferrer"><code class="inline-code">getThemeIcons</code></a>: Provides theme-specific icons for use in templates and navigation.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">generateThemeCSS(theme: AdventureTheme, outputDir: string): void {
  const cssFiles = [
    path.join(this.themesDir, &#39;base.css&#39;),
    path.join(this.themesDir, &#39;homepage.css&#39;), 
    path.join(this.themesDir, &#39;animations.css&#39;),
    path.join(this.themesDir, `${theme}.css`)
  ];
  
  let combinedCSS = &#39;&#39;;
  
  cssFiles.forEach(cssFile =&gt; {
    if (fs.existsSync(cssFile)) {
      combinedCSS += fs.readFileSync(cssFile, &#39;utf8&#39;) + &#39;\\n\\n&#39;;
    }
  });
  
  const cssPath = path.join(outputDir, &#39;assets&#39;, &#39;theme.css&#39;);
  fs.writeFileSync(cssPath, combinedCSS);
}
</code></pre>
<ul>
<li>This function aggregates multiple CSS files into a single file, ensuring consistent styling for each theme.  </li>
<li>The use of <code class="inline-code">fs.existsSync</code> prevents errors by skipping missing files.  </li>
<li>Writing the combined CSS to a specific directory simplifies asset management for generated adventures.</li>
</ul>
<hr>
<pre><code class="language-typescript">isLightTheme(theme: AdventureTheme): boolean {
  const lightThemes: AdventureTheme[] = [&#39;mythical&#39;];
  return lightThemes.includes(theme);
}
</code></pre>
<ul>
<li>This function identifies themes that require light or dark assets, ensuring visual clarity.  </li>
<li>The separation of light and dark themes simplifies asset selection for different visual contexts.  </li>
<li>Adding themes to the <code class="inline-code">lightThemes</code> array allows for easy updates and expansion.</li>
</ul>
<hr>
<pre><code class="language-typescript">getThemeIcons(theme: AdventureTheme): { theme: string; quest: string } {
  const themeIcons = {
    space: { theme: &#39;üöÄ&#39;, quest: &#39;‚≠ê&#39; },
    mythical: { theme: &#39;üè∞&#39;, quest: &#39;‚öîÔ∏è&#39; },
    ancient: { theme: &#39;üè∫&#39;, quest: &#39;üìú&#39; },
    developer: { theme: &#39;üíª&#39;, quest: &#39;üîß&#39; },
    custom: { theme: &#39;üé®&#39;, quest: &#39;‚≠ê&#39; }
  };

  return (themeIcons as any)[theme] || themeIcons.space;
}
</code></pre>
<ul>
<li>This function provides theme-specific icons, enhancing the thematic experience for users.  </li>
<li>The use of a centralized icon map ensures consistency across all templates.  </li>
<li>Defaulting to the <code class="inline-code">space</code> theme prevents errors for undefined themes.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<p>This file manages the configuration for adventures, including loading, parsing, and formatting the adventure data. It ensures that quest configurations are accessible and optimized for use in the system.  </p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L28" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseAdventureConfig</code></a>: Parses the configuration file into a usable object, handling errors gracefully.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L41" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractUniqueFilePaths</code></a>: Identifies and validates all file paths referenced in the configuration.  </li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a>: Optimizes the configuration for use in LLM prompts by reducing verbosity.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function parses the adventure configuration file, returning <code class="inline-code">null</code> for errors or missing files.  </li>
<li>The use of <code class="inline-code">try-catch</code> ensures resilience against malformed JSON.  </li>
<li>Centralizing parsing logic simplifies debugging and maintenance.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function extracts all unique file paths from the configuration, ensuring no duplicates.  </li>
<li>The use of a <code class="inline-code">Set</code> guarantees uniqueness, while <code class="inline-code">fs.existsSync</code> validates file existence.  </li>
<li>Traversing nested objects allows for flexible configuration structures.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function reduces the verbosity of the configuration for use in prompts, improving efficiency.  </li>
<li>It focuses on essential details like file paths and function names, omitting redundant descriptions.  </li>
<li>The formatted output is tailored for LLM consumption, enhancing prompt clarity.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Explore how <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> uses multiple strategies to match user input, improving flexibility.  </li>
<li>Study how <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L58" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateThemeCSS</code></a> aggregates CSS files to understand modular stylesheet management.  </li>
<li>Notice how <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a> optimizes configurations for efficient LLM use.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:  </p>
<ol>
<li><strong>Add a New Theme</strong>: Create a new theme called &quot;Oceanic Odyssey&quot; with unique CSS and icons. Update <code class="inline-code">theme.ts</code> and <code class="inline-code">theme-manager.ts</code> to support the new theme.  </li>
<li><strong>Validate Complex Configurations</strong>: Modify <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L41" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractUniqueFilePaths</code></a> to handle deeply nested configurations. Test it with a custom <code class="inline-code">adventure.config.json</code> file.  </li>
<li><strong>Customize Theme Icons</strong>: Update <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L81" target="_blank" rel="noopener noreferrer"><code class="inline-code">getThemeIcons</code></a> to include a unique quest icon for each theme. Test the changes by generating a new adventure with the modified icons.</li>
</ol>
<hr>
<p>You have mastered all the secrets of Codoria‚Äôs enchanted codebase! Your adventure is complete.</p>
<p>By the luminous glow of the Celestial Forge, you have triumphed in the quest of The Enchanted Themekeeper, weaving wisdom into your heroic tapestry‚Äîpress on, valiant seeker, for the final chapter awaits! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>