<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Enchanted Theme Codex - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Repository Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Codex of Enchanted Themes</h1>
<hr>
<p>In the heart of the Kingdom of Code lies the Codex of Enchanted Themes, a repository of magical styles and configurations that shape the adventures across the land. This codex imbues adventures with their unique essence, transforming mundane code into mythical realms. To master this final quest, you must unlock the secrets of theme customization, input validation, and configuration, ensuring your adventures are as vibrant and engaging as the kingdom itself.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>Theme Definitions</strong>: How themes are structured and accessed dynamically using helper functions.</li>
<li>üîç <strong>Input Validation</strong>: How user inputs are validated for safety and accuracy using centralized logic.</li>
<li>‚ö° <strong>Configuration Constants</strong>: How system-wide settings like timeouts and limits are managed through environment variables.</li>
<li>üí° <strong>Practical Customization</strong>: How to extend the system with custom themes and configurations.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a></h3>
<p>The <code class="inline-code">theme.ts</code> file defines the core structure and logic for handling themes in the adventure system. It centralizes theme definitions and provides helper functions for accessing and validating themes, ensuring consistency across the system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: Defines all available themes with their attributes like <code class="inline-code">id</code>, <code class="inline-code">key</code>, <code class="inline-code">displayName</code>, and descriptions.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L74" target="_blank" rel="noopener noreferrer"><code class="inline-code">getThemeById</code></a>: Retrieves a theme based on its numeric ID, ensuring quick access.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L88" target="_blank" rel="noopener noreferrer"><code class="inline-code">isValidTheme</code></a>: Validates if a given string corresponds to a valid theme key, ensuring input reliability.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a>: Parses user input to determine the appropriate theme, supporting flexibility in input formats.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  // Additional themes omitted for brevity
};
</code></pre>
<ul>
<li>Centralizes all theme definitions, making it the single source of truth for theme-related data.</li>
<li>Provides extensibility by allowing new themes to be added with minimal changes.</li>
<li>Keywords support flexible user input by matching descriptive terms to themes.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;

  const normalized = input.trim().toLowerCase();
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;

  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }

  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }

  return null;
}
</code></pre>
<ul>
<li>Implements flexible parsing logic to handle various input formats (e.g., numeric IDs, keywords).</li>
<li>Ensures robust input handling by normalizing and validating user inputs.</li>
<li>Demonstrates the use of fallback logic, improving user experience.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a></h3>
<p>This file provides centralized validation logic for user inputs, ensuring safety, reliability, and adherence to system constraints.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a>: Ensures user-provided themes are valid and matches them against predefined options.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L9" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateAdventureChoice</code></a>: Validates user choices, including length constraints and non-empty inputs.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L53" target="_blank" rel="noopener noreferrer"><code class="inline-code">sanitizeForDisplay</code></a>: Cleans up input strings for safe display, preventing injection attacks.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }

  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);

  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }

  return parsedTheme;
}
</code></pre>
<ul>
<li>Validates user input against the available themes, ensuring only valid options are accepted.</li>
<li>Provides clear error messages to guide users when invalid inputs are provided.</li>
<li>Utilizes helper functions like <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> for modular and reusable logic.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = VALIDATION_MAX_DISPLAY_LENGTH): string {
  if (!input) return &#39;&#39;;

  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>Prevents injection attacks by stripping potentially harmful characters.</li>
<li>Trims and normalizes input strings for consistent display.</li>
<li>Limits the length of displayed strings to avoid overwhelming the interface.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/config.ts</code></a></h3>
<p>The <code class="inline-code">config.ts</code> file centralizes configuration constants and environment variables, ensuring consistent settings across the system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Configures the timeout for LLM requests, balancing responsiveness and reliability.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Sets the maximum file size for analysis, optimizing performance.</li>
<li><code class="inline-code">VALIDATION_MAX_CHOICE_LENGTH</code>: Defines the maximum length for user input choices, ensuring manageable input sizes.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = parseInt(process.env.LLM_REQUEST_TIMEOUT || &#39;60000&#39;); // 60 seconds for complex story generation with large prompts
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
export const VALIDATION_MAX_CHOICE_LENGTH = parseInt(process.env.VALIDATION_MAX_CHOICE_LENGTH || &#39;200&#39;); // Maximum choice length
</code></pre>
<ul>
<li>Centralizes critical system settings, making them easy to locate and modify.</li>
<li>Uses environment variables for flexibility in different deployment environments.</li>
<li>Provides sensible default values to ensure system stability.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> to support flexible user inputs when extending theme options.</li>
<li>Leverage <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L53" target="_blank" rel="noopener noreferrer"><code class="inline-code">sanitizeForDisplay</code></a> to secure user-facing outputs.</li>
<li>Adjust configuration constants in <code class="inline-code">config.ts</code> to tailor the system to your needs.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><p><strong>Add a Custom Theme</strong>: Create a new theme in <code class="inline-code">theme.ts</code> with a unique <code class="inline-code">id</code>, <code class="inline-code">key</code>, and description. Update the <code class="inline-code">THEMES</code> object and test its integration using <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a>.</p>
<ul>
<li>Example: Add a &quot;Cyberpunk&quot; theme with futuristic keywords like &quot;neon&quot; and &quot;hacker&quot;.</li>
</ul>
</li>
<li><p><strong>Enhance Validation</strong>: Modify <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a> to provide suggestions for invalid inputs based on the closest match. Use string similarity algorithms to improve user feedback.</p>
</li>
<li><p><strong>Optimize Configurations</strong>: Experiment with changing <code class="inline-code">LLM_REQUEST_TIMEOUT</code> and <code class="inline-code">MAX_FILE_SIZE_MB</code> in <code class="inline-code">config.ts</code>. Observe how these changes impact performance during large repository analyses.</p>
</li>
</ol>
<hr>
<p>You have mastered all the secrets of the Enchanted Repository! Your adventure is complete, and the Kingdom of Code flourishes with your newfound wisdom.</p>
<p>With the wisdom of ancient sages and the valor of a true hero, you have unlocked the arcane secrets of &quot;The Enchanted Theme Codex,&quot; bringing your kingdom one step closer to eternal glory‚Äîpress on, for the final quest awaits! ‚öîÔ∏è ‚≠ê üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>