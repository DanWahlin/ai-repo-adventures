<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Spellbook of Storycraft - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Repository Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Spellbook of Storycraft</h1>
<hr>
<p>In the mystical kingdom of Codoria, a fabled artifact known as the Spellbook of Storycraft lies hidden deep within the enchanted Repository of Codex. This spellbook is said to hold the secrets of weaving magical tales from the threads of code. To unlock its power, you must delve into the intricate mechanisms of story generation, quest crafting, and adventure configuration. Beware, for the path is guarded by the complexity of structured data and the cunning traps of input validation. Only the most diligent of heroes can master this arcane art.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>Adventure Initialization</strong>: How the <code class="inline-code">AdventureManager</code> orchestrates story and quest generation from project context.</li>
<li>üîç <strong>Quest Content Generation</strong>: The role of <code class="inline-code">StoryGenerator</code> in dynamically creating themed adventures based on codebase analysis.</li>
<li>‚ö° <strong>Configuration Parsing</strong>: Techniques for extracting and formatting adventure configurations with <code class="inline-code">adventure-config.ts</code>.</li>
<li>üí° <strong>Chunked Content Processing</strong>: How large codebases are handled efficiently through chunking and iterative processing.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<p>The <code class="inline-code">AdventureManager</code> is the central figure in Codoria&#39;s storytelling magic, responsible for initializing adventures, managing quest progress, and merging configuration data into generated quests. Its methods coordinate the interaction between the repository context, story generation, and user input to create a seamless adventure experience.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L59" target="_blank" rel="noopener noreferrer"><code class="inline-code">initializeAdventure</code></a>: Sets up the adventure, generating the story and quests while incorporating configuration data.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L109" target="_blank" rel="noopener noreferrer"><code class="inline-code">exploreQuest</code></a>: Executes a selected quest, leveraging cached content for revisited quests.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Dynamically generates quest content, handling chunked codebase data for optimal processing.</li>
<li><code class="inline-code">progressPercentage</code>: Calculates the completion percentage of the adventure, providing progress feedback.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L370" target="_blank" rel="noopener noreferrer"><code class="inline-code">mergeQuestFilesFromConfig</code></a>: Combines configuration-defined files with generated quests.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Resets state to ensure a fresh start for each adventure initialization.</li>
<li>Integrates project context and theme data to tailor the story and quests.</li>
<li>Merges configuration-defined files into generated quests for a cohesive experience.</li>
<li>Demonstrates dependency on <code class="inline-code">StoryGenerator</code> for story creation.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates user input to ensure safe and accurate quest selection.</li>
<li>Handles progress requests separately, providing detailed feedback on completion.</li>
<li>Executes the chosen quest, leveraging caching for revisited quests.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<p>The <code class="inline-code">StoryGenerator</code> is the enchanted quill of Codoria, transforming raw repository data into immersive stories and quests. It integrates with LLMs to dynamically generate adventure content, supporting chunked processing for large codebases.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L299" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateStoryAndQuests</code></a>: Creates the overarching story and quests for an adventure.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Produces detailed quest content, handling single and multi-chunk scenarios.</li>
<li><code class="inline-code">processChunkedQuestContent</code>: Iteratively processes large codebases, ensuring efficient content generation.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L431" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateCompletionSummary</code></a>: Crafts a summary of quest completion, maintaining thematic consistency.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Validates the theme to ensure compatibility with the storytelling process.</li>
<li>Leverages LLMs to dynamically craft the story and quests based on project context.</li>
<li>Demonstrates modularity by delegating specific tasks to helper methods.</li>
</ul>
<hr>
<pre><code class="language-typescript">async processChunkedQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  chunkResult: ChunkResult,
  adventureGuidance: string,
  customInstructions: string,
  questPosition?: number,
  totalQuests?: number
): Promise&lt;QuestContent&gt; {
  let accumulatedContent = &#39;&#39;;
  let contextSummary = &#39;&#39;;

  for (let i = 0; i &lt; chunkResult.chunks.length; i++) {
    const chunk = chunkResult.chunks[i];
    const isFirstChunk = i === 0;
    const isLastChunk = i === chunkResult.chunks.length - 1;

    let prompt: string;

    if (isFirstChunk) {
      prompt = loadQuestContentPrompt({
        theme,
        adventureTitle: quest.title,
        codeContent: chunk.content,
        storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
        adventureGuidance: adventureGuidance || &#39;&#39;,
        ...(customInstructions &amp;&amp; { customInstructions }),
        questPosition,
        totalQuests,
        ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
      }) + `\n\nThis is the first part of a large codebase (${chunkResult.chunks.length} parts total).`;
    } else if (isLastChunk) {
      prompt = `You are continuing to generate quest content for &quot;${quest.title}&quot; with a ${theme} theme.

Previous story context: ${contextSummary}

Here is the final part of the codebase:
${chunk.content}`;
    } else {
      prompt = `You are continuing to generate quest content for &quot;${quest.title}&quot; with a ${theme} theme.

Previous story context: ${contextSummary}

Here is part ${i + 1} of ${chunkResult.chunks.length} of the codebase:
${chunk.content}`;
    }

    const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST, context: &#39;quest chunk&#39; });
    let chunkContent = this.extractMarkdownContent(response.content);

    if (isFirstChunk) {
      accumulatedContent = chunkContent;
    } else {
      accumulatedContent = chunkContent;
    }

    if (!isLastChunk) {
      contextSummary = await this.generateContextSummary(accumulatedContent, theme, i + 1, chunkResult.chunks.length);
    }
  }

  return {
    adventure: accumulatedContent,
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<ul>
<li>Handles large codebases by processing them in manageable chunks.</li>
<li>Generates context summaries to maintain coherence across iterations.</li>
<li>Ensures that the final content is cohesive and complete.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<p>The <code class="inline-code">adventure-config.ts</code> file is the Codorian librarian, managing the parsing and formatting of adventure configuration files. It ensures that quests are aligned with user-defined settings and project constraints.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L19" target="_blank" rel="noopener noreferrer"><code class="inline-code">loadAdventureConfig</code></a>: Reads the raw configuration file from the project directory.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L28" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseAdventureConfig</code></a>: Parses the configuration into a structured object for further processing.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a>: Optimizes configuration data for LLM prompts, reducing verbosity.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses raw JSON configuration files, handling errors gracefully.</li>
<li>Provides a single point of validation and parsing for adventure configurations.</li>
<li>Ensures robust handling of missing or malformed files.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Explore how the <code class="inline-code">AdventureManager</code> integrates configuration data to customize quests.</li>
<li>Study the chunked content handling in <code class="inline-code">StoryGenerator</code> to understand scalable processing techniques.</li>
<li>Review the <code class="inline-code">adventure-config.ts</code> file for insights into configuration-driven development.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><strong>Add a Custom Theme</strong>: Modify the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L59" target="_blank" rel="noopener noreferrer"><code class="inline-code">initializeAdventure</code></a> method to include a new custom theme with unique keywords and styles. Observe how the theme affects the generated story and quests.</li>
<li><strong>Trace Chunk Processing</strong>: Add logging to the <code class="inline-code">processChunkedQuestContent</code> method to visualize how each chunk contributes to the final quest content. Analyze the impact of chunk size on performance.</li>
</ol>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of Codoria&#39;s enchanted repository.</p>
<p>With the Spellbook of Storycraft now mastered, you ascend as a herald of tales, weaving legendary sagas with the brilliance of a celestial quill‚Äîonward, noble scribe, for the next chapters await! ‚ö°üìúüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>