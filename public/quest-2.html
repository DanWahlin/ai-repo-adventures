<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è Quest 2: The Chronicles of Questing (Adventure Generation) - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <script>
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">‚öîÔ∏è Realm of Enchanted Code: The Quest for the Eternal Compiler</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1><span class="header-prefix">‚öîÔ∏è Quest 2:</span> The Chronicles of Questing (Adventure Generation)</h1>
<hr>
<p>Deep within the enchanted Kingdom of Codoria, whispers of a fractured Compiler spell have spread far and wide. Legends speak of the Chronicles of Questing, an arcane text that guides adventurers to mend the broken Compilershard. To seize control of Codoria‚Äôs destiny, the adventurer must unlock the secrets contained within the quest generation engine‚Äîa magical workshop at the heart of the kingdom responsible for crafting epic tales. Wield your wit and courage, for the Chronicles demand mastery of a domain steeped in code, magic, and adventure.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">src/adventure/adventure-manager.ts:</span> Adventure orchestration managing state, themes, and user interactions</h3>
<p>This file acts as the master script for orchestrating the adventures of Codoria. The <code class="inline-code">AdventureManager</code> oversees the spinning of tales, the initiation of quests, and the seamless progression of heroic journeys. Using the mystical energies of the Eternal Compiler, it brings harmony to the chaos while keeping the adventurer‚Äôs choices and progress in its ledger. Its various methods allow the customization of themes, validation of user commands, and caching of quests to ensure every tale unfolds smoothly. The <code class="inline-code">AdventureState</code> tracks vital details such as completed quests and the overall percentage of Codoria&#39;s restoration. This file is the battle strategist that ensures every adventurer has a roadmap, a clear goal, and the means to conquer!</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: The ritual that begins the hero‚Äôs epic journey.</li>
<li><code class="inline-code">AdventureManager.exploreQuest</code>: The gateway to delving into mystical adventures.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: A magical calculation to inspire or challenge adventurers.</li>
</ul>
<h3><span class="header-prefix">src/adventure/story-generator.ts:</span> LLM-powered story creation and prompt engineering</h3>
<p>The <code class="inline-code">StoryGenerator</code> is the weaver of myths and sagas, drawing on the energy of large language models to create highly immersive quests. This class transforms raw project data into enchanting tales using structured prompts. It introduces themes like the mythical kingdom or other timeless storytelling elements, ensuring each quest fits seamlessly into the overarching adventure. The <code class="inline-code">generateQuestContent</code> method is a spell that blends code insights and user interactions into a cohesive narrative. It also validates its output through strict guidelines, making sure every generated element feels natural and lore-consistent.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">StoryGenerator.generateStoryAndQuests</code>: Conjures full-fledged stories with quests woven into their fabric.</li>
<li><code class="inline-code">StoryGenerator.generateQuestContent</code>: Creates quests tailored to the adventurer‚Äôs path and Codoria‚Äôs lore.</li>
<li><code class="inline-code">StoryGenerator.getThemeGuidelines</code>: Plucks vocabulary and style straight from the storyteller&#39;s spellbook.</li>
</ul>
<h3><span class="header-prefix">src/shared/adventure-config.ts:</span> Configuration system for enhanced story generation</h3>
<p>This file works as Codoria&#39;s sacred scroll‚Äîa script that sets the boundaries and enhancements for the Chronicles of Questing. It provides structured rules through <code class="inline-code">adventure.config.json</code> and validates the paths mentioned in the configuration for active files. The <code class="inline-code">formatAdventureConfigForPrompt</code> method refines this raw data into formatted narratives, ensuring clarity in the adventurer&#39;s tasks. Through its meticulous design, this file makes it easier to align Codoria&#39;s goals with the tools at the adventurer‚Äôs disposal, charting a clear course to reunite the Compilershard&#39;s fragments.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Retrieves the config scroll with Codoria‚Äôs sacred rules.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Deciphers Codoria‚Äôs paths and confirms their authenticity.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Lays down the foundational guidelines for magical storytelling.</li>
</ul>
<h2>Code</h2>
<h3>src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">export class AdventureManager {
  private state: AdventureState = new AdventureState();
  private storyGenerator: StoryGenerator;

  constructor() {
    this.storyGenerator = new StoryGenerator();
  }

  async initializeAdventure(
    projectInfo: ProjectInfo,
    theme: AdventureTheme,
    projectPath?: string,
    customThemeData?: CustomThemeData
  ): Promise&lt;string&gt; {
    this.state.reset();
    this.state.projectInfo = projectInfo;
    this.state.currentTheme = theme;
    this.state.projectPath = projectPath || process.cwd();
    if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
      this.storyGenerator.setCustomTheme(customThemeData);
    }

    const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

    this.state.title = storyResponse.title;
    this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
    this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
    this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

    return this.formatStoryWithQuests({
      ...storyResponse,
      quests: this.state.quests
    });
  }

  private enforceConfigQuestCount(quests: Quest[], projectPath: string | undefined): Quest[] {
    if (!projectPath) return quests;

    const config = parseAdventureConfig(projectPath);
    if (!config || typeof config !== &#39;object&#39;) return quests;

    const adventure = (config as any).adventure;
    if (!adventure || !Array.isArray(adventure.quests)) return quests;

    const configQuestCount = adventure.quests.length;

    if (quests.length &gt; configQuestCount) {
      return quests.slice(0, configQuestCount);
    }

    return quests;
  }
}
</code></pre>
<p>This class is akin to the planner of royal banquets, ensuring that every step in an adventurer‚Äôs journey leads to a harmonious, thematic exploration.</p>
<h3>src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">export class StoryGenerator {
  async generateStoryAndQuests(
    projectInfo: ProjectInfo,
    theme: AdventureTheme,
    projectPath?: string
  ): Promise&lt;StoryResponse&gt; {
    this.currentProject = projectInfo;
    this.projectPath = projectPath;

    const repomixContent = projectInfo.repomixContent || &#39;No repomix content available&#39;;
    let adventureGuidance = &#39;&#39;;

    if (this.projectPath) {
      const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);
      if (formattedConfig) {
        adventureGuidance = formattedConfig;
      }
    }

    const prompt = loadStoryGenerationPrompt({
      theme,
      repomixContent,
      ...(adventureGuidance &amp;&amp; { adventureGuidance }),
      ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
    });

    const response = await this.withTimeout(
      this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY })
    );

    let parsed;
    try {
      let cleanContent = response.content.trim();
      if (cleanContent.startsWith(&#39;```markdown&#39;)) {
        cleanContent = cleanContent.replace(/^```markdown\s*/, &#39;&#39;).replace(/\s*```$/, &#39;&#39;);
      }

      parsed = parseMarkdownToStoryResponse(cleanContent);
      StoryResponseSchema.parse(parsed);

      this.currentStoryContent = typeof parsed.story === &#39;string&#39; ? parsed.story : parsed.story.content;
    } catch (error) {
      throw new Error(`Invalid LLM response: ${error instanceof Error ? error.message : &#39;Unknown error&#39;}`);
    }
    return parsed;
  }
}
</code></pre>
<p>This generates quests like a bard composing verses for heroic deeds and legendary battles that resonate across Codoria.</p>
<h3>src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">import * as fs from &#39;fs&#39;;
import * as path from &#39;path&#39;;

function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    return null;
  }
}

export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, &#39;adventure.config.json&#39;);
  return readFileIfExists(configPath);
}

export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path;
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This adds simplicity to the chaos of adventure creation, much like a sage organizing the royal archives for future generations.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Focus first on the initialization flow in <code class="inline-code">AdventureManager</code> to understand how the adventure begins.</li>
<li>Modify the theme in <code class="inline-code">StoryGenerator</code> to experiment with different narrative styles.</li>
<li>Dive deeper into the <code class="inline-code">adventure.config.json</code> to practice creating custom adventure scenarios.</li>
</ul>
<hr>
<p>May your path be illuminated by Codoria&#39;s wisdom, brave adventurer!</p>
<p>Huzzah, valiant champion, for you have forged onward through the Chronicles of Questing, weaving a tale worthy of bards and earning your rightful place among the legends‚Äîyour journey is but a quarter complete, and yet your spirit gleams brighter than the Starforge! ‚≠ê‚öîÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: üìú Quest 3: The Codex of Repomancy (Code... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/mcp-repo-adventure" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>