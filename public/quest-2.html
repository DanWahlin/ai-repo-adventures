<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Adventure Drive: Mapping the Expedition's Core - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Cosmos of QuestCode: A Galactic Odyssey</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Adventure Drive: Mapping the Expedition&#39;s Core</h1>
<hr>
<p>In the uncharted depths of the QuestCode galaxy, where spinning lines of code flicker like pulsars, the <em>SS Refactoria</em> finds itself orbiting a particularly tangled cluster of cosmic functions and method calls. This mission—focused on the star drive of the repository, its <em>Adventure Manager</em> systems—aims to unveil the intricate pathways of the quest generation engine. As the crew synchronizes their tools, the mysterious <em>StoryGenerator Core</em> activates, glowing with the promise of insights. The journey begins to map the expedition&#39;s core—where every intricate system interlocks to steer the adventure forward.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Orchestration Hub</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file acts as the mission control of the <em>Adventure Drive</em>, orchestrating the entire operation of storytelling, quest management, and user interaction. It houses the <code class="inline-code">AdventureManager</code> class, which supervises initializing quests with the <code class="inline-code">initializeAdventure</code> function. This method sets the tone for every exploration by integrating repository information, applying themes (such as the cosmic one guiding this journey), and generating actionable quests. The state of ongoing adventures is meticulously tracked via the <code class="inline-code">AdventureState</code> class, which monitors critical metrics—such as the completion percentage—giving adventurers real-time updates on their progress. Notably, the <code class="inline-code">exploreQuest</code> function acts as a navigator, interpreting user choices to either execute quests or reveal progress. A standout feature is the targeted content generation for quest exploration, bolstered by methods like <code class="inline-code">generateQuestContent</code> and <code class="inline-code">mergeQuestFilesFromConfig</code>, ensuring that every challenge is fine-tuned and data-driven.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: Launches adventure setup by combining project data and theme integration.  </li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Dynamically tracks and calculates completion progress for ongoing quests.  </li>
<li><code class="inline-code">exploreQuest</code>: Analyzes user choices to execute quests or provide progress updates.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> The StoryGenerator Core</h3>
<p>The <code class="inline-code">story-generator.ts</code> file is the source of infinite possibility—transforming abstract project data into vivid, theme-driven narratives. At its heart is the <code class="inline-code">StoryGenerator</code> class, acting as the repository’s storyteller. The <code class="inline-code">generateStoryAndQuests</code> method plays a pivotal role, crafting an overarching narrative and a list of quests using Large Language Models (LLMs) with JSON-validated responses. The <code class="inline-code">generateQuestContent</code> function dives deeper, creating detailed quest narratives infused with real code snippets. This code employs adaptive prompts, leveraging repository context and structured guidance for user immersion. Error handling within these systems is robust, ensuring no element derails the interstellar storytelling. Impressively, the file’s design bridges the worlds of technical accuracy and creative presentation, enabling the custom tailoring of quests to meet user needs or align with specific themes.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Develops a narrative skeleton alongside specific quests using repository data.  </li>
<li><code class="inline-code">generateQuestContent</code>: Creates detailed walkthrough-like adventures with code-guided tasks.  </li>
<li>Robust schema validation with <code class="inline-code">Zod</code> to ensure that the LLM responses align with expected formats.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">export interface AdventureResult {
  narrative: string;
  choices?: string[];
  completed?: boolean;
  progressUpdate?: string;
}

export class AdventureState {
  title: string | undefined = undefined;
  story: string | undefined = undefined;
  quests: Quest[] = [];
  completedQuests: Set&lt;string&gt; = new Set();
  questContentCache: Map&lt;string, { content: QuestContent; summary: string }&gt; = new Map();
  currentTheme: AdventureTheme | null = null;
  projectInfo: ProjectInfo | undefined = undefined;
  projectPath: string | undefined = undefined;

  get progressPercentage(): number {
    return this.quests.length &gt; 0
      ? Math.round((this.completedQuests.size / this.quests.length) * 100)
      : 0;
  }

  reset() {
    this.title = undefined;
    this.story = undefined;
    this.quests = [];
    this.completedQuests.clear();
    this.questContentCache.clear();
    this.currentTheme = null;
    this.projectInfo = undefined;
    this.projectPath = undefined;
  }
}
</code></pre>
<p>The <code class="inline-code">AdventureState</code> class is like the dashboard of a starship, constantly displaying key metrics such as your coordinates (state) and fuel (progress percentage) on your exploratory journey.  </p>
<hr>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo,
  theme: AdventureTheme,
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Generate story and quests
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(
    projectInfo, 
    theme, 
    this.state.projectPath
  );

  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);

  return this.state.story || &#39;&#39;;
}
</code></pre>
<p>The <code class="inline-code">initializeAdventure</code> function is the ignition switch of the ship that gathers maps, charts, and destinations, preparing the crew for their cosmic campaign.  </p>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">export class StoryGenerator {
  private llmClient: LLMClient;

  constructor() {
    this.llmClient = new LLMClient();
  }

  async generateStoryAndQuests(
    projectInfo: ProjectInfo,
    theme: AdventureTheme,
    projectPath?: string
  ): Promise&lt;StoryResponse&gt; {
    // Fetch Repomix content
    const repomixContent = projectInfo.repomixContent || &#39;No repomix content available&#39;;
    
    // Construct prompt and gather story response
    const prompt = loadStoryGenerationPrompt({
      theme,
      repomixContent,
    });

    const response = await this.llmClient.generateResponse(prompt, {
      maxTokens: LLM_MAX_TOKENS_STORY
    });

    const markedContent = response.content.trim();
    const parsed = parseMarkdownToStoryResponse(markedContent);

    return parsed;
  }
}
</code></pre>
<p>The <code class="inline-code">StoryGenerator</code> lets the ship’s computer (LLM) translate clusters of star-filled data into actionable tales, constructing routes for each quest the crew might embark on.  </p>
<hr>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  codeContent: string
): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
  });

  const response = await this.llmClient.generateResponse(prompt, {
    maxTokens: LLM_MAX_TOKENS_QUEST,
  });

  const content = response.content.trim();
  return { adventure: content };
}
</code></pre>
<p>The <code class="inline-code">generateQuestContent</code> method is like sending a scout team to investigate specific celestial phenomena, creating detailed instructions based on their discoveries.  </p>
<h2>Helpful Hints</h2>
<ul>
<li>Start your adventure by clearly setting the theme—it influences the experience for all users.  </li>
<li>Using prompts designed with repository data ensures that generated narratives remain engaging and technically relevant.  </li>
<li>Investigate how this journey enhances onboarding for developers by making file structures intuitive through guided exploration.</li>
</ul>
<hr>
<p>Mission accomplished, star voyager—Quest 2 is a stellar milestone, igniting the thrusters of knowledge as you chart 20% of your cosmic learning journey! 🚀⭐🗺️</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The StoryGenerator Core: Forgin... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>