<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Cosmic Forge of Adventure Creation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Lumina: The Odyssey of Code</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Cosmic Forge of Adventure Creation</h1>
<hr>
<p>Enclosed within the twisting nebulae of the Repository Galaxy, the <em>Starship Lumina</em> charted a new path toward the core of its mission—the Cosmic Forge of Adventure Creation. This metaphorical heart of the MCP system harbored the very tools required to reshape narratives and codebase explorations alike. As the glowing panels of the <em>Lumina</em> flickered, the crew prepared to navigate the intricacies of quest generation and storytelling. Their objective: uncover the code threads that wove together the stories propelling developers toward guided innovation. This was no mere exploration; it was a rendezvous with the very soul of the MCP adventure.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure orchestration managing state, themes, and user interactions</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file is the nerve center responsible for orchestrating the <em>Lumina’s</em> adventure system. At its helm stands the <code class="inline-code">AdventureManager</code> class, which oversees the full lifecycle of any quest. It begins with the <code class="inline-code">initializeAdventure()</code> function, where project contexts, themes, and quests burst to life with the aid of the <em>Lumina’s</em> storytelling engines. This function collaborates with internal state management, ensuring the handoff between star map configurations and quest arrays remains seamless. Another function, <code class="inline-code">exploreQuest()</code>, is the crew’s primary interface for mission execution. With mechanisms to validate, locate, and operate on quests, this method encapsulates the dynamic flow of MCP storytelling. The file further features an embedded state system handled by the <code class="inline-code">AdventureState</code> class, offering mechanisms for progress tracking, caching, and quest completion percentage calculations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure()</code>: Creates the foundational story and plots quests aligned with the MCP system’s theme.</li>
<li><code class="inline-code">exploreQuest()</code>: A critical execution point for individual quest traversal and state updates.</li>
<li><code class="inline-code">AdventureState</code>: Manages real-time mission information such as progress and completed quest archives.</li>
<li><code class="inline-code">generateQuestContent</code>: Allows for targeted file explorations to forge detailed narratives for specific quests.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> LLM-powered story creation with theme-based narratives and prompt engineering</h3>
<p>The <code class="inline-code">story-generator.ts</code> file is where the <em>Starship Lumina</em> forges its narrative stars—generating stories and quests that transform source code into adventures. The <code class="inline-code">StoryGenerator</code> class at its core communicates with a Large Language Model (LLM) to craft thematic narratives imbued with purpose. Among its key methods is <code class="inline-code">generateStoryAndQuests()</code>, a two-pronged mechanism for constructing a high-level adventure outline and granular quest data. The file adds depth by leveraging <code class="inline-code">generateQuestContent()</code> to shape individual quest encounters, producing interactive prompts that include code snippets and detailed insights. Meanwhile, the fallback mechanism ensures continuity even in the event of communication delays with the LLM.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests()</code>: Creates an overarching narrative and builds an array of tailored quests.</li>
<li><code class="inline-code">generateQuestContent()</code>: Tailors specific narrative threads based on file content, integrating code snippets to enhance storytelling.</li>
<li><code class="inline-code">validateTheme()</code>: Ensures thematic coherence by interpreting user-supplied themes.</li>
<li>Built-in safeguards for LLM timeouts and response validation to ensure reliable outputs.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration system for guided adventures that enhance story generation</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file acts as the bridge between static configurations and dynamic adventure creation. Its functions like <code class="inline-code">parseAdventureConfig()</code> and <code class="inline-code">loadAdventureConfig()</code> load and interpret <code class="inline-code">adventure.config.json</code> files to inform adventure guidelines and required analysis sections. More importantly, <code class="inline-code">formatAdventureConfigForPrompt()</code> reconstructs this structured data into inputs compatible with LLMs, ensuring quests are crafted within well-defined guardrails. The cohesive design of this file ensures that adventures are consistently aligned with the rules dictated by the config, balancing creativity with order.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig()</code>: Parses the configuration for structured and validated quest data.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code>: Converts configuration files into adventure-ready formats for the MCP.</li>
<li><code class="inline-code">extractUniqueFilePaths()</code>: Identifies all referenced paths, ensuring quests target valid file segments.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">export class AdventureManager {
  private state: AdventureState = new AdventureState();
  private storyGenerator: StoryGenerator;

  constructor() {
    this.storyGenerator = new StoryGenerator();
  }

  async initializeAdventure(
    projectInfo: ProjectInfo, 
    theme: AdventureTheme, 
    projectPath?: string,
    customThemeData?: CustomThemeData
  ): Promise&lt;string&gt; {
    this.state.reset();
    this.state.projectInfo = projectInfo;
    this.state.currentTheme = theme;

    if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
      this.storyGenerator.setCustomTheme(customThemeData);
    }

    const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, projectPath);
    this.state.title = storyResponse.title;
    this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
    this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, projectPath);
    
    return this.formatStoryWithQuests({
      ...storyResponse,
      quests: this.state.quests
    });
  }
}
</code></pre>
<p>This excerpt is like the navigation system of a starship, ensuring the mission starts on the right trajectory.</p>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">export class StoryGenerator {
  async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
    const validatedTheme = this.validateTheme(theme);
    const prompt = loadStoryGenerationPrompt({
      theme: validatedTheme,
      repomixContent: projectInfo.repomixContent || &#39;&#39;,
    });

    const response = await this.llmClient.generateResponse(prompt);
    let parsed = parseMarkdownToStoryResponse(response.content);
    return parsed;
  }
}
</code></pre>
<p>This code snippet works like the forges of a cosmic blacksmith, taking raw elements and shaping them into adventures imbued with thematic energy.</p>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>This snippet is the toolbox of the adventure system, interpreting and organizing user-defined quest parameters.</p>
<h2>Helpful Hints</h2>
<ul>
<li>To modify adventure titles or themes dynamically, explore <code class="inline-code">AdventureManager.initializeAdventure</code>.</li>
<li>Dive deeper into <code class="inline-code">generateStoryAndQuests</code> to refine quest prompts tailored to a specific repository.</li>
<li>Review and experiment with the <code class="inline-code">adventure.config.json</code> file to unlock specialized quest configurations.</li>
</ul>
<hr>
<p>Continuing the journey, the <em>Starship Lumina</em> moves ever closer to unlocking the secrets at the heart of the Repository Galaxy. Adventure awaits!</p>
<p>Stellar voyager, you&#39;ve ignited a supernova of creativity by mastering the Cosmic Forge—your adventure-writing mission is blazing at 25% power, charting a brilliant course among the stars! 🚀⭐💎</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Nebula of Code Analysis →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>