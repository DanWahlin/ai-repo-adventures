<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Stellar Forge: Shaping the Quest Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Operation Starlight: Mapping the Galactic Code Nexus</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <p>Sure! Here&#39;s the updated narrative chapter for Quest 2 that follows the stated guidelines:</p>
<hr>
<h1>Quest 2: Stellar Forge: Shaping the Quest Engine</h1>
<hr>
<p>Amid the vast expanse of the cosmos, the <em>Prometheus Array</em> soared through an uncharted nebula, its gleaming hull pierced by beams of fractured light from a thousand unknown stars. The ECN system buzzed with activity, deciphering new fragments of galactic signal chaos. A clear pattern was emerging from the signal—a tangled web of logic intricately weaving the core of a quest engine. This elusive code nexus, dubbed the &quot;Stellar Forge,&quot; held the secret to molding harmonious data pathways for the Federation. As the ship&#39;s systems hummed to life, the crew was called to decipher the architecture of the Stellar Forge and fortify its logic for the quests to come. It was time to explore the heart of the adventure framework!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure orchestration managing state, themes, and user interactions</h3>
<p>This file is the central command center of the adventure system, orchestrating the flow of quests and tying in critical player interactions. The <code class="inline-code">AdventureManager</code> class acts as the captain, holding the story&#39;s reins and ensuring seamless integration between quests and themes. The <code class="inline-code">initializeAdventure()</code> method sets the stage, ingesting project context, enforcing configurations from <code class="inline-code">adventure-config.json</code>, and deploying calls to the <code class="inline-code">StoryGenerator</code> to create tailored narratives. It also ensures that quests align perfectly with the adventure&#39;s theme, blending thematic storytelling with individual code challenges. Meanwhile, the <code class="inline-code">exploreQuest()</code> method handles user engagement, validating selections and guiding players through quest execution. This method elegantly distinguishes between progress requests and quest invocations, maintaining the adventure&#39;s immersive flow. State management is vital here, with mechanisms like <code class="inline-code">markQuestCompleted()</code> ensuring incremental progress tracking. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: Configures adventure contexts and generates quests using LLM.</li>
<li><code class="inline-code">AdventureManager.exploreQuest</code>: Validates user choices and initiates quests or progress tracking.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Tracks real-time progress through completed and pending quests.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> LLM-powered story creation with theme-based narratives and prompt engineering</h3>
<p>The <code class="inline-code">StoryGenerator</code> is the architect of the Stellar Forge, meticulously crafting quest narratives and ensuring they align with chosen themes. The method <code class="inline-code">generateStoryAndQuests()</code> is pivotal—it collates project data and themes to deliver engaging, structured stories and their accompanying quests through intricate LLM prompts. The <code class="inline-code">generateQuestContent()</code> method processes granular context, such as code file highlights, to produce deep, enriching quest content by dynamically blending narrative and technical guidance. This file also boasts defensive coding measures, validating LLM outputs to ensure robust narratives, reducing the risk of botched or incomplete responses. The integration of adventure configurations further fine-tunes user exploration, bridging the thematic aspirations of the framework with real-world code insights.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">StoryGenerator.generateStoryAndQuests</code>: Engages LLM to produce themed adventures and actionable quests.</li>
<li><code class="inline-code">StoryGenerator.generateQuestContent</code>: Generates immersive quest narratives, blending real project context and thematic exploration.</li>
<li><code class="inline-code">StoryGenerator.validateTheme</code>: Ensures adherence to predefined themes, preventing off-pattern responses.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration system for guided adventures that enhance story generation</h3>
<p>This file reads, parses, and enforces the logic for organized adventure playbooks as defined in <code class="inline-code">adventure.config.json</code>. The <code class="inline-code">loadAdventureConfig()</code> function performs its quiet magic, loading configuration files to inform quest generation. Next, <code class="inline-code">parseAdventureConfig()</code> validates these configurations, ensuring structural integrity and gracefully managing malformed files. For instance, it ensures that only existing, legitimate file paths are included within quests, reinforcing system security. The function <code class="inline-code">formatAdventureConfigForPrompt()</code> boosts interoperability with LLMs, transforming configuration data into structured prompts rich with contextual clues. This system transforms static configurations into an organic part of storytelling—stringently guiding narratives while accommodating file-level insights.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads and retrieves configuration data from <code class="inline-code">adventure.config.json</code>.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Validates and structures adventure configurations for secure integration.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Prepares adventure config for input within LLM workflows.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">export class AdventureManager {
  private state: AdventureState = new AdventureState();
  private storyGenerator: StoryGenerator;

  constructor() {
    this.storyGenerator = new StoryGenerator();
  }

  async initializeAdventure(
    projectInfo: ProjectInfo, 
    theme: AdventureTheme, 
    projectPath?: string,
    customThemeData?: CustomThemeData
  ): Promise&lt;string&gt; {
    this.state.reset();
    this.state.projectInfo = projectInfo;
    this.state.currentTheme = theme;
    this.state.projectPath = projectPath || process.cwd();

    if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
      this.storyGenerator.setCustomTheme(customThemeData);
    }

    const storyResponse = await this.storyGenerator.generateStoryAndQuests(
      projectInfo,
      theme,
      this.state.projectPath
    );

    this.state.title = storyResponse.title;
    this.state.story = typeof storyResponse.story === &#39;string&#39;
      ? storyResponse.story
      : storyResponse.story.content;

    this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
    return this.formatStoryWithQuests({
      ...storyResponse,
      quests: this.state.quests
    });
  }
}
</code></pre>
<p>This resembles a starship&#39;s navigation system, plotting a flight plan to unify story data with player progress.</p>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme): Promise&lt;StoryResponse&gt; {
  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent: projectInfo.repomixContent || &#39;No repomix content available&#39;,
    adventureGuidance: formatAdventureConfigForPrompt(this.projectPath || &#39;&#39;) || &#39;&#39;,
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY })
  );

  if (!response.content || response.content.trim() === &#39;&#39;) {
    throw new Error(&#39;LLM returned empty response&#39;);
  }

  let parsed;
  try {
    let cleanContent = response.content.trim();
    if (cleanContent.startsWith(&#39;```markdown&#39;)) {
      cleanContent = cleanContent.replace(/^```markdown\s*/, &#39;&#39;).replace(/\s*```$/, &#39;&#39;);
    }
    
    parsed = parseMarkdownToStoryResponse(cleanContent);
    StoryResponseSchema.parse(parsed);

    this.currentStoryContent = typeof parsed.story === &#39;string&#39; ? parsed.story : parsed.story.content;
  } catch (error) {
    throw new Error(`Invalid LLM response for story: ${response.content}`);
  }
  return parsed;
}
</code></pre>
<p>It’s like a cosmic blacksmith shaping raw materials—turning configuration and themes into an engaging space saga.</p>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;

  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>This operates like a translator, converting cryptic messages from one alien dialect to another with precision and care.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Enhance <code class="inline-code">adventure.config.json</code> with clear file paths and descriptions to improve quest quality.</li>
<li>Regularly validate <code class="inline-code">parseAdventureConfig</code> to ensure compatibility with new configurations.</li>
<li>Experiment with <code class="inline-code">generateQuestContent</code> to test its responsiveness to dynamic theme modifications.</li>
</ul>
<hr>
<p>End transmission. You are one step closer to mastering the Forge of Stars!</p>
<p>⭐ Mission Accomplished: Quest 2’s Stellar Forge blazes like a newborn star, fueling the Quest Engine with cosmic brilliance—let’s chart new frontiers! 🚀</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: Repomix Observatory: Analyzing ... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>