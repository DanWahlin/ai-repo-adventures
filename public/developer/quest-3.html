<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Quest Fabrication Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Codex of Repository Insights: A Developer's Guide</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Quest Fabrication Engine</h1>
<hr>
<p>The <strong>Quest Fabrication Engine</strong> is the beating heart of the Codex of Repository Insights, synthesizing engaging development-themed quests from codebases. This intricate system operates by analyzing project-specific configurations, generating thematic instructions, and weaving structured narratives for developers to explore. By leveraging advanced parsing mechanics and dynamic storytelling prompts, this engine empowers developers to gain insights while progressing through technical adventures. Together, <code class="inline-code">adventure-manager.ts</code>, <code class="inline-code">story-generator.ts</code>, and <code class="inline-code">adventure-config.ts</code> form the triad responsible for creating development-driven quests.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Config Convergence</strong>: How does <code class="inline-code">adventure-config.ts</code> harmonize raw data and validate configurations to provide context for quests?</li>
<li>‚ö° <strong>Quest Initialization</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> in <code class="inline-code">adventure-manager.ts</code> integrate storytelling and ensure quests are synchronized with the project context?</li>
<li>üõ°Ô∏è <strong>Error Handling &amp; Validation</strong>: How does <code class="inline-code">StoryGenerator.generateQuestContent</code> in <code class="inline-code">story-generator.ts</code> handle edge cases during quest fabrication and ensure coherence in generated content?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Loader and Validator</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file reads and interprets the <code class="inline-code">adventure.config.json</code> file, ensuring the quest system interacts reliably with the developer&#39;s project configuration.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Locates and loads the raw adventure configuration file from the specified project path.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Parses the raw configuration file, validating its structure and guarding against invalid or corrupt JSON data.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts and validates file paths included in the configuration to ensure they exist and are accessible.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Managing Quest Lifecycles</h3>
<p>The <code class="inline-code">AdventureManager</code> oversees every stage of a quest‚Äîinitialization, progress tracking, and execution‚Äîensuring a smooth user experience.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Orchestrates the setup of the adventure, from resetting internal state to retrieving configuration and generating quests.</li>
<li><code class="inline-code">exploreQuest</code>: Executes a specific quest, optionally retrieving it from the cache or generating new content dynamically.</li>
<li><code class="inline-code">progressPercentage</code>: Calculates the user‚Äôs current progress in the adventure to provide feedback during their journey.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Dynamic Storytelling and Quest Creation</h3>
<p>The <code class="inline-code">StoryGenerator</code> dynamically generates contextual narratives using data from the user&#39;s codebase and optional themes. It ensures the creation of compelling, technical content.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateQuestContent</code>: Produces detailed, code-specific content for each quest by leveraging LLM responses and theme-based context.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Parses markdown responses into structured data formats, translating human-readable narrative into actionable quests.</li>
<li><code class="inline-code">generateCompletionSummary</code>: Summarizes quest completion milestones, reinforcing the user&#39;s achievements and future path.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Reads the raw configuration file, returning its contents as a string or <code class="inline-code">null</code> for missing files.  </li>
<li>Ensures that the reading operation is non-fatal, allowing the system to fail gracefully for missing or unreadable setups.</li>
</ul>
<pre><code class="language-typescript">function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses and validates JSON configuration, ensuring only valid data is passed to the quest system.</li>
<li>Unified error handling prevents crashes from invalid JSON.</li>
</ul>
<pre><code class="language-typescript">function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;
    if (typeof node.path === &#39;string&#39; &amp;&amp; fs.existsSync(path.resolve(projectPath, node.path.trim()))) {
      unique.add(node.path.trim());
    }
    stack.push(...Object.values(node));
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Recursively searches configuration objects for file paths, validating their existence.  </li>
<li>Ensures only existing and accessible paths contribute to the quest generation process.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  ...
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Central to setting up adventures by clearing previous state and integrating project data from <code class="inline-code">adventure-config</code>.  </li>
<li>Invokes <code class="inline-code">story-generator.ts</code> to dynamically generate initial story and quests, ensuring synchronization with project context.</li>
</ul>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) return this.createNotFoundResult();
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Identifies and executes quests chosen by the user, leveraging cached data if available.  </li>
<li>Fallbacks include error messaging for invalid selections.</li>
</ul>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Built with numerical precision to calculate adventure completion percentage.  </li>
<li>Directly linked to user feedback displayed during their exploration.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({
    ...
    questPosition: config.questPosition,
    totalQuests: config.totalQuests,
  });
  const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST });
  ...
  return { adventure: cleanContent, fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };
}
</code></pre>
<ul>
<li>Generates rich quest content using user-project context, thematic directives, and dynamic story configurations.  </li>
<li>Filters extraneous metadata from LLM to provide clean, reliable quest descriptions.</li>
</ul>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);
  const quests: Quest[] = [];
  let story = &#39;&#39;;
  ...
  return { title, story: story.trim(), quests };
}
</code></pre>
<ul>
<li>Converts markdown outputs from the LLM into structured, usable data for quest/story generation.  </li>
<li>Ensures consistent parsing that aligns with quest presentation formatting.</li>
</ul>
<pre><code class="language-typescript">async generateCompletionSummary(
  quest: Quest,
  theme: AdventureTheme,
  progress: number,
  total: number
): Promise&lt;string&gt; {
  const prompt = loadCompletionPrompt({
    themeDescription,
    adventureTitle: quest.title,
    progress,
    total,
    percentComplete,
  });
  const response = await this.llmClient.generateResponse(prompt);
  return response.content.trim();
}
</code></pre>
<ul>
<li>Produces concise summaries reflecting the user&#39;s quest completion status.  </li>
<li>Integrates motivational progress updates to encourage further exploration.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Use Configurations Wisely</strong>: Tailor <code class="inline-code">adventure.config.json</code> to provide real-world project contexts for quests.</li>
<li><strong>Theme Fine-Tuning</strong>: Enhance storytelling by customizing themes in <code class="inline-code">adventure-manager.ts</code>.</li>
<li><strong>Error Triage</strong>: Trace errors to <code class="inline-code">StoryGenerator</code> parsing or <code class="inline-code">adventure-config.ts</code> validation specifics.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>üéâ System.out.println(&quot;Milestone unlocked: Quest 3‚ÄîThe Quest Fabrication Engine expertly compiled, pushing your progress to 40%‚Äîyou&#39;re refactoring reality itself into legendary code üöÄüíé‚ö°!&quot;);</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>