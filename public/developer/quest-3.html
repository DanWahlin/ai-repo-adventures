<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Oracle's Pipeline - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Intelligent Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Oracle&#39;s Pipeline</h1>
<hr>
<p>The Oracle&#39;s Pipeline is where raw knowledge transforms into actionable insight. As a Repository Adventurer, you step into this crucial system to unveil the mysteries of how data flows, analyze its transformation mechanisms, and ensure the wisdom of the Oracle is accessible to all. With the help of code from <code class="inline-code">repo-analyzer.ts</code> and <code class="inline-code">llm-client.ts</code>, your mission is to unravel the workings of this intricate digital pipeline and safeguard its integrity.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pipeline Validation</strong>: How does <code class="inline-code">validateProjectPath</code> ensure input safety for paths and files?  </li>
<li>‚ö° <strong>Response Generation</strong>: How does <code class="inline-code">generateResponse</code> handle prompt execution, timeout management, and error logging?  </li>
<li>üõ°Ô∏è <strong>API Connection</strong>: What mechanisms in <code class="inline-code">LLMClient.constructor</code> and <code class="inline-code">getApiKey</code> enforce robust API setup for different providers?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a>: Data Validation &amp; Content Generation</h3>
<p>The <code class="inline-code">repo-analyzer.ts</code> file facilitates secure handling of codebase paths and generates optimized content for analysis. Its <code class="inline-code">validateProjectPath</code> method is critical for input safety, inspecting paths for integrity by checking null bytes, empty strings, and traversal attempts. Similarly, <code class="inline-code">generateRepomixContext</code> integrates caching and advanced filtering to extract code context for downstream use.</p>
<h4>Highlights</h4>
<ul>
<li><strong>validateProjectPath</strong>: Ensures valid project paths with checks for emptiness, null bytes, and safe resolution.  </li>
<li><strong>generateRepomixContext</strong>: Manages caching and generates compressed code context for efficient analysis.  </li>
<li><strong>captureRepomixStdout</strong>: Executes and captures output from the <code class="inline-code">repomix</code> CLI with timeout and memory protection.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a></h3>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }
  const trimmedPath = projectPath.trim();
  if (!trimmedPath || trimmedPath.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Invalid project path detected&#39;);
  }
}
</code></pre>
<p>The safety gate of file exploration ensures only legitimate paths are processed.</p>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);

  const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }
  
  const cliOptions: CliOptions = { style: &#39;markdown&#39;, stdout: true, compress: options.compress };
  return await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
}
</code></pre>
<p>An intelligent system leveraging caching and filtering to optimize pipeline throughput.</p>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [&#39;--stdout&#39;, &#39;--style&#39;, options.style || &#39;markdown&#39;, ...directories];
    const repomixProcess = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], { cwd });
    
    let stdout = &#39;&#39;;
    repomixProcess.stdout.on(&#39;data&#39;, (data) =&gt; stdout += data.toString());
    repomixProcess.on(&#39;close&#39;, (code) =&gt; code === 0 ? resolve(stdout) : reject(new Error(&#39;Repomix failed&#39;)));
  });
}
</code></pre>
<p>A dedicated mechanism for executing subprocesses safely and collecting their results.</p>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a>: Oracle Communication Mechanisms</h3>
<p>The <code class="inline-code">llm-client.ts</code> file bridges the system to LLM APIs, enabling Oracle interaction. Focusing on <code class="inline-code">generateResponse</code>, it handles incoming prompts, manages execution flow, and robustly logs any API errors. Initialization methods (<code class="inline-code">constructor</code> and <code class="inline-code">getApiKey</code>) setup connections dynamically based on environment variables, further enforcing security measures.</p>
<h4>Highlights</h4>
<ul>
<li><strong>LLMClient.constructor</strong>: Initializes the Oracle Pipeline for interaction with OpenAI or Azure APIs.  </li>
<li><strong>generateResponse</strong>: Executes queries with robust error handling and output validation.  </li>
<li><strong>getApiKey</strong>: Identifies and secures API keys for various providers.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a></h3>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;
  const apiKey = this.getApiKey();
  if (!apiKey || !LLM_BASE_URL) {
    throw new Error(&#39;Missing required configuration for LLM.&#39;);
  }
  if (this.isAzureOpenAI()) {
    this.client = new AzureOpenAI({ endpoint: LLM_BASE_URL.split(&#39;/openai&#39;)[0], apiKey });
  } else {
    this.client = new OpenAI({ apiKey, baseURL: LLM_BASE_URL });
  }
}
</code></pre>
<p>Dynamic initialization adjusts client setup based on target provider.</p>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  try {
    const requestParams = this.buildRequestParams(prompt, options);
    const completion = await this.executeRequest(requestParams);
    return { content: this.validateResponse(completion) };
  } catch (error) {
    this.logDetailedError(error, prompt);
    throw new Error(&#39;LLM request failed&#39;);
  }
}
</code></pre>
<p>A resilient mechanism for executing Oracle queries with detailed error logging.</p>
<pre><code class="language-typescript">private getApiKey(): string {
  if (LLM_BASE_URL.includes(&#39;azure.com&#39;) &amp;&amp; !GITHUB_TOKEN) {
    throw new Error(&#39;Azure requires GITHUB_TOKEN environment variable.&#39;);
  }
  if (!LLM_API_KEY) {
    throw new Error(&#39;LLM_API_KEY is required.&#39;);
  }
  return LLM_API_KEY || GITHUB_TOKEN;
}
</code></pre>
<p>Secures API connection by enforcing environment-based key detection.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">validateProjectPath</code> to enforce safe usage of paths before downstream operations.  </li>
<li>Optimize your system connection by matching configurations to provider-specific requirements (e.g., Azure vs OpenAI).  </li>
<li>Apply response checks in <code class="inline-code">validateResponse</code> to identify potential truncation or formatting issues in LLM output.</li>
</ul>
<hr>
<p>Your journey in unraveling The Oracle&#39;s Pipeline enriches the Repository with newfound wisdom. Proceed with courage, adventurer!</p>
<p>Congratulations, developer! You&#39;ve successfully debugged and deployed Quest 3: The Oracle&#39;s Pipeline, refactoring your skills into a cleaner, more scalable codebase as you hit 40% progress‚Äîkeep iterating toward mastery! üöÄüíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>