<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Analyzer’s Compass - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'developer' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Code Chronicles: Forge of Adventures</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Analyzer’s Compass</h1>
<hr>
<p>Stepping into a realm where code structures speak the language of clarity, and every tool is a compass guiding creators through complexity, you find yourself tasked with a new challenge. The <strong>Analyzer’s Compass</strong> lies dormant within the <strong>RepoAnalyzer</strong>. This tool, capable of turning the chaos of a dynamic codebase into well-structured insights, requires mastery of its functions to quash the looming threat of inefficiency. Guided by a whisper of purpose, your quest begins as you explore the intricate mechanisms that bring the <strong>Analyzer’s Compass</strong> to life.</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a>: The Codebase Navigator</h3>
<p>This file is dedicated to codifying how repositories are analyzed and processed into structured content. The <code class="inline-code">RepoAnalyzer</code> class plays the leading role, equipped to validate paths, normalize file lists, and leverage the <strong>Repomix</strong> tool for generating contextual outputs of the codebase. Security is paramount, as evident in methods like <code class="inline-code">validateProjectPath()</code> and <code class="inline-code">validateAndNormalizeTargetFiles()</code> which safeguard against path traversal attacks and invalid input. The <code class="inline-code">generateRepomixContext()</code> and <code class="inline-code">generateTargetedContent()</code> functions serve as the foundation for high-level analysis, pulling from files pre-configured by <code class="inline-code">adventure.config.json</code> or from the entire repository when necessary. The harnessing of subprocesses—with strict memory and timeout limits—ensures Repomix runs safely and efficiently.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateRepomixContext()</code>: Produces a comprehensive snapshot of the project while leveraging caching to optimize repeated analyses.</li>
<li><code class="inline-code">validateAndNormalizeTargetFiles()</code>: Ensures only safe and legitimate file paths are processed, reducing risks of misuse.</li>
<li><code class="inline-code">captureRepomixStdout()</code>: Executes Repomix as a subprocess, carefully managing resource limits and error handling.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a>: The Creative Connector</h3>
<p>Serving as the bridge between the adventure system and large language models, this file orchestrates LLM interactions with precision. The <code class="inline-code">LLMClient</code> class is designed to work with multiple providers such as OpenAI and Azure OpenAI. A standout feature is its ability to auto-detect the provider type, managing configurations like API keys and request parameters independently for each. With methods like <code class="inline-code">generateResponse()</code>, this module applies parameters for token limits, reasoning depth, and verbosity, offering an intelligent way to interact with dynamic AI-powered responses. Error handling in the <code class="inline-code">logDetailedError()</code> method ensures issues are logged with meticulous detail, providing helpful debugging information.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse()</code>: The primary method for requesting and formatting LLM output, including handling GPT-5&#39;s unique parameterization.</li>
<li><code class="inline-code">constructor</code>: Dynamically configures the API client based on the detected provider, ensuring seamless operation.</li>
<li><code class="inline-code">logDetailedError()</code>: A comprehensive logging mechanism that captures and displays error nuances, critical for troubleshooting.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a></h3>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [...directories, &#39;--stdout&#39;, &#39;--style&#39;, options.style || &#39;markdown&#39;];
    if (options.compress) args.push(&#39;--compress&#39;);
    if (options.removeComments) args.push(&#39;--remove-comments&#39;);
    if (options.removeEmptyLines) args.push(&#39;--remove-empty-lines&#39;);
    if (options.noDirectoryStructure) args.push(&#39;--no-directory-structure&#39;);
    if (options.ignore) args.push(&#39;--ignore&#39;, options.ignore);
    if (options.include) args.push(&#39;--include&#39;, options.include);

    const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], { cwd, stdio: [&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;] });
    let stdout = &#39;&#39;;
    let stdoutSize = 0;
    let isResolved = false;

    const timeout = setTimeout(() =&gt; {
      if (!isResolved) {
        repomix.kill(&#39;SIGTERM&#39;);
        setTimeout(() =&gt; repomix.kill(&#39;SIGKILL&#39;), REPOMIX_GRACEFUL_TIMEOUT);
        isResolved = true;
        reject(new Error(`Repomix subprocess timed out (${REPOMIX_SUBPROCESS_TIMEOUT}ms)`));
      }
    }, REPOMIX_SUBPROCESS_TIMEOUT);

    repomix.stdout.on(&#39;data&#39;, (data) =&gt; {
      const chunk = data.toString();
      stdoutSize += chunk.length;

      if (stdoutSize &gt; REPOMIX_MAX_BUFFER_SIZE) {
        if (!isResolved) {
          isResolved = true;
          clearTimeout(timeout);
          repomix.kill(&#39;SIGKILL&#39;);
          reject(new Error(`Repomix output exceeded buffer limit`));
        }
        return;
      }

      stdout += chunk;
    });

    repomix.on(&#39;close&#39;, (code) =&gt; {
      if (!isResolved) {
        isResolved = true;
        clearTimeout(timeout);
        if (code === 0) {
          resolve(stdout);
        } else {
          reject(new Error(`Repomix failed with exit code ${code}`));
        }
      }
    });
  });
}
</code></pre>
<p>This function is like a well-coordinated orchestra that ensures the subprocess plays only within the boundaries set for safety and efficiency.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a></h3>
<pre><code class="language-typescript">private buildRequestParams(prompt: string, options?: LLMRequestOptions): OpenAIRequestParams {
  const requestParams: OpenAIRequestParams = {
    model: this.model,
    messages: [{ role: &#39;user&#39;, content: prompt }]
  };

  if (options?.responseFormat) {
    requestParams.response_format = { type: options.responseFormat };
  }

  if (this.isGPT5Model()) {
    requestParams.temperature = 1;
    requestParams.max_completion_tokens = options?.maxTokens || LLM_MAX_TOKENS_DEFAULT;
    requestParams.verbosity = options?.verbosity || GPT5_VERBOSITY;
    requestParams.reasoning_effort = options?.reasoningEffort || GPT5_REASONING_EFFORT;
  } else {
    requestParams.temperature = LLM_TEMPERATURE;
    requestParams.max_tokens = options?.maxTokens || LLM_MAX_TOKENS_DEFAULT;
  }

  console.error(`Starting LLM request to ${this.model}`);
  return requestParams;
}
</code></pre>
<p>This method acts as the blueprint for crafting an intelligent query tailored to the capabilities and quirks of the chosen model.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Explore how <code class="inline-code">cache</code> in <code class="inline-code">RepoAnalyzer</code> prevents redundant computations, saving time and resources during repeated analyses.</li>
<li>Consider extending <code class="inline-code">validateProjectPath()</code> to handle edge cases like symbolic links for added security.</li>
<li>Investigate how adjustments to <code class="inline-code">LLMRequestOptions</code> parameters, such as <code class="inline-code">reasoningEffort</code>, can fine-tune AI responses for different adventure styles.</li>
</ul>
<hr>
<p>Congratulations, developer—Quest 3: The Analyzer’s Compass executed successfully; your codebase of skills now boasts a 50% deployment progress toward mastery—keep iterating and refactoring greatness! 🚀⚡💎</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: The Architect’s Codex →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>