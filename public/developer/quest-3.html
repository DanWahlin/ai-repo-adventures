<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Code Analysis & Content Pipeline - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository Chronicles: The Developer's Guide to Modular Code Systems</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Code Analysis &amp; Content Pipeline</h1>
<hr>
<p>In the dynamic realm of developer tools, the Code Analysis &amp; Content Pipeline stands as a crucial system for distilling vast codebases into actionable insights. Here, the <code class="inline-code">RepoAnalyzer</code> works to streamline the complexity of source repositories by validating, optimizing, and analyzing file content, while the <code class="inline-code">LLMClient</code> ensures that integrations with large language models are handled seamlessly. This pipeline‚Äôs integration demonstrates how modular components enable scalable, efficient workflows in modern development.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pipeline Mapping</strong>: How does <code class="inline-code">RepoAnalyzer</code> streamline analysis by validating and optimizing inputs before processing?</li>
<li>‚ö° <strong>Integration Blueprint</strong>: How does the <code class="inline-code">LLMClient</code> initialize and dynamically configure itself for different LLM providers?</li>
<li>üõ°Ô∏è <strong>Error Detection</strong>: What mechanisms are in place to handle invalid configurations or failures during runtime in both classes?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a>: Repository Analysis and Optimization Toolkit</h3>
<p>This file defines the <code class="inline-code">RepoAnalyzer</code> class, a cornerstone for preparing and processing repository data. It validates file paths, normalizes content, and extracts optimized output. Key highlights include secure path validation and repomix subprocess orchestration.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateRepomixContext</code>: Generates a comprehensive repository context, using cache and fallback methods for reliability.</li>
<li><code class="inline-code">generateTargetedContent</code>: Extracts specific file content with validation and caching to optimize system efficiency.</li>
<li><code class="inline-code">captureRepomixStdout</code>: Captures subprocess output within set time and memory limits for safety.</li>
<li><code class="inline-code">validateProjectPath</code>: Ensures the project path is valid and safe to use, preventing injection vulnerabilities.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a></h3>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);

  const configuredFiles = extractUniqueFilePaths(projectPath);

  if (configuredFiles.length &gt; 0) {
    try {
      return await this.generateOptimizedContent(projectPath, configuredFiles);
    } catch (error) {
      console.warn(`Failed to generate optimized content, falling back: ${String(error)}`);
    }
  }
  console.log(&#39;No adventure.config.json found: analyzing full codebase (compressed)&#39;);
}
</code></pre>
<ul>
<li>Creates fallback tiers: optimized, targeted, or full content generation.</li>
<li>Utilizes <code class="inline-code">validateProjectPath</code> for input sanitization.</li>
<li>Reads adventure-specific files using <code class="inline-code">extractUniqueFilePaths</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath.trim()) throw new Error(&#39;Project path must be a non-empty string&#39;);
  if (projectPath.includes(&#39;\0&#39;)) throw new Error(&#39;Project path contains null bytes&#39;);
}
</code></pre>
<ul>
<li>Confirms that the path is non-empty and excludes null bytes.</li>
<li>Acts as a preventive measure for injection attacks or invalid inputs.</li>
<li>Ensures the string format adheres to expected standards.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [&#39;--stdout&#39;, &#39;--style&#39;, options.style || &#39;markdown&#39;];
    const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], { cwd });
    let stdout = &#39;&#39;, stderr = &#39;&#39;;
    repomix.stdout.on(&#39;data&#39;, chunk =&gt; stdout += chunk.toString());
    repomix.stderr.on(&#39;data&#39;, chunk =&gt; stderr += chunk.toString());
    repomix.on(&#39;close&#39;, code =&gt; (code === 0 ? resolve(stdout) : reject(new Error(stderr))));
  });
}
</code></pre>
<ul>
<li>Spawns a subprocess to handle external <code class="inline-code">repomix</code> executions.</li>
<li>Assesses memory and time constraints for subprocesses.</li>
<li>Logs the standard output while preserving stability in case of large data streams.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a>: Interface for Large Language Model Interactions</h3>
<p>The <code class="inline-code">LLMClient</code> class centralizes LLM integrations, abstracting authentication, request structures, and result validation. With support for various providers like OpenAI and Azure, it offers extensibility while maintaining robust error management.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse</code>: Constructs prompt requests, processes responses, and handles errors gracefully.</li>
<li><code class="inline-code">constructor</code>: Manages LLM-specific API authentication and client creation based on provider.</li>
<li><code class="inline-code">getApiKey</code>: Dynamically chooses the appropriate authentication token, ensuring secure access.</li>
<li><code class="inline-code">isAzureOpenAI</code>: Identifies Azure/OpenAI provider differences, tailoring the client setup.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a></h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  try {
    const requestParams = this.buildRequestParams(prompt, options);
    const completion = await this.executeRequest(requestParams);
    let content = this.validateResponse(completion);
    if (options?.responseFormat === &#39;json_object&#39;) content = this.cleanJsonResponse(content);
    this.logTokenUsage(completion);
    return { content };
  } catch (error) {
    this.logDetailedError(error, prompt);
    throw new Error(`LLM request failed: ${String(error.message || error)}`);
  }
}
</code></pre>
<ul>
<li>Responsible for sending and processing LLM-generated responses.</li>
<li>Includes robust post-processing for JSON validation and markdown stripping.</li>
<li>Features structured error handling with comprehensive debugging information.</li>
</ul>
<hr>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;
  const apiKey = this.getApiKey();
  if (!apiKey || !LLM_BASE_URL) throw new Error(&#39;LLM configuration required.&#39;);
  if (this.isAzureOpenAI()) {
    this.client = new AzureOpenAI({ endpoint: LLM_BASE_URL, apiKey });
  } else {
    this.client = new OpenAI({ apiKey, baseURL: LLM_BASE_URL });
  }
}
</code></pre>
<ul>
<li>Dynamically initializes the client by checking the model and provider.</li>
<li>Differentiates between Azure and OpenAI-specific setups for flexibility.</li>
<li>Throws errors for missing or incomplete configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">private getApiKey(): string {
  if (LLM_BASE_URL.includes(&#39;azure.com&#39;)) {
    if (!GITHUB_TOKEN) throw new Error(&#39;GITHUB_TOKEN required for Azure-based models.&#39;);
    return GITHUB_TOKEN;
  }
  if (!LLM_API_KEY) throw new Error(&#39;LLM_API_KEY required for non-Azure providers.&#39;);
  return LLM_API_KEY;
}
</code></pre>
<ul>
<li>Selects the appropriate API token based on the provider (Azure vs. OpenAI).</li>
<li>Provides descriptive error messages for missing tokens.</li>
<li>Acts as a security measure to prevent unauthorized requests.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üí° Use <code class="inline-code">RepoAnalyzer</code>&#39;s caching to reduce redundant file processing for large repositories.</li>
<li>üöÄ Experiment with <code class="inline-code">LLMClient</code>&#39;s dynamic options to optimize prompts for different models (e.g., GPT-5).</li>
<li>üõ°Ô∏è Always validate file paths in <code class="inline-code">RepoAnalyzer</code> to ensure secure and reliable operations.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the codebase.</p>
<p>Congratulations on successfully refactoring the logic and optimizing the content pipeline‚Äîyour implementation is now 40% feature-complete and you&#39;re debugging your way toward the final deployment! üöÄüí°‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>