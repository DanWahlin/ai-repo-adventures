<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Quest Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository Atlas: A Guided Exploration of the Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest Generation Engine</h1>
<hr>
<p>The mechanics of a high-performing quest generation system are revealed! In this technical exploration, you&#39;ll investigate how quests are designed, validated, and executed‚Äîturning raw code repositories into engaging adventures. This system orchestrates configurations, story generation, and content pipelines, empowering developers to make repositories interactive and future-ready.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Config Pathways</strong>: How does the <code class="inline-code">loadAdventureConfig</code> function locate and read the configuration file, and what are the potential failure cases it handles?</li>
<li>‚ö° <strong>Adventure Initialization</strong>: What sequence of operations are triggered during <code class="inline-code">AdventureManager.initializeAdventure</code>, and how does it enforce configuration constraints from <code class="inline-code">adventure.config.json</code>?</li>
<li>üõ°Ô∏è <strong>Content Assembly</strong>: How does <code class="inline-code">StoryGenerator.generateQuestContent</code> manage code extraction and formatting for quests to ensure relevant, organized prompts?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Parsing and File Input Validation</h3>
<p>This file manages the interaction between the quest generation engine and configuration files. It ensures accurate loading, parsing, and normalization of the <code class="inline-code">adventure.config.json</code> file, and extracts critical metadata to shape quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads the adventure configuration file using its absolute path and handles missing files gracefully without fatal errors.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Validates and parses JSON content, enforcing schema requirements while handling parsing issues with fallbacks to <code class="inline-code">null</code>.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts and validates file paths mentioned in the configuration while ensuring they exist in the underlying project structure.</li>
</ul>
<h3>Code</h3>
<h4>packages/core/src/shared/adventure-config.ts</h4>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Loads the configuration file based on the provided project path.</li>
<li>Uses <code class="inline-code">readFileIfExists</code> to ensure graceful handling of missing files.</li>
<li>Promotes flexibility in cases where the configuration is not mandatory for execution.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Validates configuration content using a single parsing step.</li>
<li>Handles corrupted or missing configuration files by falling back to <code class="inline-code">null</code>.</li>
<li>Ensures that only well-formed JSON is passed downstream.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];
  
  while (stack.length) {
    const node = stack.pop();
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }
  return Array.from(unique);
}
</code></pre>
<ul>
<li>Explores nested configuration objects to extract <code class="inline-code">path</code> fields.</li>
<li>Validates file existence, ensuring only real paths enter the quest pipeline.</li>
<li>Promotes scalable, structured parsing for diverse configuration formats.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Initialization of Adventure Context</h3>
<p>This file orchestrates quest execution, ensuring that both the context and theme are configured properly. It integrates pre-processing steps for configuration enforcement and initialization.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Generates story and quest metadata, incorporating configuration limits and alignment with selected themes.</li>
<li><code class="inline-code">exploreQuest</code>: Handles user input validation and quest discovery, determining whether to execute quests or show progress.</li>
<li><code class="inline-code">generateCompletionSummary</code>: Generates end-of-quest summaries, ensuring user engagement is maintained through creative outputs.</li>
</ul>
<h3>Code</h3>
<h4>packages/core/src/adventure/adventure-manager.ts</h4>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Resets previous state and configures new initialization parameters, ensuring no residual values interfere.</li>
<li>Merges quest data from user-provided <code class="inline-code">adventure.config.json</code> with dynamically generated themes.</li>
<li>Enforces quest limits from configuration files for consistent alignment with user-defined constraints.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Detailed Quest Content Management</h3>
<p>This file oversees the generation of quest content, leveraging prompts and theme-based instructions to extract actionable narratives and learning material.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Constructs the story and quest metadata using project context and theme, ensuring dynamic integration.</li>
<li><code class="inline-code">generateQuestContent</code>: Extracts relevant code snippets and formats clear prompts for investigation during quest execution.</li>
<li><code class="inline-code">generateCompletionSummary</code>: Summarizes quest outcomes creatively, integrating completion percentages and user feedback.</li>
</ul>
<h3>Code</h3>
<h4>packages/core/src/adventure/story-generator.ts</h4>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const { quest, theme, codeContent, questPosition, totalQuests } = config;
  
  let adventureGuidance = &#39;&#39;, customInstructions = &#39;&#39;;
  if (this.projectPath) {
    adventureGuidance = formatAdventureConfigForPrompt(this.projectPath) || &#39;&#39;;
    customInstructions = extractCustomInstructions(this.projectPath) || &#39;&#39;;
  }

  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    adventureGuidance,
    questPosition,
    totalQuests,
    ...(customInstructions &amp;&amp; { customInstructions }),
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  });
  
  const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST });
  
  let cleanContent = response.content.trim();
  cleanContent = cleanContent.replace(/^```markdown/, &#39;&#39;).replace(/```$/, &#39;&#39;).trim();
  
  return {
    adventure: cleanContent,
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<ul>
<li>Creates prompts tailored to quest objectives and available context.</li>
<li>Ensures markdown content is cleanly extracted for seamless consumption.</li>
<li>Leverages <code class="inline-code">extractCustomInstructions</code> to dynamically apply configuration guidance for quests.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Search for Patterns</strong>: Investigate how functions promote modular parsing and validation in <code class="inline-code">adventure-config.ts</code>.</li>
<li><strong>Follow the Flow</strong>: Trace the flow of adventure initialization in <code class="inline-code">initializeAdventure</code> for multi-step processing patterns.</li>
<li><strong>Explore Optimizations</strong>: Review how quest content is prepared to minimize redundant descriptions in dynamic content generation workflows.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>üéâ Congratulations, developer, on successfully deploying Quest Generation Engine‚Äîyour codebase is now 40% closer to MVP launch velocity; keep iterating and pushing towards the endgame! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>