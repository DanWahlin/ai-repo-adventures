<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Quest Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Developer's Blueprint: Mastering Codebase Architecture</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest Generation Engine</h1>
<hr>
<p>Packages of immense responsibility lie before you, Developer. The Quest Generation Engine orchestrates the creation and management of code-centric adventures that unite storylines with functionality. Intricately designed, it parses configuration files, curates quests, and refines the execution experience. To unveil its secrets is to master the art of automated content generation.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>State Calibration</strong>: How does <code class="inline-code">AdventureState</code> maintain the progress percentage and cache quest completions?</li>
<li>‚ö° <strong>Initialization Inquiry</strong>: What key steps does <code class="inline-code">AdventureManager.initializeAdventure</code> employ to set up project context and populate quests?</li>
<li>‚ú® <strong>Story Generation Logic</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> ensure theme validation and process comprehensive quest structures?</li>
<li>üéØ <strong>Configuration Parsing</strong>: How does <code class="inline-code">loadAdventureConfig</code> interact with the filesystem, and how are unique paths extracted from adventure configurations?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Managing State and Execution</h3>
<p>The <code class="inline-code">AdventureManager</code> oversees story initialization and quest execution. This file centralizes configuration parsing, story generation, and state management, ensuring fluid navigation for users across quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Establishes project context, parses configurations, validates themes, and generates overarching stories and quests.</li>
<li><code class="inline-code">exploreQuest</code>: Executes a quest by handling user input and managing response generation or retrieval from cached results.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Tracks completed quests relative to the total count, providing a clear progress view of the current adventure.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(
    projectInfo, 
    theme, 
    this.state.projectPath
  );

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Establishes the context for the adventure by initializing project details, paths, and themes.</li>
<li>Integrates seamlessly with <code class="inline-code">storyGenerator</code> to build narratives and dynamically map quests.</li>
<li>Enhances adaptability via custom themes and incorporation of configurations ensuring a modular scaffold.</li>
</ul>
<hr>
<pre><code class="language-typescript">class AdventureState {
  completedQuests: Set&lt;string&gt; = new Set();
  quests: Quest[] = [];

  get progressPercentage(): number {
    return this.quests.length &gt; 0 
      ? Math.round((this.completedQuests.size / this.quests.length) * 100)
      : 0;
  }
}
</code></pre>
<ul>
<li>Encapsulates the state of the current adventure, centralizing progress metrics and managing data integrity.</li>
<li>Employs getters to calculate progress dynamically, ensuring real-time updates for users.</li>
<li>Enhances user experience through transparency in the execution journey.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Crafting Stories and Adventures</h3>
<p>The <code class="inline-code">StoryGenerator</code> shapes the narrative and underlying structure for each adventure. Its logic aligns theme validation, responsive design, and quest detail parsing into seamless storytelling.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Validates themes and generates cohesive storylines alongside action-driven quests.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Processes LLM narratives, parsing stories into organized and actionable quest lists.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Serves as the central hub for story and quest generation, delegating validation and content parsing tasks.</li>
<li>Guarantees the use of validated themes, ensuring tight integration with the project specifications.</li>
<li>Enables flexible content adaptation to diverse project contexts through its modular structure.</li>
</ul>
<hr>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);

  const title = extractTitle(tokens);
  let story = &#39;&#39;;
  const quests: Quest[] = [];

  let currentSection = &#39;&#39;;
  let currentQuest: Partial&lt;Quest&gt; = {};
  for (const token of tokens) {
    if (token.type === &#39;heading&#39;) {
      currentSection = token.text.toLowerCase();
    } else if (token.type === &#39;paragraph&#39; &amp;&amp; currentSection === &#39;story&#39;) {
      story += token.text + &#39;\n\n&#39;;
    } else if (token.type === &#39;paragraph&#39;) {
      currentQuest.description = token.text;
    } else if (token.type === &#39;list&#39;) {
      currentQuest.codeFiles = token.items.map(i =&gt; i.text);
    }
  }

  quests.push({ id: `quest-${quests.length + 1}`, ...currentQuest });
  return { title, story: story.trim(), quests };
}
</code></pre>
<ul>
<li>Leverages tokenization to parse LLM-generated markdown responses into structured stories and quest descriptions.</li>
<li>Interprets section headings and organizes content into actionable formats, ensuring narrative clarity.</li>
<li>Demonstrates flexibility via its support for dynamic and complex configurations.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Config Parsing and Validation</h3>
<p>The <code class="inline-code">adventure-config.ts</code> module handles low-level input parsing, taking textual configuration data and extracting validated adventure insights.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads configuration files from a given filesystem path, facilitating context awareness.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Converts raw configuration data into structured JSON, ensuring error resilience.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Analyzes configurations and identifies unique file paths referenced throughout.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Safeguards against missing or unreadable configuration files, ensuring system robustness.</li>
<li>Provides an entry point for loading minimal project-specific adventure data.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Centralizes configuration parsing, ensuring JSON format validation and error handling.</li>
<li>Fosters resilience against malformed input, maintaining processing integrity.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (node.path &amp;&amp; fs.existsSync(path.resolve(projectPath, node.path))) {
      unique.add(node.path.trim());
    }

    Array.isArray(node) ? node.forEach(stack.push) : stack.push(...Object.values(node));
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Iteratively identifies all unique file paths within an adventure configuration.</li>
<li>Validates their existence, ensuring relevance to the active project environment.</li>
<li>Reinforces modularity, enabling developers to focus efforts on key integration points.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">initializeAdventure</code> as the core reference for adventure setup.</li>
<li>Explore <code class="inline-code">generateStoryAndQuests</code> for insights into story integration with content.</li>
<li>Validate configuration parsing and output file tracking for modular enhancements.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations on successfully implementing the Quest Generation Engine‚Äîyour codebase is evolving into a scalable masterpiece at 40% progress, refactoring complexity into clarity and pushing the project toward deployment-ready brilliance! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>