<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Command the Adventurer's Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository of Endless Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Command the Adventurer&#39;s Tools</h1>
<hr>
<p>Beneath the veil of a developer&#39;s repository lies the secret to gamifying code exploration. Adventurers and tools alike join forces within the MCP server, enabling coders to analyze, interact, and uncover hidden treasures in their projects. The hero of this quest, the RepoAdventureServer, rallies its tools, unleashing dynamically configured handlers to power an epic adventure through code. Prepare to harness these tools, configuring narratives with precision while the thrilling server connections beckon you forward.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Logic</h3>
<p>The <code class="inline-code">RepoAdventureServer</code> class drives the interactive layer of the MCP adventure system. By establishing server transports via <code class="inline-code">StdioServerTransport</code> and dynamically registering request handlers, it bridges tool execution and configuration. Notably, the <code class="inline-code">setupHandlers</code> function simplifies tool-related operations, dynamically listing available tools and validating user inputs with schemas via the Zod framework. Further enhancements include handling asynchronous commands and warm-up caching through <code class="inline-code">repoAnalyzer</code>.</p>
<p>Functions such as <code class="inline-code">main</code>, which initializes the server alongside graceful shutdown mechanisms, offer robust error-handling strategies. Through signals like <code class="inline-code">SIGINT</code> and <code class="inline-code">SIGTERM</code>, clean exits are ensured even during interruptions. This file exemplifies the seamless interaction between adventure generation engines and transport-based communication systems, empowering developers.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code>: Dynamic tool registration and argument validation.</li>
<li><code class="inline-code">RepoAdventureServer.run</code>: Initializes transport and performs pre-generation caching.</li>
<li><code class="inline-code">main</code>: Start-up and shutdown orchestration.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);

      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }
      return await tool.handler(validationResult.data as any);
    } catch (error) {
      throw error instanceof McpError ? error : new McpError(
        ErrorCode.InternalError, 
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>Handlers act like guides, providing structured paths for users while guarding against missteps with detailed validations.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>This function starts the journey, warming up the exploration engine and preparing dynamic content to assist users.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>The main entry point strategically guards the adventure against unforeseen crashes, ensuring continuity even amidst chaos.</p>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools Interface</h3>
<p>This file centralizes the gamified tools of the MCP system, presenting an intuitive interface for exploring codebases. By exporting <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>, it bridges helpers like <code class="inline-code">adventureManager</code> to individual handlers in separate files. Each tool emphasizes interaction, tailored responses, and logical progression within a developer&#39;s adventure. </p>
<p>The tools&#39; modular structure allows for expandability, and their seamless integration into the <code class="inline-code">tools</code> export enables dynamic runtime registration by servers like <code class="inline-code">RepoAdventureServer</code>. These components power exploration, guided storytelling, and status monitoring, serving as the quest engine.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Initiates repo analysis and themes discovery.</li>
<li><code class="inline-code">choose_theme.handler</code>: Drafts a story and generates relevant quests.</li>
<li><code class="inline-code">explore_quest.handler</code>: Conducts quest-based exploration of codebase segments.</li>
<li><code class="inline-code">view_progress.handler</code>: Monitors user progress within adventures.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
</code></pre>
<p>This tool is the doorway to initiate exploration and propose themes for new journeys.</p>
<pre><code class="language-typescript">export const choose_theme = chooseTheme;
</code></pre>
<p>Helping adventurers grasp narratives, this handler generates paths filled with quests.</p>
<pre><code class="language-typescript">export const explore_quest = exploreQuest;
</code></pre>
<p>Focused exploration allows adventurers to tackle quests one at a time within a repository.</p>
<pre><code class="language-typescript">export const view_progress = viewProgress;
</code></pre>
<p>Monitoring progress provides a sense of accomplishment and directs adventurers to remaining tasks.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Utilize <code class="inline-code">setupHandlers</code> to map tools dynamically through schemas for efficient integration.</li>
<li>Explore modular features in <code class="inline-code">tools.ts</code> to customize adventure behaviors or expand services.</li>
<li>Begin with <code class="inline-code">start_adventure</code> and follow sequential tools for a smooth story-driven coding thrill.</li>
</ul>
<hr>
<p>Congratulations, brave adventurer! You now command the tools to uncover narrative treasures hidden deep within code.</p>
<p>ðŸŽ‰ Quest 1: Command the Adventurer&#39;s Tools successfully debugged and executedâ€”initialize new branches of learning with confidence, as your codebase of knowledge expands ðŸš€âš¡!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: Harness the Engine of Quests â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>