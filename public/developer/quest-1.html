<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Forge of the MCP Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Repository Chronicles</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Forge of the MCP Tools</h1>
<hr>
<p>In the bustling kingdom of Codeoria, an ancient forge known as the MCP Toolworks hums with activity. Here, the guardian Devknights gather to wield enchanted tools, each imbued with the power to illuminate fragmented codebases. As the Forge sparks to life, your quest beginsâ€”crafting and commanding tools such as <code class="inline-code">start_adventure</code> and <code class="inline-code">view_progress</code> to unravel repositories&#39; secrets, bridging the gap between knowledge and innovation.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Implementation</h3>
<p>This file contains the primary setup for the MCP server, handling dynamic tool listing, execution, and lifecycle management. Central to its architecture is the <code class="inline-code">RepoAdventureServer</code> class, which encapsulates the logic for providing an interactive and gamified experience. Critical methods like <code class="inline-code">setupHandlers</code> define the process for registering tools, while the <code class="inline-code">run</code> method initializes server transport and triggers preemptive code analysis to enhance user interactivity. As the entry point, the <code class="inline-code">main</code> function sets up handlers for graceful shutdown and unhandled errors.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code> - Defines dynamic request handlers for tool listing and execution.</li>
<li><code class="inline-code">RepoAdventureServer.run</code> - Connects server transport and performs cache pre-generation tasks.</li>
<li><code class="inline-code">main</code> - Orchestrates server startup and global signal handling for smooth operations.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, {
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    const { name, arguments: args } = request.params;
    if (!(name in tools)) {
      throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
    }
    const tool = tools[name as keyof typeof tools];
    const validationResult = tool.schema.safeParse(args);
    if (!validationResult.success) {
      const errorMessages = validationResult.error.issues.map((err) =&gt;
        `${err.path.join(&#39;.&#39;)}: ${err.message}`
      ).join(&#39;, &#39;);
      throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
    }
    return await tool.handler(validationResult.data as any);
  });
}
</code></pre>
<p>This can be likened to setting up a marketplace where tools are displayed and their functionality validated before use.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);

  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>Visualize this as preparing a fleet of carts ahead of an expedition for seamless deployment in treasure hunting.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; process.on(sig as NodeJS.Signals, gracefulShutdown));
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>This is akin to a captain organizing crew members and fail-safes before setting off on a voyage.</p>
<hr>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools Registry</h3>
<p>The file serves as the centralized entry point for registering and exposing the MCP tools, enabling gamified exploration of repositories. It orchestrates several critical utilitiesâ€”<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>â€”ensuring their accessibility via logical mappings. The shared <code class="inline-code">adventureManager</code> is also exported for coordination across tools.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code> - Initiates the codebase analysis and proposes thematic options.</li>
<li><code class="inline-code">choose_theme.handler</code> - Selects a theme and generates tailored adventures.</li>
<li><code class="inline-code">explore_quest.handler</code> - Leads an interactive quest exploration.</li>
<li><code class="inline-code">view_progress.handler</code> - Provides completion tracking and status updates.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
</code></pre>
<p>Think of this as lighting the beacon that calls adventurers to action.</p>
<pre><code class="language-typescript">export const choose_theme = chooseTheme;
</code></pre>
<p>Consider this as choosing the colors and decorations for your banner before a campaign.</p>
<pre><code class="language-typescript">export const explore_quest = exploreQuest;
</code></pre>
<p>This feels like charting paths across uncharted lands dotted with hidden treasures.</p>
<pre><code class="language-typescript">export const view_progress = viewProgress;
</code></pre>
<p>Imagine this as opening a ledger to count completed tasks and unfinished goals.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">start_adventure</code> to prepare thematic insights for the repositories before diving deep.</li>
<li>Explore <code class="inline-code">view_progress</code> periodically to track quests and avoid redundant exploration.</li>
<li>Deepen utility by expanding MCP tools for specialized tasks, ensuring their schemas are meticulously validated.</li>
</ul>
<hr>
<p>Forge completeâ€”equip yourself, brave adventurer, for the unending odyssey of code illumination!</p>
<p>Congratulations on deploying the Forge of the MCP Toolsâ€”your first pull request in the quest log has been successfully merged into the master branch of growth, setting you on an upward refactor to greatness! ðŸš€âš¡ðŸ’Ž</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Questsmith's Forg... â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>