<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Hall of MCP - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Chronicles of the Codebase</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Hall of MCP</h1>
<hr>
<p>In the grand hall of MCP, the ancient art of coding adventures unfolds. As the chosen maintainer, your duty is to unlock the mysteries within the files that power this mythical system. Here, adventurers are guided by tools forged in the fires of modular design, while their quests are tailored through enchanted handlers. Master the core <code class="inline-code">server.ts</code> and <code class="inline-code">tools.ts</code> files, and unveil the secrets of the MCP Tool Interface as you venture deeper into this legendary repository.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Core</h3>
<p>This file is the backbone of the MCP Tool Interface, functioning as the entry point for managing tools and connecting adventurers to interactive coding escapades. It defines the <code class="inline-code">RepoAdventureServer</code> class, which handles server initialization, tool execution, and communication with connected transports. The primary highlights include setting up dynamic request handlers for tools (<code class="inline-code">RepoAdventureServer.setupHandlers</code>), running the server instance (<code class="inline-code">RepoAdventureServer.run</code>), and gracefully managing shutdown scenarios (<code class="inline-code">main</code> function). These components ensure a seamless experience for adventurers, enabling real-time tool integration and robust error handling.</p>
<h4>Highlights</h4>
<ul>
<li>Defines dynamic handlers for tool listing and execution via <code class="inline-code">setupHandlers</code>.</li>
<li>Implements server startup logic using <code class="inline-code">run</code>, including pre-generating content for warm caches.</li>
<li>Employs <code class="inline-code">main</code> for initializing, managing shutdown protocols, and handling errors.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools and Handlers</h3>
<p>The <code class="inline-code">tools.ts</code> file organizes the MCP tools into modular components, providing a streamlined way to register and share handlers. It exports key tools such as <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>, which enable adventurers to analyze repositories, pick story themes, embark on quests, and monitor their progress. Each of these tools is designed to interact cohesively with the server logic for dynamic storytelling.</p>
<h4>Highlights</h4>
<ul>
<li>Centralizes tool definitions with distinct handlers for repository adventure workflows.</li>
<li>Exports <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code> handlers for direct server integration.</li>
<li>Shares common functionality through the <code class="inline-code">adventureManager</code>.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { target: &#39;jsonSchema7&#39;, $refStrategy: &#39;none&#39; })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;
      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }
      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt;
          `${err.path.join(&#39;.&#39;)}: ${err.message}`).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }
      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) throw error;
      throw new McpError(ErrorCode.InternalError, `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`);
    }
  });
}
</code></pre>
<p>Handlers are akin to enchanted gateways, dynamically resolving tool requests based on the schema.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>The <code class="inline-code">run</code> function acts as the heart of the server, pumping its lifeblood into connected transports and enabling preemptive content generation.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; process.on(sig as NodeJS.Signals, gracefulShutdown));
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>The <code class="inline-code">main</code> function is the summoning spell, initiating the server and preparing handling mechanisms for errors and shutdown signals.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>The <code class="inline-code">tools</code> object resembles a toolkit laid out for adventurers, encapsulating the key tools necessary for their journeys.</p>
<pre><code class="language-typescript">export { adventureManager };
</code></pre>
<p>The <code class="inline-code">adventureManager</code> export behaves like a guiding compass, shared among tools for consistent story management.</p>
<pre><code class="language-typescript">/**
 * MCP Repo Adventure Tools - Main Entry Point
 * 
 * These tools provide an interactive, gamified way to explore and understand codebases.
 */
export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;
</code></pre>
<p>Each exported tool acts as a magical artifact, delivering specific functionalities for adventurers to navigate their quests.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Always validate schemas before executing handlers to uphold tool reliability.</li>
<li>Explore the interrelationship between <code class="inline-code">server.ts</code> and <code class="inline-code">tools.ts</code> files to understand their cohesion.</li>
<li>Dive into additional files in the Complete Codebase for insights into deeper MCP functionalities.</li>
</ul>
<hr>
<p>Your mastery of the Hall of MCP grows stronger. Prepare for the next challenge, adventurer!</p>
<p>Congratulations on successfully debugging and deploying your way through Quest 1: The Hall of MCPâ€”you&#39;re officially initializing your epic developer adventure at 0x01, ðŸš€ keep committing greatness!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>