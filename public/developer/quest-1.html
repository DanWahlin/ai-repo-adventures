<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Unraveling the MCP Interface - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of Repository Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Unraveling the MCP Interface</h1>
<hr>
<p>In the Repository Adventure Engine&#39;s heart lies the MCP Interface, a powerful yet mysterious system enabling seamless interaction with gamified tools. Today, you embark on a journey to dissect its mechanics, revealing its layers‚Äîhandlers for dynamic tool execution, interactive transport systems, and reactive server flows. Your mission is to explore how the MCP Interface transforms developer interactions into immersive adventures.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Tool Handling Protocol</strong>: How does the <code class="inline-code">setupHandlers</code> method dynamically list and execute the tools?  </li>
<li>‚ö° <strong>Server Operation Flow</strong>: What initialization steps occur in the <code class="inline-code">run</code> method, and how is the transport connected?  </li>
<li>üõ°Ô∏è <strong>Error Safeguards</strong>: How does the system handle invalid tool inputs and runtime errors during execution?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a>: MCP server implementation</h3>
<p>This file defines the MCP server architecture with dynamic tool handling, transport mechanisms, and error-management protocols. It houses the <code class="inline-code">RepoAdventureServer</code> class, responsible for initializing handlers and processing tool requests dynamically using Zod schemas for validation. Error handling is robust, converting validation failures or runtime exceptions into structured responses that maintain operational stability.</p>
<h4>Highlights</h4>
<ul>
<li><strong><code class="inline-code">RepoAdventureServer.setupHandlers</code></strong>: Handles dynamic tool listing and execution with input validation.  </li>
<li><strong><code class="inline-code">RepoAdventureServer.run</code></strong>: Sets up the transport connection and pre-generates content for caching.  </li>
<li><strong><code class="inline-code">main</code></strong>: Orchestrates server startup, signal handling, and graceful shutdown.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a></h3>
<pre><code class="language-typescript">private setupHandlers() {  
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {  
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({  
      name,  
      description: tool.description,  
      inputSchema: zodToJsonSchema(tool.schema, {   
        target: &#39;jsonSchema7&#39;,  
        $refStrategy: &#39;none&#39;  
      })  
    }));  
    return { tools: toolList };  
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {  
    try {  
      const { name, arguments: args } = request.params;  
      if (!(name in tools)) {  
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);  
      }

      const tool = tools[name as keyof typeof tools];  
      const validationResult = tool.schema.safeParse(args);  
      if (!validationResult.success) {  
        const errorMessages = validationResult.error.issues.map((err) =&gt;   
          `${err.path.join(&#39;.&#39;)}: ${err.message}`  
        ).join(&#39;, &#39;);  
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);  
      }

      return await tool.handler(validationResult.data as any);  
    } catch (error) {  
      if (error instanceof McpError) {  
        throw error;  
      }  
      throw new McpError(  
        ErrorCode.InternalError,  
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`  
      );  
    }  
  });  
}  
</code></pre>
<p>The function is analogous to a modular worker that lists available tools and validates inputs before starting tasks.  </p>
<pre><code class="language-typescript">async run() {  
  const transport = new StdioServerTransport();  
  await this.server.connect(transport);  
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);  
  const projectPath = process.cwd();  
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);  
  repoAnalyzer.preGenerate(projectPath);  
}  
</code></pre>
<p>This resembles setting the stage for an event, ensuring prerequisites (e.g., caching) are handled while waiting for transport activity.  </p>
<pre><code class="language-typescript">async function main() {  
  try {  
    const server = new RepoAdventureServer();  
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt;   
      process.on(sig as NodeJS.Signals, gracefulShutdown)  
    );  
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {  
      console.error(&#39;Unhandled promise rejection:&#39;, reason);  
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);  
    });  
    await server.run();  
  } catch (error) {  
    console.error(&#39;Fatal error starting MCP server:&#39;, error);  
    process.exit(1);  
  }  
}  
</code></pre>
<p>Think of this as a conductor ensuring a seamless launch while preparing for errors or controlled exits.  </p>
<h2>Helpful Hints</h2>
<ul>
<li>Pay special attention to schema validation within <code class="inline-code">setupHandlers</code> for understanding dynamic tool responses.  </li>
<li>Explore how <code class="inline-code">run</code> integrates caching and transport to optimize operational flow.  </li>
<li>Investigate the signal handlers in <code class="inline-code">main</code> for insights on graceful shutdown mechanisms.</li>
</ul>
<hr>
<p>Your exploration sparks potential solutions hidden within the MCP Interface. Unravel these secrets and don‚Äôt forget to check if your tools are ready for adventure!</p>
<p>Congratulations, developer! You&#39;ve successfully debugged the runtime complexities and refactored the MCP interface to its optimal state‚Äîstellar start to the codebase quest! ‚ö°üöÄüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>