<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Forge of MCP Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codebase Chronicles: An Ancient Repository</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Forge of MCP Tools</h1>
<hr>
<p>In the era of ancient archives, the Repository Adventure Engine beckoned forth a new quest: The Forge of MCP Tools. Developers gathered around the sacred repository, prepared to delve into two vital scripts that defined the backbone of interactive storytelling. These files, imbued with tools and handlers, bridged the world of gamified exploration with the pragmatic domain of code analysis. With the mighty <code class="inline-code">RepoAdventureServer</code> as their guide, adventurers set forth to unlock the mysteries of dynamic execution and modular tools.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Toolsmith&#39;s Puzzle</strong>: How does <code class="inline-code">RepoAdventureServer.setupHandlers</code> dynamically register tools and validate their inputs using schemas?</li>
<li>‚ö° <strong>Engine Rituals</strong>: What is the flow of initialization and connection in <code class="inline-code">RepoAdventureServer.run</code>, and how does it prepare the MCP server for engagement?</li>
<li>üõ°Ô∏è <strong>Shutdown Protocols</strong>: How does <code class="inline-code">main</code> ensure graceful shutdown and handle unexpected errors?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Initialization</h3>
<p>This file implements the main server responsible for operating the repository adventure system. It utilizes the SDK‚Äôs <code class="inline-code">Server</code> class and ties together dynamic tool management with a focus on validation, error handling, and lifecycle management. Through key methods like <code class="inline-code">setupHandlers</code> and <code class="inline-code">run</code>, it demonstrates robust initialization techniques, schema-based validation, and asynchronous workflows to support interactive developer journeys.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code>: Registers tools dynamically and validates inputs using Zod schemas. This method ensures tools are listed and executed securely.</li>
<li><code class="inline-code">RepoAdventureServer.run</code>: Prepares and launches the MCP server, warming up caches and setting up transport channels for requests.</li>
<li><code class="inline-code">main</code>: Handles server lifecycle, including error handling, graceful shutdown, and execution paths for a robust runtime.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Tool Integration Framework</h3>
<p>This file provides the main entry point for all MCP tools, such as starting adventures, choosing themes, and tracking quest progress. Its modular structure ensures maintainability and clear organization of tool functionality. By exporting these tools, it facilitates dynamic registration in the MCP server, enabling interactive exploration through defined handlers.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Initiates the adventure analysis process and presents theme options based on the repository.</li>
<li><code class="inline-code">choose_theme.handler</code>: Generates custom stories and quests following a selected theme, showcasing modular gamified content pipelines.</li>
<li><code class="inline-code">explore_quest.handler</code>: Navigates specific quests, dynamically interacting with repository data to progress through exploration.</li>
<li><code class="inline-code">view_progress.handler</code>: Provides an overview of completed and remaining tasks, ensuring developers stay informed on their journey.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }
      return await tool.handler(validationResult.data as any);
    } catch (error) {
      throw error instanceof McpError 
        ? error 
        : new McpError(ErrorCode.InternalError, `Execution failed: ${error}`);
    }
  });
}
</code></pre>
<ul>
<li>Validates tool inputs dynamically using Zod schemas, ensuring secure parameter handling.</li>
<li>Registers tool execution handlers, enabling modular tool functionalities.</li>
<li>Illustrates async workflows for dynamic tool execution with robust error responses.</li>
</ul>
<hr>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<ul>
<li>Sets up server transport using <code class="inline-code">StdioServerTransport</code> for bidirectional communication.</li>
<li>Warms up repository caches by pre-generating content, enhancing performance during exploration.</li>
<li>Demonstrates initialization flows for seamless server operation.</li>
</ul>
<hr>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<ul>
<li>Ensures graceful shutdown upon receiving signals, protecting resources.</li>
<li>Catches unhandled promise rejections for improved resilience during runtime.</li>
<li>Builds error logging mechanisms to assist in debugging and robust operations.</li>
</ul>
<hr>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<ul>
<li>Consolidates tool exports for centralized registration and management.</li>
<li>Demonstrates modular design principles for scalable codebase integration.</li>
<li>Simplifies reusability and organization of key gameplay functionalities.</li>
</ul>
<hr>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;
</code></pre>
<ul>
<li>Promotes adherence to MCP naming conventions for consistency across the toolset.</li>
<li>Provides seamless integration between the tools and the main server.</li>
<li>Highlights best practices for code organization and modular re-exports.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When reviewing <code class="inline-code">setupHandlers</code>, pay close attention to <code class="inline-code">zodToJsonSchema</code> usage for schema transformation.</li>
<li>Investigate how <code class="inline-code">run</code> sets up transport and cache pre-generation features, optimizing server performance.</li>
<li>Explore tool structure in <code class="inline-code">tools.ts</code> to understand modular exports and naming conventions.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Repository Adventure Engine.</p>
<p>Congratulations, Developer! üéâ Quest 1: The Forge of MCP Tools has been successfully compiled, reviewed, and deployed‚Äîyou&#39;re debugging the future with precision! üöÄüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>