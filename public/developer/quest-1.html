<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: HTML Generator & Static Site Pipeline - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Repository Exploration: Developer's Blueprint</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: HTML Generator &amp; Static Site Pipeline</h1>
<hr>
<p>Welcome to the first technical expedition! In this quest, you will dive into the architecture of the HTML Generator module and its ancillary components, exploring how the system translates structured code content into a rich, interactive static site experience. Your mission is to analyze real-world implementations and advanced design patterns, learning the essentials for creating modular and scalable site generation pipelines.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Renderer Blueprint</strong>: How does <code class="inline-code">TemplateEngine.renderPage</code> ensure modularity in combining templates with dynamic content?</li>
<li>‚ö° <strong>Optimized Generation</strong>: What roles do <code class="inline-code">HTMLAdventureGenerator.generateAdventure</code> and <code class="inline-code">HTMLAdventureGenerator.generateAllThemes</code> play in orchestrating the static site generation process?</li>
<li>üõ°Ô∏è <strong>Asset Handling</strong>: How do <code class="inline-code">AssetManager.copyGlobalAssets</code> and <code class="inline-code">AssetManager.copyQuestNavigator</code> manage centralized and theme-specific resources to prevent redundancy?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> Template Engine for Dynamic HTML Generation</h3>
<p>This file contains the <code class="inline-code">TemplateEngine</code> class, responsible for loading, caching, and rendering templates. It abstracts the mechanics of embedding dynamic content into a static HTML structure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadTemplate</code>: Efficiently loads and caches templates to reduce redundant file reads.</li>
<li><code class="inline-code">replacePlaceholders</code>: Replaces placeholders in templates with dynamic values, enabling customization for various data contexts.</li>
<li><code class="inline-code">renderPage</code>: Combines a base template and a content-specific template to generate complete HTML pages.</li>
</ul>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> Centralized Asset Manager</h3>
<p>This file defines the <code class="inline-code">AssetManager</code> class, which handles copying and organizing resources like images and shared files for single and multi-theme setups.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyImages</code>: Copies theme-specific and shared images, ensuring each theme has the necessary visual assets.</li>
<li><code class="inline-code">copyQuestNavigator</code>: Duplicates navigation assets for theme-specific directories, enabling consistent UI elements across themes.</li>
<li><code class="inline-code">copyGlobalAssets</code>: Manages shared global resources to minimize duplication and improve maintainability.</li>
</ul>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> Main Driver for HTML Site Generation</h3>
<p>This file introduces the <code class="inline-code">HTMLAdventureGenerator</code> class, a CLI tool for generating README-based adventure sites and managing various themes.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code>: Orchestrates the structured process of creating the static site, integrating assets, templates, and content.</li>
<li><code class="inline-code">generateAllThemes</code>: Enables multi-theme generation, ensuring parallel workflows to optimize site creation.</li>
<li><code class="inline-code">startHttpServer</code>: Implements a lightweight HTTP server to preview the static site after generation.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">private loadTemplate(templateName: string): string {
  if (this.templateCache.has(templateName)) {
    return this.templateCache.get(templateName)!;
  }

  const templatePath = path.join(this.templatesDir, templateName);
  
  try {
    const content = fs.readFileSync(templatePath, &#39;utf-8&#39;);
    this.templateCache.set(templateName, content);
    return content;
  } catch (error) {
    throw new Error(`Failed to load template ${templateName}: ${error}`);
  }
}
</code></pre>
<ul>
<li>Implements caching for performance optimization, avoiding redundant file reads.</li>
<li>Ensures templates are fetched from the correct directory using <code class="inline-code">path.join</code>.</li>
<li>Throws clear error messages for debugging failed template loads.</li>
</ul>
<hr>
<pre><code class="language-typescript">private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;
  
  for (const [key, value] of Object.entries(variables)) {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, &#39;g&#39;), value || &#39;&#39;);
  }
  
  return result;
}
</code></pre>
<ul>
<li>Replaces placeholders (e.g., <code class="inline-code">{{key}}</code>) with dynamic values using regular expressions.</li>
<li>Sanitizes input variables to avoid undefined values disrupting the template.</li>
<li>Supports repeated placeholder occurrences using a global regex.</li>
</ul>
<hr>
<pre><code class="language-typescript">renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  
  const pageVariables = {
    ...variables,
    CONTENT: renderedContent
  };
  
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>Combines base and content templates, ensuring separation of concerns and modular design.</li>
<li>Uses <code class="inline-code">replacePlaceholders</code> to integrate dynamic data into the templates.</li>
<li>Facilitates scalable page generation for complex multi-template sites.</li>
</ul>
<hr>
<h3>packages/generator/src/cli/asset-manager.ts</h3>
<pre><code class="language-typescript">copyGlobalAssets(outputDir: string): void {
  try {
    const globalAssetsDir = path.join(outputDir, &#39;assets&#39;);
    const targetImagesDir = path.join(globalAssetsDir, &#39;images&#39;);
    fs.mkdirSync(targetImagesDir, { recursive: true });

    const globalSharedDir = path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;);
    fs.mkdirSync(globalSharedDir, { recursive: true });
    
    const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
    globalImages.forEach(file =&gt; {
      const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
      if (fs.existsSync(sourcePath)) {
        const targetPath = path.join(globalSharedDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      }
    });

    const headerImageSource = path.join(this.sourceDir, &#39;assets&#39;, &#39;images&#39;, &#39;ai-adventures.png&#39;);
    if (fs.existsSync(headerImageSource)) {
      const headerImageTarget = path.join(targetImagesDir, &#39;ai-adventures.png&#39;);
      fs.copyFileSync(headerImageSource, headerImageTarget);
    }
  } catch (error) {
    console.log(chalk.yellow(&#39;‚ö†Ô∏è Warning: Could not copy global images&#39;));
  }
}
</code></pre>
<ul>
<li>Organizes shared assets (e.g., GitHub logos) into central directories for reuse.</li>
<li>Uses conditional checks to ensure files exist before copying, improving error resilience.</li>
<li>Creates necessary directories recursively to maintain folder structure integrity.</li>
</ul>
<hr>
<pre><code class="language-typescript">copyQuestNavigator(outputDir: string): void {
  const templatesDir = path.join(this.sourceDir, &#39;templates&#39;);
  const cssSource = path.join(templatesDir, &#39;quest-navigator.css&#39;);
  const jsSource = path.join(templatesDir, &#39;quest-navigator.js&#39;);
  const svgSource = path.join(templatesDir, &#39;compass-icon.svg&#39;);
  
  const assetsDir = path.join(outputDir, &#39;assets&#39;);
  fs.mkdirSync(assetsDir, { recursive: true });

  if (fs.existsSync(cssSource)) {
    fs.copyFileSync(cssSource, path.join(assetsDir, &#39;quest-navigator.css&#39;));
  }
  if (fs.existsSync(jsSource)) {
    fs.copyFileSync(jsSource, path.join(assetsDir, &#39;quest-navigator.js&#39;));
  }
  if (fs.existsSync(svgSource)) {
    fs.copyFileSync(svgSource, path.join(assetsDir, &#39;compass-icon.svg&#39;));
  }
}
</code></pre>
<ul>
<li>Ensures quest navigation assets (e.g., stylesheets, JavaScript, SVG) are available in the output directory.</li>
<li>Implements reusable logic to verify and replicate files across directories.</li>
<li>Aligns navigation asset placement with site-wide design consistency.</li>
</ul>
<hr>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">async generateAdventure(): Promise&lt;void&gt; {
  console.log(chalk.yellow.bold(&#39;üöÄ Generating Adventure...&#39;));

  // Load repository URL and initialize variables
  const projectInfo = createProjectInfo(await repoAnalyzer.generateRepomixContext(this.projectPath));
  const storyContent = await this.adventureManager.initializeAdventure(
    projectInfo, 
    this.selectedTheme, 
    this.projectPath,
    this.customThemeData
  );

  this.extractQuestInfo();
  const themeCss = this.loadThemeCSS(this.selectedTheme);
  
  fs.mkdirSync(this.outputDir, { recursive: true });
  this.generateThemeCSS();
  this.copyImages();
  this.generateIndexHTML();

  console.log(chalk.green.bold(&#39;üéâ Adventure website generated successfully!&#39;));
}
</code></pre>
<ul>
<li>Coordinates the entire site generation by invoking internal helpers like <code class="inline-code">generateIndexHTML</code> and <code class="inline-code">copyImages</code>.</li>
<li>Integrates repository analysis (<code class="inline-code">repoAnalyzer</code>) with theme-specific logic.</li>
<li>Abstracts reusable substeps (e.g., extracting quest info) for better modularity.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateAllThemes(args: Map&lt;string, string&gt;): Promise&lt;void&gt; {
  console.log(chalk.green(&#39;‚úÖ Generating all themes&#39;));
  this.isMultiTheme = true;

  const themes: AdventureTheme[] = [&#39;space&#39;, &#39;mythical&#39;, &#39;ancient&#39;, &#39;developer&#39;];
  const themePromises = themes.map(async (theme) =&gt; {
    const themeGenerator = new HTMLAdventureGenerator();
    themeGenerator[&#39;selectedTheme&#39;] = theme;
    themeGenerator[&#39;outputDir&#39;] = path.join(this.outputDir, theme);
    await themeGenerator.generateAdventure();  
  });
  await Promise.all(themePromises);
}
</code></pre>
<ul>
<li>Implements parallel processing to generate multiple themes concurrently.</li>
<li>Utilizes isolated generator instances to avoid state conflicts.</li>
<li>Adapts output directories dynamically for each theme configuration.</li>
</ul>
<hr>
<pre><code class="language-typescript">async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
  const server = http.createServer((req, res) =&gt; {
    let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);
    if (!filePath.startsWith(this.outputDir)) {
      res.writeHead(403);
      res.end(&#39;Forbidden&#39;);
      return;
    }
    fs.readFile(filePath, (err, content) =&gt; {
      if (err) {
        res.writeHead(err.code === &#39;ENOENT&#39; ? 404 : 500);
        res.end(err.code === &#39;ENOENT&#39; ? &#39;File not found&#39; : &#39;Server error&#39;);
      } else {
        res.writeHead(200);
        res.end(content, &#39;utf-8&#39;);
      }
    });
  });
  server.listen(port, () =&gt; {
    console.log(chalk.green(`üåê HTTP server started on http://localhost:${port}`));
  });
}
</code></pre>
<ul>
<li>Sets up an HTTP server for previewing the generated site.</li>
<li>Implements basic security checks and error handling for file access.</li>
<li>Demonstrates a lightweight, pure Node.js solution for serving static content.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Profile First Load</strong>: Explore <code class="inline-code">generateAdventure</code> to identify where caching and reduced I/O can speed up large theme builds.</li>
<li><strong>Add Edge Cases</strong>: Review <code class="inline-code">startHttpServer</code> for additional MIME types or folder-based access restrictions.</li>
<li><strong>Modularize Your Workflow</strong>: Break down large theme generation tasks for testing using <code class="inline-code">generateAllThemes</code>.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations, developer! üéâ You&#39;ve successfully deployed an automated static site pipeline with an HTML generator‚Äîan MVP-worthy milestone in your coding journey toward mastering the stack! üöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>