<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Nexus of Protocols â€“ Master the Adventure Command Center - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'developer' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Codex of the Infinite Adventures</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Nexus of Protocols â€“ Master the Adventure Command Center</h1>
<hr>
<p>The digital winds have called you to embark on your first challenge in the Codex&#39;s realm! Your task: to master the inner workings of the Adventure Command Center, a magical fusion of MCP protocol handlers and gamified storytelling tools. With the tools of <code class="inline-code">server.ts</code> and <code class="inline-code">tools.ts</code> at your disposal, you&#39;ll configure the protocols that bring epic code-expanding journeys to life. Get ready to dive into the mechanisms that stage quests and empower each adventurer in the coding realms. Let the exploration begin!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> Core MCP Server Implementation</h3>
<p>The <code class="inline-code">server.ts</code> file is the heart of the Adventure Command Center. It implements the MCP (Model Context Protocol) server and orchestrates its operations. This file sets up a <code class="inline-code">RepoAdventureServer</code> class, which is responsible for defining the server&#39;s behavior via handlers and connecting the transport layer for client communication. Tools like <code class="inline-code">ListToolsRequestSchema</code> and <code class="inline-code">CallToolRequestSchema</code> allow dynamic listing and execution of tools, forming the foundation of the MCP&#39;s interactive capabilities. </p>
<p>Specifically, the <code class="inline-code">setupHandlers()</code> method registers key server handlers, such as listing tools dynamically from the available <code class="inline-code">tools</code> object, and calling these tools with request parameters validated through Zod schemas. The <code class="inline-code">run()</code> method initializes the server using <code class="inline-code">StdioServerTransport</code> and pre-generates Repomix content to optimize future interactions. Furthermore, a graceful shutdown mechanism in <code class="inline-code">main()</code> ensures proper cleanup of resources and error handling in the case of unexpected interruptions.</p>
<h4>Highlights</h4>
<ul>
<li>Sets up dynamic MCP handlers for listing and executing tools (<code class="inline-code">setupHandlers</code>).</li>
<li>Connects the Adventure Command Center via <code class="inline-code">StdioServerTransport</code> (<code class="inline-code">run()</code>).</li>
<li>Graceful shutdown logic for signal interruptions handled in <code class="inline-code">main()</code>.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools for Codebase Exploration</h3>
<p>The <code class="inline-code">tools.ts</code> file acts as an index for MCP tools, defining interactive methods that allow users to start adventures, choose story themes, and explore quests. This file imports handlers like <code class="inline-code">startAdventure</code>, <code class="inline-code">chooseTheme</code>, and <code class="inline-code">exploreQuest</code> from submodules and re-exports them under a structured object called <code class="inline-code">tools</code>. These tools are the primary interface for end-users, offering interactive entry points to analyze repositories and progress through adventures.</p>
<p>Each tool addresses a specific stage in the adventure framework. For example, <code class="inline-code">start_adventure</code> analyzes the current codebase and prepares themes for exploration, while <code class="inline-code">choose_theme</code> customizes the narrative experience. <code class="inline-code">explore_quest</code> dives deep into individual exploration tasks, and <code class="inline-code">view_progress</code> reports the player&#39;s progress through their coding odyssey.</p>
<h4>Highlights</h4>
<ul>
<li>Consolidates all MCP tools into a single exported object for easy management.</li>
<li>Enables interactive storytelling workflows like <code class="inline-code">start_adventure</code> and <code class="inline-code">choose_theme</code>.</li>
<li>Provides progress tracking with the <code class="inline-code">view_progress</code> tool.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  private server: Server;

  constructor() {
    this.server = new Server(
      {
        name: &#39;repo-adventure&#39;,
        version: &#39;1.0.0&#39;,
        description: &#39;A gamified MCP server for exploring code repositories through interactive storytelling&#39;
      },
      {
        capabilities: {
          tools: {},
        },
      }
    );

    this.setupHandlers();
  }

  private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
  }

  async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
    
    const projectPath = process.cwd();
    console.error(`Pre-generating repomix content for project at ${projectPath}...`);
    repoAnalyzer.preGenerate(projectPath);
  }
}
</code></pre>
<p>Just like a bus driver ensures passengers board the correct route, <code class="inline-code">setupHandlers()</code> and <code class="inline-code">run()</code> ensure the MCP server gets requests on the right track.</p>
<hr>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This structure is like a menu at a themed restaurant, where each dish (<code class="inline-code">tool</code>) is prepared by importing unique recipe files.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Understanding <code class="inline-code">setupHandlers()</code> is essential for adding new MCP tools to the Adventure Command Center.</li>
<li>Explore the individual handlers in <code class="inline-code">tools/</code> to customize adventures or add new functionality.</li>
<li>Use the Codex to dive into <code class="inline-code">server.ts</code> and <code class="inline-code">tools.ts</code> enhancements for your quest-building goals.</li>
</ul>
<p>Congratulations on successfully deploying your first milestone in the Nexus of Protocolsâ€”your mastery of the Adventure Command Center is now committed to the main branch of your developer journey! ðŸš€âš¡ðŸ’Ž</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Forge of Stories â€“ Crafting... â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>