<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Forge of Tools and Paths - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Mystic Archives of RepoVentures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Forge of Tools and Paths</h1>
<hr>
<p>In this realm of digital exploration, you come upon a mysterious enclave known as the MCP server. It stands as both guardian and guide, housing tools designed to illuminate the paths through complex repositories. Your mission is to delve deep into the core of this server and its tools, unraveling their ingenious design and forging your connection to the interactive story elements they power. Here, in the forge of tools and paths, lies your gateway to boundless adventure.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> The Server&#39;s Foundation</h3>
<p>The <code class="inline-code">server.ts</code> file acts as the backbone of the <code class="inline-code">RepoAdventureServer</code>, providing an infrastructure for managing requests and interactions within the MCP ecosystem. This file establishes a gamified MCP server that not only handles client-server communication but also dynamically responds to tool invocation and configuration. Key highlighted functionality includes <code class="inline-code">setupHandlers</code> for binding dynamic request handling, the <code class="inline-code">run</code> method for initializing the server, and the centralized <code class="inline-code">main</code> function for orchestration. Each of these elements demonstrates careful thought in design and function.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers</code>: Configures request handling for tool listing and execution, dynamically adapting based on tool definitions.</li>
<li><code class="inline-code">run</code>: Initializes server transport, connects it, and warms up repository analysis utilities.</li>
<li><code class="inline-code">main</code>: Acts as the entry point, ensuring graceful startup and shutdown of the server.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The Repository Toolkit</h3>
<p>The <code class="inline-code">tools.ts</code> file serves as the entry point for including and consolidating all MCP tools. Organized for maintainability, it imports discrete tools like <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. By re-exporting these tools and providing shared components for integration, this file ensures flexibility and robust functionality. The focus is on enabling consistent tool registration and adherence to MCP naming conventions.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: The primary initialization point for repository analysis and adventure generation.</li>
<li><code class="inline-code">choose_theme.handler</code>: Provides thematic customization capability for adventures.</li>
<li><code class="inline-code">explore_quest.handler</code>: Enables users to traverse individual quest narratives.</li>
<li><code class="inline-code">view_progress.handler</code>: Monitors progression and uncompleted quest details.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>A blacksmith shaping tools dynamically, ensuring every request is polished and correct.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>The ignition of the forge, setting the machinery in motion to prepare for the wielder&#39;s arrival.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );

    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });

    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>The captain at the helm, ensuring the ship launches smoothly despite stormy seas.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
</code></pre>
<p>The spark that lights the initial path, pointing the adventurer toward their journeyâ€™s genesis.</p>
<pre><code class="language-typescript">export const choose_theme = chooseTheme;
</code></pre>
<p>The compass that aligns the adventurerâ€™s voyage with a bespoke thematic compass.</p>
<pre><code class="language-typescript">export const explore_quest = exploreQuest;
</code></pre>
<p>The guide enabling exploration of uncharted territories, one quest at a time.</p>
<pre><code class="language-typescript">export const view_progress = viewProgress;
</code></pre>
<p>The mapmaker, reflecting on traveled roads and the unnamed lands that still await.</p>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Practical tip</strong>: Structure your own toolchains with modularity in mind for flexibility and maintainability.</li>
<li><strong>Exploration recommendation</strong>: Dive deeper into <code class="inline-code">choose_theme</code> for insight into generating customized narratives.</li>
<li><strong>Next steps</strong>: Investigate <code class="inline-code">repoAnalyzer</code> utilities for insight into back-end preparations for tool execution.</li>
</ul>
<hr>
<p>The tools are ready, and the paths are set. Venture forth, knowing that each line of code mastered becomes another step in your great adventure.</p>
<p>ðŸŽ‰ Initialization of foundational tools and architecture successfully completeâ€”Quest 1 is now a solid build artifact; onward to the next deploy! ðŸš€ðŸ’Žâœ¨</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>