<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The MCP Tool Interface - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository Chronicles: The Developer's Guide to Modular Code Systems</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The MCP Tool Interface</h1>
<hr>
<p>In the modular pathways of the MCP system lies a foundational interface that orchestrates interactive tool management. The <code class="inline-code">RepoAdventureServer</code> module enables dynamic tool discovery and execution, while the <code class="inline-code">tools</code> module defines functionality for immersive code exploration. Together, they establish a robust entry point for integrating gamified repository adventures. These components ensure reliability, extensibility, and efficient interaction between the server and its tools. As an aspiring architect of interactive workflows, your challenge is to delve into these interconnected structures and uncover their operational patterns.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Tool Registration Protocol</strong>: How does the <code class="inline-code">setupHandlers</code> method dynamically list and execute the tools?</li>
<li>‚ö° <strong>Server Execution Flow</strong>: What are the key steps in the <code class="inline-code">run</code> method for initializing and running the server?</li>
<li>üõ°Ô∏è <strong>Tool Modularity Analysis</strong>: How are the tools structured in <code class="inline-code">tools.ts</code> and what ensures their flexibility for reuse?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> Core Server Operations</h3>
<p>The <code class="inline-code">server.ts</code> file serves as the backbone of the MCP Tool Interface by creating and configuring the <code class="inline-code">RepoAdventureServer</code>. This class initializes the MCP server with capabilities like dynamic tool discovery and tool execution while gracefully handling errors.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers</code>: This method sets up request handlers for listing and executing tools. It dynamically adapts to available tools and seamlessly validates inputs using schemas.</li>
<li><code class="inline-code">run</code>: This method starts the server, connects it to the transport layer, and initiates the background generation of repository content, ensuring readiness for interaction.</li>
<li><code class="inline-code">main</code>: The entry point of the program, it initializes the server, manages signal handling for graceful shutdowns, and logs critical errors during server startup.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Tool Definitions and Structure</h3>
<p>The <code class="inline-code">tools.ts</code> file consolidates all MCP tools and makes them available for the server. Each tool is modularized for maintainability and is equipped with specialized functionality for interactive tasks.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Initiates a repository analysis and prepares themed exploration paths.</li>
<li><code class="inline-code">choose_theme.handler</code>: Enables users to select a story theme, dynamically generating quests based on their choice.</li>
<li><code class="inline-code">explore_quest.handler</code>: Processes individual quests, advancing the user‚Äôs exploration journey.</li>
<li><code class="inline-code">view_progress.handler</code>: Summarizes the user&#39;s progress and shows remaining objectives.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;
      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }
      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }
      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<ul>
<li>Dynamically adapts to the registered tools, retrieving metadata such as descriptions and input schemas. </li>
<li>Uses <code class="inline-code">zodToJsonSchema</code> for schema validation and conversion.</li>
<li>Handles errors gracefully, differentiating between known issues and internal failures.</li>
</ul>
<hr>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<ul>
<li>Initializes the <code class="inline-code">StdioServerTransport</code> to facilitate server communications.</li>
<li>Boots the MCP server and initiates background content generation, improving performance during subsequent commands.</li>
<li>Promotes scalability by separating user interaction from resource-intensive preparation tasks.</li>
</ul>
<hr>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<ul>
<li>Serves as the program entry point, encapsulating server initialization and error handling.</li>
<li>Implements signal handling for a clean shutdown in response to termination signals.</li>
<li>Provides fallback error management for unexpected promise rejections.</li>
</ul>
<hr>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<ul>
<li>Aggregates all tool handlers into a single export for seamless integration.</li>
<li>Modularizes tool definitions, decoupling individual functionalities like quest generation and progress tracking.</li>
<li>Facilitates extensibility, enabling future tool additions with minimal code impact.</li>
</ul>
<hr>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
export const start_adventure = startAdventure;
</code></pre>
<ul>
<li>Bridges external modules into the MCP toolset for simplified import and usage.</li>
<li>Adheres to clean code standards with cohesive and descriptive file organization.</li>
<li>Promotes reusability and maintainability by isolating tool-specific logic.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ†Ô∏è Explore <code class="inline-code">setupHandlers</code> carefully for an understanding of how dynamic tool execution is enabled.</li>
<li>üöÄ Focus on the <code class="inline-code">run</code> method to see how server initialization is approached with scalability in mind.</li>
<li>üîç Study the modular structure of <code class="inline-code">tools.ts</code> to see how maintainability and extensibility are prioritized.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission accomplished: Quest 1 is now fully deployed with zero error logs‚Äîyour MCP Tool Interface skills are initialized and running at ‚ö° 100% efficiency; onward to the next milestone, dev hero!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>