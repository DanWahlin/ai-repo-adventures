<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Keeper of Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codebound Chronicles</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Keeper of Tools</h1>
<hr>
<p>The air hums softly as you step into the digital expanse of the Repomix archive; the gateway to infinite developer challenges and knowledge. Before you lies the path of enlightenment through the mastery of tools. Your first mission: unravel the Repository Adventure Server&#39;s mystical grip on the MCP Tool Interface. To succeed, you must decode the lifeblood of handlers and their interconnected mechanisms. Wield your skill wisely, for this quest&#39;s wisdom ensures safe passage to untold adventures.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> Repository Adventure Server Setup and Execution</h3>
<p>This file houses the core server logic responsible for connecting and managing interactive tool-based adventures. Its magic lies in its ability to dynamically register tools and orchestrate safe execution using schemas. Three features stand out:</p>
<ul>
<li>The <code class="inline-code">setupHandlers</code> method turns user requests into actionable tool invocations, maintaining integrity via schema validation.</li>
<li>The <code class="inline-code">run</code> method initializes the server, enabling seamless communication through <code class="inline-code">StdioServerTransport</code> while pre-generating required content.</li>
<li>The <code class="inline-code">main</code> function acts as the entryway into this world, ensuring error resilience and graceful shutdown.</li>
</ul>
<p>Users exploring this file will discover patterns of schema-based validation, dynamic tool registration, and asynchronous server lifecycle management.</p>
<h4>Highlights</h4>
<ul>
<li>Implements dynamic request handlers via <code class="inline-code">setupHandlers</code>.</li>
<li>Starts communication with clients in <code class="inline-code">run</code>.</li>
<li>Handles critical startup and shutdown procedures in <code class="inline-code">main</code>.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">  private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          throw new McpError(ErrorCode.InvalidParams, `${validationResult.error.issues.map(err =&gt; `${err.path.join(&#39;.&#39;)} - ${err.message}`).join(&#39;, &#39;)}`);
        }

        return await tool.handler(validationResult.data as any);
      } catch (error) {
        // Error handling
        throw new McpError(ErrorCode.InternalError, `Execution failed: ${error}`);
      }
    });
  }
</code></pre>
<p>The <code class="inline-code">setupHandlers</code> function is the keystone for dynamic tool coordination and schema enforcement.</p>
<pre><code class="language-typescript">  async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error(&#39;Running on stdio&#39;);
    
    const projectPath = process.cwd();
    console.error(`Pre-generating content for ${projectPath}`);
    repoAnalyzer.preGenerate(projectPath);
  }
</code></pre>
<p>Here, the <code class="inline-code">run</code> method establishes the server via <code class="inline-code">StdioServerTransport</code> and warms up the repomix cache.</p>
<pre><code class="language-typescript">  async function main() {
    try {
      const server = new RepoAdventureServer();
      [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; process.on(sig, gracefulShutdown));
      process.on(&#39;unhandledRejection&#39;, reason =&gt; console.error(&#39;Unhandled Error:&#39;, reason));
      await server.run();
    } catch (e) {
      console.error(&#39;Fatal error:&#39;, e);
      process.exit(1);
    }
  }
</code></pre>
<p>The <code class="inline-code">main</code> function provides a fail-safe gateway to precision handling of unforeseen issues.</p>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Tool Management and Registration</h3>
<p>This file is a powerhouse repository for all MCP tools, including their logic, schema, and integration points. It enables developers to tap into various interactive adventures, seamlessly connecting themes and tools. The tools are modular by design and contain steps that align with adventure workflows:</p>
<ol>
<li><code class="inline-code">start_adventure</code> - Analyze and begin repository exploration.</li>
<li><code class="inline-code">choose_theme</code> - Personalize the game&#39;s storyline based on developer interest.</li>
<li><code class="inline-code">explore_quest</code> - Execute specific challenges, one step at a time.</li>
<li><code class="inline-code">view_progress</code> - Track ongoing progress toward adventure completion.</li>
</ol>
<p>This file structures tools for reusability via clean exports, ensuring maintainability.</p>
<h4>Highlights</h4>
<ul>
<li>Outlines four essential tools: start_adventure, choose_theme, explore_quest, view_progress.</li>
<li>Adheres to high cohesion by leveraging organization-based imports/exports.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { adventureManager } from &#39;@ai-repo-adventures/core/adventure&#39;;
import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

// Export tools with MCP naming convention
export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This snippet demonstrates modular organization and tool readiness for server integration.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">setupHandlers</code> as a blueprint for schema-driven API handler registration.</li>
<li>Investigate how tools interface directly with <code class="inline-code">adventureManager</code> to fine-tune workflows.</li>
<li>Experiment with mock tools to extend server functionality before full deployment.</li>
</ul>
<hr>
<p>Success! You have unlocked a deep understanding of the MCP Tool Interface. Armed with this knowledge, configure your tools to tackle the chaos ahead. Adventure beckons, brave technomancer! Continue unearthing the mysteries of Repomix.</p>
<p>Quest 1: The Keeper of Tools has been successfully deployed, initializing new knowledge modules‚Äîstellar work advancing your developer framework ‚≠êüöÄ‚ö°!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>