<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The MCP Interface Nexus - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Intelligent Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The MCP Interface Nexus</h1>
<hr>
<p>In the realm of digital repositories, the MCP Interface Nexus serves as the bridge between adventurers and their quests. With its ability to dynamically adapt tools and manage operations, the Nexus transforms chaotic codebases into adventures worth exploring. Your mission today, adventurer, is to investigate the systems powering this interface and the tools it deploys, uncovering the mysteries behind its seamless orchestration.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Tool Registration Dynamics</strong>: How does the <code class="inline-code">setupHandlers</code> function dynamically handle tool listing and execution within a structured schema?</li>
<li>‚ö° <strong>Server Initialization</strong>: What processes occur during the <code class="inline-code">run</code> function to prepare the MCP server for operation?</li>
<li>üõ°Ô∏è <strong>Error Handling in Tools</strong>: How does the MCP server ensure robust validation and prevent tool-related errors during execution?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> Server Setup and Execution</h3>
<p>This file houses the definition of <code class="inline-code">RepoAdventureServer</code>, the core that interacts with client requests and manages tools dynamically. Key functionalities include <code class="inline-code">setupHandlers</code>, which registers tool-related handlers, and <code class="inline-code">run</code>, which initializes the server. The <code class="inline-code">main</code> function manages the lifecycle of the server, ensuring graceful shutdowns and handling unforeseen errors.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code>: Registers tool listing and execution handlers with error validation.</li>
<li><code class="inline-code">RepoAdventureServer.run</code>: Initiates server transport, pre-generates content, and starts the MCP interface.</li>
<li><code class="inline-code">main</code>: Coordinates server lifecycle, signal handling for graceful shutdowns, and error logging.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;
      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }
      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }
      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>Dynamic handlers are like a well-organized marketplace where each stall (tool) meets strict standards of validation and operation.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>Initializations in <code class="inline-code">run</code> function set the stage like turning lights on before the grand show begins.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>The <code class="inline-code">main</code> function serves as the control tower, ensuring safe takeoff and landing for the new MCP experience.</p>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Tool Definitions and Registry</h3>
<p>This file organizes individual tools such as <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. Each tool has a distinct function and ergonomic interface for MCP server clients.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Analyzes the codebase to lay the foundation for further thematic exploration.</li>
<li><code class="inline-code">choose_theme.handler</code>: Enables adventurers to select an adventure that aligns with a preferred repository story.</li>
<li><code class="inline-code">explore_quest.handler</code>: Drives the exploration of individual quests derived from the chosen theme.</li>
<li><code class="inline-code">view_progress.handler</code>: Calculates completion status and progress tracking for quests within the adventure.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>Like a treasure map, this export organizes tools for easy discovery and execution by the MCP server.</p>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;

export const start_adventure = startAdventure;
</code></pre>
<p>The <code class="inline-code">start_adventure.handler</code> begins the journey, initializing the adventure manager like briefing a team before a mission.</p>
<pre><code class="language-typescript">import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;

export const choose_theme = chooseTheme;
</code></pre>
<p>The <code class="inline-code">choose_theme.handler</code> acts as a gateway, allowing adventurers to pick their path based on repository content.</p>
<pre><code class="language-typescript">import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;

export const explore_quest = exploreQuest;
</code></pre>
<p>With <code class="inline-code">explore_quest.handler</code>, adventurers delve into the intricacies of digital landscapes, extracting insights.</p>
<pre><code class="language-typescript">import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export const view_progress = viewProgress;
</code></pre>
<p>The <code class="inline-code">view_progress.handler</code> ensures adventurers remain informed about their achievements and upcoming challenges.</p>
<h2>Helpful Hints</h2>
<ul>
<li>To track server states, use debug logs in <code class="inline-code">run</code> function for live insights.</li>
<li>Explore <code class="inline-code">tools</code> definitions to understand individual tool workflows and dependencies.</li>
<li>Follow structured schema validation patterns in <code class="inline-code">setupHandlers</code> to implement new tools easily.</li>
</ul>
<hr>
<p>The Repository Nexus awakens, ready to connect adventurers! Dive deeper into the mysteries as the path unfolds.</p>
<p>Congratulations on successfully debugging the MCP Interface Nexus, initializing the path to mastery‚Äîyour codebase is one step closer to production-level brilliance! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>