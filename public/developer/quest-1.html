<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The MCP Nexus â€“ Commanding the Repositoryâ€™s Interface - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'developer' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Codex Chronicles: Guardians of the Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The MCP Nexus â€“ Commanding the Repositoryâ€™s Interface</h1>
<hr>
<p>The Repository whispers once more, its vast vaults crackling with the electric hum of interconnected secrets. As a Guardian, your path is clear: to master the MCP Nexusâ€”the bridge between the mortal realm of developers and the living code within. With its protocol, the Repositoryâ€™s intricacies unfold into interactive quests, their power constrained only by the clarity of the codeâ€™s intent. But beware: even a single misstep in the MCPâ€™s command could ripple through the Repository, disrupting the delicate dance of exploration.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>The file <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> serves as the beating heart of the MCP system. It implements the foundational MCP (Model Context Protocol) server, providing the command-line infrastructure that connects users to the gamified adventure tools. The class <code class="inline-code">RepoAdventureServer</code> orchestrates this process, acting as the maestro for managing the protocol handlers and the <code class="inline-code">stdio</code> transport interface, allowing users to interact seamlessly. Notable functions include <code class="inline-code">setupHandlers()</code>, which registers dynamic handlers for tool listing and execution, and <code class="inline-code">run()</code>, where the server establishes its connection while warming up the repository analysis cache in the background. This thoughtful design ensures that the environment is ready-to-go before the adventure begins, making onboarding smooth and efficient.</p>
<p>Built-in safeguards demonstrate meticulous engineering: <code class="inline-code">main()</code> ensures graceful handling of shutdown signals like <code class="inline-code">SIGINT</code> and <code class="inline-code">SIGTERM</code>, while also managing unhandled promise rejections without compromising runtime integrity. The file encapsulates the complexities of LLM-backed tooling into a streamlined developer experience, making it central to managing the Repositoryâ€™s instruction set.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers()</code> dynamically registers protocol handlers for tool listing and execution commands.</li>
<li><code class="inline-code">run()</code> establishes server transport and preloads <code class="inline-code">repomix</code> data for optimized performance.</li>
<li>Graceful shutdown and error recovery mechanisms protect the server runtime.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Gamified MCP Tool Interface</h3>
<p>The file <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> houses the core interactive tools that bridge the userâ€™s imagination with the Repositoryâ€™s reality. Each tool is dedicated to a specific step in the gamified adventure process: <code class="inline-code">start_adventure</code> analyzes the repository and offers creative theme options, <code class="inline-code">choose_theme</code> personalizes the narrative, <code class="inline-code">explore_quest</code> dives into specific tasks, and <code class="inline-code">view_progress</code> tracks completion. The tools leverage the shared <code class="inline-code">adventureManager</code> utility to orchestrate story generation, state preservation, and quest progression.</p>
<p>By exporting all tools in a unified object, developers benefit from clean, maintainable code structures. The thoughtful MCP naming conventionsâ€”like <code class="inline-code">view_progress</code> aligning with its functionâ€”ensures that even external integrations remain intuitive. This modular design allows tool updates without disruption, making it a cornerstone of user interaction with the adventure system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure</code> parses codebases and serves as the opening gateway to themed exploration.</li>
<li>Tools are modular and collectively exported via <code class="inline-code">tools</code> for streamlined registration.</li>
<li>Naming conventions align with purpose, ensuring clarity for MCP clients.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      // Execute the tool handler with validated arguments
      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>This code section is like setting up a guest list for an exclusive event to ensure only the vetted and prepared can join the party.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">// Export all tools for easy registration
export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This is like placing tools neatly into a toolbox, ensuring each is ready whenever you need it for a specific task.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Breaking down protocols like <code class="inline-code">setupHandlers()</code> can help design reusable interfaces for dynamic command handling.</li>
<li>Consider exploring the <code class="inline-code">adventureManager</code> utility in depth to understand its role in bridging tools with story generation.</li>
<li>Next, dive into the configuration files to learn how themes and quests are defined and validated.</li>
</ul>
<p>Congratulations on successfully committing Quest 1 to your developer log; you&#39;ve debugged the MCP Nexus and mastered the syntax for commanding the repositoryâ€™s interface â€“ deploy ðŸš€ confidently towards the remaining quests with your skills now upgraded to MVP status!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Quest Architect â€“ Forging A... â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>