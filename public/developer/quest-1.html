<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: HTML Generator & Static Site Pipeline - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Developer's Blueprint: Mastering Codebase Architecture</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: HTML Generator &amp; Static Site Pipeline</h1>
<hr>
<p>An essential infrastructure for converting developer narratives into engaging web experiences, this quest dives into the HTML Generator &amp; Static Site Pipeline. You&#39;ll traverse through the mechanics of generating HTML pages, managing assets, and constructing templates that form the foundation for developer-centric storytelling. By exploring this pipeline, you will understand how the system modularly creates frameworks for scalable and cohesive web-based adventures.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pipeline Integration</strong>: How does the <code class="inline-code">HTMLAdventureGenerator</code> orchestrate template rendering, asset management, and quest generation to produce a complete static site?</li>
<li>‚ö° <strong>Dynamic Rendering</strong>: What strategies does the <code class="inline-code">TemplateEngine</code> employ to dynamically replace placeholders and compose complex HTML structures?</li>
<li>üõ°Ô∏è <strong>Asset Management Reliability</strong>: How does the <code class="inline-code">AssetManager</code> ensure that assets are copied efficiently and handle potential errors during the process?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> HTML generation and pipeline management</h3>
<p>The <code class="inline-code">HTMLAdventureGenerator</code> is the core class for managing the static site generation process. It orchestrates template rendering, asset copying, and the creation of pages for each quest and theme. This file highlights how modular and scalable design is used to handle content production pipelines.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code>: Coordinates the complete static site generation process, including quest page creation and theme-based customization.</li>
<li><code class="inline-code">startHttpServer</code>: Launches a local server to preview the generated static site, ensuring quick iterations and testing.</li>
<li><code class="inline-code">buildQuestHTML</code>: Handles the individual rendering of quest pages using reusable templates and placeholders.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">async generateAdventure(): Promise&lt;void&gt; {
    console.log(chalk.yellow.bold(&#39;üöÄ Generating Adventure...&#39;));
    console.log();

    // Load repository URL from adventure.config.json
    const config = parseAdventureConfig(this.projectPath);
    if (config &amp;&amp; typeof config === &#39;object&#39; &amp;&amp; &#39;adventure&#39; in config) {
      const adventure = (config as any).adventure;
      if (adventure &amp;&amp; typeof adventure.url === &#39;string&#39;) {
        this.repoUrl = adventure.url.replace(/\/$/, &#39;&#39;); // Remove trailing slash
      }
    }

    // Step 1: Generate project analysis
    console.log(chalk.dim(&#39;üìä Analyzing codebase...&#39;));
    const repomixContent = await repoAnalyzer.generateRepomixContext(this.projectPath);
    const projectInfo = createProjectInfo(repomixContent);

    // Step 2: Initialize adventure
    console.log(chalk.dim(&#39;‚ú® Generating themed story and quests...&#39;));
    const storyContent = await this.adventureManager.initializeAdventure(
      projectInfo, 
      this.selectedTheme, 
      this.projectPath,
      this.customThemeData
    );

    // Save story content if logging is enabled
    this.saveLlmOutput(&#39;story.output.md&#39;, storyContent);

    // Step 3: Extract quest information
    this.extractQuestInfo();

    // Step 3.5: Trim quests array if max-quests is specified (before homepage generation)
    const questsToGenerate = this.maxQuests !== undefined ? Math.min(this.maxQuests, this.quests.length) : this.quests.length;
    if (questsToGenerate &lt; this.quests.length) {
      this.quests = this.quests.slice(0, questsToGenerate);
    }

    // Step 4: Generate all files
    console.log(chalk.dim(&#39;üé® Creating theme styling...&#39;));
    this.generateThemeCSS();

    console.log(chalk.dim(&#39;üß≠ Adding quest navigator...&#39;));
    if (!this.isMultiTheme) {
      this.copyQuestNavigator();
    }

    console.log(chalk.dim(&#39;üñºÔ∏è Copying images...&#39;));
    this.copyImages();

    console.log(chalk.dim(&#39;üìù Creating main adventure page...&#39;));
    this.generateIndexHTML();

    console.log(chalk.dim(&#39;üìñ Generating quest pages...&#39;));
    await this.generateQuestPages();

    console.log(chalk.dim(&#39;üéâ Creating adventure summary page...&#39;));
    await this.generateSummaryHTML();
  }
</code></pre>
<ul>
<li>Shows how the pipeline is orchestrated, integrating analysis, template rendering, quest creation, and asset generation.</li>
<li>Highlights the modular structure enabling extensible and reusable components.</li>
<li>Emphasizes attention to error handling and trimming based on <code class="inline-code">maxQuests</code>, ensuring scalability.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
    return new Promise((resolve, reject) =&gt; {
        const server = http.createServer((req, res) =&gt; {
            let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);
            
            // Security check - ensure we stay within the directory
            if (!filePath.startsWith(this.outputDir)) {
                res.writeHead(403);
                res.end(&#39;Forbidden&#39;);
                return;
            }

            // Set content type based on file extension
            const extname = path.extname(filePath);
            let contentType = &#39;text/html&#39;;
            switch (extname) {
                case &#39;.js&#39;:
                    contentType = &#39;text/javascript&#39;;
                    break;
                case &#39;.css&#39;:
                    contentType = &#39;text/css&#39;;
                    break;
                case &#39;.json&#39;:
                    contentType = &#39;application/json&#39;;
                    break;
                case &#39;.png&#39;:
                    contentType = &#39;image/png&#39;;
                    break;
                case &#39;.jpg&#39;:
                    contentType = &#39;image/jpg&#39;;
                    break;
                case &#39;.svg&#39;:
                    contentType = &#39;image/svg+xml&#39;;
                    break;
            }

            fs.readFile(filePath, (err, content) =&gt; {
                if (err) {
                    if (err.code === &#39;ENOENT&#39;) {
                        res.writeHead(404);
                        res.end(&#39;File not found&#39;);
                    } else {
                        res.writeHead(500);
                        res.end(&#39;Server error&#39;);
                    }
                } else {
                    res.writeHead(200, { &#39;Content-Type&#39;: contentType });
                    res.end(content, &#39;utf-8&#39;);
                }
            });
        });

        server.listen(port, () =&gt; {
            const url = `http://localhost:${port}`;
            console.log(chalk.green(`üåê HTTP server started on ${url}`));
            
            // Open browser after a brief delay
            setTimeout(() =&gt; this.openBrowser(url), 1000);
            
            resolve();
        });

        server.on(&#39;error&#39;, (err) =&gt; reject(err));
    });
}
</code></pre>
<ul>
<li>Implements a quick HTTP server for real-time previews of the static site.</li>
<li>Enforces security by ensuring requests stay within the target directory.</li>
<li>Illustrates clean code by mapping MIME types and handling file I/O control gracefully.</li>
</ul>
<hr>
<pre><code class="language-typescript">private buildQuestHTML(quest: QuestInfo, content: string, questIndex: number): string {
  const prevQuest = questIndex &gt; 0 ? this.quests[questIndex - 1] : null;
  const nextQuest = questIndex &lt; this.quests.length - 1 ? this.quests[questIndex + 1] : null;

  let bottomNavigation = &#39;&#39;;
  const isLastQuest = questIndex === this.quests.length - 1;

  bottomNavigation = `
  &lt;div class=&quot;quest-navigation&quot;&gt;
    ${prevQuest ? `&lt;a href=&quot;${prevQuest.filename}&quot; class=&quot;prev-quest&quot;&gt;Previous&lt;/a&gt;` : &#39;&#39;}
    ${nextQuest ? `&lt;a href=&quot;${nextQuest.filename}&quot; class=&quot;next-quest&quot;&gt;Next&lt;/a&gt;` : &#39;&#39;}
  &lt;/div&gt;
`;

  const variables = {
    PAGE_TITLE: quest.title,
    QUEST_CONTENT: content,
    QUEST_NAVIGATION: bottomNavigation
  };

  return this.templateEngine.renderPage(&#39;quest-template.html&#39;, variables);
}
</code></pre>
<ul>
<li>Prominently displays how quest-based HTML content is dynamically generated based on templates.</li>
<li>Integrates easy navigation between quests using a bottom navigation component.</li>
<li>Highlights the reusable, modular, and templated rendering approach.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Always trace variable flow between rendering methods and template variables to understand content customization.</li>
<li>To experiment further, modify a template file and observe the changes in rendered output without altering the core logic.</li>
<li>Check the error handling in asset management to explore contingencies during HTML or asset copying.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations on achieving your first milestone‚ÄîQuest 1 complete! You&#39;ve successfully architected an HTML generator and implemented your static site pipeline like a true developer champion; codebase evolution is üöÄ underway and the journey is now live on the production path!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>