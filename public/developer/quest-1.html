<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: HTML Generator & Static Site Pipeline - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository Atlas: A Guided Exploration of the Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: HTML Generator &amp; Static Site Pipeline</h1>
<hr>
<p>This journey begins with exploring the systems that transform repository content into interactive HTML-based adventure websites. At the heart of this operation are modular tools that streamline template rendering, asset management, and full-site HTML generation. By understanding the core logic behind these systems, you unlock a deeper appreciation for how developer-oriented pipelines can power dynamic static site creation.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Rendering Insights</strong>: How does the <code class="inline-code">TemplateEngine</code> render pages by combining base and content templates with dynamic variables?</li>
<li>‚ö° <strong>Asset Organization</strong>: What strategies does the <code class="inline-code">AssetManager</code> use to copy and structure assets such as images and shared files for multi-theme and single-theme support?</li>
<li>üõ°Ô∏è <strong>Pipeline Resilience</strong>: How is the <code class="inline-code">HTMLAdventureGenerator</code> designed to prevent errors during theme initialization, file generation, and HTTP server setup?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/template-engine.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/generator/src/cli/template-engine.ts</code></a>: Template Rendering Engine</h3>
<p>The <code class="inline-code">TemplateEngine</code> class facilitates HTML generation by loading templates, replacing placeholders with dynamic values, and rendering entire pages. It uses a template caching mechanism to improve performance during repeated operations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">renderPage</code>: Combines base and content templates into a fully rendered HTML page with support for additional variables.</li>
<li><code class="inline-code">replacePlaceholders</code>: Performs placeholder substitutions using dynamic keys and values within templates.</li>
<li><code class="inline-code">loadTemplate</code>: Efficiently loads and caches templates from the filesystem to minimize redundant operations.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/asset-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/generator/src/cli/asset-manager.ts</code></a>: Managing Static Assets</h3>
<p>The <code class="inline-code">AssetManager</code> class ensures that static dependencies‚Äîlike images, CSS files, and shared assets‚Äîare copied and organized correctly during site generation for both single-theme and multi-theme setups.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyGlobalAssets</code>: Organizes and structures shared images, including GitHub logos and header graphics, ensuring accessibility across multiple themes.</li>
<li><code class="inline-code">copyQuestNavigator</code>: Copies essential quest-navigation files (e.g., CSS, JavaScript) to theme-specific directories for standalone usage.</li>
<li><code class="inline-code">copyImages</code>: Handles both single- and multi-theme image copying, ensuring consistent organization in the generated output directory.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/html-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/generator/src/cli/html-generator.ts</code></a>: Master HTML Generation Pipeline</h3>
<p>The <code class="inline-code">HTMLAdventureGenerator</code> orchestrates the overall pipeline, from initializing themes to creating pages and launching optional HTTP servers. It handles user input, theme configuration, and file generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code>: The main orchestration function that coordinates theme selection, repository analysis, and file generation.</li>
<li><code class="inline-code">generateAllThemes</code>: Supports multi-theme generation by creating separate directories and combining shared assets for efficient output.</li>
<li><code class="inline-code">startHttpServer</code>: Sets up a lightweight HTTP server for verifying or previewing the generated static site locally.</li>
<li><code class="inline-code">buildQuestHTML</code>: Dynamically generates themed content for individual quests, incorporating navigational elements for site-wide usability.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/template-engine.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/generator/src/cli/template-engine.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Render a complete page using base template + content template
 */
renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  
  // First render the content template
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  
  // Then render the base template with the content
  const pageVariables = {
    ...variables,
    CONTENT: renderedContent
  };
  
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>Combines the base template with a content-specific template to produce complete HTML pages.</li>
<li>Reuses shared <code class="inline-code">replacePlaceholders</code> logic to dynamically substitute variables.</li>
<li>Handles nested template rendering (content within a base layout) for flexibility across themes.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Replace placeholders in template with variables
 */
private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;
  
  for (const [key, value] of Object.entries(variables)) {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, &#39;g&#39;), value || &#39;&#39;);
  }

  return result;
}
</code></pre>
<ul>
<li>Leverages regular expressions to find and dynamically replace placeholders (<code class="inline-code">{{key}}</code>) within templates.</li>
<li>Supports multiple replacements of the same key within a template.</li>
<li>Ensures missing or undefined variables are safely replaced with empty values to avoid runtime errors.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/asset-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/generator/src/cli/asset-manager.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Copy global shared assets for multi-theme generation
 */
copyGlobalAssets(outputDir: string): void {
  try {
    const globalAssetsDir = path.join(outputDir, &#39;assets&#39;);
    const targetImagesDir = path.join(globalAssetsDir, &#39;images&#39;);
    fs.mkdirSync(targetImagesDir, { recursive: true });

    // Copy global shared images to shared directory  
    const globalSharedDir = path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;);
    fs.mkdirSync(globalSharedDir, { recursive: true });
    
    const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
    globalImages.forEach(file =&gt; {
      const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
      if (fs.existsSync(sourcePath)) {
        const targetPath = path.join(globalSharedDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      }
    });

    // Copy header image for theme selection page
    const headerImageSource = path.join(this.sourceDir, &#39;assets&#39;, &#39;images&#39;, &#39;ai-adventures.png&#39;);
    if (fs.existsSync(headerImageSource)) {
      const headerImageTarget = path.join(targetImagesDir, &#39;ai-adventures.png&#39;);
      fs.copyFileSync(headerImageSource, headerImageTarget);
    }
  } catch (error) {
    console.log(chalk.yellow(&#39;‚ö†Ô∏è Warning: Could not copy global images&#39;));
  }
}
</code></pre>
<ul>
<li>Creates shared directories for assets reused by multiple themes, such as global icons.</li>
<li>Uses error handling to ensure the pipeline continues even if some files are missing.</li>
<li>Organizes fixed assets like logos and hero images into standard directories for user accessibility.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Copy quest navigator files to theme-specific location (for single theme)
 */
copyQuestNavigator(outputDir: string): void {
  const templatesDir = path.join(this.sourceDir, &#39;templates&#39;);
  const cssSource = path.join(templatesDir, &#39;quest-navigator.css&#39;);
  const jsSource = path.join(templatesDir, &#39;quest-navigator.js&#39;);
  const svgSource = path.join(templatesDir, &#39;compass-icon.svg&#39;);

  const assetsDir = path.join(outputDir, &#39;assets&#39;);
  fs.mkdirSync(assetsDir, { recursive: true });

  // Copy CSS file
  if (fs.existsSync(cssSource)) {
    fs.copyFileSync(cssSource, path.join(assetsDir, &#39;quest-navigator.css&#39;));
  }

  // Copy JS file  
  if (fs.existsSync(jsSource)) {
    fs.copyFileSync(jsSource, path.join(assetsDir, &#39;quest-navigator.js&#39;));
  }

  // Copy SVG icon
  if (fs.existsSync(svgSource)) {
    fs.copyFileSync(svgSource, path.join(assetsDir, &#39;compass-icon.svg&#39;));
  }
}
</code></pre>
<ul>
<li>Ensures theme-specific navigational assets (CSS, JS, SVG) are copied to the correct output location.</li>
<li>Creates and organizes assets within theme-specific directories to maintain structural clarity.</li>
<li>Validates existence of source files before copying, reducing the likelihood of runtime errors.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/html-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/generator/src/cli/html-generator.ts</code></a></h3>
<pre><code class="language-typescript">  async generateAdventure(): Promise&lt;void&gt; {
    console.log(chalk.yellow.bold(&#39;üöÄ Generating Adventure...&#39;));
    console.log();

    // Load repository URL from adventure.config.json
    const config = parseAdventureConfig(this.projectPath);
    if (config &amp;&amp; typeof config === &#39;object&#39; &amp;&amp; &#39;adventure&#39; in config) {
      const adventure = (config as any).adventure;
      if (adventure &amp;&amp; typeof adventure.url === &#39;string&#39;) {
        this.repoUrl = adventure.url.replace(/\/$/, &#39;&#39;); // Remove trailing slash
      }
    }

    // Step 1: Generate project analysis
    console.log(chalk.dim(&#39;üìä Analyzing codebase...&#39;));
    const repomixContent = await repoAnalyzer.generateRepomixContext(this.projectPath);
    const projectInfo = createProjectInfo(repomixContent);

    // Step 2: Initialize adventure
    console.log(chalk.dim(&#39;‚ú® Generating themed story and quests...&#39;));
    const storyContent = await this.adventureManager.initializeAdventure(
      projectInfo, 
      this.selectedTheme, 
      this.projectPath,
      this.customThemeData
    );

    // Rest of the function omitted for brevity
  }
</code></pre>
<ul>
<li>Manages the entire flow of adventure generation, from analyzing repository contents to creating user-facing HTML files.</li>
<li>Validates configurations like repository URLs from <code class="inline-code">adventure.config.json</code> to ensure correctness.</li>
<li>Integrates various components (e.g., <code class="inline-code">repoAnalyzer</code>, <code class="inline-code">adventureManager</code>) to streamline project insights and storytelling.</li>
</ul>
<hr>
<pre><code class="language-typescript">  private async generateAllThemes(args: Map&lt;string, string&gt;): Promise&lt;void&gt; {
    console.log(chalk.green(&#39;‚úÖ Generating all themes&#39;));
    this.isMultiTheme = true;

    // Create root output directory
    fs.mkdirSync(this.outputDir, { recursive: true });
    fs.mkdirSync(path.join(this.outputDir, &#39;assets&#39;), { recursive: true });
    fs.mkdirSync(path.join(this.outputDir, &#39;assets&#39;, &#39;images&#39;), { recursive: true });

    // Copy shared assets to avoid duplication across themes
    const assetManager = new (await import(&#39;./asset-manager.js&#39;)).AssetManager(__dirname);
    assetManager.copySharedNavigator(this.outputDir);
    assetManager.copyGlobalAssets(this.outputDir);
    
    // Generate each theme in its own subdirectory
    const themes: AdventureTheme[] = [&#39;space&#39;, &#39;mythical&#39;, &#39;ancient&#39;, &#39;developer&#39;];
    const themePromises = themes.map(async (theme) =&gt; {
      const themeDir = path.join(this.outputDir, theme);
      fs.mkdirSync(themeDir, { recursive: true });

      const themeGenerator = new HTMLAdventureGenerator();
      themeGenerator[&#39;selectedTheme&#39;] = theme;
      themeGenerator[&#39;outputDir&#39;] = themeDir;

      return themeGenerator.generateAdventure();
    });

    await Promise.allSettled(themePromises);
    console.log(chalk.green.bold(&#39;üéâ All themes generated successfully!&#39;));
  }
</code></pre>
<ul>
<li>Allows multiple themes to be generated simultaneously, each with its own directory structure.</li>
<li>Ensures shared assets (like icons and navigation files) are copied once to the root directory.</li>
<li>Uses promises to handle concurrent theme generation while tracking the overall progress.</li>
</ul>
<hr>
<pre><code class="language-typescript">  private async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
    return new Promise((resolve, reject) =&gt; {
      const server = http.createServer((req, res) =&gt; {
        let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);
        
        // Security check - ensure we stay within the directory
        if (!filePath.startsWith(this.outputDir)) {
          res.writeHead(403);
          res.end(&#39;Forbidden&#39;);
          return;
        }

        // Serve files dynamically based on request type
        const extname = path.extname(filePath);
        let contentType = &#39;text/html&#39;;
        switch (extname) {
          case &#39;.js&#39;: contentType = &#39;text/javascript&#39;; break;
          case &#39;.css&#39;: contentType = &#39;text/css&#39;; break;
          case &#39;.json&#39;: contentType = &#39;application/json&#39;; break;
          case &#39;.png&#39;: contentType = &#39;image/png&#39;; break;
          case &#39;.svg&#39;: contentType = &#39;image/svg+xml&#39;; break;
        }

        fs.readFile(filePath, (err, content) =&gt; {
          if (err) {
            if (err.code === &#39;ENOENT&#39;) {
              res.writeHead(404);
              res.end(&#39;File not found&#39;);
            } else {
              res.writeHead(500);
              res.end(&#39;Server error&#39;);
            }
          } else {
            res.writeHead(200, { &#39;Content-Type&#39;: contentType });
            res.end(content, &#39;utf-8&#39;);
          }
        });
      });

      server.listen(port, () =&gt; resolve());
      server.on(&#39;error&#39;, err =&gt; reject(err));
    });
  }
</code></pre>
<ul>
<li>Creates an HTTP server to preview the generated static HTML content.</li>
<li>Dynamically serves files, mapping file extensions to appropriate content types.</li>
<li>Implements security checks to avoid unauthorized directory traversal.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ†Ô∏è Start with the <code class="inline-code">generateAdventure</code> method to understand the full generation process.</li>
<li>üìñ Review how <code class="inline-code">TemplateEngine</code> simplifies HTML creation to adapt it for custom use cases.</li>
<li>‚ö° Experiment with the <code class="inline-code">generateAllThemes</code> function to automatically generate multi-theme outputs.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations on deploying your first end-to-end static site pipeline‚Äîyour mastery of HTML generation is the foundation ‚≠ê of scalable, production-ready workflows; onward to Quest 2! üöÄ</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>