<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Quest Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository Chronicles: The Developer's Guide to Modular Code Systems</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Quest Generation Engine</h1>
<hr>
<p>In the intricate core of the codebase lies the <code class="inline-code">Quest Generation Engine</code>, a pivotal subsystem for crafting rich, dynamic developer-themed adventures. This engine orchestrates configurable quests, story generation, and content integration, working seamlessly across specialized modules. Its architecture forms the backbone of an interactive experience that adapts to project structures while ensuring flexibility and reliability. Within the <code class="inline-code">Quest Generation Engine</code>, three files‚Äî<code class="inline-code">adventure-manager.ts</code>, <code class="inline-code">story-generator.ts</code>, and <code class="inline-code">adventure-config.ts</code>‚Äîcollaborate to empower initialization, quest exploration, and configuration handling.</p>
<p><strong>Prepare to dive deep into this code-driven narrative framework and unveil its architectural prowess!</strong></p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Thematic Initialization</strong>: How does the <code class="inline-code">AdventureManager</code> initialize itself with the relevant context, and what role does configuration merging play in linking generated quests with the project setup?</li>
<li>‚ö° <strong>Dynamic Content Creation</strong>: What strategies does <code class="inline-code">StoryGenerator</code> employ to generate a cohesive, markdown-formatted story and quest structure dynamically?</li>
<li>üõ°Ô∏è <strong>Configuration Interpretation</strong>: How do the <code class="inline-code">loadAdventureConfig</code> and <code class="inline-code">formatAdventureConfigForPrompt</code> functions handle and sanitize adventure configurations to integrate with quest creation?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Orchestrating Adventure State</h3>
<p>The <code class="inline-code">AdventureManager</code> class manages the lifecycle of the adventure‚Äîfrom initialization to quest execution and state tracking. It utilizes the <code class="inline-code">StoryGenerator</code> for dynamic content generation and depends on configuration files to validate and enrich quest content.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Initializes the adventure state with project info, theme, and quests by merging dynamically generated and configuration-defined content.</li>
<li><code class="inline-code">exploreQuest</code>: Dynamically retrieves or executes a quest based on user input, handling both progress checks and quest revisits.</li>
<li><code class="inline-code">enforceConfigQuestCount</code>: Adjusts the number of quests to align with the external configuration, ensuring consistency between generated content and settings.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Generating Dynamic Adventures</h3>
<p>The <code class="inline-code">StoryGenerator</code> class generates markdown-based stories and quest content using LLM prompts. Its modular design ensures compatibility with structured JSON and raw markdown inputs.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Generates stories and quests dynamically, leveraging external prompts, themes, and project exploration.</li>
<li><code class="inline-code">generateQuestContent</code>: Produces markdown-formatted content for specific quests, integrating configuration details and project-specific structures.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Processes markdown responses to extract structured data like story titles, descriptions, and quest details.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Configurations for Guidance</h3>
<p>This module handles the reading and processing of configuration files, ensuring the generator‚Äôs flexibility and adaptability to different project setups.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Loads raw adventure configuration text from project files if present.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes configuration data for LLM-based prompts by formatting quests and paths into a compact, readable structure.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts and validates file paths from the configuration, ensuring references exist and are unique.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string, customThemeData?: CustomThemeData): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Resets adventure state to ensure a clean slate for initialization.</li>
<li>Generates stories and quests dynamically while merging configuration data for consistency.</li>
<li>Allows customization of themes, reinforcing the flexibility of the adventure.</li>
</ul>
<hr>
<pre><code class="language-typescript">private enforceConfigQuestCount(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;

  const adventure = (config as any).adventure;
  if (quests.length &gt; (adventure.quests?.length || 0)) {
    return quests.slice(0, adventure.quests.length);
  }
  return quests;
}
</code></pre>
<ul>
<li>Enforces a consistent number of quests based on configuration, aligning dynamically created scenarios with external definitions.</li>
<li>Ensures no unnecessary quests while adhering to user-defined limits.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Coordinates project information, theme validation, and LLM-based generation of stories and quests.</li>
<li>Serves as the entry point for dynamic story creation.</li>
</ul>
<hr>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);
  const title = extractTitle(tokens);
  
  let story = &#39;&#39;;
  const quests: Quest[] = [];

  for (const token of tokens) {
    if (token.type === &#39;paragraph&#39;) {
      if (isStorySection(token.text)) story += token.text + &#39;\n\n&#39;;
    } else if (token.type === &#39;heading&#39; &amp;&amp; token.depth === 3) {
      quests.push({ title: token.text, description: &#39;&#39;, codeFiles: [] });
    }
  }

  return { title, story: story.trim(), quests };
}
</code></pre>
<ul>
<li>Parses markdown responses into structured story and quest objects.</li>
<li>Extracts key details, ensuring compatibility with markdown inputs.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, &#39;adventure.config.json&#39;);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Reads adventure configuration files, enabling external overrides of dynamic generation.</li>
<li>Ensures non-fatal behavior for missing or invalid configuration files.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;
  const adventure = parsed.adventure;

  let formatted = `## Quest Structure\n`;
  adventure.quests.forEach((quest: any) =&gt; {
    formatted += `### ${quest.title}\nFiles: ${quest.files.map((f: any) =&gt; f.path).join(&#39;, &#39;)}\n`;
  });

  return formatted;
}
</code></pre>
<ul>
<li>Formats configuration data for use with LLM prompts, streamlining quest structure rendering.</li>
<li>Prioritizes compactness and relevance to maximize context for LLM operations.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Cross-Reference Configurations</strong>: When debugging quest generation, check <code class="inline-code">adventure.config.json</code> side-by-side with the <code class="inline-code">mergeQuestFilesFromConfig</code> logic.</li>
<li><strong>Understand Dependencies</strong>: Study how <code class="inline-code">StoryGenerator</code> and <code class="inline-code">AdventureManager</code> exchange data for seamless functionality.</li>
<li><strong>Experiment with Themes</strong>: Try using custom themes to explore the full configurability of the system.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>üéâ With the Quest Generation Engine now deployed, you&#39;ve successfully debugged the roadmap&#39;s core algorithm‚Äîan achievement that levels up your development prowess to 20% completion! ‚ö°üöÄ</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>