<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Secrets of the Quest Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Repository Chronicles: A Tale of Code and Quests</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Secrets of the Quest Generation Engine</h1>
<hr>
<p>In the interconnected libraries of the Repository Kingdom, the Quest Generation Engine stands as a cornerstone for automating adventures and weaving project paths into compelling narratives. With every initialization, the engine extracts precision from project configuration files and validates user selections, engaging developers in epic quests. Will you unravel the secrets of <code class="inline-code">AdventureManager</code>, <code class="inline-code">AdventureState</code>, and <code class="inline-code">StoryGenerator</code>, ensuring that each adventure is meticulously crafted and seamlessly executed? The code whispers its secrets‚Äîventure forth to decode its magic.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Adventure Initialization Map</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> use the project context and themes to set up quests and generate the overarching narrative?  </li>
<li>‚ö° <strong>Quest Execution Flow</strong>: What mechanisms does <code class="inline-code">AdventureManager.exploreQuest</code> deploy to find and execute user-selected quests?  </li>
<li>üõ°Ô∏è <strong>Config Input Integration</strong>: How does <code class="inline-code">parseAdventureConfig</code> in <code class="inline-code">adventure-config.ts</code> ensure seamless merging and validation with project configuration data?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Adventure Coordinator</h3>
<p>The <code class="inline-code">AdventureManager</code> class is the brain behind quest orchestration. It initializes adventures with project data, integrates themes, validates quest inputs, and executes user choices. Its counterpart, <code class="inline-code">AdventureState</code>, maintains persistent information about the adventure&#39;s progress, quests, and cache for enhanced user experience. The highlights below showcase key functionality that ensures dynamic and configurable adventures:  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets the state and builds story/quests using project paths and configurations. Crucial for starting fresh adventures.  </li>
<li><code class="inline-code">exploreQuest</code>: Handles quest selection and execution, ensuring logical flow between user input and narrative updates.  </li>
<li><code class="inline-code">progressPercentage</code>: Tracks progress across completed quests, tying execution to meaningful milestones.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Sets up the foundational context for a new adventure, linking project information with configurable themes.  </li>
<li>Uses <code class="inline-code">generateStoryAndQuests</code> to dynamically build immersive narratives and convert them into actionable quests.  </li>
<li>Implements robust initialization by calling <code class="inline-code">mergeQuestFilesFromConfig</code> and <code class="inline-code">enforceConfigQuestCount</code> to integrate data from configuration files.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates user input and maps it to specific quests via selection functions (<code class="inline-code">findQuest</code>, <code class="inline-code">createNotFoundResult</code>).  </li>
<li>Ensures logical continuity by supporting cached content for revisited quests (<code class="inline-code">getProgress</code>) or real-time quest execution.  </li>
<li>Incorporates <code class="inline-code">validateAndSanitizeChoice</code> to enhance error handling for cleaner UX.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Provides clarity for the end-user on adventure progression, allowing real-time tracking of milestones.  </li>
<li>Converts complex data (from <code class="inline-code">completedQuests</code> set size) into an intuitive percentage format.  </li>
<li>Enables decision-making for quest prioritization by quantifying completion metrics.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Config Insights</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file is vital for retrieving and parsing quest-related configurations from project paths. It ensures that quests reference validated files and align with adventure requirements seamlessly.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Loads and parses JSON configuration data into an object for structured analysis.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts valid file paths referenced in the configuration, ensuring all paths exist in the project repository.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes raw config data for LLM context prompts, reducing redundant information.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Streamlined JSON parsing ensures configuration reflects accurate and reliable file structure.  </li>
<li>Handles errors gracefully‚Äîreturns <code class="inline-code">null</code> for malformed or missing data instead of throwing exceptions.  </li>
<li>Centralizes parsing logic for reuse in other configuration-dependent functions.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Utilizes recursive traversal to extract viable file paths, ensuring all entries are validated (<code class="inline-code">fs.existsSync</code>).  </li>
<li>Effectively handles nested configurations and complex JSON schemas using a stack model.  </li>
<li>Outputs deduplicated paths, reducing redundancy in further file analysis.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;
  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Transforms raw configuration into concise outputs suitable for text-based exploration prompts (e.g., LLM integrations).  </li>
<li>Reduces verbosity while retaining semantics (such as quests, files, and highlights).  </li>
<li>Supports adaptive presentation formats for human-readable interaction or machine-learning pipelines.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Investigate how <code class="inline-code">mergeQuestFilesFromConfig</code> integrates file-specific contexts in <code class="inline-code">AdventureManager</code>.  </li>
<li>Observe how error handling in configuration parsing supports resilience during quest initialization.  </li>
<li>Explore <code class="inline-code">progressPercentage</code> as an example of clean metric-based state tracking.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations, developer! You&#39;ve successfully debugged the logic and unlocked the core functionality of the Quest Generation Engine in Quest 2‚Äîyou&#39;re now 20% closer to achieving master-level scripting prowess! üöÄüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>