<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Forge of Stories - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Repository of Infinite Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Forge of Stories</h1>
<hr>
<p>In the Repository of Infinite Adventures, you step into the enchanted chamber where narratives and quests are forged directly from the raw materials of source code. Here resides &quot;The Forge of Stories,&quot; a legendary mechanism powered by the <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code> classes. This mystical system extracts insights from project configurations and dynamically generates captivating storylines, tailored to the explorer&#39;s chosen theme. As a Keeper of Code, your task is to navigate this intricate system and uncover how adventures are created, configured, and refined within its core functions.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Thematic Calibration</strong>: How does the <code class="inline-code">AdventureManager</code> initialize an adventure with project-specific context and themes?</li>
<li>‚ö° <strong>Narrative Flow</strong>: What strategies are used by the <code class="inline-code">StoryGenerator</code> to transform project data into structured stories and quests?</li>
<li>üõ°Ô∏è <strong>Validation Forge</strong>: How is user input sanitized and validated when choosing or exploring quests?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Core logic for managing the adventure lifecycle.</h3>
<p>The <code class="inline-code">AdventureManager</code> orchestrates the lifecycle of code-based adventures. It initializes adventures, validates user inputs, and aligns dynamic quests with project configurations. The <code class="inline-code">initializeAdventure</code> method resets the internal state, sets the project and theme contexts, and generates stories and quests using the <code class="inline-code">StoryGenerator</code>. The <code class="inline-code">exploreQuest</code> function is responsible for validating user choices and ensuring progress is tracked as users journey through their quests. This file also contains mechanisms for enforcing constraints from adventure configurations and caching completed quest data for efficient retrieval.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Generates the initial adventure, including themes, quests, and story.</li>
<li><code class="inline-code">exploreQuest</code>: Validates and executes quests based on user choices.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Computes the progress percentage based on completed quests.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Converts project data into themed stories and quests.</h3>
<p>The <code class="inline-code">StoryGenerator</code> processes project data and themes to generate rich narratives and structured quest content. It uses the <code class="inline-code">generateStoryAndQuests</code> function to compile story descriptions and quests into cohesive adventures. The class leverages advanced prompting mechanisms to interact with language models and ensure the response aligns with the chosen theme. Additionally, robust parsing and validation steps are utilized to extract meaningful data from generated content.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Combines project information and theme settings to generate stories and quests.</li>
<li><code class="inline-code">generateQuestContent</code>: Produces detailed, interactive content for each quest.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Converts markdown data from the language model into a structured response.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Interface to load and process adventure configurations.</h3>
<p>This file handles the configuration process for adventures. The <code class="inline-code">parseAdventureConfig</code> function parses a JSON-based configuration file, while <code class="inline-code">extractUniqueFilePaths</code> identifies relevant file paths in the project. These parsed details are used to enhance quest generation by incorporating specific project files and highlights. The <code class="inline-code">formatAdventureConfigForPrompt</code> function formats configuration data into concise summaries for language model prompts.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses the <code class="inline-code">adventure.config.json</code> file for quest configurations.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts file references for quest generation.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Formats configuration data for prompt optimization.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>The <code class="inline-code">initializeAdventure</code> method configures the state, generates the adventure, and aligns quests with project data.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<p>The <code class="inline-code">exploreQuest</code> function processes user input to validate choices, find the relevant quest, and execute it.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>The <code class="inline-code">progressPercentage</code> getter tracks user progress based on completed quests.</p>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<p>The <code class="inline-code">generateStoryAndQuests</code> function combines project and theme data to dynamically create stories and quests.</p>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  codeContent: string
): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;
  });
  
  const response = await this.llmClient.generateResponse(prompt);
  return { adventure: response.content.trim(), fileExploration: &#39;&#39; };
}
</code></pre>
<p>The <code class="inline-code">generateQuestContent</code> method generates detailed content for each quest by interacting with a language model.</p>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);
  let title = &#39;&#39;;
  let story = &#39;&#39;;
  const quests: Quest[] = [];

  // Parsing logic for title, story, and quests from markdown tokens

  return { title, story, quests };
}
</code></pre>
<p>The <code class="inline-code">parseMarkdownToStoryResponse</code> function processes markdown and extracts story details and quest definitions.</p>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>The <code class="inline-code">parseAdventureConfig</code> function reads and parses the <code class="inline-code">adventure.config.json</code> file for configuration details.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  // Recursive extraction of file paths

  return Array.from(unique);
}
</code></pre>
<p>The <code class="inline-code">extractUniqueFilePaths</code> function collects all unique file paths listed in the configuration.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;

  // Generate a summarized string representation of the configuration for prompts

  return formatted;
}
</code></pre>
<p>The <code class="inline-code">formatAdventureConfigForPrompt</code> function optimizes configuration data for prompt usage, reducing redundancy.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Start by identifying key relationships between <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code>.</li>
<li>Look for patterns in how quests are initialized and tied to configuration files in <code class="inline-code">adventure.config.json</code>.</li>
<li>Experiment with modifying configurations to see how they influence generated quests.</li>
</ul>
<hr>
<p>You have explored the intricate forge of code, gaining mastery over story creation. The narrative awaits your return for further customization and refinement!</p>
<p>Congratulations on completing &#39;Quest 2: The Forge of Stories&#39;‚Äîyou‚Äôve successfully deployed a new module of knowledge into your mental framework, achieving 20% code coverage on your epic development journey üöÄ‚ö°üíé!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>