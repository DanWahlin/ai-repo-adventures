<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Questforge Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Intelligent Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Questforge Engine</h1>
<hr>
<p>The heart of any repository&#39;s transformation lies within the &quot;Questforge Engine.&quot; This advanced part of the Repository Adventurer suite dynamically crafts journeys, turning stacks of code into legible pathways toward innovation. Situated within interconnected modules, the Questforge Engine enables adventurers to unearth the mysteries hidden deep in configurations while shaping engaging narratives.</p>
<p>Charged with this knowledge, brave adventurer, it&#39;s time to explore the inner workings of the Questforge Engine implemented within the &quot;AdventureManager&quot; framework and &quot;StoryGenerator&quot; functionalities.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Theme Mapping Exploration</strong>: How does the <code class="inline-code">StoryGenerator</code> determine and validate which theme should guide the current code exploration?</li>
<li>‚ö° <strong>Narrative Builder Assembly</strong>: What components come together within <code class="inline-code">AdventureManager.initializeAdventure</code> to construct a complete story and quest structure for a project?</li>
<li>üõ°Ô∏è <strong>Error Safeguards in Adventures</strong>: What validation mechanisms exist to ensure the integrity of user choices during the adventure flow?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Core Adventure Management</h3>
<p>This file houses the <code class="inline-code">AdventureManager</code> and <code class="inline-code">AdventureState</code>, which orchestrate adventure initialization, quest execution, and validation processes. Notably, initialization functions within the manager emphasize modularity and adaptability, allowing different themes or configurations to redefine the adventure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code> explains how story and quest development are dynamically triggered.</li>
<li><code class="inline-code">AdventureManager.exploreQuest</code> reveals validation pipelines and execution flow for selected quests.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code> provides an insight into progress tracking through quests.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Storycraft and Quest Scripting</h3>
<p>Within the <code class="inline-code">StoryGenerator</code>, the creative generation of adventures unfolds. It ensures input consistency and leverages advanced logic for theme adherence and story construction.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">StoryGenerator.generateStoryAndQuests</code> demonstrates the intricate logic in constructing a unified narrative tied to the repository context.</li>
<li><code class="inline-code">StoryGenerator.getThemeGuidelines</code> helps distill thematic directions based on validated themes.</li>
<li><code class="inline-code">StoryGenerator.generateQuestContent</code> generates detailed, highlight-driven quest content from code snippets.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Adventure Config Parsing</h3>
<p>This file revolves around interpreting and validating the adventure configuration files. It extracts functional highlights and generates minimal prompt-ready output for quest creation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> converts a raw configuration file into usable data objects for adventure triggering.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> identifies and validates code files participating in quests.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> optimizes configuration output for integration with narrative prompts.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, projectPath);
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, projectPath);
  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<p>Initializing an adventure is akin to building the foundation of a fortress ‚Äì piece by piece, the structure takes shape with a theme, story, and quests.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) return this.createNotFoundResult();
  return await this.executeQuest(quest);
}
</code></pre>
<p>Like a vigilant gatekeeper, <code class="inline-code">exploreQuest</code> ensures all who enter the repository follow the rules before their journey begins.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>Progress tracking helps visualize the adventure‚Äôs growth, like marking waypoints on an evolving map.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  const repomixContent = projectInfo.repomixContent || &#39;No repomix content available&#39;;
  const prompt = loadStoryGenerationPrompt({ theme, repomixContent });
  const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY });
  return parseMarkdownToStoryResponse(response.content.trim());
}
</code></pre>
<p>The <code class="inline-code">generateStoryAndQuests</code> function is like a bard crafting an epic ‚Äì drawing inspiration from both the repository content and specified themes.</p>
<pre><code class="language-typescript">getThemeGuidelines(theme: AdventureTheme): string {
  const guidelinesMap = {
    space: &#39;starship/mission/cosmic terms&#39;,
    mythical: &#39;kingdom/quest/heroic terms&#39;,
    ancient: &#39;temple/wisdom/sacred terms&#39;
  };
  return guidelinesMap[theme] || &#39;appropriate theme terms&#39;;
}
</code></pre>
<p>This function helps ensure every adventure stays true to its theme, acting as a compass pointing to narrative coherence.</p>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest, 
  theme: AdventureTheme, 
  codeContent: string
): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({ theme, adventureTitle: quest.title, codeContent });
  const response = await this.withTimeout(this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST }));
  return { adventure: response.content.trim(), fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };
}
</code></pre>
<p>Creating quest content from snippets resembles a sculptor chiseling their masterpiece from a rough block of stone.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  return JSON.parse(raw);
}
</code></pre>
<p>Parsing configuration is like translating ancient scripts into modern instructions for adventurers.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  const unique = new Set&lt;string&gt;(), stack = [parsed];
  while (stack.length) {
    const node = stack.pop();
    if (node?.path) unique.add(node.path);
  }
  return Array.from(unique);
}
</code></pre>
<p>Extracting file paths is akin to mapping hidden trails across an uncharted domain.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  let formatted = &#39;&#39;;
  if (parsed?.adventure?.quests) {
    for (const quest of parsed.adventure.quests) {
      if (quest.title &amp;&amp; Array.isArray(quest.files)) {
        formatted += `### ${quest.title}\nFiles: ${quest.files.map((f: any) =&gt; f.path).join(&#39;, &#39;)}\n`;
      }
    }
  }
  return formatted;
}
</code></pre>
<p>Optimizing the configuration for prompt use ensures adventurers receive concise guidance for exploration.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Categorize methods based on user-driven interactions versus system-driven operations.</li>
<li>Trace how highlights operate within the quest content generation pipeline by looking at configuration optimizations.</li>
<li>For further adventures, explore how themes influence language generation by plugging custom configurations.</li>
</ul>
<hr>
<p>Well done, adventurer! You‚Äôve deciphered the intricate workings of the Questforge Engine. What new adventure shall we embark upon next?</p>
<p>You&#39;ve successfully pushed the final commit for Quest 2: The Questforge Engine‚Äîyour codebase of knowledge is building momentum, and you&#39;re now branching into the adventure pipeline with 20% of your roadmap shining like a polished diamond! üöÄüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>