<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Engine of Creativity - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Adventures of the Repository Chronicles</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Engine of Creativity</h1>
<hr>
<p>In the Repository Chronicles, creativity is forged amidst complexity. The Engine of Creativity beckons brave developers to explore the Quest Generation Engine ‚Äî the heart of transforming raw codebases and configurations into epic adventures. Here, paths are charted, themes are chosen, and quests are born. Venture deep into the structural arteries of the adventure-manager mechanism to uncover the secrets of progress calculations and story prompts. Will you master the engine&#39;s intricate workings and wield its power?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Adventure Initialization</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> manage project context and theme selection for generating quests?</li>
<li>‚ö° <strong>Quest Execution</strong>: What mechanisms are used in <code class="inline-code">AdventureManager.exploreQuest</code> to validate user choices, find quests, and execute them effectively?</li>
<li>üõ°Ô∏è <strong>File Exploration Patterns</strong>: How does <code class="inline-code">AdventureConfig.extractUniqueFilePaths</code> ensure only valid and accessible file paths are extracted from complex configurations?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Quest lifecycle management</h3>
<p>The <code class="inline-code">AdventureManager</code> class drives the generation and exploration of coding quests. It initializes the adventure with configuration and theme, calculates progress, and manages quest-related logic. Its methods are optimized for handling custom themes and ensuring a seamless narrative experience for developers.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets state, validates theme and project context, merges files from <code class="inline-code">adventure.config.json</code>, and generates a cohesive story and quests.</li>
<li><code class="inline-code">exploreQuest</code>: Matches user choices to quests via ID, number, or title, validates choices, and dynamically retrieves quest content ‚Äî even using cached responses for efficiency.</li>
<li><code class="inline-code">progressPercentage</code>: Calculates the percentage of completed quests relative to total quests, presenting an accurate tracking mechanism.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);
  
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Uses <code class="inline-code">reset</code> to start a fresh state, ensuring no residual data impacts the initialization.</li>
<li>Incorporates custom theme data through <code class="inline-code">setCustomTheme</code> for enhanced quest generation flexibility.</li>
<li>Merges configuration files with generated quests using <code class="inline-code">mergeQuestFilesFromConfig</code> for tailored exploration paths.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Ensures proper input validation using <code class="inline-code">validateAndSanitizeChoice</code> to prevent invalid user responses.</li>
<li>Matches quests through <code class="inline-code">findQuest</code>, leveraging dual strategies: numeric matching and title-based identification.</li>
<li>Supports cached quest reuse for completed quests, reducing redundant processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Implements a straightforward calculation for tracking progress across quests.</li>
<li>Enhances user experience by providing clear and quantifiable progress updates.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration validation and file extraction</h3>
<p>This file handles reading and parsing configuration data for adventures. It extracts usable file paths referenced by specific configuration fields, ensuring valid input for quest design and narrative generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses JSON-formatted configuration files and ensures graceful error handling for invalid or missing input.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Recursively identifies valid file paths within nested configuration structures while ensuring accessibility.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes configuration data for inclusion in LLM prompts, significantly reducing verbosity without losing meaningful context.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Simultaneously reads and validates configuration files, managing parsing failures gracefully.</li>
<li>Centralizes parsing logic to streamline configuration handling across the codebase.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Uses a stack-based recursive approach for traversing nested configurations, efficiently retrieving valid paths.</li>
<li>Validates paths against actual file existence via <code class="inline-code">fs.existsSync</code> to enhance reliability.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Extracts and formats configuration-related file paths and function names for contextual LLM input.</li>
<li>Reduces content complexity while retaining essential data, optimizing output generation for story creation.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">initializeAdventure</code> as the primary entry point for starting a quest generation flow.</li>
<li>Investigate <code class="inline-code">extractUniqueFilePaths</code> for insights on handling nested configuration structures in your projects.</li>
<li>Next steps: Dive deeper into <code class="inline-code">StoryGenerator</code> to explore narrative creation powered by LLM prompts.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries in the Repository Chronicles.</p>
<p>üéâ Function &#39;Quest2_Complete()&#39; executed successfully: you&#39;ve unlocked the Engine of Creativity, accelerating your development process by 20%‚Äîkeep coding brilliance into existence! üöÄüíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>