<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Forging the Quest Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of Repository Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Forging the Quest Generation Engine</h1>
<hr>
<p>The Repository Adventure Engine buzzes with purpose, ready to forge meaningful quests for developers. Yet, its intricate mechanisms remain shrouded in mystery. To progress, adventurers must delve into its source codes and unveil the secrets of its quest generation prowess. This journey promises to uncover how stories intertwine with code structures, and what fuels the engine‚Äôs decision-making process. Prepare to unlock the arcane algorithms that summon quests from digital depths.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Quest Blueprint Analysis</strong>: How does <code class="inline-code">AdventureManager</code> initialize and configure quests based on project context and themes?</li>
<li>‚ö° <strong>Story Creation Flow</strong>: What role does <code class="inline-code">StoryGenerator</code> play in generating stories and adventure content? How are themes validated?</li>
<li>üõ°Ô∏è <strong>Adventure Config Integration</strong>: How does <code class="inline-code">parseAdventureConfig</code> influence the generated quests and ensure consistency with project-specific files?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Quest initialization and management</h3>
<p>The <code class="inline-code">AdventureManager</code> coordinates the lifecycle of quests, from instantiation using project details to executing selections by adventurers. It integrates user choices, themes, and project configurations to ensure the generated quests are precise and aligned. Code highlights in this file reveal the initialization process, quest execution mechanisms, and progress tracking.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code> showcases how the project context and themes are loaded.</li>
<li><code class="inline-code">AdventureManager.exploreQuest</code> explores quest selection and execution logic.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code> demonstrates progress calculation in active quests.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Narrative creation mechanism</h3>
<p>The <code class="inline-code">StoryGenerator</code> crafts compelling stories by merging themes, project configurations, and LLM-generated content. It validates themes, processes markdown responses, and aligns the narrative flow with the structured project context. Highlights in this file unravel story creation, content curation, and keyword integrations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">StoryGenerator.generateStoryAndQuests</code> unveils the primary entry point for story and quest generation.</li>
<li><code class="inline-code">StoryGenerator.generateQuestContent</code> dives into how quest-specific content is produced.</li>
<li><code class="inline-code">StoryGenerator.validateTheme</code> ensures themes are checked and substituted when invalid.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Config file handling</h3>
<p>The <code class="inline-code">adventure-config</code> utility extracts, parses, and validates configuration files for adventures. By preparing targeted prompts and extracting highlights, it bridges the gap between project-specific files and generated content. Highlights here emphasize config parsing, file path extraction, and formatting logic.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> explains how configs are parsed into usable JSON objects.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> identifies referenced files, adding precision to quest coverage.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> prepares compact and meaningful configurations for prompt optimization.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>Think of <code class="inline-code">initializeAdventure</code> as the captain assembling the crew before embarking on a voyage, aligning tools and roles based on the map and destination.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<p>The <code class="inline-code">exploreQuest</code> function is akin to a wizard choosing their spell, validating the target and retrieving cached outcomes or fresh results.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>Imagine the <code class="inline-code">progressPercentage</code> as a magical gauge that visualizes how far an adventurer has journeyed through the realm.</p>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<p>Generating story and quests here feels like an artist creating a masterpiece, blending contextual colors to paint a coherent narrative.</p>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  codeContent: string
): Promise&lt;QuestContent&gt; {
  const adventureGuidance = this.projectPath ? formatAdventureConfigForPrompt(this.projectPath) : &#39;&#39;;
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    adventureGuidance,
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );

  return { adventure: this.removeLLMMetaCommentary(response.content), fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };
}
</code></pre>
<p>This content generation mirrors a blacksmith forging precise tools from raw material to fit a specific quest.</p>
<pre><code class="language-typescript">private validateTheme(theme: AdventureTheme): AdventureTheme {
  if (!isValidTheme(theme)) {
    console.warn(`Invalid theme &#39;${theme}&#39;, defaulting to ${DEFAULT_THEME}`);
    return DEFAULT_THEME;
  }
  return theme;
}
</code></pre>
<p>Validating themes here ensures the adventurer‚Äôs magic spell corresponds with accepted realms.</p>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Parsing the config feels like unlocking a treasure chest to retrieve a vital map.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (node?.path?.trim() &amp;&amp; fs.existsSync(path.resolve(projectPath, node.path.trim()))) {
      unique.add(node.path.trim());
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; { if (typeof child === &#39;object&#39;) stack.push(child); });
  }

  return Array.from(unique);
}
</code></pre>
<p>Extracting file paths operates like a cartographer charting all paths from interconnected nodes.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  const adventure = (parsed as any)?.adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  return adventure.quests.map(quest =&gt; `### ${quest.title}\nFiles: ${quest.files?.map(f =&gt; f.path).join(&#39;, &#39;) || &#39;None&#39;}\n`).join(&#39;\n&#39;);
}
</code></pre>
<p>Formatting for prompts acts as a distiller, compressing vast context into essence for consuming machines.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Trace flows: Follow initialization functions to understand preconditions for quest generation.</li>
<li>Study integration points: Investigate how configurations inject precision into generated content.</li>
<li>Validate assumptions: Cross-reference parsing methods with actual config files for integrity.</li>
</ul>
<hr>
<p>Your adventure grows more captivating with each discovery. Continue unraveling the magic behind dynamic quest creation!</p>
<p>üéâ Version 2.0 of your questing algorithm successfully deployed‚Äîlogic flawlessly iterated, efficiency optimized, and you&#39;ve leveled up with 20% progress toward the ultimate milestone! üöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>