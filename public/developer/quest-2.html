<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Engine of Creation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Computational Adventures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Engine of Creation</h1>
<hr>
<p>In the sprawling software realm, amidst the intertwining algorithms and digital landscapes, lies the coveted <strong>Engine of Creation</strong>. This mystical construct powers the generative story engine, weaving interactive quests that challenge developers to harness its mechanics. However, the path to unlocking its secrets is laden with intrigue. By studying key files and understanding vital highlights, you will illuminate the mechanisms that propel this engine forward.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Engine Initialization</strong>: How does <code class="inline-code">initializeAdventure</code> set up the quest mechanics using configuration, themes, and project context?</li>
<li>‚ö° <strong>Narrative Weaving</strong>: How does <code class="inline-code">generateStoryAndQuests</code> combine the project analysis with adventure themes to produce custom storylines?</li>
<li>üõ°Ô∏è <strong>Structure Verification</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure configuration data is correctly fetched and validated to guide the narrative?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Manage adventure initialization and progression</h3>
<p>This file orchestrates the interaction between user input, project context, and generative storytelling systems. It handles initialization, quest selection, and execution, ensuring each quest reflects the developer&#39;s coding environment and objectives.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: This crucial method sets the stage for the adventure. It resets the state, applies themes, processes configurations, and generates quests using <code class="inline-code">StoryGenerator</code>.</li>
<li><code class="inline-code">exploreQuest</code>: Handles user selections, validates input, and drives quest content generation while leveraging caching for revisited quests.</li>
<li><code class="inline-code">progressPercentage</code>: Calculates quest completion as a percentage, showcasing player progress.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Generate quest narratives and content</h3>
<p>This file leverages AI-driven methods to craft the stories and quests, parsing project data and themes into structured responses. It ensures the Engine of Creation remains adaptive and inspiring.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Produces the backbone narrative by parsing project information and combining it with selected themes.</li>
<li><code class="inline-code">generateQuestContent</code>: Dynamically creates rich quest content, integrating project analysis with thematic storytelling prompts.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Transforms markdown responses from AI into structured data, extracting quests and storylines precisely.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Provide configuration support for adventures</h3>
<p>This file is responsible for interacting with <code class="inline-code">adventure.config.json</code>, extracting relevant configuration data and validating it. It supplies structured guidance for quest generation and engine optimization.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Reads and parses the configuration file, ensuring compatibility and validity for the generative system.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies all unique file references in the configuration, validating their existence for quest context alignment.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Converts the configuration into a concise format, optimizing it for use by the storytelling engine.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);
  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Resets the adventure state, ensuring clean initialization for new projects and themes.</li>
<li>Incorporates theme selection and configuration merging to tailor the experience.</li>
<li>Utilizes the <code class="inline-code">StoryGenerator</code> for custom quest generation based on project analysis.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Calculates completion percentage, providing visual feedback to users.</li>
<li>Encourages developers to track progress interactively with minimal computational overhead.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  const validatedTheme = this.validateTheme(theme);
  const formattedConfig = formatAdventureConfigForPrompt(projectPath || &#39;&#39;);
  const customInstructions = extractCustomInstructions(projectPath || &#39;&#39;);
  const prompt = loadStoryGenerationPrompt({
    theme: validatedTheme,
    repomixContent: projectInfo.repomixContent,
    adventureGuidance: formattedConfig,
    customInstructions
  });

  const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY });
  const parsed = parseMarkdownToStoryResponse(response.content.trim());
  this.currentStoryContent = parsed.story;
  return parsed;
}
</code></pre>
<ul>
<li>Combines project analysis results with selected themes to generate customized narratives.</li>
<li>Employs AI-driven prompts for dynamic storytelling based on developer context.</li>
<li>Validates and parses responses to ensure structured output for smooth integration.</li>
</ul>
<hr>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);
  const title = extractTitle(tokens);
  let story = &#39;&#39;;
  const quests: Quest[] = [];
  let currentSection = &#39;&#39;;
  let currentQuest: Partial&lt;Quest&gt; = {};
  let titleFound = false;

  tokens.forEach(token =&gt; {
    if (token.type === &#39;heading&#39;) {
      if (token.depth === 1) {
        titleFound = true;
        currentSection = &#39;story&#39;;
      } else if (token.depth === 2) {
        currentSection = token.text.toLowerCase();
      } else if (token.depth === 3 &amp;&amp; isQuestSection(currentSection)) {
        if (currentQuest.title &amp;&amp; currentQuest.description) quests.push(createQuest(currentQuest, quests.length));
        currentQuest = { title: token.text, description: &#39;&#39;, codeFiles: [] };
      }
    } else if (token.type === &#39;paragraph&#39; &amp;&amp; currentQuest.title) currentQuest.description += token.text + &#39;\n\n&#39;;
  });

  return { title, story, quests };
}
</code></pre>
<ul>
<li>Processes markdown responses into structured story elements, ensuring compatibility with the quest engine.</li>
<li>Separates narrative sections from quest details for precise extraction and integration.</li>
<li>Implements fallback validation to handle incomplete or ambiguous response formats.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const rawConfig = loadAdventureConfig(projectPath);
  if (!rawConfig) return null;
  try {
    return JSON.parse(rawConfig);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses the configuration file, ensuring that any syntax errors or missing files are gracefully handled.</li>
<li>Supplies data for quest customization, enabling tailored adventures for diverse projects.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  const uniqueFiles = new Set&lt;string&gt;();
  const stack = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (node &amp;&amp; typeof node === &#39;object&#39; &amp;&amp; typeof node.path === &#39;string&#39; &amp;&amp; fs.existsSync(path.resolve(projectPath, node.path.trim()))) uniqueFiles.add(node.path.trim());
    Array.isArray(node) &amp;&amp; stack.push(...node);
  }
  
  return Array.from(uniqueFiles);
}
</code></pre>
<ul>
<li>Identifies all unique file paths referenced in the configuration, validating their existence for reliability.</li>
<li>Supports streamlined project file targeting for quest content generation.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const adventureConfig = parseAdventureConfig(projectPath);
  if (!adventureConfig || typeof adventureConfig !== &#39;object&#39;) return &#39;&#39;;
  
  const adventure = (adventureConfig as any).adventure;
  let formatted = &#39;## Quest Structure\n&#39;;
  
  adventure.quests.forEach(quest =&gt; {
    if (quest.title &amp;&amp; Array.isArray(quest.files)) formatted += `### ${quest.title}\nFiles: ${quest.files.map((f: any) =&gt; f.path).filter(Boolean).join(&#39;, &#39;)}\nFunctions: ${(quest.files.flatMap((f: any) =&gt; f.highlights || []).map((h: any) =&gt; h.name).filter(Boolean).join(&#39;, &#39;))}\n\n`;
  });
  
  return formatted;
}
</code></pre>
<ul>
<li>Converts the configuration into an optimized format for generative storytelling prompts, reducing redundant or irrelevant data.</li>
<li>Ensures compatibility while adhering to strict character limits.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Efficiency Tip</strong>: Focus on modular functions like <code class="inline-code">parseAdventureConfig</code> to support configuration validation in varied contexts.</li>
<li><strong>Exploration Recommendation</strong>: Investigate how the story generator adapts to themes dynamically to deepen quest immersion.</li>
<li><strong>Next Steps</strong>: Apply the knowledge from this quest to craft new quests optimizing user engagement and narrative alignment.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries within the Engine of Creation.</p>
<p>Congratulations, developer! You&#39;ve successfully compiled &#39;Quest 2: The Engine of Creation,&#39; with zero errors and maximum efficiency‚Äîyour progress bar now shines at 20%, keep iterating toward the final deploy! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>