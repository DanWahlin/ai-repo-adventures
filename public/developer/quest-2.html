<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Scrolls of Storycraft - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codebase Chronicles: An Ancient Repository</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Scrolls of Storycraft</h1>
<hr>
<p>In the era of ancient archives, brave adventurers have long sought the Scrolls of Storycraft, sacred scripts that possess the power to transform barren lines of code into vibrant narratives. It is whispered that these scrolls are guarded by a labyrinth of Adventure Artifacts, encoded deep within the Repository Adventure Engine. To claim the Scrolls, you must unearth the secrets of adventure initialization and the alchemy of quest generation. Do not falter, for the journey requires sharp wit and keen understanding.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üó∫Ô∏è <strong>Scrolls of Initialization</strong>: How does the <code class="inline-code">AdventureManager</code> initialize an adventure, and how are the quests generated? Look for steps related to theme selection and merging configurations.  </li>
<li>üîç <strong>Quest Artifacts</strong>: How does the <code class="inline-code">StoryGenerator</code> transform project context and themes into structured quests and stories? Focus on the code handling quest details and LLM integrations.  </li>
<li>‚ö° <strong>Configuration Oracle</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function interact with <code class="inline-code">adventure.config.json</code> to optimize quest generation processes? Examine how data is parsed and validated.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Manager</h3>
<p>The <code class="inline-code">AdventureManager</code> orchestrates the lifecycle of adventures. It initializes journeys, processes quests, and ensures a seamless exploration experience. Key components of the manager include quest validation, interaction with the <code class="inline-code">StoryGenerator</code>, and maintaining state via <code class="inline-code">AdventureState</code>.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Prepares the adventure by resetting state, configuring themes, and generating storylines and quests.  </li>
<li><code class="inline-code">exploreQuest</code>: Executes a quest based on user input while validating progress and prerequisites.  </li>
<li><code class="inline-code">enforceConfigQuestCount</code>: Ensures consistency by adjusting quest count per the <code class="inline-code">adventure.config.json</code> settings.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Story Generator</h3>
<p>The <code class="inline-code">StoryGenerator</code> authoritatively crafts the narrative framework of adventures. By leveraging project information and external configurations, it generates dynamic stories and quests. Integration with the LLM API enables high-quality outputs.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Generates an overarching story and associated quests based on a selected theme and project metadata.  </li>
<li><code class="inline-code">generateQuestContent</code>: Produces detailed quest content tailored to specific code files and adventure context.  </li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Parses LLM responses into structured data containing a story and list of quests.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Adventure Configuration</h3>
<p>This module governs the parsing and validation of <code class="inline-code">adventure.config.json</code>. It ensures file paths and configuration data are accurately extracted and utilized to influence quest generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Loads and parses the adventure configuration file into a structured object.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies and validates all file paths referenced in the configuration.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Converts the configuration into a compact form for efficient use in LLM prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string, 
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This function resets the adventure state and initializes themes and project context.  </li>
<li>Centralizes narrative generation with <code class="inline-code">StoryGenerator</code>, ensuring cohesion between theme, project, and user inputs.  </li>
<li>Uses configuration validation to align quests with <code class="inline-code">adventure.config.json</code>, preventing mismatches.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  const validatedTheme = this.validateTheme(theme);

  const prompt = loadStoryGenerationPrompt({
    theme: validatedTheme,
    repomixContent: projectInfo.repomixContent || &#39;No repomix content available&#39;,
    adventureGuidance: this.projectPath ? formatAdventureConfigForPrompt(this.projectPath) : &#39;&#39;,
    customInstructions: this.projectPath ? extractCustomInstructions(this.projectPath) : &#39;&#39;
  });

  const response = await this.llmClient.generateResponse(prompt, { maxTokens: 2000 });
  const parsed = parseMarkdownToStoryResponse(response.content.trim());
  return StoryResponseSchema.parse(parsed);
}
</code></pre>
<ul>
<li>Utilizes <code class="inline-code">LLMClient</code> to transform project context into a structured story/quest framework.  </li>
<li>Includes configuration-enhanced prompt generation for robust and accurate storytelling.  </li>
<li>Validates LLM responses with <code class="inline-code">StoryResponseSchema</code> to ensure data integrity.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses and validates the adventure configuration into usable JSON.  </li>
<li>Safeguards against corrupted or missing files, ensuring robust workflow continuity.  </li>
<li>Serves as a foundational step for subsequent processing in quest generation.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>File Context</strong>: Use the highlights provided to understand how functions like <code class="inline-code">initializeAdventure</code> and <code class="inline-code">generateStoryAndQuests</code> interact with each other.  </li>
<li><strong>LLM-Powered Systems</strong>: Explore LLM input/output flows to appreciate how prompts influence narrative crafting.  </li>
<li><strong>Configuration Validation</strong>: Ensure <code class="inline-code">adventure.config.json</code> is well-structured to prevent quest generation anomalies.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Repository Adventure Engine.</p>
<p>Congratulations on successfully deploying &#39;Quest 2: The Scrolls of Storycraft&#39;‚Äîyour codebase of knowledge is now 20% compiled, with robust logic and a clean commit history; keep iterating and shipping greatness! ‚ö°üöÄüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>