<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Protocol Sanctum - The MCP Gateway Rites - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'developer' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Code Repository: The Architect's Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Protocol Sanctum - The MCP Gateway Rites</h1>
<hr>
<p>The path forward tantalizes with its ancient, digital undertones. Here stands the MCP Gateway‚Äîan enigmatic bridge between user ambitions and system understanding. It is said that mastering its rites unlocks pathways to protocols, command handling, and the intricate dance of tools. The room is alight with the hum of server connections and the heartbeat of the repository analyzer, daring you to uncover the untold secrets coded within.</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a>: MCP server protocol implementation that hosts the adventure tools</h3>
<p>This file governs the orchestration of the MCP server, drawing together protocols, tools, and error resilience in one cohesive command access hub. It is the foundational entry point for user interaction, delegating the lifeblood of the system‚Äôs tools and quests. The class <code class="inline-code">RepoAdventureServer</code> acts as the bridge between MCP protocols and user intents, scheduling communications via <code class="inline-code">stdio</code> and ensuring the proper setup of handlers. Important functions such as <code class="inline-code">setupHandlers</code> register critical commands like <code class="inline-code">ListTools</code> and <code class="inline-code">CallTool</code>. Meanwhile, <code class="inline-code">run</code> connects the transport layer and primes the system with the requisite <code class="inline-code">repomix</code> context to fuel the adventures. The resilience of this code lies in its entry function, <code class="inline-code">main</code>, with robust mechanisms for handling errors and a clean signal-driven shutdown ensuring that every adventure ends gracefully.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code> ensures the protocol handlers like <code class="inline-code">ListTools</code> and <code class="inline-code">CallTool</code> are initialized, enabling tool communication.</li>
<li><code class="inline-code">RepoAdventureServer.run</code> connects <code class="inline-code">stdio</code> transport, facilitating interaction between the user and the adventure server.</li>
<li><code class="inline-code">main</code> provides a strong foundation for error handling and orchestrated termination, enhancing both reliability and maintainability.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a>: The 4 main MCP tools that provide the user interface to the adventure system</h3>
<p>This file breathes life into the MCP tools, ensuring seamless interaction with the storytelling system. Like a polished compass, it guides users across four pivotal handlers: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. Each of these tools represents a chapter in the user experience. For example, <code class="inline-code">start_adventure.handler</code> bridges the world of repository analysis with splendid adventures by analyzing codebases and presenting theme options. Similarly, <code class="inline-code">explore_quest.handler</code> invites users to dive into specific stories, tracking progress. The methodical arrangement in <code class="inline-code">tools.ts</code> makes it evident how one action inspires the next, achieving a seamless flow of user engagement.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code> initializes repository analysis, launching the journey.</li>
<li><code class="inline-code">choose_theme.handler</code> elegantly connects storytelling preferences with system-generated themes.</li>
<li><code class="inline-code">explore_quest.handler</code> drives execution for specific quests, ensuring smooth progress tracking.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a></h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  setupHandlers(): void {
    this.handlers.set(&#39;ListTools&#39;, this.listToolsHandler);
    this.handlers.set(&#39;CallTool&#39;, this.callToolHandler);
  }

  async run(): Promise&lt;void&gt; {
    await transport.connect();
    console.log(&#39;Server running...&#39;);
    repoAnalyzer.preGenerate(this.repoPath!);
  }
}

(async function main() {
  const server = new RepoAdventureServer();
  try {
    console.log(&#39;Starting server...&#39;);
    await server.run();
  } catch (error) {
    console.error(`Fatal error: ${error.message}`);
  }

  process.on(&#39;SIGINT&#39;, async () =&gt; {
    console.log(&#39;Gracefully shutting down...&#39;);
    await server.shutdown();
  });
})();
</code></pre>
<p>The <code class="inline-code">run</code> method acts as the ignition key for the server&#39;s journey, while <code class="inline-code">main</code> safeguards smooth landings even in stormy conditions.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a></h3>
<pre><code class="language-typescript">export const start_adventure = {
  handler: async () =&gt; {
    const repoInfo = await analyzeRepo();
    const themeOptions = generateThemes();
    console.log(&#39;Repository analyzed. Choose a theme:&#39;, themeOptions);
  },
};

export const explore_quest = {
  handler: async (questId: string) =&gt; {
    const questContent = await fetchQuest(questId);
    console.log(`Exploring quest: ${questId}`);
    console.log(questContent);
  },
};
</code></pre>
<p>The <code class="inline-code">start_adventure.handler</code> feels like opening a door to infinite possibilities, while <code class="inline-code">explore_quest.handler</code> lets users dive headfirst into exploratory storytelling.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Ensure the <code class="inline-code">setupHandlers</code> method includes all relevant <code class="inline-code">MCP</code> protocol commands for comprehensive functionality.</li>
<li>Refine the <code class="inline-code">start_adventure.handler</code> to dynamically filter out irrelevant theme options based on context for improved user focus.</li>
<li>Explore deeper into <code class="inline-code">repoAnalyzer.preGenerate</code> to understand how it primes the adventure stories based on the repository‚Äôs context.</li>
</ul>
<hr>
<p>Congratulations on successfully deploying &quot;Protocol Sanctum - The MCP Gateway Rites&quot; into production; your codebase just hit 20% completion with precision and scalability‚Äîstellar work, onward to the next milestone! üöÄ‚≠êüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Mystic Lens - Analyzing the... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>