<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundation & Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository Chronicles: The Developer's Guide to Modular Code Systems</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundation &amp; Utilities</h1>
<hr>
<p>In the realm of developer workflows, foundational utilities represent the scaffolding that holds the system together. The <code class="inline-code">adventure-config.ts</code> file is a keystone in this architecture, ensuring that configurations are seamlessly loaded, validated, and prepared for further processing. Each function in this module embodies extensibility, leveraging predictable patterns and well-structured operations. By exploring these utilities, you will uncover how robust file handling, data parsing, and configuration reduction are interconnected to optimize workflows.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>File Handling Mastery</strong>: How does <code class="inline-code">readFileIfExists</code> safeguard against missing or unreadable files, and why is this strategy useful for configuration loading?</li>
<li>‚ö° <strong>Configuration Analysis</strong>: How does <code class="inline-code">parseAdventureConfig</code> centralize JSON parsing and validation, and what role does it play in ensuring data integrity?</li>
<li>üõ°Ô∏è <strong>Data Extraction Insights</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> traverse and validate paths in a nested configuration object, and what patterns ensure scalability and error resistance?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Foundation Utilities for Configuration</h3>
<p>This file is dedicated to processing project-specific configurations. It includes functions for reading configuration files, parsing JSON data, and extracting meaningful details from complex structures. With a focus on resilience and adaptability, these utilities minimize failures due to invalid or missing data, ensuring smooth integration with higher-level modules.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">readFileIfExists</code>: Reads a file&#39;s contents if it exists, handling missing or unreadable files gracefully to avoid interrupting the system&#39;s flow. </li>
<li><code class="inline-code">parseAdventureConfig</code>: Converts raw configuration data into a structured object, consolidating all JSON parsing and validation to a single, secure location.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Iterates through a parsed configuration object, extracting valid paths from nested fields while applying thorough validation to ensure correctness.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    // Missing or unreadable file is non-fatal
    return null;
  }
}
</code></pre>
<ul>
<li>Reads the file content only if it exists, returning <code class="inline-code">null</code> if the file is inaccessible.</li>
<li>Uses a <code class="inline-code">try-catch</code> block to gracefully handle errors from <code class="inline-code">fs.readFileSync</code>, preventing uncaught exceptions.</li>
<li>Provides a non-intrusive way to determine if a configuration file is available without disrupting the workflow.</li>
<li>Centralizes low-level file interactions, promoting clean and reusable code.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Loads the raw configuration file content using <code class="inline-code">loadAdventureConfig</code> and handles the case where no file is available.</li>
<li>Parses the content as JSON while managing parsing errors with a <code class="inline-code">try-catch</code> block, ensuring invalid configurations do not crash the system.</li>
<li>Consolidates all JSON handling into a single function, promoting consistency and reducing duplication.</li>
<li>Acts as the main entry point for consuming configuration data in the system.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Iteratively traverses the nested structure of a parsed configuration object using a stack-based approach.</li>
<li>Validates each path field by checking if the resolved file path exists on the file system using <code class="inline-code">fs.existsSync</code>.</li>
<li>Collects unique file paths in a <code class="inline-code">Set</code> data structure to eliminate duplicates efficiently.</li>
<li>Able to handle deeply nested structures and malformed data gracefully, showcasing robust scalability.</li>
<li>Bridges data extracted from configurations with concrete file system checks, ensuring integrity in downstream operations.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Practical Tip</strong>: Review function dependencies to understand the flow of data and the role of helper functions like <code class="inline-code">loadAdventureConfig</code>.</li>
<li><strong>Exploration Recommendation</strong>: Test these functions locally using mock configurations to observe how different scenarios (e.g., missing paths, invalid JSON) are handled.</li>
<li><strong>Next Steps</strong>: Connect the insights gained here to higher-level modules like the <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code> to see how configurations drive content generation.</li>
</ul>
<hr>
<p>You have mastered all the secrets of developer workflow scaffolding! Your adventure is complete.</p>
<p>System.out.println(&quot;Quest 5: Foundation &amp; Utilities successfully deployed‚Äîcore modules architected, utilities optimized, and you&#39;re now 80% compiled toward mastery! üöÄ‚ö°üíé&quot;);</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>