<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Keeper of Configurations - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Realm of Repository Adventures</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Keeper of Configurations</h1>
<hr>
<p>In the heart of Repository Adventures lies the ancient Keeper of Configurations. This guardian oversees the structural integrity of quests, ensuring every file path and configuration is harmonized. To master this domain, you must delve into the elemental code that shapes adventures and learn the intricacies of how configurations feed the realm’s magical engine. Forge ahead, adventurer, and uncover the secrets to configuring stories that transcend time and space.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>🧭 <strong>Pathfinder Logic</strong>: How does the <code class="inline-code">extractUniqueFilePaths</code> function validate and collect paths in a system where configurations can wander into the unknown?</li>
<li>🧪 <strong>Parsing Secrets</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure JSON configurations are parsed safely without causing runtime errors?</li>
<li>✨ <strong>Legend Compression</strong>: What optimizations are used in <code class="inline-code">formatAdventureConfigForPrompt</code> to reduce complexity while preserving essential data?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Management</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file defines the backbone for managing, validating, and extracting adventure-related configurations. From loading raw JSON files to parsing and condensing their content for large language model interactions, each function plays a critical role in ensuring adventures are accurately represented and efficiently stored. The code highlights illustrate various approaches to file reading, error handling, JSON parsing, and formatting. These methods allow developers to seamlessly process configurations while maintaining integrity and usability.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: This function loads raw configuration data from disk, ensuring the file exists without parsing, which defers validation to later steps.</li>
<li><code class="inline-code">parseAdventureConfig</code>: A critical entry-point for decoding and validating JSON content, it guarantees safe parsing without catastrophic failures caused by malformed structures.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Iteratively explores configuration objects to extract unique file paths, ensuring referenced files exist in a project context.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses configurations into minimal formats optimized for LLM prompts while maintaining key structural details.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This function loads the raw text of a configuration file from a given project path.</li>
<li>It avoids parsing the contents, making it suitable for initial input validation.</li>
<li>File existence is delegated to a helper function, <code class="inline-code">readFileIfExists</code>.</li>
<li>It supports fail-safe operation; missing files result in a harmless <code class="inline-code">null</code> return.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Decodes raw JSON data into an object and gracefully handles parse errors, preventing runtime crashes.</li>
<li>Uses <code class="inline-code">try</code>/<code class="inline-code">catch</code> to safeguard against malformed JSON structures.</li>
<li>Functions without valid input return <code class="inline-code">null</code> to denote non-critical errors.</li>
<li>Provides centralized parsing logic for adventure configuration files.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Iteratively traverses the adventure configuration tree to locate and validate file paths.</li>
<li>Prevents duplicates using a <code class="inline-code">Set</code> for unique entries.</li>
<li>Incorporates robust validation to ensure all referenced paths exist in the filesystem.</li>
<li>Utilizes a stack-based traversal to handle nested and array-based objects, accommodating flexible structures.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Optimizes adventure configurations for large language model (LLM) prompts by reducing verbose content.</li>
<li>Extracts only essential elements like file paths and function names to preserve clarity and relevance.</li>
<li>Implements flexible structured formatting for diverse quest configurations.</li>
<li>Achieves substantial input reduction (~72%) for efficient LLM processing.</li>
</ul>
<h2>Helpful Hints</h2>
<ul>
<li>Ensure the <code class="inline-code">adventure.config.json</code> file follows the correct schema to avoid errors during parsing and extraction steps.</li>
<li>Explore output from <code class="inline-code">formatAdventureConfigForPrompt</code> to identify key patterns in how configurations are condensed.</li>
<li>Investigate the traversal logic in <code class="inline-code">extractUniqueFilePaths</code> to understand how nested paths are handled.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Repository Adventures! Your journey through the Keeper of Configurations has unlocked harmony between structure and function. The realm of code and config stands ready for your command.</p>
<p>Congratulations on successfully refactoring your configuration management skills and deploying Quest 5 with precision—you&#39;re 80% through the development roadmap and debugging greatness, keep pushing towards the final milestone! 🚀💎⚡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">← Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>