<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Configuration & Theme System - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-developer">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Codebase Chronicles: Mastering the Repository Realms</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Configuration &amp; Theme System</h1>
<hr>
<p>The final challenge is here, where our journey through the automated adventure-building system takes us deep into the engine of customization and user engagement: the configuration and theme modules. These components form the backbone of adaptability in the system, enabling developers to tailor adventures through flexible settings and rich thematic options. Understanding how configuration values are accessed, validated, and applied to themes will illuminate the path to mastering this powerful platform.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configuration Analysis</strong>: How does the system define and manage environment-based constants for integrations like LLM or GitHub?</li>
<li>‚ö° <strong>Theme Logic Discovery</strong>: In what ways are themes validated, parsed, and retrieved to ensure a consistent user experience?</li>
<li>üõ°Ô∏è <strong>Validation Mechanisms</strong>: How does the system safeguard against invalid or unsafe user inputs for themes and other configurable values?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Centralized configuration handling for external integrations and application settings</h3>
<p>This file is the hub for managing constants and environment-based variables used across the adventure-building system. It contains values for API integrations, timeout settings, and limits for file and token processing, ensuring all components adhere to standardized configurations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Defines timeout for LLM requests to handle long-running operations gracefully.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Sets the cache duration for storing Repomix data, balancing performance and memory use.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Restricts maximum file size for analysis, protecting against memory overflow in large repositories.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Central repository for theme definitions and utilities</h3>
<p>This file houses the definitions, structure, and logic for managing themes. Themes are treated as first-class citizens, each described with metadata such as keywords and display names, and utilities are provided to ensure themes are correctly validated and parsed.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: A constant storing all predefined themes, serving as the source for validation and retrieval.</li>
<li><code class="inline-code">getAllThemes</code>: A helper function that retrieves all available themes in a straightforward manner.</li>
<li><code class="inline-code">parseTheme</code>: Attempts to match a user‚Äôs input to a theme through ID, key, or keyword association.</li>
</ul>
<h3><span class="header-prefix">packages/generator/src/cli/theme-manager.ts:</span> Theme management utilities for CSS generation and custom assets</h3>
<p>This file provides methods for managing dynamic theme application, ensuring the right CSS, icons, and assets are consolidated for the user&#39;s chosen theme.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">ThemeManager.generateThemeCSS</code>: Combines multiple CSS files into a single theme-specific style for the output.</li>
<li><code class="inline-code">ThemeManager.getThemeIcons</code>: Matches thematic icons to enhance the visual identity within a theme.</li>
<li><code class="inline-code">ThemeManager.isLightTheme</code>: Determines whether a theme uses a light background, ensuring proper color contrast for icons.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = parseInt(process.env.LLM_REQUEST_TIMEOUT || &#39;60000&#39;); // 60 seconds for complex story generation with large prompts, configurable via env
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li>This code establishes key configuration values for LLM requests, caching, and file size limits.</li>
<li>The use of <code class="inline-code">process.env</code> ensures that values can be overridden in different environments, promoting flexibility.</li>
<li>These constants provide safety limits, preventing resource exhaustion during API calls or file analysis.</li>
<li>By centralizing configurations, these values can be reused across the system for consistent behavior.</li>
</ul>
<hr>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: { id: 1, key: &#39;space&#39;, displayName: &#39;Space Exploration&#39;, emoji: &#39;üöÄ&#39;, description: &#39;Journey through cosmic codebases...&#39;, keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;] },
  MYTHICAL: { id: 2, key: &#39;mythical&#39;, displayName: &#39;Enchanted Kingdom&#39;, emoji: &#39;üè∞&#39;, description: &#39;Explore magical and mythical realms...&#39;, keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;castle&#39;] },
  ANCIENT: { id: 3, key: &#39;ancient&#39;, displayName: &#39;Ancient Civilization&#39;, emoji: &#39;üè∫&#39;, description: &#39;Discover lost temples of code...&#39;, keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;] },
  DEVELOPER: { id: 4, key: &#39;developer&#39;, displayName: &#39;Developer Documentation&#39;, emoji: &#39;üìñ&#39;, description: &#39;Technical documentation approach...&#39;, keywords: [&#39;developer&#39;, &#39;code&#39;, &#39;technical&#39;] }
};
</code></pre>
<ul>
<li>Each theme is defined with a unique ID, key, emoji, and keywords for easy identification and user matching.</li>
<li>The <code class="inline-code">keywords</code> array allows for flexible user input parsing, catering to variations in naming styles.</li>
<li>By storing themes in a constant, the file acts as the single source of truth for theme data across the system.</li>
<li>This approach simplifies updates to theme metadata, ensuring consistency everywhere themes are used.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>This function normalizes and matches user input against theme IDs, keys, or keywords to return a valid theme.</li>
<li>Numeric and string-based matching ensure robust handling of varying input formats.</li>
<li>By iterating over <code class="inline-code">THEMES_ARRAY</code>, it supports keyword-based partial matching for user-friendly input handling.</li>
</ul>
<hr>
<h3>packages/generator/src/cli/theme-manager.ts</h3>
<pre><code class="language-typescript">public generateThemeCSS(theme: AdventureTheme, outputDir: string): void {
  const cssFiles = [
    path.join(this.themesDir, &#39;base.css&#39;),
    path.join(this.themesDir, &#39;homepage.css&#39;), 
    path.join(this.themesDir, &#39;animations.css&#39;),
    path.join(this.themesDir, `${theme}.css`)
  ];
  
  let combinedCSS = &#39;&#39;;
  
  cssFiles.forEach(cssFile =&gt; {
    if (fs.existsSync(cssFile)) {
      combinedCSS += fs.readFileSync(cssFile, &#39;utf8&#39;) + &#39;\\n\\n&#39;;
    }
  });
  
  const cssPath = path.join(outputDir, &#39;assets&#39;, &#39;theme.css&#39;);
  fs.writeFileSync(cssPath, combinedCSS);
}
</code></pre>
<ul>
<li>This method combines multiple CSS files for a selected theme into a unified file for rendering.</li>
<li>The use of <code class="inline-code">fs.existsSync</code> ensures only available files are included, avoiding runtime errors.</li>
<li>Outputs are written to a defined <code class="inline-code">outputDir</code>, centralizing assets for easy retrieval.</li>
<li>Streamlined handling of theme-specific styles enables flexibility in visual customization.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Review <code class="inline-code">config.ts</code> for environment-driven configurations and how defaults are applied when variables are missing.</li>
<li>Analyze <code class="inline-code">theme.ts</code> to understand how themes are structured, validated, and parsed for integration into the system.</li>
<li>Experiment with <code class="inline-code">theme-manager.ts</code> to observe how CSS files adapt dynamically based on the selected theme.</li>
</ul>
<hr>
<p>You have mastered all the secrets of this automated adventure-building system! Your adventure is complete.</p>
<p>üéâ You&#39;ve successfully debugged and deployed Quest 5: Configuration &amp; Theme System‚Äîyour codebase evolution is now at 80%, propelling you closer to the final milestone with precision and mastery! üöÄüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>