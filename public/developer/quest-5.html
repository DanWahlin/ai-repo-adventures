<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Glyphs of Configuration - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Computational Adventures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Glyphs of Configuration</h1>
<hr>
<p>In the grand halls of the <strong>Codex of Computational Adventures</strong>, whispers speak of a final trial that tests a developer‚Äôs mastery over the deepest structures of their projects. To overcome this trial, one must decipher the enigmatic <strong>Glyphs of Configuration</strong>. These glyphs, ancient scripts encoded within the project files, influence the realms of adventure generation and customization. Only those who can unveil their secrets will triumph in restoring balance to the digital kingdom.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Config Extraction Ritual</strong>: How does the system retrieve and validate unique file paths referenced within the adventure configuration?</li>
<li>‚ö° <strong>Formatting Glyphs</strong>: In what ways does <code class="inline-code">formatAdventureConfigForPrompt</code> optimize configuration data for generative engines and how does this make adventure prompts compact yet functional?</li>
<li>üõ°Ô∏è <strong>Error Safeguards</strong>: What error-handling techniques ensure stability when reading/parsing invalid or missing files?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Utilities</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file serves as the foundational framework for managing, parsing, and interpreting configuration data relevant to the adventure generation engine. It provides utilities for reading configuration files, extracting meaningful paths for actionable processing, and formatting content for lightweight optimization in generative prompt mechanisms. By centralizing these operations, it ensures robust handling of configuration data and meaningful integration with other components like the story generator and validators.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">readFileIfExists</code>: Attempts to read a file from the filesystem; ensures non-fatal behavior for missing or inaccessible files.</li>
<li><code class="inline-code">loadAdventureConfig</code>: Reads raw config file content for further processing; acts as a base layer to retrieve plain text.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Parses raw JSON content from the configuration file; validates data and forms the central interface for accessing configuration objects.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts and validates file paths mentioned within the configuration; ensures references are accurate and resolve correctly in the filesystem.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Prepares configuration data for generative AI prompts; reduces verbosity while retaining the functional essence of the adventure structure.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    // Missing or unreadable file is non-fatal
    return null;
  }
}
</code></pre>
<ul>
<li>Reads the content of a file if it exists, returning <code class="inline-code">null</code> if the file cannot be read.</li>
<li>Provides stability by handling missing file errors gracefully without terminating the application.</li>
<li>Embodies a core fail-safe mechanism crucial for exploratory systems reliant on external inputs.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Combines <code class="inline-code">readFileIfExists</code> with a predefined configuration file path (<code class="inline-code">ADVENTURE_CONFIG_FILE</code>) to streamline retrieval.</li>
<li>Acts as the preliminary step to expose raw configuration data in a reusable manner.</li>
<li>Ensures simplicity and reusability before engaging advanced parsing logic.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Takes raw config content from <code class="inline-code">loadAdventureConfig</code> and validates it via JSON parsing.</li>
<li>Returns <code class="inline-code">null</code> on parsing errors, providing an additional error safety layer for malformed files.</li>
<li>Opens the configuration object for further operations without compromising system integrity.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses deeply nested configuration objects to extract all valid file paths referenced within.</li>
<li>Uses a <code class="inline-code">Set</code> to ensure uniqueness of paths while confirming existence in the filesystem.</li>
<li>Handles recursive exploration safely, accommodating varied structural configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts parsed configuration data into a compact and generative-friendly format for AI engines.</li>
<li>Strips redundant descriptions while preserving essential structure for quest generation.</li>
<li>Optimizes for generative contexts by emphasizing functionality over verbosity for reduced token usage.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Review recursive exploration techniques in <code class="inline-code">extractUniqueFilePaths</code> to understand safe traversal patterns.</li>
<li>Study validation approaches in <code class="inline-code">parseAdventureConfig</code> to learn effective ways of handling malformed files.</li>
<li>Use <code class="inline-code">formatAdventureConfigForPrompt</code> as a reference for data optimization techniques in token-limited environments.</li>
</ul>
<hr>
<p>You have mastered all the secrets of configuration and the Codex of Computational Adventures! Your adventure is complete.</p>
<p>With Quest 5: The Glyphs of Configuration successfully debugged and deployed to your knowledge repository, your progress toward this epic development roadmap is a shining example of optimized persistence‚Äîkeep refactoring greatness! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>