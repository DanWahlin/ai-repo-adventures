<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Configuration Crucible - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Intelligent Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Configuration Crucible</h1>
<hr>
<p>In the labyrinth of digital knowledge, configurations are the arcane spells that bind systems together and breathe life into innovation. &quot;Quest 5: The Configuration Crucible&quot; challenges adventurers to delve into the subtle mechanics of an adventure configuration system. Hidden within its interplay of files and paths, the true power to shape the narrative lies. Your journey will reveal the foundational elements that orchestrate the loading, parsing, and transformation of configuration data into actionable insights.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Decoding the Load Mechanism</strong>: How is raw configuration data loaded from files, and what safeguards exist for missing or unreadable files?</li>
<li>‚ö° <strong>Parsing Paradigm</strong>: What happens during the configuration parsing process, and how does the system handle errors or invalid data structures?</li>
<li>üõ°Ô∏è <strong>Path Explorer</strong>: How does the system validate, extract, and ensure the uniqueness of file paths from the configuration?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Configuration Utilities</h3>
<p>This file serves as the cornerstone for managing and interpreting adventure configurations. It provides utilities to read raw data, parse it into structured objects, and extract meaningful entities such as file paths. The code is modular and error-tolerant, ensuring robustness against malformed or absent configuration files. </p>
<p>Key highlights include:</p>
<ul>
<li><code class="inline-code">loadAdventureConfig</code> handles reading raw configuration data from disk. It wraps the file system interaction with safeguards against missing files.</li>
<li><code class="inline-code">parseAdventureConfig</code> is the central hub for parsing and validation. It processes the loaded configuration and ensures recovery from JSON parsing errors.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> dives deep into the configuration object, systematically exploring nested structures to collect valid file paths, ensuring no duplication.</li>
</ul>
<h4>Highlights</h4>
<ul>
<li>File read mechanism with <code class="inline-code">loadAdventureConfig</code>.</li>
<li>Configuration parsing logic with <code class="inline-code">parseAdventureConfig</code>.</li>
<li>Validated path extraction with <code class="inline-code">extractUniqueFilePaths</code>.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<p>Like retrieving a sealed letter from a cavern, this function cautiously retrieves raw data without opening it.</p>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Imagine decoding a secret message ‚Äî this step processes the raw data into a meaningful structure, discarding it if unreadable.</p>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>As if using a treasure map, this code traverses the parsed configuration to identify and collect only valid paths.</p>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Error Handling Emphasis</strong>: Pay close attention to how file reading and parsing gracefully recover from errors.</li>
<li><strong>Breadth-First Traversal Tip</strong>: Focus on how the stack structure enables systematic exploration of nested objects during path extraction.</li>
<li><strong>Testing Suggestion</strong>: Simulate scenarios with missing fields, malformed JSON, or empty configurations to observe the robustness of the implementation.</li>
</ul>
<hr>
<p>The crucible has tested your mettle, and now these once-opaque processes are illuminated. Press forward, brave adventurer!</p>
<p>You‚Äôve successfully deployed your changes to the Configuration Crucible repository with precision‚Äînext stop, Quest 5 refactor mastery! ‚≠êüöÄüëÅÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>