<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Architect‚Äôs Scroll - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Digital Journeys</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Architect&#39;s Scroll</h1>
<hr>
<p>In the digital labyrinth where quests forge paths through vast systems, the Architect‚Äôs Scroll emerges as the ultimate challenge. This quest takes adventurers into the deepest vaults of the repository, where foundational configurations interweave to power the grand journey generator. The Architect‚Äôs Scroll houses the secrets of validation, file parsing, and preparing optimized content for adventurer tools. Brave the mysteries of foundational code and unlock the final scroll to complete your adventure.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Scroll Analysis</strong>: How are configuration files read, validated, and safely parsed within the system?</li>
<li>‚ö° <strong>Pathfinding Mechanics</strong>: How does the code extract and confirm file paths needed for adventures?</li>
<li>üõ°Ô∏è <strong>Prompt Optimization</strong>: What techniques are used to streamline adventure config formatting for efficient transmission?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Adventure Config Management</h3>
<p>This file is the cornerstone of the adventure generation system, responsible for reading, validating, and leveraging the JSON-based configuration file (<code class="inline-code">adventure.config.json</code>). It plays a key role in parsing the adventure structure, extracting referenced file paths, and creating optimized string outputs for the system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads the adventure configuration JSON file as a raw string if it exists, with robust error handling to prevent crashes on missing or inaccessible files.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the adventure configuration file to discover unique file paths referenced by key nodes, ensuring those files exist before inclusion.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Transforms the full adventure configuration into a minimal, optimized format for use in LLM prompts, removing redundancy while retaining critical data.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This function takes a <code class="inline-code">projectPath</code>, combines it with the adventure config file name, and attempts to read its contents as a string.</li>
<li>Error handling ensures that a missing or unreadable file does not disrupt the execution flow.</li>
<li>Encourages separation of concerns, as it handles only file reading, leaving parsing to other functions.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses the parsed adventure config JSON to collect all unique file paths listed under <code class="inline-code">path</code> properties.</li>
<li>Validates each file path to ensure it exists within the given <code class="inline-code">projectPath</code>, adding only valid paths to the <code class="inline-code">Set</code>.</li>
<li>Utilizes a stack-based depth-first search (DFS) approach to handle even deeply nested structures within the config.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Simplifies the adventure configuration into a concise format suitable for prompt generation, focusing on file paths and function names rather than verbose descriptions.</li>
<li>Focuses on brevity and structure, ensuring the data remains useful while reducing its complexity.</li>
<li>This optimization ensures LLMs can better process the configuration with fewer characters.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">loadAdventureConfig</code> to understand the file-loading logic and its role in error-tolerant design.</li>
<li>Study the traversal technique in <code class="inline-code">extractUniqueFilePaths</code> to learn how to navigate and validate nested data structures.</li>
<li>Explore <code class="inline-code">formatAdventureConfigForPrompt</code> to see an example of data reduction and transformation for external systems.</li>
</ul>
<hr>
<p>You have mastered all the secrets of this repository! Your adventure is complete.</p>
<p>Congratulations on successfully deploying Quest 5: The Architect‚Äôs Scroll‚Äîyour algorithmic precision and mastery of design patterns have pushed the project lifecycle to 80% completion; keep iterating towards the final milestone! üöÄüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>