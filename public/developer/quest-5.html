<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundation & Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Repository Chronicles: Developer's Blueprint</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundation &amp; Utilities</h1>
<hr>
<p>At the core of every robust adventure lies a well-structured foundation of utility functions, ensuring seamless data flow and efficient operations. This quest delves deep into the utility functions located in <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>, unveiling the essential mechanisms that underpin the configuration and customization of interactive adventures. By exploring these methods, you will uncover how configurations are parsed, files are validated, and content is formatted for enhanced system functionality. Equip yourself with these tools as you uncover the pivotal role of foundational utilities.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Validation Matrix</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure only valid configurations are processed, and what edge cases does it handle?</li>
<li>‚ö° <strong>Pathfinder Protocol</strong>: In <code class="inline-code">extractUniqueFilePaths</code>, how does the function efficiently process deeply nested structures to locate valid file references?</li>
<li>üõ°Ô∏è <strong>Optimization Engine</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> transform data for LLM prompts, and what design choices optimize its output?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Utility Functions for Adventure Config Management</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file comprises core functions that handle configuration processing and utility services for the adventure generation system. These utilities are integral to loading raw configuration data, validating it, and optimizing the format for downstream processing. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Safely reads and parses a given adventure configuration file from raw JSON, ensuring invalid or non-existent configurations are gracefully handled.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses nested configuration structures to extract and validate all unique file paths referenced in adventure settings.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the adventure configuration by reducing verbosity and formatting the data for efficient consumption in LLM prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Provides a centralized mechanism for parsing configuration files.</li>
<li>Uses <code class="inline-code">loadAdventureConfig</code> to fetch the raw JSON data, separating file I/O from data parsing.</li>
<li>Gracefully handles invalid JSON with a try-catch block, ensuring no uncaught exceptions.</li>
<li>Returns <code class="inline-code">null</code> on error or absence of data, maintaining safety and robustness in data processing.</li>
<li>Integral to subsequent functions relying on parsed adventure configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses deeply nested objects in the parsed configuration to locate all <code class="inline-code">&quot;path&quot;</code> fields.</li>
<li>Ensures each path is unique by using a <code class="inline-code">Set</code> to store results.</li>
<li>Validates paths against the file system to exclude non-existent files, ensuring accurate results.</li>
<li>Implements a stack-based depth-first search (DFS) algorithm for efficient traversal.</li>
<li>Supports diverse configuration structures by dynamically handling arrays and plain objects.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Transforms the full configuration into a concise, structured format for language model prompts.</li>
<li>Strips verbose descriptions to reduce token count, focusing on essentials like file paths and function names.</li>
<li>Dynamically accommodates the presence of multiple quests and file configurations.</li>
<li>Provides a clear, hierarchical organization of data using headings and bullet points.</li>
<li>Optimizes data representation for LLM input, balancing readability and efficiency.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">parseAdventureConfig</code> as a template for safely reading and validating JSON inputs in other utilities.</li>
<li>Leverage <code class="inline-code">extractUniqueFilePaths</code> when analyzing or processing file dependencies within nested configurations.</li>
<li>Adapt the approach in <code class="inline-code">formatAdventureConfigForPrompt</code> to streamline data output in other contexts where efficiency matters.</li>
</ul>
<hr>
<p>You have mastered all the secrets of this interactive code repository! Your adventure is complete.</p>
<p>You&#39;ve successfully refactored your skillset in Quest 5: Foundation &amp; Utilities‚Äîyou&#39;re just one commit away from merging the full stack of triumph into your developer journey! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>