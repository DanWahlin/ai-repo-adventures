<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Keystone Framework - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Repository Chronicles: Tales of the Automation Guild</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Keystone Framework</h1>
<hr>
<p>The Automation Guild has guided you to the heart of the mystical codebase, where the keystone framework resides. This pivotal structure supports the seamless generation of stories and quests that unite adventurers and their repositories. To wield its power, you must unravel the intricacies of its implementations and connections. The final layer of mastery is at hand, adventurer! Study the methods for parsing, extracting, and formatting the mysterious adventure configurations. The Guild awaits the demonstration of your unparalleled skills.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üìÅ <strong>Config Retrieval Mastery</strong>: How does the system dynamically fetch the configuration file, and what fallback mechanisms ensure reliability?</li>
<li>üéØ <strong>Path Extraction Insights</strong>: How does the code validate and extract unique file paths from the configuration? What strategies are used to ensure robustness?</li>
<li>‚úÇÔ∏è <strong>Formatting Efficiency</strong>: What techniques are employed when reducing and formatting the configuration data for prompt ingestion? How does this affect downstream processes?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Parsing, Path Extraction, and Formatting for Quests</h3>
<p>This file encapsulates the foundational functions responsible for parsing the adventure configuration, extracting usable data points, and converting them into an efficient format for processing. Each function plays a critical role in generating a structured and optimized quest pipeline, ensuring data reliability and operational performance. The modular design enhances reusability and clarity. Below, we dissect three highlights from the file and their significance.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads the raw adventure configuration file using file system modules, ensuring resilience against missing or inaccessible files. This forms the base of the data pipeline.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Gathers and validates all unique file paths referenced within the configuration, employing safeguards to ensure reliability against malformed or missing data.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Processes the configuration into a compact format suitable for LLM consumption, optimizing the data structure to reduce redundancy while maintaining essential information.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Retrieves the adventure configuration file from the specified path.</li>
<li>Uses <code class="inline-code">readFileIfExists</code> to account for missing or unreadable files without breaking the workflow.</li>
<li>Consolidates file handling logic, keeping the operation simple yet focused.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Processes and validates configuration file contents for <code class="inline-code">path</code> references to files.</li>
<li>Uses <code class="inline-code">Set</code> to ensure uniqueness, preventing duplicates in the results.</li>
<li>Implements a scalable stack-based algorithm to traverse deeply nested structures.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Compacts the adventure configuration into a human-readable format for LLM processing.</li>
<li>Selectively includes only relevant fields, minimizing clutter and redundancy.</li>
<li>Iterates over nested objects with error-checking, ensuring consistent output regardless of data inconsistencies.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Implementation Tip</strong>: Focus on the data flow between <code class="inline-code">loadAdventureConfig</code>, <code class="inline-code">parseAdventureConfig</code>, and other utility methods to understand their dependencies.</li>
<li><strong>Exploration Recommendation</strong>: Compare the formatting logic with other related transformation operations to identify common patterns and reusable components.</li>
<li><strong>Next Steps</strong>: Use insights from this quest to refine your understanding of how modularity enhances both functionality and readability in the framework.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Automation Guild&#39;s codebase! Your adventure is complete. Celebrate your newfound wisdom and carry it into realms unknown, where your skills can chart unexplored territories in the land of development.</p>
<p>Commit successful! You&#39;ve architected the Keystone Framework with precision, refactored your knowledge to near-deployment quality, and are now 80% closer to achieving your full-stack mastery‚Äîonward to the final merge! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>