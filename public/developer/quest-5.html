<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundation & Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository Chronicles: Crafting a Dynamic Adventure Framework</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundation &amp; Utilities</h1>
<hr>
<p>For this final venture, we will descend into the critical utilities that underpin the adventure generation engine. These foundational pieces are responsible for configuration management, file path processing, and formatting raw data for higher-level components. Understanding how these utilities operate is essential to ensuring seamless integration and clean handoffs between components. This section, centered on <code class="inline-code">adventure-config.ts</code>, provides the structural scaffolding that allows the overall architecture to function efficiently.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Config Parser Insights</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function ensure robust JSON parsing and error resilience?</li>
<li>‚ö° <strong>Path Navigation</strong>: What techniques does <code class="inline-code">extractUniqueFilePaths</code> use to handle recursive path extraction, and how does it validate these paths?</li>
<li>üõ°Ô∏è <strong>Format Optimizations</strong>: How does the <code class="inline-code">formatAdventureConfigForPrompt</code> function consolidate data for large language model (LLM) optimization?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Core Config Management</h3>
<p>This module is the backbone of configuration handling, ensuring that essential data flows correctly throughout the system. It provides utility functions to load, parse, format, and traverse adventure configuration files. These utilities play a significant role in preparing structured inputs for upstream functions, ensuring both reliability and efficiency.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: This function processes raw configuration files, performing JSON parsing while managing potential errors gracefully. It serves as a single validation point.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: A recursive file path extractor that validates paths using the filesystem. This ensures that only existing and deduplicated paths are returned.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes configuration data for LLM prompts by stripping redundant details and compressing content into a concise format.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses raw JSON safely while handling missing or malformed files.</li>
<li>Serves as a gatekeeper function for consuming configuration data downstream.</li>
<li>Demonstrates simplicity in design by offloading file loading to another function.</li>
<li>Establishes a fallback mechanism, ensuring system stability even if the config is invalid.</li>
<li>Exemplifies the single responsibility principle and tight modularity.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Recursively traverses configuration objects to extract all valid file paths.</li>
<li>Uses depth-first traversal to inspect nested structures, enabling flexibility in config schemas.</li>
<li>Employs <code class="inline-code">Set</code> for efficient deduplication of paths.</li>
<li>Ensures paths exist using <code class="inline-code">fs.existsSync</code>, reducing the chance of runtime errors when files are accessed.</li>
<li>Aligns with the principle of defensive programming by validating inputs comprehensively.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Condenses complex adventure configuration data into an LLM-friendly format.</li>
<li>Focuses on extracting titles, file paths, and function names from the configuration.</li>
<li>Skips verbose metadata, resulting in optimized and compact outputs.</li>
<li>Ensures scalability by iterating dynamically over quests and their components.</li>
<li>Simplifies downstream LLM interactions, reducing redundancy and data bloat.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When exploring the code, pay attention to how <code class="inline-code">try-catch</code> blocks are used to handle resilience in file and JSON operations.</li>
<li>Consider using this module as a reference for handling nested data structures and validating user-configured inputs.</li>
<li>For future expansions, think about how additional metadata fields like tags or descriptions might be incorporated into the <code class="inline-code">extractUniqueFilePaths</code> function.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the adventure generation engine! Your adventure is complete.</p>
<p>You&#39;ve successfully debugged Quest 5: Foundation &amp; Utilities, refactoring your skillset and pushing your developer progress to an impressive 80%‚Äîkeep optimizing toward the final deployment! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>