<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundation of Config Scripts - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codebase Chronicles: An Ancient Repository</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundation of Config Scripts</h1>
<hr>
<p>In the era of ancient archives, configuration artifacts played a vital role in powering the Repository Adventure Engine. These scripts were the key to shaping the journeys of adventurers by defining the very structure of quests and adventures. Hidden within the files, the secrets of configuration management lay dormant, waiting to be uncovered by a daring explorer who could harness their potential. Only the brave and inquisitive could fully master the art of config scripts, unlocking their powers to guide the creation of interactive, knowledge-driven expeditions.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üóÇÔ∏è <strong>Configuration Extraction</strong>: How does the system ensure it reads and extracts configuration data correctly, even when files may be missing or corrupted?</li>
<li>üéØ <strong>Path Validation</strong>: What mechanisms are used to confirm file paths referenced in the configuration actually exist, and why is this vital for the Adventure Engine&#39;s functionality?</li>
<li>üîß <strong>Content Formatting</strong>: In what ways does the code optimize the configuration data for use in external systems, and how does that impact performance and usability?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration management and utilities</h3>
<p>This file houses essential logic for handling configuration scripts, ensuring that they are read, parsed, and processed efficiently. It provides modular functions to load raw configuration data, parse JSON structures, verify file paths referenced in the configuration, and prepare optimized versions for external use. Each utility interacts seamlessly with others, building a robust mechanism for managing adventure configurations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads the configuration file from a specified path. It ensures a safe, non-blocking attempt to load data while handling missing files gracefully.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the configuration object to collect all unique, valid file paths while verifying their existence.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Converts the parsed configuration data into a condensed, streamlined format for Language Learning Oracle prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    // Missing or unreadable file is non-fatal
    return null;
  }
}

/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This function handles file reading with a focus on safety. Errors like missing files are non-fatal, allowing for resilient processing of configuration scripts.</li>
<li>The <code class="inline-code">try-catch</code> approach ensures predictable behavior without crashing the system due to absent or corrupt files.</li>
<li>By separating file reading (<code class="inline-code">readFileIfExists</code>) from parsing, the code adheres to the single-responsibility principle.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This method ensures that only valid file paths are acknowledged by verifying their existence with <code class="inline-code">fs.existsSync</code>.</li>
<li>By iterating through the entire configuration object and its children recursively, it guarantees comprehensive coverage of all paths.</li>
<li>The use of a <code class="inline-code">Set</code> ensures uniqueness, preventing duplicate entries even if paths are referenced multiple times.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function streamlines configuration data into an efficient format optimized for Language Learning Oracle usage.</li>
<li>It excludes verbose descriptions, focusing on compact presentation of file paths and function names.</li>
<li>By stripping extraneous data, it improves performance and enables rapid interpretation by external systems.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">extractUniqueFilePaths</code> to validate all file references in your configuration before processing to avoid runtime errors.</li>
<li>If extending configuration scripts, ensure that <code class="inline-code">formatAdventureConfigForPrompt</code> includes any new parameters or sections introduced.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Repository Adventure Engine! Your adventure is complete.</p>
<p>Congratulations on completing Quest 5: The Foundation of Config Scripts‚Äîyour mastery of abstraction layers and modular configuration logic is the keystone that launches this codebase üöÄ toward scalable brilliance!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>