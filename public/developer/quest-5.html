<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundations of Adventure Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Repository Chronicles: A Tale of Code and Quests</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundations of Adventure Utilities</h1>
<hr>
<p>In the heart of the Repository, a forgotten yet vital chamber holds the utilities that fortify all adventures: the legends of file parsing, configuration extraction, and streamlined formatting. These foundations ensure every new saga stands on robust ground. As you step into this final challenge, the paths to mastery lead through tools that validate and illuminate core configurations. To wield these utilities is to command clarity from chaos, structure from fragments, and power from simplicity. The Repository awaits your culminating wisdom.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Config Locator&#39;s Trace</strong>: How does <code class="inline-code">parseAdventureConfig</code> handle JSON parsing, and what mechanisms are in place for error handling?  </li>
<li>‚ö° <strong>Pathweaver&#39;s Discovery</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> traverse and validate paths in a JSON config structure?  </li>
<li>üõ°Ô∏è <strong>Formatter&#39;s Precision</strong>: What strategies are used in <code class="inline-code">formatAdventureConfigForPrompt</code> to optimize configuration data for LLM-friendly outputs?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Utility Core for Adventure Configuration</h3>
<p>The file <code class="inline-code">adventure-config.ts</code> encapsulates the core utilities for processing configuration files used in the Adventure Generator system. These functions provide the critical operations required to read, validate, extract, and format data from adventure configurations, ensuring seamless integration with other components.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> parses raw configuration JSON data into JavaScript objects. It centralizes error handling for malformed or missing files, making it a critical safety mechanism.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> inspects the JSON configuration recursively to gather and validate file paths while filtering out duplicates. This ensures accuracy and efficiency in utility file operations.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> optimizes the adventure configuration, reducing verbosity for LLM consumption while retaining essential quests, paths, and functions.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This code reads the configuration file and attempts to parse it as JSON.  </li>
<li>Error handling is straightforward: parsing failures return <code class="inline-code">null</code>, ensuring the system avoids hard crashes.  </li>
<li>By centralizing JSON parsing through this function, the code promotes reusable and maintainable practices.  </li>
<li>It relies on a clean separation of concerns by delegating file loading to <code class="inline-code">loadAdventureConfig</code>.  </li>
<li>This approach balances simplicity and safety, ensuring robust operation even with incomplete data.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function recursively traverses a parsed configuration object to identify and validate file paths.  </li>
<li>By using <code class="inline-code">Set</code> for uniqueness, it avoids duplicate entries while maintaining performance.  </li>
<li>The function demonstrates a depth-first traversal strategy to ensure thorough inspection of nested structures.  </li>
<li>File validation via <code class="inline-code">fs.existsSync</code> ensures only existing paths are returned, increasing reliability.  </li>
<li>The design supports modularity, as it builds on the output of <code class="inline-code">parseAdventureConfig</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>The function simplifies and compresses JSON configuration data into a shorter, task-oriented format for LLM compatibility.  </li>
<li>It explicitly avoids verbose descriptions, relying on the LLM‚Äôs context inference capabilities.  </li>
<li>This function traverses nested arrays of quests and files to extract paths and function names in organized sections.  </li>
<li>The output format ensures efficient communication of structure and content, reducing overhead for downstream processes.  </li>
<li>Its design integrates tightly with <code class="inline-code">parseAdventureConfig</code>, showcasing a high degree of modular reuse.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Always validate JSON data using <code class="inline-code">parseAdventureConfig</code> to prevent unexpected runtime errors.  </li>
<li>Use <code class="inline-code">extractUniqueFilePaths</code> to maintain clarity and confidence in file path management across adventures.  </li>
<li>Optimize configuration data for external tools like LLMs using <code class="inline-code">formatAdventureConfigForPrompt</code>.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Adventure Generator! Your adventure is complete.</p>
<p>Congratulations on successfully debugging and deploying the core modules for &quot;Adventure Utilities&quot;‚Äîyour 80% progress is a critical checkpoint in refactoring your development journey into an epic production build! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>