<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Hall of Themes and Runes - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Mythic Repository Chronicles</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Hall of Themes and Runes</h1>
<hr>
<p>In this technical exploration, you will examine the theme registry and validation runes that govern configuration and input safety. This quest focuses on how theme metadata is defined, parsed, and validated, as well as how configuration constants establish limits and cadence. Treat the questions below as a guided checklist while reading the code, intended to help you identify architectural patterns, data flow, and validation safeguards. All examples reference real code from the specified files to ensure practical, implementation-focused learning.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Theme Sentinel: How does <code class="inline-code">parseTheme</code> combine exact key matching, numeric ID matching, and keyword includes to resolve a user input to a theme?</li>
<li>‚ö° Configuration Cadence: Which configuration constants directly influence LLM behavior and pipeline constraints, and how are env vars integrated safely?</li>
<li>üõ°Ô∏è Input Wardens: How do <code class="inline-code">validateTheme</code>, <code class="inline-code">validateProjectPath</code>, and <code class="inline-code">sanitizeForDisplay</code> constrain untrusted input while remaining developer-friendly?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Centralized theme registry and resolution logic</h3>
<p>This file provides a single source of truth for theme definitions and helpers. The <code class="inline-code">THEMES</code> object encodes each theme‚Äôs <code class="inline-code">id</code>, <code class="inline-code">key</code>, <code class="inline-code">displayName</code>, <code class="inline-code">emoji</code>, <code class="inline-code">description</code>, and <code class="inline-code">keywords</code>. Retrieval helpers <code class="inline-code">getThemeById</code>, <code class="inline-code">getThemeByKey</code>, and <code class="inline-code">getAllThemes</code> operate on a derived <code class="inline-code">THEMES_ARRAY</code>. Validation and parsing are intentionally simple, relying on array scanning rather than complex data structures, improving readability and maintainability given the small fixed set.</p>
<p>Key flow:</p>
<ul>
<li><code class="inline-code">parseTheme</code> normalizes input, attempts exact key matching with <code class="inline-code">getThemeByKey</code>, then numeric parsing via <code class="inline-code">getThemeById</code>, and finally a keyword includes scan over all entries. This sequence allows flexible user input such as numeric IDs or descriptive keywords.</li>
<li><code class="inline-code">isValidTheme</code> is a type guard that checks presence of <code class="inline-code">theme.key</code> within <code class="inline-code">THEMES_ARRAY</code>, ensuring post-parse validity.</li>
<li>Formatting helpers like <code class="inline-code">formatThemeOption</code> and <code class="inline-code">getFormattedThemeOptions</code> create display-ready text while maintaining the underlying canonical data.</li>
</ul>
<p>The combination of explicit structure and minimal logic enables robust, auditable theme resolution with clear extension points if more themes are added.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code> defines canonical theme data and keywords</li>
<li><code class="inline-code">getAllThemes</code> returns a list used by validation and formatting</li>
<li><code class="inline-code">isValidTheme</code> provides a type guard for post-parse checks</li>
<li><code class="inline-code">parseTheme</code> implements multi-strategy input resolution</li>
<li><code class="inline-code">formatThemeOption</code> standardizes theme display text</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Configuration runes and operational limits</h3>
<p>This file centralizes configuration for LLM interaction, analysis timeouts, cache TTLs, and adventure-specific limits. Environment variables are loaded via <code class="inline-code">dotenv</code> with defaults for safe operation. Constants like <code class="inline-code">LLM_REQUEST_TIMEOUT</code>, <code class="inline-code">REPOMIX_CACHE_TTL</code>, and <code class="inline-code">MAX_FILE_SIZE_MB</code> directly influence performance, reliability, and resource usage.</p>
<p>Key flow:</p>
<ul>
<li>LLM settings (<code class="inline-code">LLM_BASE_URL</code>, <code class="inline-code">LLM_MODEL</code>, <code class="inline-code">LLM_MAX_TOKENS_*</code>, <code class="inline-code">LLM_TEMPERATURE</code>) define generation capacity and variability, with defaults providing a sensible baseline.</li>
<li>Timeouts and buffers (<code class="inline-code">FILE_READ_TIMEOUT</code>, <code class="inline-code">LLM_REQUEST_TIMEOUT</code>, <code class="inline-code">REPOMIX_MAX_BUFFER_SIZE</code>) protect the system from stalls and memory exhaustion.</li>
<li>Analysis constraints (<code class="inline-code">MAX_SCAN_DEPTH</code>, <code class="inline-code">MAX_FILE_SIZE_MB</code>, <code class="inline-code">MAX_FILES_PER_QUEST</code>) keep content generation bounded and reproducible.</li>
<li>Error messages and ignore patterns establish consistent user-facing feedback and predictable scanning scope.</li>
</ul>
<p>This centralized approach encourages consistent configuration usage across modules and simplifies operational tuning via env vars.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> sets upper bound for story generation requests</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> governs context caching duration</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> constrains analysis to keep resource use predictable</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  },
  DEVELOPER: {
    id: 4,
    key: &#39;developer&#39;,
    displayName: &#39;Developer Documentation&#39;,
    emoji: &#39;üìñ&#39;,
    description: &#39;Technical documentation approach with clear explanations, best practices, and code analysis&#39;,
    keywords: [&#39;developer&#39;, &#39;code&#39;, &#39;technical&#39;, &#39;debug&#39;, &#39;guide&#39;, &#39;tutorial&#39;, &#39;binary&#39;]
  },
  CUSTOM: {
    id: 5,
    key: &#39;custom&#39;,
    displayName: &#39;Custom Theme&#39;,
    emoji: &#39;üé®&#39;,
    description: &#39;Design your own adventure! You\&#39;ll be prompted to provide theme name, description, and keywords&#39;,
    keywords: [&#39;custom&#39;, &#39;personalized&#39;, &#39;unique&#39;, &#39;creative&#39;, &#39;personal&#39;]
  }
} as const;
</code></pre>
<p>Think of <code class="inline-code">THEMES</code> as a well-structured catalog where each entry has a fixed SKU, readable name, and tags for search.</p>
<pre><code class="language-typescript">export function getAllThemes(): ThemeDefinition[] {
  return THEMES_ARRAY;
}
</code></pre>
<p>This is like returning all items from inventory without filters for easy iteration and display.</p>
<pre><code class="language-typescript">export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
</code></pre>
<p>This is a gatekeeper that only allows known keys to pass as valid entries.</p>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<p>This works like a multi-stage search: exact match, ID lookup, then keyword relevance.</p>
<pre><code class="language-typescript">export function formatThemeOption(theme: ThemeDefinition): string {
  return `${theme.emoji} **${theme.id}. ${theme.displayName}** - ${theme.description}`;
}
</code></pre>
<p>This is a formatter that produces a consistent, human-friendly listing entry.</p>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
</code></pre>
<p>Treat this as a stopwatch that prevents LLM calls from running indefinitely.</p>
<pre><code class="language-typescript">export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
</code></pre>
<p>This is a freshness timer ensuring repomix results are reused for a short window.</p>
<pre><code class="language-typescript">export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<p>This functions like a gate that blocks oversized files from analysis.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Prefer <code class="inline-code">parseTheme</code> followed by <code class="inline-code">isValidTheme</code> for resilient theme resolution paths.</li>
<li>Use configuration constants rather than hardcoding values to keep behavior consistent and tunable via env vars.</li>
<li>Pair <code class="inline-code">validateProjectPath</code> and <code class="inline-code">sanitizeForDisplay</code> (from <code class="inline-code">input-validator.ts</code>) with error messages from <code class="inline-code">config.ts</code> to provide clear, safe feedback.</li>
</ul>
<hr>
<p>Adventure complete. You have mapped the theme registry, validation runes, and configuration limits that shape system behavior. Use these insights to implement consistent theme resolution and secure configuration in your own modules.</p>
<p>Quest 4: The Hall of Themes and Runes successfully merged into main‚Äîexcellent refactor of styling patterns and semantic tokens‚Äîbringing you to 60% completion; keep shipping clean, modular UI architecture and iterate like a pro üöÄ‚ö°.</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>