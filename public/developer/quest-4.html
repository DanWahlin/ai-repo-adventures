<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Scroll of Themes ‚Äì Crafting the Repository‚Äôs Myths - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'developer' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Codex Chronicles: Guardians of the Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Scroll of Themes ‚Äì Crafting the Repository‚Äôs Myths</h1>
<hr>
<p>The Repository&#39;s themes whisper like eldritch spirits in the ether, enticing you to uncover their magic. Yet, their mysteries cannot be unraveled by mere curiosity alone. Armed with the Scroll of Themes, a Guardian must wield the power of validation, interpretation, and truth to balance structure and chaos. Venture forth, for within these pathways lie the codices that bind the Repository&#39;s myths. Will you wield the Scroll wisely, Guardian, or unleash an inconceivable entropy?</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a>: Theme System and Validation</h3>
<p>The <code class="inline-code">theme.ts</code> file is the Repository&#39;s enchanted manuscript for managing themes. It defines the five mighty domains‚Äî<code class="inline-code">SPACE</code>, <code class="inline-code">MYTHICAL</code>, <code class="inline-code">ANCIENT</code>, <code class="inline-code">DEVELOPER</code>, and <code class="inline-code">CUSTOM</code>‚Äîeach with unique descriptors, keywords, and magical emojis. At its heart lies the <code class="inline-code">THEMES</code> constant, which is a source of truth for these realms, accompanied by helper functions like <code class="inline-code">isValidTheme()</code> and <code class="inline-code">parseTheme()</code> to ensure smooth traversal. This file empowers users to embrace thematic adventures by validating user input against keywords, numeric IDs, or exact matches to theme keys. With its robust structure, developers can retrieve themes, access definitions, and enforce JSON prompts for adventures, ensuring consistency and seamless experience.</p>
<h4>Highlights</h4>
<ul>
<li>Centralized theme definitions via the immutable <code class="inline-code">THEMES</code> constant.  </li>
<li>Comprehensive validation using <code class="inline-code">isValidTheme()</code> and <code class="inline-code">parseTheme()</code> functions.  </li>
<li>User-friendly formatting with <code class="inline-code">getFormattedThemeOptions()</code> for clear display.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a>: Input Validation Framework</h3>
<p>The <code class="inline-code">input-validator.ts</code> file is like a disciplined gatekeeper, ensuring all commands entering the Repository are clean, precise, and safe. It validates user inputs, trims excess data, and prevents malicious payloads. Functions like <code class="inline-code">validateAdventureChoice()</code> ensure choices are appropriate, while <code class="inline-code">validateTheme()</code> works closely with <code class="inline-code">theme.ts</code> to enforce valid thematic selections. Additionally, <code class="inline-code">sanitizeForDisplay()</code> cleanses inputs of forbidden characters, ensuring safe rendering. This code enforces rules critical for maintaining the Repository&#39;s resilient architecture.</p>
<h4>Highlights</h4>
<ul>
<li>Input validation for adventures via <code class="inline-code">validateAdventureChoice()</code>.  </li>
<li>Theme-specific validation linked with <code class="inline-code">theme.ts</code>.  </li>
<li>String sanitization with <code class="inline-code">sanitizeForDisplay()</code> to prevent injection attacks.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a></h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  ...
};
</code></pre>
<p>The <code class="inline-code">THEMES</code> constant acts as the centralized library of available coding dimensions where each theme is an inviting portal.  </p>
<pre><code class="language-typescript">export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}

export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<p>These functions demonstrate precise, layered parsing‚Äîfirst by exact match, then numeric ID, and finally a keyword search‚Äîensuring robust input handling.  </p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a></h3>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<p>This function safeguards the integrity of user-selected themes by leveraging helper functions to ensure accuracy and reliability.  </p>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<p>The <code class="inline-code">sanitizeForDisplay()</code> function ensures user input is safe for rendering by stripping potentially harmful characters while maintaining readability.  </p>
<h2>Helpful Hints</h2>
<ul>
<li>Focus on the interplay between <code class="inline-code">theme.ts</code> and <code class="inline-code">input-validator.ts</code> for robust validation workflows.  </li>
<li>Refactor any additional files with repetitive code into reusable helper functions for cleaner design.  </li>
<li>Explore adding custom themes dynamically by extending <code class="inline-code">parseTheme()</code> to support external definitions.</li>
</ul>
<hr>
<p>Success! You‚Äôve committed the Scroll of Themes to the repository of knowledge, merging your hard-won patterns with the master branch of progress‚ÄîQuest 4 complete, 60% deployment achieved, and your roadmap shines brighter than ever! üöÄüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5: The Keeper of Config ‚Äì Guardian... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>