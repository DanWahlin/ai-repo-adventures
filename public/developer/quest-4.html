<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Codex of Themes - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Realm of Repository Adventures</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Codex of Themes</h1>
<hr>
<p>The time has come to delve into the Codex of Themes, the mystical source of adventure customization in the Realm of Repository Adventures. This arcane module governs the themes that shape your quest, balancing the power of predefined elements with the ability to craft personalized journeys. Here, brave coder, you will uncover how themes are validated, retrieved, and displayed, while also learning the finer points of input validation and configuration mechanisms. The Codex awaits your inquiry!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Theme Mapping</strong>: How are theme information and related keywords structured, and why is a consistent format important?</li>
<li>‚ö° <strong>Validation Enchantment</strong>: What mechanisms ensure that input data like themes and project paths conform to expected formats and constraints?</li>
<li>üõ°Ô∏è <strong>Configuration Glyphs</strong>: What role do the various timeout and limit constants play in ensuring system stability and performance?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Managing Themes and Data</h3>
<p>This file is the source of truth for all adventure themes. It contains predefined themes and provides utility functions to parse, validate, and display themes. The design uses a simple and extendable structure to ensure future scalability. The helper methods like <code class="inline-code">isValidTheme</code> and <code class="inline-code">getAllThemes</code> are vital for validating user input and retrieving theme data efficiently.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: Defines the structure of each theme, including ID, name, keywords, and emojis. Central to managing all themes.</li>
<li><code class="inline-code">isValidTheme</code>: A type guard that checks if a given theme string matches any valid theme key. Ensures compatibility during user input validation.</li>
<li><code class="inline-code">parseTheme</code>: Parses raw input text to identify a valid theme, utilizing ID lookup and keyword matching for flexibility.</li>
<li><code class="inline-code">getAllThemes</code>: Retrieves all available themes in array format. Facilitates theme selection and iteration in the adventure system.</li>
<li><code class="inline-code">getFormattedThemeOptions</code>: Formats complete theme details for user display with emojis and descriptions.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
};
</code></pre>
<ul>
<li>Provides a clear structure for themes with associated metadata like keywords and emojis. </li>
<li>Ensures scalability by allowing additional themes to be added with minimal changes. </li>
<li>Keywords enable flexible matching, enhancing the user experience when providing input. </li>
<li>The <code class="inline-code">description</code> key adds narrative depth, making the system engaging.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
</code></pre>
<ul>
<li>Verifies if the provided string matches a valid theme key. </li>
<li>Useful for input validation and preventing invalid configurations.</li>
<li>Supports safety in theme-dependent operations throughout the system.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>Implements a flexible parsing mechanism that supports exact matches, numeric IDs, and keyword overlaps. </li>
<li>Enhances usability by allowing users to describe themes in multiple ways. </li>
<li>Includes edge case handling for empty strings and invalid input. </li>
<li>Serves as a foundation for user-friendly theme selection.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Validation Logic</h3>
<p>This file provides input validation functions to ensure thematic and configuration parameters comply with expected constraints. These foundational validations prevent errors downstream and maintain system integrity.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateTheme</code>: Validates if a given theme string matches one of the defined themes in <code class="inline-code">theme.ts</code>.</li>
<li><code class="inline-code">validateAdventureChoice</code>: Cleans and validates user inputs to ensure they are non-empty and within the allowed character length.</li>
<li><code class="inline-code">validateProjectPath</code>: Normalizes project paths while checking constraints like length and invalid characters.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Strips potentially unsafe characters and trims long input for safe display, guarding against injection vulnerabilities.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Ensures that incomplete or invalid inputs for themes are filtered out. </li>
<li>Leverages <code class="inline-code">parseTheme</code> and <code class="inline-code">isValidTheme</code> for reliable validations. </li>
<li>Provides clear error messages, improving user feedback loops. </li>
<li>Keeps the system robust by rejecting invalid themes before further processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  
  if (input.length &gt; 500) {
    throw new Error(&#39;Project path too long (max 500 characters)&#39;);
  }
  
  if (input.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid characters&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Checks paths for anomalies like excessive length or null characters. </li>
<li>Defaults to the current working directory if no path is provided. </li>
<li>Protects against vulnerabilities and ensures valid data is passed through the pipeline. </li>
<li>Simple yet effective for ensuring correct path inputs.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>Removes potentially malicious characters to prevent injection attacks. </li>
<li>Limits input length for improved safety and consistent presentation. </li>
<li>Enhances user-facing systems by ensuring sanitized, safe outputs. </li>
<li>Can be used across the adventure system for consistent formatting.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Configuration Management</h3>
<p>This file outlines constants and configurable values for the system, enabling centralized and maintainable adjustments to project settings.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Configures timeout duration for interactions with the LLM, avoiding stuck processes.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Establishes a time-to-live for caching repository analysis results, balancing performance and memory usage.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Sets a limit on file sizes for analysis, preventing excessive resource consumption.</li>
<li><code class="inline-code">DEFAULT_THEME</code>: Defines the fallback theme for adventures, maintaining consistency when none is specified.</li>
<li><code class="inline-code">IGNORE_PATTERNS</code>: Lists directories and files to be excluded from scanning, improving efficiency and clarity.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000;
export const REPOMIX_CACHE_TTL = 300000;
export const MAX_FILE_SIZE_MB = 10;
export const DEFAULT_THEME = &#39;space&#39; as const;
export const IGNORE_PATTERNS = [
  &#39;node_modules&#39;,
  &#39;.git&#39;,
  &#39;.env&#39;,
  &#39;build&#39;,
  &#39;*.log&#39;,
];
</code></pre>
<ul>
<li>These constants ensure that crucial system constraints are in place. </li>
<li>Improves maintainability by preventing hard-coded values scattered in the codebase. </li>
<li>The <code class="inline-code">DEFAULT_THEME</code> acts as a safety mechanism for fallback behavior. </li>
<li>The ignored patterns optimize performance by avoiding unnecessary scans. </li>
<li>Ensures configurable flexibility through environment variables and defaults.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Consider how <code class="inline-code">keywords</code> enhance user experience by allowing flexible inputs.</li>
<li>Review the way <code class="inline-code">sanitizeForDisplay</code> prevents unintended output issues across modules.</li>
<li>Test the impact of adjusting timeout values for long-running or intensive processes.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>üéâ Congratulations, developer‚ÄîQuest 4: The Codex of Themes has been successfully merged into your master branch of knowledge, elevating your implementation prowess to a stellar 60% completion milestone! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>