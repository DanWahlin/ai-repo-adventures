<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Configuration & Theme System - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Modular Adventures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Configuration &amp; Theme System</h1>
<hr>
<p>The configuration and theme system is the backbone of the adventure generation platform, specifying how stories and quests adapt to user preferences and environmental constraints. This system governs every aspect of the quest-building environment‚Äîfrom API configurations to the customization allowed for themes, ensuring a seamless developer-centric storytelling experience. By understanding this modular setup, you can extend functionality, optimize flow, and guarantee adaptability for dynamic user inputs.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configuration Patterns</strong>: How are environment variables and constants utilized within the configuration file to manage system behavior?</li>
<li>‚ö° <strong>Theme Customization</strong>: What does the <code class="inline-code">THEMES</code> object define, and how can it be extended or modified for new adventure modes?</li>
<li>üõ°Ô∏è <strong>Validation Mechanisms</strong>: How do validation functions ensure input integrity, and what patterns prevent potential errors in user-driven setups?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Core Configuration Management</h3>
<p>This file defines constants and configurations for the system, relying on environment variables and static parameters to control aspects such as API settings, timeouts, and cache limits. It ensures modularity by centralizing all adjustable elements of the platform.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Defines how long the system can wait for a response from the language model, balancing speed with robust content generation.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Manages caching duration for underlying subprocesses to optimize repeated analyses.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Specifies size constraints for file inclusion in analysis, protecting performance when processing large repositories.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li>These constants balance system performance and usability in handling diverse repositories and data input sizes.</li>
<li>Modular configuration through environment variables enables flexible deployments in different operational contexts.</li>
<li>The limits on file sizes and timeouts ensure stable operation even with large-scale data or slower API responses.</li>
<li>The use of <code class="inline-code">parseInt</code> and default values guarantees robust fallback mechanisms.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Input Validation Utilities</h3>
<p>This file ensures input integrity by validating essential fields like theme selection and project paths. Validation prevents malformed user inputs from causing errors in downstream systems.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateTheme</code>: Ensures that chosen themes correspond to predefined or valid user-provided keys.</li>
<li><code class="inline-code">validateAdventureChoice</code>: Controls the length and content of user-submitted choices to guarantee secure processing.</li>
<li><code class="inline-code">validateProjectPath</code>: Sanitizes and verifies file paths before usage to maintain system security and reliability.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Keeps invalid themes from being processed by cross-referencing the <code class="inline-code">THEMES</code> object.</li>
<li>Uses normalized string comparisons to enhance user freedom while avoiding errors.</li>
<li>Calls helper functions like <code class="inline-code">parseTheme</code> to simplify theme extraction logic.</li>
</ul>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  
  if (input.length &gt; 500) {
    throw new Error(&#39;Project path too long (max 500 characters)&#39;);
  }
  
  if (input.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid characters&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Ensures paths remain valid and sanitized, preventing common vulnerabilities like null byte injection.</li>
<li>Employs simple checks to maintain readability and future adaptability.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Theme Definition and Utilities</h3>
<p>This file centralizes theme configurations, creating a single source of truth for theme-related operations. Each theme includes IDs, display names, descriptions, keywords, and icons, augmenting user engagement through personalization.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: A static object defining fixed adventures, their metadata, and how they are matched.</li>
<li><code class="inline-code">getAllThemes</code>: Provides an easy way to fetch a list of all themes for display or analysis.</li>
<li><code class="inline-code">isValidTheme</code>: Verifies that a given input corresponds to one of the defined themes.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  }
} as const;
</code></pre>
<ul>
<li>Emphasizes modularity by defining all themes in one immutable object, simplifying updates and additions.</li>
<li>Includes emoji and descriptions for clear, user-friendly display options.</li>
</ul>
<pre><code class="language-typescript">export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
</code></pre>
<ul>
<li>A type guard that enables the system to differentiate valid themes from invalid ones.</li>
<li>Simplifies debugging by providing a clear yes/no validation process.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Expanding Themes</strong>: Creating a new theme requires adding a new entry to the <code class="inline-code">THEMES</code> object and extending any relevant validation logic.</li>
<li><strong>Environment Control</strong>: Fine-tune global parameters like timeouts and size thresholds via environment variables for specialized deployments.</li>
<li><strong>Validation Strategy</strong>: Consistently use clear, centralized validation functions to minimize code duplication and improve reliability.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>You&#39;ve successfully refactored complexity into clarity with Quest 4: Configuration &amp; Theme System‚Äîdeployment-ready brilliance unlocked ‚≠êüöÄ‚ö°!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>