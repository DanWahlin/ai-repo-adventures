<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Configuration & Theme System - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository of Ancient Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Configuration &amp; Theme System</h1>
<hr>
<p>The ancient repository hums with potential as you venture into its deep settings, a labyrinth of configurations and theme definitions. Here lies the core machinery dictating how adventures come alive, shaping the journey with rules and aesthetics. The files you will uncover form the backbone of storytelling and validation, offering clarity amidst chaos. Harness the tools of configuration, validate your choices, and explore the realm of themes. Brave adventurer, the system awaits your discovery‚Äîwill you master the art of merging flexibility and control?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Adventure Parameters</strong>: How are timeout settings and limits structured within the configuration system to balance efficiency and resource constraints?</li>
<li>‚ö° <strong>Theme Magic</strong>: How does the theme system define and validate themes while ensuring user flexibility with robust matching techniques?</li>
<li>üõ°Ô∏è <strong>Sanctuary Validation</strong>: What mechanisms ensure the input validation system sanitizes and safeguards adventure pathways for seamless user experience?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Configuration Setup</h3>
<p>This file encapsulates core constants used across the MCP tool interface. It handles environment variables, timeout definitions, analysis limits, and theme defaults, providing a centralized management point for the application. By exploring this file, you can understand how reliability and scalability are baked into the quest generation framework.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Configures the timeout for large requests, enabling efficient handling of complex story generation tasks.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Defines cache expiration for short-term storage, balancing performance optimization with memory constraints.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Establishes a file size limit for scanning operations to prevent resource exhaustion and maintain system stability.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Theme Definitions</h3>
<p>This file acts as the single source of truth for theme-related data, defining themes, their structure, and functions to validate and match user inputs. The modular approach ensures clean code and straightforward scalability.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: Provides predefined theme configurations, complete with identifiers, descriptions, and keywords.</li>
<li><code class="inline-code">isValidTheme</code>: Validates themes against predefined options using efficient type guards.</li>
<li><code class="inline-code">parseTheme</code>: Parses user input based on various matching criteria, including exact keys, numeric IDs, and keywords.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Input Validation</h3>
<p>This file implements utility functions to validate and sanitize user inputs, ensuring robust error handling and clean data processing. It acts as a critical layer for maintaining integrity within the adventure system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Validates the user‚Äôs adventure selection for proper formatting and length constraints.</li>
<li><code class="inline-code">validateTheme</code>: Ensures the provided theme matches one of the defined configurations, throwing descriptive errors when invalid.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Cleans input strings and prepares them for safe rendering, avoiding display corruption.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li>The <code class="inline-code">LLM_REQUEST_TIMEOUT</code> ensures prolonged operations for intensive prompts without causing abrupt termination.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> optimizes performance with configurable caching using environment variables.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> limits file scanning to maintain speed and prevent overloading memory.</li>
</ul>
<hr>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  // Other themes...
};

export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}

export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li><code class="inline-code">THEMES</code> defines universal configuration for theme options, aligning symbols and descriptions with keywords for intuitive exploration.</li>
<li><code class="inline-code">isValidTheme</code> validates user-provided themes against the known set using efficient iteration techniques.</li>
<li><code class="inline-code">parseTheme</code> leverages multi-tiered matching logic to deliver flexibility in recognizing user inputs.</li>
</ul>
<hr>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}

export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}

export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> enforces constraints and formats user selections, preventing invalid choices.</li>
<li><code class="inline-code">validateTheme</code> ensures the user‚Äôs theme aligns with available configurations and checks for improper input formatting.</li>
<li><code class="inline-code">sanitizeForDisplay</code> cleans user-generated strings for safe rendering, avoiding inconsistencies or malicious outputs.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>For configuration adjustments: consider using <code class="inline-code">.env</code> overrides to personalize parameters and system limits.</li>
<li>Keep the predefined themes accessible through the <code class="inline-code">THEMES_ARRAY</code> for quick reference or modification.</li>
<li>Use the validator functions as utilities across the applications to ensure consistent logic enforcement.</li>
</ul>
<hr>
<p>Harness the knowledge uncovered within these files to refine your mastery of configuration and thematic systems. The codebase&#39;s secrets await further exploration!</p>
<p>Quest 4: Configuration &amp; Theme System successfully merged into the main branch‚Äîyour codebase of knowledge is 60% compiled and executing with stellar precision; onward to the next milestone, sysadmin superstar! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>