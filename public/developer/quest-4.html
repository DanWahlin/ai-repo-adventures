<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Configuration & Theme System - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository Chronicles: The Developer's Guide to Modular Code Systems</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Configuration &amp; Theme System</h1>
<hr>
<p>In the vast expanse of modular systems lies a repository designed to orchestrate developer workflows with precision. The <strong>Configuration &amp; Theme System</strong> governs the foundation for tailoring adventures and experiences, ensuring that every quest aligns with user preferences and performance constraints. From managing environment variables and timeouts to defining user-selectable themes, this system exemplifies the art of adaptability and maintainability. By exploring its configuration constants, validation routines, and theme definitions, developers can refine their understanding of crafting robust and extensible systems.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Timeout Mapping</strong>: How does the <code class="inline-code">config</code> file manage and enforce the various timeouts across operations, and what are the implications for system performance?</li>
<li>‚ö° <strong>Theme Discovery</strong>: What role does <code class="inline-code">THEMES</code> play in defining adventure settings, and how does the theme system balance simplicity with extensibility?</li>
<li>üõ°Ô∏è <strong>Validation Workflow</strong>: How do the input validators validate and sanitize user inputs to ensure validity, prevent abuse, and safeguard against errors?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Centralized configuration management</h3>
<p>The <code class="inline-code">config.ts</code> file centralizes all critical constants and configurable parameters for the system, ensuring consistent behavior across modules. This file uses environment variables for dynamic adjustments (e.g., <code class="inline-code">REPOMIX_CACHE_TTL</code>) and includes sensible defaults for fallback. Categories include API settings, file limits, adventure constraints, and error handling. This modular approach simplifies system-wide updates and ensures all components reference the same parameters.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Sets the limit on API request durations, balancing responsiveness with reliability in operations.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Manages in-memory cache expiration to optimize performance without over-consuming resources.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Ensures memory efficiency by limiting the size of files analyzed during code processing.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Theme definitions and utilities</h3>
<p>This file serves as the single source of truth for all predefined themes in the system. By defining a robust theme structure (<code class="inline-code">ThemeDefinition</code>), it supports everything from keyword matching to customizable descriptions. Its helper methods (<code class="inline-code">getAllThemes</code>, <code class="inline-code">isValidTheme</code>, <code class="inline-code">parseTheme</code>) facilitate validation, retrieval, and processing of themes from user input, contributing to seamless integrations across the adventure setup.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: The comprehensive configuration for all available themes, from &quot;Space Exploration&quot; to the customizable &quot;Developer Documentation.&quot;</li>
<li><code class="inline-code">parseTheme</code>: Matches user input to appropriate themes through flexible parsing and keyword mapping.</li>
<li><code class="inline-code">getFormattedThemeOptions</code>: Generates user-friendly listings of all predefined themes with metadata for display.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Validates and sanitizes user inputs</h3>
<p>This file provides utility functions for error-proofing user inputs during setup and exploration. Functions like <code class="inline-code">validateTheme</code> ensure valid themes are selected, while <code class="inline-code">sanitizeForDisplay</code> removes potentially unsafe or invalid characters from outputs.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Ensures user-provided selections meet length and validation criteria for adventure setups.</li>
<li><code class="inline-code">validateTheme</code>: Verifies themes against the predefined list, throwing detailed errors when invalid selections are made.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Prepares user input for safe presentation, removing any malicious or disruptive elements.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li>Defines critical timeout and memory-related constraints for services.</li>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> ensures requests terminate if they exceed a defined duration, preventing system hang-ups.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> balances memory efficiency and request performance by caching results temporarily.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> guards against excessive memory consumption, focusing system resources on manageable file sizes.</li>
</ul>
<hr>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  DEVELOPER: {
    id: 4,
    key: &#39;developer&#39;,
    displayName: &#39;Developer Documentation&#39;,
    emoji: &#39;üìñ&#39;,
    description: &#39;Technical documentation approach with clear explanations, best practices, and code analysis&#39;,
    keywords: [&#39;developer&#39;, &#39;code&#39;, &#39;technical&#39;, &#39;debug&#39;, &#39;guide&#39;, &#39;tutorial&#39;, &#39;binary&#39;]
  },
  CUSTOM: {
    id: 5,
    key: &#39;custom&#39;,
    displayName: &#39;Custom Theme&#39;,
    emoji: &#39;üé®&#39;,
    description: &#39;Design your own adventure! You\&#39;ll be prompted to provide theme name, description, and keywords&#39;,
    keywords: [&#39;custom&#39;, &#39;personalized&#39;, &#39;unique&#39;, &#39;creative&#39;, &#39;personal&#39;]
  }
} as const;

export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;

  const normalized = input.trim().toLowerCase();

  // Check for exact key match
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;

  // Check for numeric ID
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }

  // Check keywords using simple includes check
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }

  return null;
}
</code></pre>
<ul>
<li><code class="inline-code">THEMES</code> creates predefined options with unique keys, descriptions, and display elements.</li>
<li>Includes user-friendly metadata (<code class="inline-code">emoji</code>, <code class="inline-code">displayName</code>) for engaging representations.</li>
<li><code class="inline-code">parseTheme</code> implements user-friendly parsing logic, enabling flexibility through keywords and exact matches.</li>
</ul>
<hr>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}

export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> ensures robust input handling, rejecting overly long or empty choices.</li>
<li><code class="inline-code">validateTheme</code> uses <code class="inline-code">parseTheme</code> logic to verify theme validity and formats errors based on preconfigured themes.</li>
<li>Enhances error clarity and safeguards system stability with precise validations.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Configurable constants like <code class="inline-code">REPOMIX_CACHE_TTL</code> allow fine-grained control over optimization.</li>
<li>Use the <code class="inline-code">THEMES</code> mapping to explore how pre-defined settings enable flexibility and personalization.</li>
<li>Keep an eye on input sanitization methods to understand how the system prevents invalid or malicious data entry.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations, you&#39;ve successfully refactored your skill set by integrating the Configuration &amp; Theme System‚Äîyour codebase of knowledge now operates at 60% functionality with robust modularity! üöÄüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>