<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Codex of Themes and Seals - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Starship Codex: Navigating the Repository Constellation</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Codex of Themes and Seals</h1>
<hr>
<p>This guide continues your configuration and validation expedition on the MPC bridge. Your task: calibrate the Codex of Themes and Seals that governs developer-focused itineraries. You will verify time constants, scan limits, and cache windows, then confirm theme registry integrity and safety of user inputs. Treat the following objectives as exploration guides while reading the actual code, focusing on architecture, patterns, and implementation details that determine how your command deck validates themes, protects inputs, and enforces operational limits.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Scanner Calibration: How do <code class="inline-code">MAX_FILE_SIZE_MB</code> and related limits in <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/config.ts</code></a> constrain analysis scope, and where are they intended to be consumed downstream?</li>
<li>‚ö° Theme Resolution Flow: How do <code class="inline-code">THEMES</code>, <code class="inline-code">getAllThemes</code>, and <code class="inline-code">parseTheme</code> interact to resolve user input into a canonical theme key within <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a>?</li>
<li>üõ°Ô∏è Input Safeguards: What sequence of checks in <code class="inline-code">validateTheme</code>, <code class="inline-code">validateAdventureChoice</code>, and <code class="inline-code">validateProjectPath</code> ensures safe, normalized, and actionable inputs in <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a>?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Centralized configuration and operational constraints</h3>
<p>This module defines environment-driven configuration and operational limits for the system. It uses <code class="inline-code">dotenv</code> initialization with <code class="inline-code">config({ quiet: true })</code> to load environment variables. Critical LLM parameters like <code class="inline-code">LLM_API_KEY</code>, <code class="inline-code">LLM_BASE_URL</code>, <code class="inline-code">LLM_MODEL</code>, and <code class="inline-code">LLM_REQUEST_TIMEOUT</code> establish defaults for service availability and performance boundaries. Analysis constraints such as <code class="inline-code">FILE_READ_TIMEOUT</code>, <code class="inline-code">FILE_ANALYSIS_TIMEOUT</code>, <code class="inline-code">MAX_SCAN_DEPTH</code>, and <code class="inline-code">MAX_FILE_SIZE_MB</code> provide upper bounds that downstream analyzers and generators should respect. Cache and buffer settings including <code class="inline-code">LLM_CACHE_TTL</code>, <code class="inline-code">REPOMIX_CACHE_TTL</code>, and <code class="inline-code">REPOMIX_MAX_BUFFER_SIZE</code> protect stability during heavy operations. The constants prefer environment overrides but fall back to safe defaults, forming a predictable baseline. Error messaging via <code class="inline-code">ERROR_MESSAGES</code> standardizes user-facing responses, while <code class="inline-code">IGNORE_PATTERNS</code> enumerates directories and files to exclude during scans. <code class="inline-code">PROMPT_PATHS</code> centralizes prompt file locations to support prompt engineering workflows. Together, these constants function as a single source of truth for timeouts, limits, and paths, enabling other modules to remain focused on logic rather than configuration plumbing.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> sets the upper bound for LLM calls to prevent stalled requests and aligns latency expectations across the system.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> defines cache freshness for repository context generation, balancing accuracy and performance.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> caps analyzed file size, ensuring memory safety and focusing the pipeline on source code most relevant to documentation.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">// Timeouts in milliseconds
export const FILE_READ_TIMEOUT = 10000;
export const FILE_ANALYSIS_TIMEOUT = 30000;
export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const LLM_CACHE_TTL = 300000; // 5 minutes
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const REPOMIX_SUBPROCESS_TIMEOUT = parseInt(process.env.REPOMIX_SUBPROCESS_TIMEOUT || &#39;120000&#39;); // 2 minutes, configurable via env
export const REPOMIX_GRACEFUL_TIMEOUT = 5000; // 5 seconds for graceful shutdown before SIGKILL
export const REPOMIX_MAX_BUFFER_SIZE = 100 * 1024 * 1024; // 100MB max buffer to prevent memory exhaustion
</code></pre>
<ul>
<li>Establishes consistent time budgets for file IO, analysis, and LLM requests to prevent resource starvation.</li>
<li>Uses environment overrides where appropriate, enabling tuning without code changes.</li>
<li>Introduces a separate TTL for LLM cache vs. RepoMix cache, clarifying distinct lifecycle policies.</li>
<li>Buffer cap prevents unbounded memory usage during subprocess capture.</li>
<li>Patterns emphasize explicit numeric defaults plus env-driven configurability.</li>
</ul>
<hr>
<pre><code class="language-typescript">// Analysis limits
export const MAX_SCAN_DEPTH = 3; // Maximum directory depth to prevent infinite recursion and keep analysis focused
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
export const KEY_SOURCE_FILES = 10; // Number of key files to highlight in adventure generation
export const TOP_FUNCTIONS = 20; // Maximum functions to include in code analysis summaries
export const TOP_CLASSES = 5; // Maximum classes to include in analysis to keep stories focused
</code></pre>
<ul>
<li>Defines guardrails for repository scanning and summarization scope.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> directly influences which files are considered, improving performance and relevance.</li>
<li>Summary caps (<code class="inline-code">KEY_SOURCE_FILES</code>, <code class="inline-code">TOP_FUNCTIONS</code>, <code class="inline-code">TOP_CLASSES</code>) keep generated content concise and actionable.</li>
<li>Separation of scanning depth and summarization counts supports efficient and targeted analysis.</li>
<li>Encourages downstream code to reference these constants rather than hardcoding values.</li>
</ul>
<hr>
<pre><code class="language-typescript">// LLM settings
export const LLM_CACHE_SIZE = parseInt(process.env.LLM_CACHE_SIZE || &#39;100&#39;);
export const LLM_TEMPERATURE = parseFloat(process.env.LLM_TEMPERATURE || &#39;0.7&#39;);
export const LLM_MAX_TOKENS = parseInt(process.env.LLM_MAX_TOKENS || &#39;4000&#39;);
export const LLM_MAX_TOKENS_STORY = Math.max(LLM_MAX_TOKENS, 8000); // Maximum tokens for story generation (use env var if higher)
export const LLM_MAX_TOKENS_QUEST = Math.max(LLM_MAX_TOKENS, 6000); // Maximum tokens for individual quest exploration content (use env var if higher)
export const LLM_MAX_TOKENS_DEFAULT = LLM_MAX_TOKENS; // Use env var or default to 4000
</code></pre>
<ul>
<li>Centralizes LLM tunables with sane defaults and environment overrides for deployment flexibility.</li>
<li>Separates token budgets for story vs. quest generation to align with content size profiles.</li>
<li>Uses <code class="inline-code">Math.max</code> to guarantee minimum token ceilings even if env values are lower.</li>
<li>Highlights temperature as a configurable creativity control.</li>
<li>Reinforces the pattern of centralized config for consistency across the pipeline.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Align downstream analyzers to honor <code class="inline-code">MAX_SCAN_DEPTH</code> and <code class="inline-code">MAX_FILE_SIZE_MB</code> to prevent runaway processing.</li>
<li>Prefer referencing <code class="inline-code">ERROR_MESSAGES</code> for consistency in user feedback across modules.</li>
<li>Use <code class="inline-code">PROMPT_PATHS</code> to decouple prompt content from code and enable iterative prompt improvements.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Quest 4: Codex of Themes and Seals successfully merged into main‚Äîexcellent implementation of modular UI theming and secure seal validation, achieving 60% mission completion; keep iterating, ship confidently, and maintain velocity toward full release üöÄ‚ö°üíé.</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>