<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Configuration & Theme System - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository Chronicles: The Codebase Codex</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Configuration &amp; Theme System</h1>
<hr>
<p>The cornerstone of creating adaptive and engaging developer journeys lies in the proper configuration and theme management of the system. In this quest, we delve into the files that define system parameters, validate input, and maintain a dynamic, theme-driven architectural approach. These components lay the foundation for tailoring interactive experiences within the codebase. Prepare to explore the centralized configuration, robust input validation, and comprehensive theme handling that underpin the adventure generation engine.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>System Parameterization</strong>: How are key constants and defaults structured, and what mechanisms allow them to be dynamically adjusted via the environment?</li>
<li>‚ö° <strong>Theme Recognition</strong>: What logic governs theme parsing, selection, and validation within the adventure system?</li>
<li>üõ°Ô∏è <strong>Input Validation</strong>: How does the system ensure the integrity of user inputs, such as themes and paths, while handling edge cases?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Centralized Settings for Adventure Generation</h3>
<p>This file consolidates all configurable constants and settings that drive the core behavior of the adventure system. It includes environment variables, timeouts, cache settings, and limits designed to ensure robustness and flexibility. The design prioritizes simplicity while allowing for dynamic updates via environment variables.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Specifies the maximum waiting period for Large Language Model requests, ensuring smooth story generation even for complex prompts.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Configures the cache persistence duration, balancing performance with up-to-date code analysis.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Defines the maximum acceptable size for files during analysis, helping to avoid performance bottlenecks with large files.</li>
</ul>
<h3>Code</h3>
<h4>packages/core/src/shared/config.ts</h4>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li>These constants control diverse aspects of the adventure system, balancing adaptability and stability.</li>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> mitigates risks of hanging requests by defining a clear timeout for the model&#39;s responses.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> uses environment variables to adapt caching behavior based on deployment scenarios, enhancing scalability.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> prevents excessive memory consumption by filtering out oversized files during analysis.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Central Theme Management</h3>
<p>The <code class="inline-code">theme.ts</code> module defines the adventure system&#39;s themes using structured data, validation utilities, and helper functions to match user inputs with predefined themes. It ensures consistency and serves as the single source of truth for theme-related information.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: Enumerates all available themes, including their metadata, descriptions, and associated keywords.</li>
<li><code class="inline-code">getAllThemes</code>: Retrieves a list of all available themes as objects, enabling exploration or validation purposes.</li>
<li><code class="inline-code">isValidTheme</code>: Validates user-specified themes against the available options, safeguarding against invalid inputs.</li>
</ul>
<h3>Code</h3>
<h4>packages/core/src/shared/theme.ts</h4>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: { id: 1, key: &#39;space&#39;, displayName: &#39;Space Exploration&#39;, emoji: &#39;üöÄ&#39;, description: &#39;Journey through cosmic codebases...&#39;, keywords: [&#39;space&#39;] },
  DEVELOPER: { id: 4, key: &#39;developer&#39;, displayName: &#39;Developer Documentation&#39;, emoji: &#39;üìñ&#39;, description: &#39;Technical documentation approach...&#39;, keywords: [&#39;developer&#39;] }
} as const;

export function getAllThemes(): ThemeDefinition[] {
  return Object.values(THEMES);
}

export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
</code></pre>
<ul>
<li><code class="inline-code">THEMES</code> embeds detailed metadata for each theme, enriching the user experience with structured and descriptive data.</li>
<li><code class="inline-code">getAllThemes</code> abstracts theme retrieval, ensuring developers can access this data in a straightforward manner.</li>
<li><code class="inline-code">isValidTheme</code> ensures thematic integrity by rejecting any strings that fail to match valid theme keys, bolstering system reliability.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Validating Inputs for Adventure Integrity</h3>
<p>This file provides essential validation functions for user inputs. It ensures that adventure choices, theme selections, and project paths conform to expected formats, preventing disruptions from invalid or malicious inputs.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Ensures that a non-empty, properly formatted adventure choice is submitted by the user.</li>
<li><code class="inline-code">validateTheme</code>: Validates user-provided themes against the available theme library, incorporating fallback error handling.</li>
<li><code class="inline-code">validateProjectPath</code>: Verifies the validity of user-specified project paths, offering default values when none are provided.</li>
</ul>
<h3>Code</h3>
<h4>packages/core/src/shared/input-validator.ts</h4>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>This function ensures valid, non-empty user choices, trimming superfluous whitespace for consistency.</li>
<li>By enforcing a maximum character limit, it prevents scenarios where excessively long inputs might degrade performance.</li>
<li>Error handling explicitly communicates issues to users, offering clear guidance for corrections.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);

  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }

  return parsedTheme;
}
</code></pre>
<ul>
<li>This function leverages <code class="inline-code">parseTheme</code> and <code class="inline-code">isValidTheme</code> to robustly validate user themes against allowable values.</li>
<li>It normalizes input for consistency, accommodating case-insensitive matches.</li>
<li>By enumerating valid themes in error messages, it aids users in making informed corrections.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  
  if (input.length &gt; 500) {
    throw new Error(&#39;Project path too long (max 500 characters)&#39;);
  }
  
  if (input.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid characters&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li><code class="inline-code">validateProjectPath</code> ensures paths adhere to length and character constraints, preventing malformed or potentially malicious inputs.</li>
<li>Defaulting to the current working directory simplifies setup for users who omit this parameter.</li>
<li>String sanitization protects against injection attacks, adding an extra layer of security.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Environment Configuration</strong>: Ensure your <code class="inline-code">.env</code> file is correctly populated to test the dynamic overrides of configuration values.</li>
<li><strong>Thematic Validation</strong>: Try modifying the theme keywords in <code class="inline-code">theme.ts</code> to see how the system adapts to new criteria.</li>
<li><strong>Input Testing</strong>: Experiment with edge cases (e.g., excessively long strings, empty inputs) to deepen your understanding of the validators&#39; robustness.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Quest 4: Configuration &amp; Theme System successfully merged into the repository of your skills‚Äîyour progress is pushing past breakpoints with 60% complete; onward to the final stretch, architect of scalable solutions! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>