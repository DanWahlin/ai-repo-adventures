<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Chronicles of the Story Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository Chronicles</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Chronicles of the Story Engine</h1>
<hr>
<p>In the heart of the enchanted Kingdom of Reposithia lies the Story Engine, a mystic forge capable of breathing life into ideas. It is said that the Story Generator, a magical artifact within this forge, can spin entire adventures from threads of code and dreams. However, the artifact‚Äôs power is waning, leaving adventurers in uncertainty. To restore its full potential, brave knights must unearth its secrets and wield its magic for the realms of collaboration. Will you uncover the intricate workings of the Story Engine and unlock its might?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Theme Selection Mysteries</strong>: How does the <code class="inline-code">StoryGenerator</code> validate and handle different adventure themes during initialization?</li>
<li>‚ö° <strong>Narrative Creation Flow</strong>: How is the overall story and quest structure generated using the <code class="inline-code">generateStoryAndQuests</code> function?</li>
<li>üõ°Ô∏è <strong>Configuration Adaptation</strong>: How does the <code class="inline-code">formatAdventureConfigForPrompt</code> transform raw adventure configurations into something suitable for prompts?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> The mythical artifact of narrative creation</h3>
<p>The <code class="inline-code">StoryGenerator</code> is the magical core of the Story Engine, tasked with transforming code files into thematic adventures. Central to its magic is the <code class="inline-code">generateStoryAndQuests</code> function, which spins tales from the analyzed repository content. It checks the validity of themes and retrieves project information to guide the crafting process. Additionally, the function integrates formatted configuration details to enrich the prompts. Its companion, <code class="inline-code">generateQuestContent</code>, expands individual quests into detailed instructions for adventurers, leveraging structured guidance and pre-analyzed code.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Processes project context and adventure themes to craft initial stories and quests.</li>
<li><code class="inline-code">validateTheme</code>: Ensures the selected adventure theme aligns with the mystical guidelines of the Story Engine.</li>
<li><code class="inline-code">generateQuestContent</code>: Delivers quest-specific content by using both the project‚Äôs codebase and configuration.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<p>The storyteller‚Äôs ritual begins here, combining project lore with the chosen theme to invoke the LLM&#39;s creative magic.</p>
<pre><code class="language-typescript">private validateTheme(theme: AdventureTheme): AdventureTheme {
  if (!isValidTheme(theme)) {
    console.warn(`Invalid theme &#39;${theme}&#39;, defaulting to ${DEFAULT_THEME}`);
    return DEFAULT_THEME;
  }
  return theme;
}
</code></pre>
<p>A safeguard spell ensures errant themes are rectified before the story takes form.</p>
<pre><code class="language-typescript">async generateQuestContent(quest: Quest, theme: AdventureTheme, codeContent: string): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );

  return {
    adventure: response.content.trim(),
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<p>The fine details of the quest are delicately etched here, tailored uniquely by the adventurer&#39;s context and theme.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Keep a watchful eye on how themes are mapped to vocabulary hints for prompt generation.</li>
<li>Pay attention to how <code class="inline-code">generateStoryAndQuests</code> incorporates both repository data and configurations into the output.</li>
<li>Extend the magic by exploring how the LLM client interacts with the formatted configs.</li>
</ul>
<hr>
<p>Your exploration of the Story Engine paves the way for creating tales of grandeur. Let the light of your analysis illuminate the path forward!</p>
<p>Hail, brave scholar‚Äîby conquering Quest 2: Chronicles of the Story Engine, you‚Äôve unlocked the first rune of mastery upon the tapestry of this epic journey, proving the might of your storytelling prowess! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>