<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Forge of Adventure Craftsmanship - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository of Quests</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Forge of Adventure Craftsmanship</h1>
<hr>
<p>In the heart of Repoheim lies the arcane Forge of Adventure Craftsmanship, a sacred workshop where the most intricate quests are shaped and tempered with the heat of logic and the anvil of inspiration. Whispers tell of the <code class="inline-code">adventure-manager.ts</code>, the master artificer orchestrating the creation of tales, while the <code class="inline-code">story-generator.ts</code> channels mythical energies into vibrant stories and challenges. The enigmatic <code class="inline-code">adventure-config.ts</code> provides the blueprint, detailing the whispers of forgotten lore and specifying paths to create each tale. Brave adventurer, your task is to inspect the forge, understand its inner workings, and harness its power to craft your own legendary quests. </p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Forging the Journey</strong>: How does the <code class="inline-code">AdventureManager</code> initialize the crafting of stories and quests, and what are the essential components involved?</li>
<li>‚ö° <strong>The Tapestry Threader</strong>: How does the <code class="inline-code">StoryGenerator</code> structure and validate the creation of stories and quests, ensuring consistency with project data?</li>
<li>üõ°Ô∏è <strong>Blueprint Insights</strong>: What mechanisms does <code class="inline-code">adventure-config.ts</code> use to read and parse adventure configuration files, and how do these files shape quest generation?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Adventure management and quest orchestration</h3>
<p>The <code class="inline-code">AdventureManager</code> serves as the coordinator of the Forge, overseeing all interactions, from initializing adventures to executing selected quests. With a rich utility suite, it manipulates the adventure state and invokes external collaborators such as <code class="inline-code">StoryGenerator</code>. This is the central forge where your adventure begins and evolves.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Prepares the adventure by resetting the state, setting a theme, and generating quests and stories based on the <code class="inline-code">projectInfo</code> and <code class="inline-code">theme</code>.</li>
<li><code class="inline-code">exploreQuest</code>: Executes a specific quest by validating the choice, retrieving or generating its content, and caching results.</li>
<li><code class="inline-code">progressPercentage</code>: Calculates quest progress as a percentage, offering adventurers insight into their journey.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Integrates quest-specific file information from config, enhancing the detail of each challenge.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Ensures the integrity of user input when selecting a quest.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Resets the adventure state to start fresh and specifies the theme and project context.</li>
<li>Employs <code class="inline-code">StoryGenerator</code> to craft the overarching narrative and quests.</li>
<li>Merges configuration-defined files into generated quests to enhance specificity.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates and processes the user&#39;s quest selection.</li>
<li>Locates the related quest and executes it, efficiently managing cached and new content.</li>
<li>Returns a structured result containing the outcomes and available next steps.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Calculates the completion percentage of the adventure.</li>
<li>Demonstrates a simple yet effective formula for progress tracking.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Quest blueprint management</h3>
<p>The <code class="inline-code">adventure-config.ts</code> acts as the blueprint artisan, extracting the vital paths and configuration details needed for story creation. By parsing <code class="inline-code">adventure.config.json</code>, it ensures the forge follows the intended design.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads raw adventure configuration files from the project directory.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Safely parses and validates JSON structure for error avoidance.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts distinct file paths referenced within the configuration for quest purposes.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>Reads the raw content of <code class="inline-code">adventure.config.json</code> from a given project path.</li>
<li>Simplifies the process of validating the presence and accessibility of configuration files.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Converts the raw JSON content of the configuration into a usable object.</li>
<li>Ensures safety with error handling for invalid or corrupt files.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Collects unique file paths specified in the configuration.</li>
<li>Validates both the existence and relevance of these files, boosting quest accuracy.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">initializeAdventure</code> as your entry point for probing the adventure generation system.</li>
<li>Dive into <code class="inline-code">mergeQuestFilesFromConfig</code> to understand how configuration files tailor quest content to specific adventures.</li>
<li>Inspect the <code class="inline-code">extractUniqueFilePaths</code> function to see how file paths are validated and integrated into the quest pipeline.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries buried within the enchanted repository of Repoheim!</p>
<p>By the valor of your craftsmanship and the guiding aura of destiny, you have claimed victory in Quest 2, forging new mastery in the realm of adventure‚Äîlet this triumph shine as a jeweled beacon on your heroic path ahead! ‚öîÔ∏èüíéüöÄ</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>