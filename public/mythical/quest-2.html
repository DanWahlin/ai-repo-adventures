<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Forge of the Questsmith - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Kingdom of Code</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Forge of the Questsmith</h1>
<hr>
<p>In the mystical Forge of the Questsmith, where the flames of enchantment meld together raw ideas into artifacts of adventure, the Repository beckons brave Developers to unravel its intricate spells. Within this hallowed anvil of creativity, scrolls and tomes hide arcane knowledge of how to craft dynamic quests that respond to a kingdom‚Äôs unique fabric. Today, you venture forth into the Forge, piecing together how the magic of stories and quests is woven into the grand tapestry of the Enchanted Kingdom of Code.</p>
<p>Let your tools ‚Äì enchanted functions, magical configurations, and the flames of creativity ‚Äì guide you as you uncover the spellwork behind adventure generation!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>The Art of Configurations</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function validate and transform mystical raw data into structured, usable context for quests?</li>
<li>‚ö° <strong>The Forge‚Äôs Mechanisms</strong>: How does the <code class="inline-code">generateQuestContent</code> function summon detailed quest content using the raw magic of quest definitions and thematic energies?</li>
<li>üõ°Ô∏è <strong>Patterns of Safety</strong>: What safeguards are implemented in <code class="inline-code">AdventureManager.initializeAdventure</code> to ensure the adventure creation process remains controlled yet flexible?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Scrolls</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file acts as the blueprint for extracting, parsing, and validating settings from the Repository, ensuring the Forge has access to the precise materials for its creations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Uses file spells to retrieve raw configuration data from the Repository.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Transforms the raw contents into structured entities, ensuring safe and usable outputs.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts referenced file paths within configuration scrolls and verifies their existence.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> The Master Questsmith</h3>
<p>This file represents the central mechanism for managing the art of forging quests and adventures. It ensures the Questsmith remains guided by the enchanted scrolls at their disposal.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Prepares the Repository‚Äôs resources, blends them with chosen themes, and crafts the foundational narrative of the adventure.</li>
<li><code class="inline-code">exploreQuest</code>: Guides Developers through selected quests, ensuring seamless navigation between storytelling and implementation.</li>
<li><code class="inline-code">validateQuestPrerequisites</code>: Verifies that all required conditions are met before a quest is explored, ensuring the Forge does not falter.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> The Storyweaver‚Äôs Incantations</h3>
<p>The <code class="inline-code">story-generator.ts</code> file conjures thematic narratives and quest details by combining the Forge‚Äôs raw materials with the lyrical wisdom of enchanted algorithms.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateQuestContent</code>: Creates detailed quest outcomes using both code-based and thematic inspirations.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Processes and breaks down markdown-based lore from the Repository into structured quests.</li>
<li><code class="inline-code">buildStoryGenerationPrompt</code>: Crafts specialized prompts for summoning LLM-based guidance tailored to the kingdom‚Äôs themes.</li>
</ul>
<hr>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Handles raw spell scrolls (<code class="inline-code">adventure.config.json</code>) and transforms them into structured objects.</li>
<li>Uses JSON parsing techniques, with built-in protections, to ensure corrupted scrolls do not disrupt the Forge‚Äôs magical balance.</li>
<li>Forms the backbone of configuration validation, preventing misaligned quest definitions from casting unpredictable spells.</li>
<li>Works in tandem with <code class="inline-code">loadAdventureConfig</code> to retrieve only essential wisdom.</li>
<li>Watch for the null-safe mechanisms designed to protect the system from external mischief.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Gathers the threads of referenced file paths across configuration scrolls using recursive exploration.</li>
<li>Employs <code class="inline-code">Set</code> to ensure only unique magical runes (file paths) are included.</li>
<li>Uses validation spells (<code class="inline-code">fs.existsSync</code>) to verify that no illusionary paths distort the system‚Äôs integrity.</li>
<li>Illustrates the stack-based depth-first traversal approach to parsing.</li>
<li>Vital for ensuring that all Scroll-based files are genuine residents of the Repository.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string, customThemeData?: CustomThemeData): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = storyResponse.quests;

  return this.formatStoryWithQuests(storyResponse);
}
</code></pre>
<ul>
<li>Resets the Forge (state) to prepare for a fresh adventure.</li>
<li>Infuses configuration scrolls and thematic descriptions to shape the overarching tale.</li>
<li>Calls upon <code class="inline-code">StoryGenerator</code> to weave threads of synthetic wisdom with core data artifacts.</li>
<li>Transparently merges tale generation, ensuring each scroll contributes to the larger narrative.</li>
<li>Incorporates safety checks to prevent theme mismatches or incomplete adventures.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  const quest = this.findQuest(sanitizedChoice);
  
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Ensures user inputs (quest selections) are validated using enchanted sanitization filters.</li>
<li>Handles mismatched or unrecognized choices gracefully, preventing disruptions.</li>
<li>Relies on modularized functions (<code class="inline-code">findQuest</code>, <code class="inline-code">executeQuest</code>) to streamline progression.</li>
<li>Highlights the flow of selecting and executing adventures without exposing Developers to internal complexities.</li>
<li>Key to ensuring an intuitive interface with end-users and their quests.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const { quest, theme, codeContent, questPosition, totalQuests } = config;

  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    questPosition,
    totalQuests
  });

  const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST });

  return { adventure: response.content.trim() };
}
</code></pre>
<ul>
<li>Combines theme, quest details, and project context to summon detailed exploration content.</li>
<li>Uses structured prompts to leverage the Repository‚Äôs enchanted LLM wisdom.</li>
<li>Ensures each quest receives thematic guidance tailored to its exact specifications.</li>
<li>Balances runtime efficiency with precision, preparing vast amounts of code while reducing excess processing.</li>
<li>Illustrates how configuration data transforms dynamically into enriched narratives.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">extractUniqueFilePaths</code> to trace the layers of configuration spellwork and examine their impact on quests.</li>
<li>Pay attention to how <code class="inline-code">initializeAdventure</code> manages state and external calls.</li>
<li>Dive into <code class="inline-code">generateQuestContent</code> to see how thematic metadata combines with code.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Enchanted Kingdom of Code.</p>
<p>Hail, brave hero‚Äîby conquering the Forge of the Questsmith, you have tempered your mind with new wisdom and kindled your destiny‚Äôs flame; press forward, for the stars themselves now whisper of your triumph! ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>