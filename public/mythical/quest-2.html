<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Quest Generation Codex - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Code: The Enchanted Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Quest Generation Codex</h1>
<hr>
<p>In the mythical Kingdom of Code, the Quest Generation Codex is an ancient spellbook said to hold the secrets of weaving interconnected adventures. This enchanted book was scattered across three vital scrolls, hidden in the depths of the Codebase Castle. King Repo has tasked you with recovering these fragments from the <code class="inline-code">adventure-manager.ts</code>, the <code class="inline-code">adventure-config.ts</code>, and the <code class="inline-code">story-generator.ts</code> files.</p>
<p>The Mystic Compiler warns that only through deciphering the spells of initialization, exploration, and content creation will you succeed in restoring the lost Codex. Brave adventurer, the future of narrative magic rests in your scroll-reading prowess.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Codex Initialization</strong>: How does the <code class="inline-code">AdventureManager</code> initialize the Kingdom&#39;s adventures and manage their context?</li>
<li>‚ö° <strong>Codex Exploration</strong>: What mechanisms allow the <code class="inline-code">AdventureManager</code> to validate and execute selected quests?</li>
<li>üõ°Ô∏è <strong>Codex Composition</strong>: How does the <code class="inline-code">StoryGenerator</code> construct stories and generate adventure content?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Managing the adventure state and quest orchestration</h3>
<p>This file reveals the core mechanisms for initializing quests, exploring them, and maintaining the <code class="inline-code">AdventureState</code>. The <code class="inline-code">AdventureManager</code> class orchestrates quest selection, story generation, and content validation. Key highlights include how adventures are initiated using project themes (<code class="inline-code">initializeAdventure</code>), quest execution (<code class="inline-code">exploreQuest</code>), and progress tracking (<code class="inline-code">progressPercentage</code>).</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: Adventure setup with project context and themes</li>
<li><code class="inline-code">AdventureManager.exploreQuest</code>: Execution of quests chosen by the adventurer</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Tracking completed quests as a percentage</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Configuration parsing and file extraction</h3>
<p>This file offers insight into how adventure configurations are parsed from JSON and transformed into manageable entities. It plays a vital role in merging external configurations with procedural story generation. Key highlights focus on configuration interpretation and file path extraction.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Converts raw JSON adventure configurations into structured objects</li>
<li><code class="inline-code">loadAdventureConfig</code>: Reads metadata files required for adventure generation</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Gathers file paths referenced within the configuration</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Generating mythical tales</h3>
<p>This file is where stories come alive. The <code class="inline-code">StoryGenerator</code> integrates project context and themes into dynamic prompts for story and quest creation. By leveraging structured data and validation, it ensures consistency and immersion in the adventures. Key points include story generation, quest content handling, and theme guidelines.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">StoryGenerator.generateStoryAndQuests</code>: Core functionality for initiating stories and quest lists</li>
<li><code class="inline-code">StoryGenerator.generateQuestContent</code>: Tailors quest content using code-relevant context</li>
<li><code class="inline-code">loadAdventureConfig</code>: Loads guidance for templated adventure setups</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(
    projectInfo, 
    theme, 
    this.state.projectPath
  );

  this.state.title = storyResponse.title;
  this.state.quests = this.enforceConfigQuestCount(
    this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath), 
    this.state.projectPath
  );

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>This initializes an adventure with its context, quests, and thematic direction, akin to selecting a magical scroll for your journey.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<p>Ensures quest exploration proceeds only after charmed validation, much like testing the purity of an enchanted blade.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>This calculates progress as a percentage, ensuring every step is a measurable climb toward the castle&#39;s pinnacle.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Here, raw JSON transforms into actionable configurations, much like enchanting runes for deciphering arcane maps.</p>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<p>This loads adventure metadata and establishes the boundary for your narrative world, like consulting a crystal ball.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (node &amp;&amp; typeof node === &#39;object&#39; &amp;&amp; typeof node.path === &#39;string&#39;) {
      unique.add(node.path.trim());
      stack.push(...Object.values(node));
    }
  }

  return Array.from(unique);
}
</code></pre>
<p>Harvests file paths like shards of a crystal, ensuring no valuable clue escapes the adventurer&#39;s grasp.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  const adventureGuidance = formatAdventureConfigForPrompt(projectPath || &#39;&#39;);
  const response = await this.withTimeout(
    this.llmClient.generateResponse(
      loadStoryGenerationPrompt({
        theme,
        repomixContent: projectInfo.repomixContent || &#39;&#39;,
        adventureGuidance
      }),
      { maxTokens: LLM_MAX_TOKENS_STORY }
    )
  );

  const parsed = parseMarkdownToStoryResponse(response.content || &#39;&#39;);
  return StoryResponseSchema.parse(parsed);
}
</code></pre>
<p>Constructs mythical tales by blending enchanting guidance with the kingdom&#39;s context, like weaving an ancient tapestry.</p>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest, 
  theme: AdventureTheme, 
  codeContent: string
): Promise&lt;QuestContent&gt; {
  const adventureGuidance = formatAdventureConfigForPrompt(this.projectPath || &#39;&#39;);
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    adventureGuidance
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );

  return {
    adventure: response.content.trim(),
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<p>Generates quest details from the ether of possibility, turning generic context into personal inquiries for heroes.</p>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, &#39;adventure.config.json&#39;);
  return fs.existsSync(configPath) ? fs.readFileSync(configPath, &#39;utf-8&#39;) : null;
}
</code></pre>
<p>Gathers adventure configurations directly from the source, ensuring no secret spell is overlooked.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Ensure that all paths are valid to retrieve full story contexts.</li>
<li>Use the <code class="inline-code">progressPercentage</code> to track progress and optimize your quest order.</li>
<li>Study the quest-merging mechanics in <code class="inline-code">adventure-manager.ts</code> to understand how configurations influence outcomes.</li>
</ul>
<hr>
<p>The Codex awaits, reconstructed at your hands! Step forth and reclaim harmony in the Kingdom of Code!</p>
<p>With the wisdom of ancient sages unlocked in the Quest Generation Codex, you ascend as a luminous champion, blazing the trail toward triumph in the kingdom&#39;s grand odyssey‚Äîshield high and destiny at hand! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>