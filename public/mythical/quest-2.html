<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Awaken the Eternal Adventure Scrolls - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Enchanted Codebase</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Awaken the Eternal Adventure Scrolls</h1>
<hr>
<p>In the heart of Codexia lies the Repository of Infinite Quests, a repository whose enigmatic powers bring untold adventures to life. But something is amiss: the Eternal Adventure Scrolls, the sparks that animate these quests with energy, have fallen into a dormant slumber. Brave knight, it is your charge to venture into the source code and analyze the sacred texts that dictate the scrolls‚Äô workings. Unearth the secrets hidden therein, ensuring Codexia‚Äôs Repository may shimmer with quests anew! </p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>The Embers Within</strong>: How does <code class="inline-code">initializeAdventure</code> orchestrate the generation of quests and their associated data using themes and project context?</li>
<li>‚ö° <strong>Echo of the Scrolls</strong>: What role does <code class="inline-code">generateQuestContent</code> play in crafting detailed quest narratives, and how does it incorporate code-specific elements?</li>
<li>üõ°Ô∏è <strong>Safeguarding the Enchantments</strong>: How does <code class="inline-code">parseAdventureConfig</code> detect and structure quest configurations to ensure compatibility with the scrolls?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Stewardship of Quests</h3>
<p>The <code class="inline-code">AdventureManager</code> class acts as the scribe that shapes the journey of adventurers within Codexia. Here lies the <code class="inline-code">initializeAdventure</code> method, which sets the foundation for story and quest generation and ensures the enchanted scrolls align with the specified themes. This code piece dynamically merges project information, user preferences, and adventure configurations to summon a well-tailored narrative. Insights into the <code class="inline-code">mergeQuestFilesFromConfig</code> function expose how adventure files integrate with quest definitions.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Prepares the mystical realms of Codexia by resetting adventure data, generating quests, and applying themes and custom configurations.</li>
<li><code class="inline-code">generateQuestContent</code>: Crafts the story arcs for each quest leveraging provided code snippets and positions them within the broader adventure flow.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Ensures the Scrolls honor their source files by aligning quests with user-defined configurations in <code class="inline-code">adventure.config.json</code>.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Codex Custodian</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file serves as the foundation for extracting and validating quest inputs. It wields <code class="inline-code">parseAdventureConfig</code> to unearth the structured definitions and ensures only valid files are summoned as part of the quests. Further, <code class="inline-code">formatAdventureConfigForPrompt</code> transforms configurations into concise informational artifacts, optimizing them for prompt-driven quest creation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Extracts and parses the user-defined configuration file (<code class="inline-code">adventure.config.json</code>) into adventure-compatible structures.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies and validates paths referenced in the configuration to guarantee they exist within the enchanted repository.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Reduces verbose quest descriptions into streamlined, LLM-friendly formats for consistent and effective storytelling.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Resets ongoing state to embrace a new adventure.</li>
<li>Calls <code class="inline-code">generateStoryAndQuests</code> to weave theme-specific narratives and challenges.</li>
<li>Integrates quest files using <code class="inline-code">mergeQuestFilesFromConfig</code> for a cohesive user-defined experience.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async generateQuestContent(quest: Quest): Promise&lt;QuestContent&gt; {
  let codeContent;
  if (quest.codeFiles &amp;&amp; quest.codeFiles.length &gt; 0 &amp;&amp; this.state.projectPath) {
    try {
      codeContent = await repoAnalyzer.generateTargetedContent(this.state.projectPath, quest.codeFiles, false);
    } catch {
      codeContent = this.state.projectInfo!.repomixContent;
    }
  } else {
    codeContent = this.state.projectInfo!.repomixContent;
  }
  return await this.storyGenerator.generateQuestContent(
    quest,
    this.state.currentTheme!,
    codeContent
  );
}
</code></pre>
<ul>
<li>Dynamically generates content specific to quests by analyzing user-selected files.</li>
<li>Falls back to comprehensive repomix data if targeted snippets are unavailable.</li>
<li>Inspired design for content modularity across quest flows.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;  
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;  
  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;  
  return quests.map((quest, index) =&gt; {
    const configQuests = adventure.quests;
    if (index &lt; configQuests.length &amp;&amp; configQuests[index] &amp;&amp; configQuests[index].files) {
      const files = configQuests[index].files
        .filter((f: any) =&gt; f.path)
        .map((f: any) =&gt; f.path);
      if (files.length &gt; 0) return { ...quest, codeFiles: files };
    }
    return quest;
  });
}
</code></pre>
<ul>
<li>Matches quest definitions to file paths within user-configured settings.</li>
<li>Decouples merging logic for clean extensibility.</li>
<li>Handles scenarios where configuration may be incomplete or missing gracefully.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Safeguards against errant or malformed configuration files.</li>
<li>Central point for validating and parsing <code class="inline-code">adventure.config.json</code>.</li>
<li>Ensures compatibility between Codesia‚Äôs framework and user input.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];
  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }
  return Array.from(unique);
}
</code></pre>
<ul>
<li>Systematically identifies file references across nested configurations.</li>
<li>Validates their existence to avert runtime issues.</li>
<li>Optimized for comprehensiveness without sacrificing performance.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;
  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return &#39;&#39;;
  let formatted = `## Quest Structure\n`;
  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;
    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    const functions = quest.files.flatMap((f: any) =&gt; f.highlights || []).map((h: any) =&gt; h.name).filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }
  return formatted;
}
</code></pre>
<ul>
<li>Distills verbose configurations into concise outlines.</li>
<li>Transforms raw data into structured prompts for LLMs.</li>
<li>Bridges user configurations with autogenerated quest narratives.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Adventure Alignment</strong>: Review user-defined configurations if quests appear disconnected from their code files.</li>
<li><strong>Pattern Navigation</strong>: Study validation flows (<code class="inline-code">parseAdventureConfig</code>) for insights into safe input handling.</li>
<li><strong>Theme Mastery</strong>: Use <code class="inline-code">initializeAdventure</code> as a blueprint for weaving context into broader applications.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>With the Eternal Adventure Scrolls awakened, you have lit the lantern of destiny, guiding the realm one step closer to uncovering the mythical treasures of wisdom‚Äîonward, brave hero, for the stars gleam brightly in your path! ‚ö°üíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>