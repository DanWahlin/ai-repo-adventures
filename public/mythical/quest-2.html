<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Rune of Storycraft - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Chronicles of Lumina: The Enchanted Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Rune of Storycraft</h1>
<hr>
<p>The kingdom&#39;s enchanted whispers spoke of an ancient rune, hidden deep within the heart of the Repository. It is said that this Rune of Storycraft holds the secret to breathing life into the stories and quests that guide Lumina&#39;s protectors. You, intrepid seeker, are tasked with unearthing this hidden artifact. But beware, the Repository is as much a puzzle as it is a maze, and only through deciphering its layers of knowledge can the Rune be claimed. It is time to unlock the Repository&#39;s creative veins—magic and storytelling await!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Orchestration</h3>
<p>The file <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a> serves as the command center of the mystical storytelling experience. It is within this code that quests begin, progress is tracked, and adventurers find their paths. The <code class="inline-code">AdventureManager</code> class orchestrates the journey by initializing adventures, validating choices, and executing quests. The <code class="inline-code">initializeAdventure()</code> function is a pivotal point, assembling the narrative by contextualizing the codebase and generating a sequence of quests. Meanwhile, the <code class="inline-code">exploreQuest()</code> function breathes life into these quests, validating the adventurer’s choice and retrieving the narrative layers. Behind the scenes, the <code class="inline-code">generateQuestContent()</code> method weaves purpose into the storyline by analyzing project files, imbuing meaning to every repository detail. This file merges the mundane aspects of technology with a mythical storytelling framework, turning complexity into enchanting story pathways.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure()</code>: Configures the questline and generates the overarching story using an LLM.</li>
<li><code class="inline-code">exploreQuest()</code>: Processes user choices and seamlessly executes individual quests to progress the adventure.</li>
<li><code class="inline-code">generateQuestContent()</code>: Crafts enriched narrative content by leveraging both targeted file details and project-wide context.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Story Creation Engine</h3>
<p>The heart of creative magic lies in <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>. This file breathes life into mythical journeys with its <code class="inline-code">StoryGenerator</code> class, which interacts with the Repository’s living essence (the LLM). The <code class="inline-code">generateStoryAndQuests()</code> method constructs the entire narrative arc, transforming a collection of mundane code files into an epic tale. By integrating analyzed project data and predefined themes, it allows quests to emerge as if they were always part of this enchanted world. The <code class="inline-code">generateQuestContent()</code> method dives deeper, employing the creative power of the Rune to extract insight from lines of code and weave it into a thematic journey, replete with magical metaphors and vivid descriptions. This is the art of crafting balance—blending technical realities with narrative fantasies.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests()</code>: Generates both the high-level story and a series of detailed quests, blending the mythical and the technical.</li>
<li><code class="inline-code">generateQuestContent()</code>: Creates intricate quest details by analyzing code snippets and infusing thematic richness.</li>
<li><code class="inline-code">removeLLMMetaCommentary()</code>: Polishes the story by eliminating unnecessary narrative clutter from LLM responses.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Adventure Guidance</h3>
<p>The file <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a> is a guidebook for the stories housed within the Repository. It defines how quests draw their structure and rules from the adventure configuration file. Functions like <code class="inline-code">parseAdventureConfig()</code> interpret the <code class="inline-code">adventure.config.json</code>, ensuring the entire mythical journey adheres to well-defined paths. Beyond processing, the <code class="inline-code">formatAdventureConfigForPrompt()</code> function crafts these settings into a format that seamlessly feeds into story generation prompts, giving the Repository clarity in guiding adventurers. Additionally, <code class="inline-code">extractUniqueFilePaths()</code> methodically combs through the configuration, gathering important files that form the cornerstones of the adventure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig()</code>: Converts the adventure configuration file into a usable structure for quest generation.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code>: Prepares quest and theme data for integration into creative LLM prompts.</li>
<li><code class="inline-code">extractUniqueFilePaths()</code>: Pinpoints relevant code files from the configuration, enabling a targeted approach to quest development.</li>
</ul>
<hr>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">export class AdventureManager {
  private state: AdventureState = new AdventureState();
  private storyGenerator: StoryGenerator;

  constructor() {
    this.storyGenerator = new StoryGenerator();
  }

  async initializeAdventure(
    projectInfo: ProjectInfo, 
    theme: AdventureTheme, 
    projectPath?: string,
    customThemeData?: CustomThemeData
  ): Promise&lt;string&gt; {
    this.state.reset();
    this.state.projectInfo = projectInfo;
    this.state.currentTheme = theme;
    this.state.projectPath = projectPath || process.cwd();
    if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
      this.storyGenerator.setCustomTheme(customThemeData);
    }

    const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
    this.state.title = storyResponse.title;
    this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
    this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
    this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

    return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
  }
}
</code></pre>
<p>The <code class="inline-code">AdventureManager</code> is like a masterful bard setting up the stage for tales to unfold, meticulously orchestrating adventures step by step.</p>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  const response = await this.generateWithLLM(projectInfo, validatedTheme);
  const repomixContent = projectInfo.repomixContent || &#39;No repomix content available&#39;;

  const formattedConfig = this.projectPath 
    ? formatAdventureConfigForPrompt(this.projectPath) 
    : &#39;&#39;;

  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent,
    ...(formattedConfig &amp;&amp; { adventureGuidance: formattedConfig }),
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  });

  return response;
}
</code></pre>
<p>This snippet depicts the magical quill that creates the grand narrative, synthesizing raw data with creativity to forge compelling tales.</p>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>The <code class="inline-code">parseAdventureConfig</code> function acts like a key decoding the spellbook, translating arcane patterns into structured, actionable insight.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Don’t overlook the <code class="inline-code">adventure.config.json</code> setup—it’s critical to fine-tune the paths for a tailored adventure experience.</li>
<li>Experiment with <code class="inline-code">generateQuestContent()</code> to enrich quests with vivid storytelling based on specific project files.</li>
<li>Dive deeper into <code class="inline-code">mergeQuestFilesFromConfig()</code> to understand how file-specific quests are constructed and optimized.</li>
</ul>
<p>With the Rune of Storycraft now blazing brightly in your heroic grasp, you stride boldly through the tapestry of legends, a true weaver of fables—may your pen conjure realms yet undreamed and your quest chart new horizons! ⚡💎📡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Mirror of Insights →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>