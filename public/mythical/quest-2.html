<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Heroic Council of Questcrafting - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository: A Hero's Tale</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Heroic Council of Questcrafting</h1>
<hr>
<p>The kingdom of Codehaven stands in peril as the Codex of Creation, the mythical artifact that powers the realm‚Äôs adventures, has become increasingly unpredictable. Whispers of imbalance in the Codex echo across the land. To restore harmony, the Adventurer‚Äôs Guild has tasked you with advising the Heroic Council on crafting quests of unparalleled excellence. Your journey takes you deep into the magical workings of the Questcrafting Engine, where spells of generation, validation, and thematic crafting come to life.</p>
<p>Seek the secrets hidden within the enchanted parchments of the <code class="inline-code">adventure-manager.ts</code>, <code class="inline-code">adventure-config.ts</code>, and <code class="inline-code">story-generator.ts</code> scrolls. Will you heed the call, adventurer, and forge a path of discovery to save Codehaven?</p>
<p><strong>Adventure Awaits</strong> ‚Äì Join the council and explore the Codex‚Äôs mysteries!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Crafting Harmony</strong>: How does <code class="inline-code">AdventureManager</code> combine project context, themes, and quests to create an overarching narrative?</li>
<li>‚ö° <strong>Mystical Validation</strong>: What mechanisms are used to validate and sanitize quest choices, and why are they important in a magical realm prone to missteps?</li>
<li>üõ°Ô∏è <strong>Encoded Guidance</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> optimize the hierarchy of quests, ensuring the Codex responds faithfully to adventurers‚Äô needs?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: The Master of Ceremonies</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> is the central authority that governs the interplay of themes, project contexts, and quests. Acting as the master storyteller, the <code class="inline-code">AdventureManager</code> orchestrates the journey of the Codex explorers, creating quests, validating choices, and tracking progress. Its utility spans the entirety of the kingdom as it integrates LLM-powered generation with user interaction, ensuring no adventurer is left unguided.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Builds the overarching quest narrative by uniting themes, project details, and LLM-generated stories.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Ensures each user decision adheres to the kingdom‚Äôs laws, filtering out rogue or malformed inputs.</li>
<li><code class="inline-code">enforceConfigQuestCount</code>: Debates within the council to align generated quests with predefined boundaries dictated by the adventure configuration.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: The Chronicle Keeper</h3>
<p>This file serves as the repository of wisdom for Codex inputs. The <code class="inline-code">adventure-config.ts</code> ensures the Codex‚Äôs mysteries are well-organized and faithfully adheres to user-defined rules. It extracts, validates, and prepares configurations for the vaunted Story Generator and its magic.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Deciphers the enchanted adventure configuration, ensuring all quests adhere to their intended form.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Locates all referenced scrolls essential for generating quests, ensuring integration with existing lore.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Crafts the configuration into a succinct format optimized for interaction with the Codex‚Äôs magical prompt generator.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: The Artisan of Fables</h3>
<p>The <code class="inline-code">story-generator.ts</code> breathes life into Codehaven‚Äôs adventures. Responsible for constructing quest narratives and ensuring their thematic cohesion, it partners with the Adventure Manager to expand the legendary Codex in meaningful ways. This file is the enchanted brush that paints adventures across the kingdom.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Embarks on a quest to create the initial storyline and companion quests using the Codex‚Äôs magic.</li>
<li><code class="inline-code">generateQuestContent</code>: Draws upon repository context to summon specific file highlights and investigative prompts for each quest.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Tames the Codex‚Äôs markdown responses into well-structured stories and quests, ensuring readability and utility.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(
    projectInfo, theme, this.state.projectPath
  );

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.enforceConfigQuestCount(
    this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath),
    this.state.projectPath
  );
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This code generates the primary narrative and quests based on project context, enchanting the user experience.</li>
<li>Thematic customization plays a pivotal role, offering flexibility for both general themes and custom-designed adventures.</li>
<li>The layered merging of configurations ensures output coherence and alignment with user-defined preferences.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateAndSanitizeChoice(input: string): string {
  try {
    return validateAdventureChoice(input);
  } catch (error) {
    throw new Error(`Invalid adventure choice: ${error instanceof Error ? error.message : &#39;Unknown error&#39;}`);
  }
}
</code></pre>
<ul>
<li><code class="inline-code">validateAndSanitizeChoice</code> ensures adventurer input is clear, preventing unintended consequences within the quest crafting process.</li>
<li>This validation step shows the importance of proactive error handling to protect Codehaven‚Äôs magic.</li>
</ul>
<hr>
<pre><code class="language-typescript">private enforceConfigQuestCount(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;

  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;

  const configQuestCount = adventure.quests.length;
  if (quests.length &gt; configQuestCount) {
    return quests.slice(0, configQuestCount);
  }
  return quests;
}
</code></pre>
<ul>
<li>Limits generated quests to those specified in the adventure configuration, upholding balance in quest creation.</li>
<li>Demonstrates modularity in respecting pre-existing configurations, a cornerstone of maintainable systems.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Ensures that configuration inputs are parsed securely, a crucial tool for interpreting user-defined adventures.</li>
<li>Provides error resistance in handling invalid configurations, safeguarding the Codex from chaos.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];
  while (stack.length) {
    const node = stack.pop();
    if (node &amp;&amp; typeof node === &#39;object&#39;) {
      if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
        const rel = node.path.trim();
        if (fs.existsSync(path.resolve(projectPath, rel))) {
          unique.add(rel);
        }
      }
      const children = Array.isArray(node) ? node : Object.values(node);
      children.forEach(child =&gt; {
        if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
      });
    }
  }
  return Array.from(unique);
}
</code></pre>
<ul>
<li>Identifies all critical files referenced in the configuration, crucial for generating targeted content.</li>
<li>Promotes modularity within the kingdom‚Äôs body of enchanted scripts.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    const functions = quest.files.flatMap((f: any) =&gt; f.highlights || []).map((h: any) =&gt; h.name).filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Translates complex configurations into simplified summaries optimized for magical prompts.</li>
<li>Streamlines the communication between mortal adventurers and the Codex, enhancing efficiency.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>ü™Ñ Before exploring, ensure you understand the themes and strategies for quest generation.</li>
<li>üìú Pay close attention to how configurations intersect with quest generation for project-specific tailoring.</li>
<li>üîç Review error-handling techniques in parsing to learn resilience practices for enchanted scripts.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Codex‚Äôs hidden power.</p>
<p>By the might of the celestial forge and the council‚Äôs enchanted wisdom, you have unlocked the first jewel of the heroic journey‚Äîride forth, brave champion, for legendary triumph beckons! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>