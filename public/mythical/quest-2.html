<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Mystic Gateway ‚Äî Summoning the MCP Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Elder Codex: Chronicles of the Enchanted Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Mystic Gateway ‚Äî Summoning the MCP Tools</h1>
<hr>
<p>The Elder Codex crackles with instability, sending ripples of uneasy energy across the halls of the Kingdom of Repoaether. A shrill voice echoes through the repository chambers: ‚ÄúThe MCP Tools must be summoned!‚Äù As the Chosen Architect, you are beckoned to unlock the Mystic Gateway that binds the Codex‚Äôs energies to the tools it powers. Journey toward understanding these enchanted instruments, their functions hidden deep in the repository&#39;s layers, and restore harmony to the Codex‚Äôs ancient magic.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server protocol implementation that hosts the adventure tools</h3>
<p>The file <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> stands as the magical foundation of the MCP server protocol, where the tools used to navigate the Elder Codex are harnessed. The primary guardian of this gateway is <code class="inline-code">RepoAdventureServer</code>, whose core responsibility is to setup handlers and ensure harmonious connectivity. Within the file, the <code class="inline-code">setupHandlers()</code> method is where the enchantments of the MCP protocol come alive. It prepares the tools that enable developers to explore the Codex interactively by defining routes and functional paths such as <code class="inline-code">ListTools()</code> and <code class="inline-code">CallTool()</code>. Another critical defender is the <code class="inline-code">run()</code> method, which connects the repository‚Äôs mystical <code class="inline-code">stdio</code> transport‚Äîan ethereal channel allowing seamless command execution. The <code class="inline-code">main()</code> function completes this charm by gracefully handling shutdowns to prevent the Codex‚Äôs glyphs from scattering and ensures error recovery protocols are in place.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers()</code>: Orchestrates tool interaction by registering protocol routes.</li>
<li><code class="inline-code">RepoAdventureServer.run()</code>: Establishes connection to <code class="inline-code">stdio</code> transport and pre-generates repomix content for quests.</li>
<li><code class="inline-code">main()</code>: Acts as the stable entry point with error recovery and handling shutdowns.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The 4 main MCP tools for interacting with the adventure system</h3>
<p>The file <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> houses the mighty MCP tools that empower adventurers to unravel the mysteries of the Codex. These tools form the heart of user interactivity, each serving a unique purpose in supporting quest progression. The <code class="inline-code">start_adventure.handler</code> acts as the opening spell, analyzing repositories to present theme options for quests‚Äîcapturing the essence of the adventure itself. Once the theme is chosen, <code class="inline-code">choose_theme.handler</code> casts a magical net, summoning stories tailored to the user‚Äôs selection. The <code class="inline-code">explore_quest.handler</code> method dives into adventures dynamically, unlocking hidden knowledge with each completed quest. Finally, <code class="inline-code">view_progress.handler</code> provides mystical insight into the adventurer‚Äôs achievements, tallying completed quests against the majestic roadmap etched into the Elder Codex.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Initiates analysis of repositories and sets the stage for quest theme selection.</li>
<li><code class="inline-code">choose_theme.handler</code>: Pulls thematic stories and adventures based on user input.</li>
<li><code class="inline-code">explore_quest.handler</code>: Propels the adventurer forward to explore individual quests.</li>
<li><code class="inline-code">view_progress.handler</code>: Tracks completion statistics and remaining quests.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">export class RepoAdventureServer {
  setupHandlers() {
    this.tools.registerHandler(&#39;ListTools&#39;, listToolsHandler);
    this.tools.registerHandler(&#39;CallTool&#39;, callToolHandler);
  }

  run() {
    const transport = new StdioServerTransport();
    this.connect(transport);
    console.log(&#39;üéâ Server is now running!&#39;);
  }
}

function main() {
  try {
    const server = new RepoAdventureServer();
    server.setupHandlers();
    server.run();

    process.on(&#39;SIGINT&#39;, () =&gt; handleGracefulShutdown(server));
    process.on(&#39;SIGTERM&#39;, () =&gt; handleGracefulShutdown(server));

  } catch (error) {
    console.error(&#39;An error occurred:&#39;, error.message);
  }
}
</code></pre>
<p>Much like knights readying their armor before riding into battle, <code class="inline-code">setupHandlers()</code> prepares the tools that adventurers need to face the Codex‚Äôs challenges.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = {
  handler: async (request) =&gt; {
    const themeOptions = await analyzeRepository(request.projectPath);
    return { themes: themeOptions };
  }
};

export const choose_theme = {
  handler: async (request) =&gt; {
    const story = await generateThemeStories(request.theme);
    return { storyContent: story };
  }
};

export const explore_quest = {
  handler: async (request) =&gt; {
    const questResult = await executeQuest(request.questID);
    return { questDetails: questResult };
  }
};

export const view_progress = {
  handler: async (request) =&gt; {
    const progress = calculateProgress(request.userID);
    return { progressStats: progress };
  }
};
</code></pre>
<p>Just as spellcasters wield their wands to cast different enchantments, these functions let adventurers summon quests, themes, and their progress through the Codex using magical commands.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use the MCP server&#39;s handlers like <code class="inline-code">setupHandlers()</code> to explore additional protocol paths and adventure tools.</li>
<li>Dive deeper into the handlers in <code class="inline-code">tools.ts</code> to uncover how each MCP tool contributes to quest progression and user interaction.</li>
<li>Experiment with extending the <code class="inline-code">view_progress.handler</code> to add visual insights for completed tasks.</li>
</ul>
<p>Hear ye, valiant hero, for with the summoning of the MCP Tools, thou hast unlocked the Mystic Gateway and lit the first beacon on thy noble journey ‚Äî onward to glory! ‚ö°üíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Omen of Knowledge ‚Äî The Sec... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>