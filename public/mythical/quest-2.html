<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Arcane Engine of Adventures - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Kingdom of Code</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Arcane Engine of Adventures</h1>
<hr>
<p>In the mythical realm of Codathia, you have unlocked the next chapter of your noble journey! The sacred Spellbook of Development emanates a soft, warm glow as you prepare to delve into &quot;The Arcane Engine of Adventures.&quot; This enchanted mechanism, intricately wrought from ancient magic and logic, is said to hold the power to weave entire realms into existence. Only by mastering its intricate spells‚Äîhidden within intertwined scrolls of code‚Äîcan you restore Codathia&#39;s fragile balance. Prepare yourself, brave coder-knight, to face systems that harness creativity and precision alike.</p>
<h2>Quest Objectives</h2>
<p>As you examine the enchanted code below, seek answers to these mysteries:</p>
<ul>
<li>üîç <strong>Quest Weaving</strong>: How does <code class="inline-code">initializeAdventure</code> orchestrate the creation of the story and quests, tying input themes to folder paths and configurations?</li>
<li>‚ö° <strong>Path of Discovery</strong>: In what ways does <code class="inline-code">AdventureManager.exploreQuest</code> locate and retrieve the appropriate adventure based on user choices? What safeguards are in place for invalid selections?</li>
<li>üõ°Ô∏è <strong>Mystic Boundaries</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure the integrity of the &quot;adventure.config.json&quot; file, and how are erroneous configurations handled?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: The heart of the adventure engine</h3>
<p>This file serves as the controller of the magical engine that drives all adventures, from initializing quests to guiding explorers through their chosen paths. It provides core methods to generate stories, validate user input, and ensure the synchronization of quests with external configurations. Pay close attention to methods like <code class="inline-code">initializeAdventure</code>, which bridges creative themes with technical configurations, and <code class="inline-code">exploreQuest</code>, which governs the interaction between adventurers and the arcane selections they make.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Establishes project context, selects themes, and generates both the overall narrative and individual quests, merging them with configuration file data to ensure consistency.</li>
<li><code class="inline-code">exploreQuest</code>: Validates and processes user choice, determining the correct quest to execute while handling errors gracefully.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: A private utility that uses input validation to ensure only legitimate quest identifiers are used.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  
  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>The <code class="inline-code">initializeAdventure</code> method resets the magical state, establishes the narrative context based on the chosen theme, and seamlessly integrates the details of external saga configurations.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code> ensures that quests align with project-specific data, giving coherence to the stories.</li>
<li>This implementation embraces a fail-safe approach, falling back to default paths in the absence of necessary inputs, ensuring resilience.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  // Check if this is a progress request
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  // Find the quest based on the choice
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  // Execute the quest
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>The <code class="inline-code">exploreQuest</code> method validates the adventurer‚Äôs choice and determines the appropriate path between ongoing quests and progress updates. </li>
<li>By invoking <code class="inline-code">validateAndSanitizeChoice</code>, it ensures invalid entries do not disrupt the flow, safeguarding the system.</li>
<li>Provisions are implemented for error handling, such as producing a &quot;Quest not found&quot; result when necessary.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateAndSanitizeChoice(input: string): string {
  try {
    return validateAdventureChoice(input);
  } catch (error) {
    throw new Error(`Invalid adventure choice: ${error instanceof Error ? error.message : &#39;Unknown error&#39;}`);
  }
}
</code></pre>
<ul>
<li>This utility function leverages predefined input validation mechanisms, providing a protective boundary against malformed or adversarial inputs.</li>
<li>The approach follows the principle of a single responsibility, isolating validation logic to ensure clear code structure and readability.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<p>This file encapsulates the mechanics for parsing and handling the &quot;adventure.config.json&quot; file, ensuring the configuration remains an honest reflection of the greater Spellbook‚Äôs knowledge. It emphasizes the validation of external data sources to reinforce trust within the realm&#39;s arcane systems.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Attempts to parse and validate the configuration file, returning <code class="inline-code">null</code> if errors occur, ensuring no unintended failures propagate.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Collects all accessible file paths referenced in the configuration, verifying the existence of each.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the configuration structure for integrations, using a careful balance of strictness and flexibility.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>The <code class="inline-code">parseAdventureConfig</code> function ensures safe handling of JSON parsing, gracefully mitigating potential structural issues within the configuration file.</li>
<li>Emphasis is placed on resilience, avoiding hard failures while incorporating extensibility for future improvements.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Explore how the state management in <code class="inline-code">AdventureManager</code> bridges narrative logic with external files‚Äîobserve the seamless merging of magical stories through resilient code.</li>
<li>Pay attention to error handling patterns in both <code class="inline-code">validateAndSanitizeChoice</code> and configuration-related functions.</li>
<li>Reflect on how <code class="inline-code">parseAdventureConfig</code> provides a secure interface for external data, reinforcing durability within interconnected systems.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>By the decree of the celestial council, your triumph over Quest 2: The Arcane Engine of Adventures sets the realm ablaze with the brilliance of your heroic resolve‚Äî20% closer to forging a legacy that will echo through the halls of myth! ‚ö°üíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>