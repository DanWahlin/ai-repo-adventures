<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Chronicle of the Quest Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Kingdom of Codemiria</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Chronicle of the Quest Engine</h1>
<hr>
<p>In the mystical heart of Codemiria, the Chronicle of the Quest Engine rests inside the Tower of Logic. This realm, where spells of logic shape the enchanted systems, relies on the harmony of knights, wizards, and storytellers. Yet, a shadow threatens Codemiria‚Äîits Quest Engine, the magical force that breathes life into adventures, has started to falter. The source of its power dwindles, and heroes are called forth to investigate its secrets hidden within its intricate incantations.</p>
<p>Journey into the Quest Engine and uncover the arcane workings of <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code>. Explore how stories are woven, themes applied, and great chronicles birthed by Codemiria&#39;s enchanted codex.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Foundations of Adventure</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> craft the narrative and assign the quests? What role does <code class="inline-code">AdventureState.progressPercentage</code> play in the grand tale?</li>
<li>‚ö° <strong>Forge of Stories</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> collaborate to create the overarching story? What resources and spells does it invoke?</li>
<li>üõ°Ô∏è <strong>Imbuing Config Magic</strong>: How does <code class="inline-code">parseAdventureConfig</code> extract custom rules for configurations? How are the files and restrictions for quests defined through this spell?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Managing Kingdom Adventures</h3>
<p>Within this file lies the <code class="inline-code">AdventureManager</code> class, a masterful enchanter responsible for orchestrating the quests and managing their lifecycles. At the heart of this artifact lies the <code class="inline-code">initializeAdventure</code> method, which summons a new narrative and imbues it with context such as project details, themes, and custom data. Completing this tapestry is <code class="inline-code">AdventureState.progressPercentage</code>, an artifact forged to measure the hero‚Äôs journey.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Configures the adventure by preparing themes, paths, and quests. Collaborates with <code class="inline-code">StoryGenerator</code> to summon narratives.</li>
<li><code class="inline-code">exploreQuest</code>: Executes specific quests based on adventurer‚Äôs choices, utilizing cached memories to revisit completed stories with precision.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: A key utility that calculates the adventurer&#39;s progress, ensuring their journey through Codemiria is clearly marked.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> The Tale Weaver</h3>
<p>Here resides the mystic <code class="inline-code">StoryGenerator</code>, a creator of epic chronicles. With tools like <code class="inline-code">generateStoryAndQuests</code>, this weaver etches the grand narrative and constructs the journeys from the magical configurations provided. It ensures every quest feels alive, powered by validated themes and Codemiria‚Äôs vast story-telling spells.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Orchestrates the LLM to extract narrative elements, quests, and overarching stories from the configured input.</li>
<li><code class="inline-code">buildStoryGenerationPrompt</code>: Constructs a detailed request for the LLM, wrapping it in Codemirian storytelling linguistics for precision.</li>
<li><code class="inline-code">generateQuestContent</code>: Perfects the essence of each quest, imbuing detailed explorations and challenges for the adventurer.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Codex of Configuration</h3>
<p>This file contains the powerful spells used to read and interpret the <code class="inline-code">adventure.config.json</code> codex. The methods here, such as <code class="inline-code">parseAdventureConfig</code>, channel the repository‚Äôs state and transform JSON inputs into actionable elements that guide quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses the codex to understand special instructions, quest counts, and file specifics for personalized crafting.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Weaves together unique file paths from the configuration to streamline adventurers‚Äô focus.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the codex for clear and efficient inclusion in LLM prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Configures initialization by resetting and applying new themes, paths, and custom data.</li>
<li>Collaborates with <code class="inline-code">StoryGenerator</code> to summon narratives and define quests.</li>
<li>Invokes methods to merge and enforce rules from external configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Dynamically calculates progress as a percentage.</li>
<li>Forms a feedback loop for adventurers to measure their performance.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  const response = await this.generateWithLLM(projectInfo, validatedTheme);

  return response;
}
</code></pre>
<ul>
<li>Begins the journey of story creation by validating the theme and invoking collaboration with the LLM.</li>
<li>Bridges project context and thematic design into cohesive narratives.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async generateWithLLM(projectInfo: ProjectInfo, theme: AdventureTheme): Promise&lt;StoryResponse&gt; {
  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent: projectInfo.repomixContent || &#39;No content&#39;,
    ...this.getOptionalConfig()
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY })
  );

  const parsed = parseMarkdownToStoryResponse(response.content.trim());
  return parsed;
}
</code></pre>
<ul>
<li>Communicates with the LLM to conjure detailed stories.</li>
<li>Processes and validates results to ensure usable data.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Reads the configuration codex and transforms JSON inputs into usable objects.</li>
<li>Safeguards against errors to ensure robust quest generation.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed) return &#39;&#39;;

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return &#39;&#39;;

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    formatted += `Files: ${quest.files.map((f: any) =&gt; f.path).filter(Boolean).join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Optimizes the configuration for LLM consumption, trimming redundant data.</li>
<li>Ensures clarity and brevity for enhanced processing.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>ü™Ñ Always examine how <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code> interact, as they form the foundation of narrative orchestration.</li>
<li>üìú Explore the configuration utilities closely‚Äîthey shape the bounds of every crafted quest.</li>
<li>üõ† Use the hints embedded in the quest objectives to focus your investigation.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries in Codemiria‚Äôs enchanted systems!</p>
<p>Hark, valiant traveler, you have etched your legend upon the eternal scrolls of destiny by conquering &quot;Quest 2: Chronicle of the Quest Engine,&quot; earning the favor of the stars ‚≠ê and fortifying your heroic odyssey to realms unknown! ‚öîÔ∏è‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>