<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Scrolls of Questcraft — The Adventure Generation Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Mystic Code of Eldoria</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Scrolls of Questcraft — The Adventure Generation Engine</h1>
<hr>
<p>In the heart of the Enchanted Repository, where lines of code hum with ancient magic, lies a powerful artifact: the Scrolls of Questcraft. These scrolls are imbued with the power to weave tales of mythical journeys, casting legendary heroes into adventures guided by the arcane logic of the Adventure Generation Engine. To restore the balance of Eldoria, you must decipher their intricate glyphs, navigate their enchanted constructs, and breathe life into their coded spells. The magic of the Scrolls is strong, beckoning you deeper into the Repository’s labyrinth. Will you heed its call?</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure orchestration managing state, themes, and user interactions</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file acts as the beating heart of the Questcraft engine, channeling untamed magic into structured adventures. It orchestrates the flow of each adventure, tracking the hero’s progress, initializing quests, and weaving narrative threads. At its core lies the <code class="inline-code">AdventureManager</code> class, which facilitates the initialization of quests through <code class="inline-code">initializeAdventure()</code> and handles the hero’s choices during exploration with <code class="inline-code">exploreQuest()</code>. The <code class="inline-code">AdventureState</code> class complements the engine, storing vital information like completed quests, progress metrics, and cached content. By connecting to the mystical <code class="inline-code">StoryGenerator</code>, the manager ensures every choice contributes toward the harmonious unraveling of Eldoria&#39;s destiny.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure()</code> initializes the adventure by generating stories and quests based on the project’s mystical context and chosen theme.</li>
<li><code class="inline-code">exploreQuest()</code> validates user choices and guides heroes through their selected quests.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code> calculates and tracks completion, an indicator of the hero’s journey through the scrolls.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> LLM-powered story creation with theme-based narratives</h3>
<p>The <code class="inline-code">story-generator.ts</code> file is the enchanted pen that writes Eldoria’s tales. Here, the magic of LLMs (Language-Linked Manuscripts) is harnessed to craft dynamic quests. The <code class="inline-code">StoryGenerator</code> class handles story generation, turning project details and theme selections into immersive narratives. Key functions include <code class="inline-code">generateStoryAndQuests()</code> for conjuring the overarching story and <code class="inline-code">generateCompletionSummary()</code> for encapsulating the hero’s journey upon finishing a quest. By deciphering the glyphs hidden in the repository&#39;s code, the generator spins tales that blend mythical themes with technical explorations, ensuring a seamless marriage of magic and logic.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests()</code> creates a connected narrative and list of quests using structured prompts and LLM magic.</li>
<li><code class="inline-code">generateQuestContent()</code> weaves the details of a selected quest by analyzing repository content and applying theme guidelines.</li>
<li><code class="inline-code">removeLLMMetaCommentary()</code> ensures the purity of narrative by filtering out extraneous patterns from LLM responses.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Centralizing logic for adventure configuration</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file acts as the codex for the Scrolls of Questcraft, a detailed manual guiding how quests are structured and analyzed. It provides clarity and focus to the generation engine, ensuring adventures are aligned with predefined rules. The <code class="inline-code">parseAdventureConfig()</code> function validates the configuration file <code class="inline-code">adventure.config.json</code>, while <code class="inline-code">formatAdventureConfigForPrompt()</code> translates this configuration into an accessible format for the LLM story-engine. The codex upholds the law of the adventures, dictating which files and highlights must be explored during a quest, ensuring heroes never stray from their destined path.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig()</code> validates and parses the <code class="inline-code">adventure.config.json</code> for clear definitions of quests and file mappings.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code> structures the adventure rules to guide LLM responses with clear directives.</li>
<li><code class="inline-code">extractUniqueFilePaths()</code> ensures that only valid and accessible file paths are referenced, avoiding pitfalls in the quest.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">export class AdventureState {
  title: string | undefined = undefined;
  story: string | undefined = undefined;
  quests: Quest[] = [];
  completedQuests: Set&lt;string&gt; = new Set();
  questContentCache: Map&lt;string, { content: QuestContent; summary: string }&gt; = new Map();
  currentTheme: AdventureTheme | null = null;
  projectInfo: ProjectInfo | undefined = undefined;
  projectPath: string | undefined = undefined;

  get progressPercentage(): number {
    return this.quests.length &gt; 0 
      ? Math.round((this.completedQuests.size / this.quests.length) * 100)
      : 0;
  }
}
</code></pre>
<p>The <code class="inline-code">AdventureState</code> class is like a magical ledger, chronicling each hero’s journey—completed quests, progress, and the current theme.</p>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">export class StoryGenerator {
  async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
    const repomixContent = projectInfo.repomixContent || &#39;No repomix content available&#39;;
    
    const prompt = loadStoryGenerationPrompt({
      theme,
      repomixContent
    });

    const response = await this.llmClient.generateResponse(prompt);
    return parseMarkdownToStoryResponse(response.content.trim());
  }
}
</code></pre>
<p>This function calls upon the Scrolls&#39; innate power, drafting a story and quests from a repository, much like crafting maps and legends for adventurers.</p>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p><code class="inline-code">parseAdventureConfig()</code> is akin to a humble scribe deciphering a scroll’s arcane codes, ensuring the quests within align with the adventure’s greater purpose.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Validate the configuration to ensure all quests adhere to Adventure Code Guidance for clear exploration paths.</li>
<li>Focus on <code class="inline-code">StoryGenerator</code>’s structure to understand how themes shape narratives and quests.</li>
<li>Test <code class="inline-code">AdventureManager</code>’s initialization to confirm smooth orchestration of project files into mythical tales.</li>
</ul>
<hr>
<p>Hail, valiant adventurer, for you have unlocked the enchanted Scrolls of Questcraft, harnessing the ancient art of adventure generation — your heroic journey shines bright like a ⭐ celestial beacon, with this triumphant step marking 25% of your legendary saga!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Oracle’s Insight — Code Ana... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>