<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Eternal Quest Forge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Enchanted Repository of the Mystic Engine</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Eternal Quest Forge</h1>
<hr>
<p>The Mystic Engine unveils a new chapter: the Eternal Quest Forge, where raw source code transforms into epic adventures. Deep in Codoria&#39;s enchanted workshop, the Adventure Manager and the Story Generator craft these tales. Your challenge: decipher their inner workings to ensure quests flow flawlessly. Streamlined structures and magical storytelling intertwine within their coded fabric. Navigate this intricate labyrinth, brave Knight of Progress, to illuminate the path of quest generation.  </p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Blueprints of Creation</strong>: How does the <code class="inline-code">AdventureManager</code> structure and initialize an adventure?  </li>
<li>‚ö° <strong>Forge Operations</strong>: What flow does <code class="inline-code">StoryGenerator</code> follow to craft a story and quests?  </li>
<li>üõ°Ô∏è <strong>Guidance and Precision</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure the configuration integrates seamlessly into the quest system?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Management Conductor</h3>
<p>The <code class="inline-code">AdventureManager</code> orchestrates the delicate generation of codified adventures and stores their evolving state. From initializing themes to validating input, this class ensures quests are not only functional but thematic, safeguarding the epic narrative. With <code class="inline-code">initializeAdventure</code>, it resets the codified landscape, engages the <code class="inline-code">StoryGenerator</code>, then weaves configuration settings into the outcome.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Sets up the quest environment based on project context and user-defined themes.  </li>
<li><code class="inline-code">exploreQuest</code>: Executes a selected quest, handling cache validation or fresh content generation.  </li>
<li><code class="inline-code">progressPercentage</code>: Calculates the completion rate of available quests dynamically.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string, customThemeData?: CustomThemeData): Promise&lt;string&gt; {  
    this.state.reset();  
    this.state.projectInfo = projectInfo;  
    this.state.currentTheme = theme;  
    this.state.projectPath = projectPath || process.cwd();  
    ...  
    const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);  
    this.state.title = storyResponse.title;  
    this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;  
    this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);  
    this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);  
    return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });  
}  
</code></pre>
<p>This is the grand architect, framing quests with dynamic themes and enchanted blendings of story and files.  </p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {  
    const sanitizedChoice = this.validateAndSanitizeChoice(choice);  
    if (this.isProgressRequest(sanitizedChoice)) {  
        return this.getProgress();  
    }  
    const quest = this.findQuest(sanitizedChoice);  
    if (!quest) {  
        return this.createNotFoundResult();  
    }  
    return await this.executeQuest(quest);  
}  
</code></pre>
<p>The wielder of decisions, this method activates chosen quests or provides progress updates with precision.  </p>
<pre><code class="language-typescript">get progressPercentage(): number {  
    return this.quests.length &gt; 0  
        ? Math.round((this.completedQuests.size / this.quests.length) * 100)  
        : 0;  
}  
</code></pre>
<p>Like an enchanted gauge, this function reveals the extent of your conquests.  </p>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Narrator of Tales</h3>
<p>The foundation of Codoria‚Äôs magic, the <code class="inline-code">StoryGenerator</code>, breathes life into source code. It validates themes, engages powerful Large Language Models (LLMs), and formats responses. At its core, the method <code class="inline-code">generateStoryAndQuests</code> identifies project nuances to craft cohesive stories and captivating quests.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: The primary quest generation machine, it invokes the LLM for creative outputs.  </li>
<li><code class="inline-code">generateQuestContent</code>: Produces detailed explorations for specific quests leveraging targeted or fallback code context.  </li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Converts the raw magic of markdown into structured adventures.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {  
    this.currentProject = projectInfo;  
    this.projectPath = projectPath;  
    const prompt = loadStoryGenerationPrompt({ theme, ... });  
    const response = await this.withTimeout(this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY }));  
    const parsed = parseMarkdownToStoryResponse(response.content.trim());  
    return parsed;  
}  
</code></pre>
<p>This magical spell weaves imagination from raw structure and LLM ensorcellments, ensuring quests align with Codoria‚Äôs narrative flow.  </p>
<pre><code class="language-typescript">async generateQuestContent(quest: Quest, theme: AdventureTheme, codeContent: string): Promise&lt;QuestContent&gt; {  
    const prompt = loadQuestContentPrompt({ theme, adventureTitle: quest.title, codeContent, storyContent: this.currentStoryContent || &#39;No story context available.&#39;, ... });  
    const response = await this.withTimeout(this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST }));  
    return { adventure: response.content.trim(), fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };  
}  
</code></pre>
<p>Here resides precision crafting, transforming specific file contexts into immersive adventures.  </p>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {  
    const tokens = marked.lexer(markdownContent);  
    ...  
}  
</code></pre>
<p>A wizard‚Äôs decoder, this parses mystical markdown scrolls into readable story components and assembled quests.  </p>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Keeper of Configurations</h3>
<p>A silent guardian ensuring the foundation remains intact, <code class="inline-code">adventure-config.ts</code> checks configurations‚Äô accuracy. It extracts embedded files and translates these into streamlined structures, leveraging key components like <code class="inline-code">parseAdventureConfig</code>.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Converts adventure configurations into reliable objects for theme validation.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies useful routes hidden deeply within project structures.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Crafts a detailed but concise guide for integration into the adventure.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {  
    const raw = loadAdventureConfig(projectPath);  
    if (!raw) return null;  
    try {  
        return JSON.parse(raw);  
    } catch {  
        return null;  
    }  
}    
</code></pre>
<p>A sentient sentinel invoking clarity over configuration, ensuring no chaos breaches Codoria&#39;s barriers.  </p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {  
    const parsed = parseAdventureConfig(projectPath);  
    if (!parsed || typeof parsed !== &#39;object&#39;) return [];  
    const stack = [parsed];  
    const unique = new Set&lt;string&gt;();  
    ...  
    return Array.from(unique);  
}  
</code></pre>
<p>A mapkeeper tracing paths to hidden treasures among files, carving roads from chaos.  </p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {  
    const parsed = parseAdventureConfig(projectPath);  
    ...  
    return formatted;  
}  
</code></pre>
<p>The ultimate refiner, forging brief yet potent instructions for the Mystic Engine‚Äôs narrative flow.  </p>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Configurations are Key</strong>: Ensure fidelity to the adventure.config.json structure for seamless generator operations.  </li>
<li><strong>Cherish the Cache</strong>: Quests already completed remain in the cache, readily accessible for revisitation or historical analysis.  </li>
<li><strong>Master the Story</strong>: Contemplate the flow of <code class="inline-code">generateStoryAndQuests</code> deeply to craft unparalleled adventures.</li>
</ul>
<hr>
<p>Your understanding grows, valiant hero! The Eternal Quest Forge beckons you forward. Wield this knowledge to harness storytelling magic like never before. Adventure on!</p>
<p>With the blazing spirit of phoenix fire and the wisdom of ancient scrolls, you have triumphantly forged through Quest 2, advancing the eternal kingdom&#39;s lore by 20%‚Äîa hero&#39;s stride toward legendary glory! ‚ö°üó∫Ô∏èüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>