<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Quest Generation Forge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Realm of Codaria</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Quest Generation Forge</h1>
<hr>
<p>In the heart of Castle Configura lies the mystical Quest Generation Forge, a sacred chamber where the raw materials of code are transformed into the enchanted adventures that safeguard Codaria. This forge is guided by the wizards of the <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code>, who meticulously craft stories and quests to prepare adventurers for their journey. Yet, whispers of the Chaos Bug suggest corruption may already be seeping into their creations. Your second quest, brave hero, is to delve into the forge, study its intricate mechanisms, and uncover insights to fortify Codaria.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Mystic Initialization</strong>: How does <code class="inline-code">AdventureManager</code> translate the project context into an adventure featuring quests? What initialization techniques are employed?</li>
<li>‚ö° <strong>Thematic Threads</strong>: How does <code class="inline-code">StoryGenerator</code> ensure the theme influences both the story and the quest content? What key functions maintain thematic consistency?</li>
<li>üõ°Ô∏è <strong>Protection Wards</strong>: How are potential errors or anomalies‚Äîsuch as invalid themes or empty quest responses‚Äîhandled within the quest generation process?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Core logic for managing adventures</h3>
<p>The <code class="inline-code">AdventureManager</code> serves as the orchestrator of the quest system, from initialization to execution. Within its vast arsenal of spells lies the ability to generate adventures, enforce consistency with the project&#39;s configuration, and execute quests selected by users. It leans on the power of <code class="inline-code">StoryGenerator</code> for crafting narratives and the <code class="inline-code">AdventureState</code> object for tracking progress. This file holds the secrets to operational flow and integrity in the Quest Generation Forge.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: The cornerstone of quest creation, this function initializes the adventure, generates a story with quests, and prepares the state.</li>
<li><code class="inline-code">exploreQuest</code>: Executes a specific quest by utilizing user input, validates choices, and gracefully handles non-existent quests.</li>
<li><code class="inline-code">generateQuestContent</code>: A pivotal function that ties theme, quest position, and code files together to produce tailored quest content.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Crafting the heart of the adventure</h3>
<p>The <code class="inline-code">StoryGenerator</code> is the magical workshop where themes come alive. It leverages project context and user-selected themes to generate immersive narratives and quests. From parsing markdown responses to validating its unique structure, this file ensures captivating journeys for adventurers.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Creates the overarching story and quests based on theme-specific prompts and project details.</li>
<li><code class="inline-code">generateQuestContent</code>: Produces detailed quest narratives, ensuring they align with project context and thematic vocabulary.</li>
<li><code class="inline-code">validateTheme</code>: Verifies and defaults the selected theme to match core guidelines, preventing misaligned adventures.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: The sacred scripture of configuration</h3>
<p>This file safeguards the alignment between quest generation and the <code class="inline-code">adventure.config.json</code>. It extracts unique file paths and formats the configuration for clearer prompts, ensuring the forge always has the right materials to work with.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Retrieves the raw adventure configuration file.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Converts the configuration file into a usable object with helpful validation.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies all referenced file paths within the configuration, ensuring consistency with the codebase.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Uses <code class="inline-code">StoryGenerator</code> to craft stories and quests while merging external configurations.</li>
<li>Resets the adventure state to ensure clean initialization for each run.</li>
<li>Custom themes are supported, enhancing flexibility and immersion.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates user input, ensuring safety against invalid or malicious choices.</li>
<li>Differentiates progress requests from quest executions.</li>
<li>Handles missing quests gracefully with descriptive error handling.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Core function linking project context to the story creation process.</li>
<li>Validates theme to align with storytelling requirements.</li>
<li>Wraps logic for generating prompts via the Language Learning Model (LLM).</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Handles JSON parsing with error-fallback, protecting the app from crashing due to malformed configurations.</li>
<li>Ensures the configuration being loaded is safely validated.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Explore interactions between <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code> to better understand the modular flow of the system.</li>
<li>Observe the error-handling mechanisms in <code class="inline-code">parseAdventureConfig</code> to uncover protections against invalid data.</li>
<li>Experiment with feeding diverse themes into <code class="inline-code">generateStoryAndQuests</code> to test how thematic constraints are upheld.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Huzzah, valiant seeker of wisdom, for you have lit the sacred forge of Quest Generation with the flames of ingenuity‚Äîmay the next trials tremble before your unyielding resolve! ‚öîÔ∏èüî•‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>