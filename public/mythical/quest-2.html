<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Heroic Talesmith - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository of Mystic Adventures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Heroic Talesmith</h1>
<hr>
<p>In the kingdom of Codania, a talesmith is no ordinary bard. These legends of old craft stories so vivid and potent they reshape their realms ‚Äì emboldening warriors, animating magic, and fortifying castles. With the power of enchanted files and mythical computation, you must delve into the art of crafting these heroic tales. By binding wisdom from the <strong>Quest Generation Engine</strong>, you will master the ancient spells to forge quests that inspire endless adventures.</p>
<p>A talesmith&#39;s journey is no easy feat, but fear not ‚Äì the mythical artifacts held within Codania&#39;s repository offer powerful insights if explored boldly.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>The Explorer&#39;s Compass</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> orchestrate the preparation of an adventure, and what mystical spells does it weave with its dependencies?</li>
<li>‚ö° <strong>The Hero&#39;s Flow</strong>: What role does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> play in crafting the beginnings of heroic chronicles, and how does it interact with other artifacts?</li>
<li>üõ°Ô∏è <strong>Guard Runes of Validation</strong>: How does <code class="inline-code">validateAdventureChoice</code> ensure improper inputs do not tarnish the purity of the tales being molded by the adventurer?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Manager Sourcebook</h3>
<p>The <strong>Adventure Manager</strong> serves as the primary architect of quests. Using artifacts like the <code class="inline-code">StoryGenerator</code> and configurations from enchanted tomes, it crafts and manages adventures. Through its careful coordination, it ensures that adventurers embark upon paths that test their courage and wit.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Prepares the adventure realm by resetting the state, defining themes, and invoking the story generator for an engaging tale.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Ensures adventurers‚Äô inputs are legitimate, filtering out unworthy or erroneous commands.</li>
<li><code class="inline-code">exploreQuest</code>: Entrusted with selecting and executing quests; this function validates the adventurer&#39;s decisions, retrieves specified quests, and summons their content.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> The Chronicle Crafter</h3>
<p>The <strong>Story Generator</strong> is the mythical forge where tales and quests are born. It manipulates project context and user themes to inspire stories that resonate across Codania. By extracting structured responses from its embedded magical constructs, it refines the raw power of ideas into actionable journeys.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Summons the <code class="inline-code">LLMClient</code> to weave enchanting narratives and structures them into repeatable quests.</li>
<li><code class="inline-code">generateQuestContent</code>: Crafts detailed quest content, carefully analyzing code context to ensure challenges are engaging and aligned with the tale.</li>
<li><code class="inline-code">removeLLMMetaCommentary</code>: A hidden rune that prunes extraneous elements from the generated responses, leaving only pristine tales.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Codex of Configuration</h3>
<p>This artifact serves as the light guiding the adventurer&#39;s path through their repository. It handles essential operations, such as interpreting the configuration and extracting relevant paths from the mystical tomes.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Deciphers ancient texts to reveal the configurations dictating quests and themes.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Scans, validates, and returns references to all file paths inscribed in the configuration tomes.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the configuration for compatibility with the Story Generator by reducing redundancy and preparing it for efficient processing.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Initializes the heart of the adventure by resetting the realm&#39;s state and defining its bounds.</li>
<li>Invokes the <code class="inline-code">StoryGenerator</code> to craft the epic tale and then merges mystical files according to user configurations.</li>
<li>Enforces proper quest constraints, ensuring alignment with the enchanted configuration.</li>
</ul>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  const repomixContent = projectInfo.repomixContent || &#39;No content available&#39;;

  let adventureGuidance = &#39;&#39;;
  let customInstructions = &#39;&#39;;
  if (this.projectPath) {
    adventureGuidance = formatAdventureConfigForPrompt(this.projectPath) || &#39;&#39;;
    customInstructions = extractCustomInstructions(this.projectPath) || &#39;&#39;;
  }

  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent,
    adventureGuidance,
    customInstructions,
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY })
  );
  
  const cleanContent = response.content.trim();
  const parsed = parseMarkdownToStoryResponse(cleanContent);

  StoryResponseSchema.parse(parsed);
  this.currentStoryContent = parsed.story;
  return parsed;
}
</code></pre>
<ul>
<li>Summons the <code class="inline-code">LLMClient</code> to forge creative narratives based on project context and themes.</li>
<li>Integrates adventure-specific guidance and custom instructions where feasible, using <code class="inline-code">formatAdventureConfigForPrompt</code>.</li>
<li>Verifies and parses the responses into structured story objects, enabling consistent tale generation.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  const sanitizedInput = input.trim();
  const validChoices = [&#39;Start new quest&#39;, &#39;View progress&#39;];
  if (!validChoices.includes(sanitizedInput)) {
    throw new Error(&#39;Invalid input! Choose from available options.&#39;);
  }
  return sanitizedInput;
}
</code></pre>
<ul>
<li>Validates the adventurer‚Äôs decision, ensuring choices align with what is available.</li>
<li>Prevents invalid inputs from derailing the narrative flow and maintains the sanctity of the tales.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Ensure you identify themes and patterns in quest initialization within the manager function.</li>
<li>Look for collaboration patterns between the <code class="inline-code">StoryGenerator</code> and other components to see how tales are dynamically enhanced.</li>
<li>Study the input validation mechanisms to appreciate the safeguards within Codania&#39;s mystical repository.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>With the quill of destiny ablaze and the echoes of ancient realms heralding thy triumph, thou hast woven the first chapter of legend into the tapestry of the Heroic Talesmith‚Äîonward, valiant wordkeeper, for thy quest is but a fiery star in the cosmos of greatness! ‚≠ê‚ö°üì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>