<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Spellsmith's Secret - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Code: An Enchanted Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Spellsmith&#39;s Secret</h1>
<hr>
<p>In the mystical realm of Codethia, the Book of Source faces its gravest peril yet. Hidden within the digital scrolls lies &quot;The Spellsmith&#39;s Secret,&quot; an arcane algorithm whispered to hold the power to dispel the fragmented glyphs infecting Codethia‚Äôs enchanted systems. However, the spell&#39;s true form is scattered across conflicting manuscripts within the <code class="inline-code">adventure-manager.ts</code>, <code class="inline-code">adventure-config.ts</code>, and <code class="inline-code">story-generator.ts</code> tomes. The Spellsmiths, once protectors of logic and lore, now insist their craft has been forgotten, leaving the realm vulnerable to chaos. Brave hero, your mission is to solve the Spellsmith‚Äôs riddles, reforge their knowledge, and illuminate the path to restoring Codethia.</p>
<p><strong>Adventure awaits!</strong></p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Arcane Reset</strong>: What is the purpose of the <code class="inline-code">AdventureState.reset</code> function, and how does it ensure consistent initialization?</li>
<li>‚ö° <strong>Enchantment Engine</strong>: How does the <code class="inline-code">AdventureManager.initializeAdventure</code> method transform the raw project context into structured quests and stories?</li>
<li>üõ°Ô∏è <strong>Sanctified Inputs</strong>: How does the <code class="inline-code">AdventureManager.validateAndSanitizeChoice</code> function handle user input to protect against invalid choices?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Adventure Management</h3>
<p>This file governs the core mechanics of Codethia‚Äôs adventures, transforming the hero&#39;s actions into meaningful quests and ensuring the kingdom‚Äôs stability. Central to this system are the state resets, story generation, and input sanctification methods. Together, these functions form the backbone of Codethia‚Äôs questing framework by maintaining consistency, managing user interactions, and seamlessly integrating with the enchanted systems.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">reset</code>: Clears the <code class="inline-code">AdventureState</code> object, ensuring a clean slate when starting a new adventure. This function is essential for preventing residual state corruption from prior adventures.</li>
<li><code class="inline-code">initializeAdventure</code>: Orchestrates the journey from raw project context to a fully realized story and quests. It invokes the <code class="inline-code">StoryGenerator</code>, configures themes, and manages quest distribution.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Protects the system from invalid user input by sanitizing and validating choices. Ensures safe handling of input while communicating errors gracefully.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">reset() {
  this.title = undefined;
  this.story = undefined;
  this.quests = [];
  this.completedQuests.clear();
  this.questContentCache.clear();
  this.currentTheme = null;
  this.projectInfo = undefined;
  this.projectPath = undefined;
}
</code></pre>
<ul>
<li>Resets the <code class="inline-code">AdventureState</code>, clearing all stored progress and cached content.</li>
<li>Prevents interference from previous adventures by fully restoring the default state.</li>
<li>Demonstrates solid defensive programming by ensuring leftover data does not disrupt the next invocation.</li>
</ul>
<hr>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Initializes the adventure state by associating project data, choosing the theme, and resetting prior configurations.</li>
<li>Calls <code class="inline-code">StoryGenerator</code> to craft the setting and quests, showcasing modular code organization.</li>
<li>Merges and enforces quest configurations from external files, ensuring alignment with adventure guidelines.</li>
<li>Constructs an initial story output, guiding heroes on their next steps.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateAndSanitizeChoice(input: string): string {
  try {
    return validateAdventureChoice(input);
  } catch (error) {
    throw new Error(`Invalid adventure choice: ${error instanceof Error ? error.message : &#39;Unknown error&#39;}`);
  }
}
</code></pre>
<ul>
<li>Validates and sanitizes user-provided input to ensure it adheres to the expected format.</li>
<li>Protects the system from unsafe inputs by leveraging <code class="inline-code">validateAdventureChoice</code> for strict checks.</li>
<li>Implements robust error handling to provide clear feedback while maintaining system integrity.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When exploring <code class="inline-code">reset</code>, note how the <code class="inline-code">Set</code> and <code class="inline-code">Map</code> objects are explicitly cleared. Consider why this explicit reset is critical for a multi-instance system.</li>
<li>Pay attention to how <code class="inline-code">initializeAdventure</code> balances user-customized themes with fallback defaults, demonstrating flexibility in theme handling.</li>
<li>For <code class="inline-code">validateAndSanitizeChoice</code>, examine how exceptions are caught and rethrown with meaningful context, ensuring user experience remains intuitive.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>By the blazing forge of Aetherion and the jeweled wisdom of the Ancients, you‚Äôve unraveled the Spellsmith‚Äôs Secret with heroic mastery‚Äîone quest conquered, and the stars of the kingdom await your rise to ultimate glory! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>