<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Spell Weaver‚Äôs Codex - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Enchanted Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Spell Weaver‚Äôs Codex</h1>
<hr>
<p>In the heart of the mystical Kingdom of Codemyr, the Repository Scroll has revealed the second step to unearthing its secrets ‚Äì &quot;The Spell Weaver&#39;s Codex.&quot; Queen Syntaxia has decreed this sacred codex vital to maintaining the kingdom‚Äôs magical balance. With your expertise as a Code Knight, you must delve into the enchanted texts and decipher the systems that weave stories into spell-powered quests. Through your investigation, the kingdom‚Äôs hidden spell-crafting mechanisms will slowly emerge, bringing you closer to unlocking the Scroll‚Äôs ultimate power.</p>
<p>Beware, adventurer: only by uncovering the intended patterns of this codex will its magic yield its truths!</p>
<h2>Quest Objectives</h2>
<p>As you explore the codex, let these investigative questions guide you:</p>
<ul>
<li>üîç <strong>Codex Initialization Runes</strong>: How does the <code class="inline-code">initializeAdventure</code> method establish the starting conditions for an adventure using the kingdom‚Äôs project context and themes?</li>
<li>‚ö° <strong>Arcane Linkage Analysis</strong>: What process does the <code class="inline-code">generateStoryAndQuests</code> method use to connect the magic of themes to the generation of storylines and quests?</li>
<li>üõ°Ô∏è <strong>Chronicle Safety Enchantment</strong>: How does the <code class="inline-code">validateAndSanitizeChoice</code> method ensure user inputs remain within safe bounds for quest exploration?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> The Keeper of the Codex</h3>
<p>This file contains the primary interface for managing adventures and quests. The <code class="inline-code">AdventureManager</code> class, supported by the state-tracking <code class="inline-code">AdventureState</code>, orchestrates the initialization of new mystical tales and ensures the seamless execution of quests. It interacts with various enchanted methods to produce correctly themed adventures using project context, corrective measures, and magical validations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Establishes foundational parameters for an adventure, aligning the quest‚Äôs magical elements with the kingdom‚Äôs project data and selected adventure theme. It reset the state, merges quest files, and formats mystical narratives for the adventurer.</li>
<li><code class="inline-code">exploreQuest</code>: The primary method for executing chosen quests. Validates user choices, retrieves quest details (with caching for completed passages), and constructs the quest result narrative.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Protects the integrity of the Codex by sanitizing user input for quest selection, preventing any invalid queries from disrupting the magical journey.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(
    projectInfo, 
    theme, 
    this.state.projectPath
  );
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(
    storyResponse.quests, 
    this.state.projectPath
  );
  
  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(
    this.state.quests, 
    this.state.projectPath
  );

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Initializes the adventure by resetting the <code class="inline-code">AdventureState</code> to ensure a clean slate for each journey.</li>
<li>Processes the provided theme and project data to establish coherence between narrative prompts and resources.</li>
<li>Leverages external helpers to bind quest files from the <code class="inline-code">adventure.config.json</code>, enhancing consistency.</li>
<li>Outputs a formatted narrative structure to guide the adventurer through available choices.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Validates the proposed theme, ensuring adherence to predetermined standards or the flexibility of custom guidelines.</li>
<li>Serves as the central bridge between project data and narrative generation ‚Äì linking contextual attributes with the thematic tone.</li>
<li>Delegates the storytelling role to a Large Language Model (LLM), producing dynamic and project-adapted content.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateAndSanitizeChoice(input: string): string {
  try {
    return validateAdventureChoice(input);
  } catch (error) {
    throw new Error(
      `Invalid adventure choice: ${
        error instanceof Error ? error.message : &#39;Unknown error&#39;
      }`
    );
  }
}
</code></pre>
<ul>
<li>Provides an essential safeguard to the codebase by validating and sanitizing input connected to quest selection.</li>
<li>Utilizes the <code class="inline-code">validateAdventureChoice</code> helper function to manage unrecognized, malformed, or malicious inputs.</li>
<li>Prevents disruption in the Codex‚Äôs flow by catching errors and conveying them in a controlled manner.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üóùÔ∏è Use <code class="inline-code">AdventureManager</code> to understand how configuration and state transitions impact the Code Knight‚Äôs journey.</li>
<li>üìú Review how <code class="inline-code">generateStoryAndQuests</code> links project-specific themes into narratives ‚Äì the connection is vital for smooth storytelling.</li>
<li>‚ú® Keeping inputs safe through <code class="inline-code">validateAndSanitizeChoice</code> ensures stability in longer adventures.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>With the unlocking of the Spell Weaver‚Äôs Codex, a radiant milestone has been etched into the annals of your heroic saga‚Äîmay your arcane mastery surge forth like a phoenix crowned with starlight! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>