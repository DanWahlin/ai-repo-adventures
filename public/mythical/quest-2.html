<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Heroic Engines of Fabled Storycraft - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository of Aetheria</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Heroic Engines of Fabled Storycraft</h1>
<hr>
<p>In the glowing halls of the Repository of Codes, a mystical hum reverberates from an ancient, crystalline machine known as the Engine of Storycraft. Its enchanted cogs weave tales and quests from the essence of code. Yet, its mechanisms have faltered under the relentless pressure of the Chaos of Bugs. The Keeper of the Engine, a spectral archivist, beseeches your aid. Brave mage, your task is to delve into the essence of its Heroic Engines, uncovering the spells binding its quests, themes, and intricate lore. The time has come to restore the pulse of Aetheria&#39;s imagination!</p>
<p><strong>Adventure Awaits</strong> ‚Äì Draw your wand of knowledge and dare to venture deeper!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Unveiling the Engine</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> create a foundation for the story and quests? What structures and inputs does it rely on?</li>
<li>‚ö° <strong>The Flow of Exploration</strong>: What happens when <code class="inline-code">AdventureManager.exploreQuest</code> is invoked, and how does it ensure a chosen quest is executed correctly?</li>
<li>üõ°Ô∏è <strong>The Voice of the Engine</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> craft narratives and quests? How are themes and code content woven into its storytelling?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: The storyteller&#39;s conductor</h3>
<p>This file contains the <code class="inline-code">AdventureManager</code> class and its companion <code class="inline-code">AdventureState</code>, which orchestrate the creation and navigation of coding adventures. The <code class="inline-code">initializeAdventure</code> method generates the foundational story and quest structure, while <code class="inline-code">exploreQuest</code> facilitates the execution of these quests. Here lies the control center for the Heroic Engines of Storycraft, tying together themes, files, and user interactions.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Generates the story and quests, setting the stage for your entire adventure.</li>
<li><code class="inline-code">exploreQuest</code>: Executes a chosen quest, ensuring correct retrieval and managing cached or new content generation.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Tracks progress through the completion rate of quests, ensuring a measurable journey.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  
  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This method is the engine&#39;s ignition, resetting the adventure state and crafting a narrative with bundled quests.</li>
<li>The <code class="inline-code">storyGenerator.generateStoryAndQuests</code> fetches the quests and stories tailored to the chosen theme.</li>
<li>Dynamic adaptability allows the merging of external configurations (<code class="inline-code">mergeQuestFilesFromConfig</code>), ensuring bespoke adventures.</li>
<li>By formatting the story with quests, it ensures adventurers see their upcoming paths at the journey&#39;s start.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  // Check if this is a progress request
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  // Find the quest based on the choice
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  // Execute the quest
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>This code drives the adventurer&#39;s exploration of a selected quest, ensuring that it is properly validated.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code> ensures input stability against chaotic bugs.</li>
<li>Logical bands like <code class="inline-code">findQuest</code> and <code class="inline-code">executeQuest</code> provide seamless transitions from choice to action.</li>
<li>Handles missteps gracefully with <code class="inline-code">createNotFoundResult</code>, assisting any veering apprentice.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>This delightful formula calculates an adventurer‚Äôs progress, showcasing their journey&#39;s milestone.</li>
<li>Relational reasoning between completed (<code class="inline-code">completedQuests</code>) and total quests emphasizes clarity of achievement.</li>
<li>The resulting percentage infuses transparency into the experience.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Summons the LLM to craft narratives and quests, ensuring alignment with the chosen theme and project.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Processes markdown to extract quests and stories, dynamically constructing the adventure‚Äôs structure.</li>
<li><code class="inline-code">generateQuestContent</code>: Illuminates individual quests, funneling code content into the magical storyline.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>The method bridges project context with storytelling, paving paths into the enchanted.</li>
<li>Classification of themes (<code class="inline-code">validateTheme</code>) personalizes myths, ensuring resonance with the adventurer&#39;s choice.</li>
<li>Dependency on LLM ensures robustness in complexity and intricate tales.</li>
</ul>
<hr>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);

  let title = &#39;&#39;;
  let story = &#39;&#39;;
  const quests: Quest[] = [];
  
  for (const token of tokens) {
    if (token.type === &#39;heading&#39; &amp;&amp; token.depth === 1) title = token.text;
    else if (token.type === &#39;paragraph&#39; &amp;&amp; title) story += token.text + &#39;\n\n&#39;;
    else if (token.type === &#39;paragraph&#39;) {
      quests.push({ id: `quest-${quests.length + 1}`, title: token.text, description: &#39;&#39; });
    }
  }

  return { title, story, quests };
}
</code></pre>
<ul>
<li>Tokenization (<code class="inline-code">marked.lexer</code>) transmutes markdown into structured stories and quests.</li>
<li>Intelligent iteration parcels headings, paragraphs, and quests into defined entities.</li>
<li>Flexibility in format allows unique adventures to take shape from varied input.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  codeContent: string
): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({
    theme, 
    adventureTitle: quest.title,
    codeContent
  });

  const response = await this.llmClient.generateResponse(prompt);
  return { adventure: response.content.trim(), fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };
}
</code></pre>
<ul>
<li>Carefully orchestrates bespoke content for each quest, using LLM as the creative force.</li>
<li>Templates ensure thematic alignment and code-context immersion.</li>
<li>The result is a combination of narrative and technical insights, enriching the quest.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>ü™Ñ Focus on understanding how <code class="inline-code">initializeAdventure</code> binds the Engine‚Äôs magical threads.</li>
<li>üß© Reflect on the dynamic interplay between user inputs and <code class="inline-code">exploreQuest</code>.</li>
<li>üìñ Decipher how stories and quests emerge from themes, markdown, and code in the StoryGenerator.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>With luminous wisdom and the quill of ancient bards, you have forged a chapter worthy of Valhalla‚Äôs archives‚Äîhail the triumphant hero of the Heroic Engines of Fabled Storycraft! ‚≠ê‚öîÔ∏èüìú</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>