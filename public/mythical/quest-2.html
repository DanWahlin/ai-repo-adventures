<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Heroic Story Forge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository and the Chronicles of Code</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Heroic Story Forge</h1>
<hr>
<p>In the mystical kingdom of Codemyr, the Enchanted Repository stirs restlessly, its magic radiating with uncharacteristic flickers. The Queen of Code convenes her bravest heroes to venture into the heart of the Heroic Story Forge, a fabled mechanism that crafts the enchanted narratives guiding Codemyr&#39;s balance. The forge, long dormant, must be reignited by understanding its arcane mechanics and deciphering the ancient scrolls stored within. The outcome of your success will shape the storylines that power the kingdom‚Äôs harmony.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>The Binding Framework</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> initialize the hero‚Äôs journey and what role does the <code class="inline-code">AdventureState</code> class play in storing progress?</li>
<li>‚ö° <strong>The Fire of the Forge</strong>: What strategy does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> employ to create a cohesive narrative and connect the code files to quests?</li>
<li>üõ°Ô∏è <strong>Safety Locks</strong>: How does the <code class="inline-code">parseAdventureConfig</code> method ensure the configuration for the Heroic Story Forge is both accurate and complete?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Core of the Heroic Story Forge</h3>
<p>This file contains the mechanisms that manage Codemyr&#39;s quests from initialization to execution. The <code class="inline-code">AdventureManager</code> class acts as the overseer, coordinating the quest paths while the <code class="inline-code">AdventureState</code> retains the history of progress. It also generates quest-specific content and ensures smooth orchestration between story components.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Initializes a new storyline by resetting the forge‚Äôs state, applying themes, and creating new quests tied to the magical artifacts (files).</li>
<li><code class="inline-code">exploreQuest</code>: Executes the selected quest, handling choices and caching completed content to balance resource use and responsiveness.</li>
<li><code class="inline-code">progressPercentage</code>: A calculated property that tracks the hero&#39;s journey completion rate to inspire knights to advance further.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({...storyResponse, quests: this.state.quests});
}
</code></pre>
<ul>
<li>Initializes a fresh adventure by resetting state and applying the selected theme using <code class="inline-code">state.reset</code>.</li>
<li>Invokes the Story Generator to create the overarching tale and its quests (<code class="inline-code">generateStoryAndQuests</code>).</li>
<li>Ensures alignment with configuration-defined constraints using <code class="inline-code">mergeQuestFilesFromConfig</code> and <code class="inline-code">enforceConfigQuestCount</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>A mathematical measure of the hero‚Äôs journey, calculated as the ratio of completed quests to total quests.</li>
<li>Keeps adventurers motivated by tracking progress in exact percentages.</li>
<li>Highlights the importance of encapsulating metrics within computed properties for clarity.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Handles the hero‚Äôs selection, whether it is viewing progress or undertaking a specific quest.</li>
<li>Sanitizes and validates user input to ensure safe execution.</li>
<li>Leverages caching of completed quest results to avoid redundant calls and improve efficiency.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Forging the Narrative</h3>
<p>The <code class="inline-code">StoryGenerator</code> class is the central architect of Codemyr‚Äôs narratives. It uses provided project details to generate the storyline and interweaves quests with specific code artifacts. This file shapes the enchanting storylines that drive the heroes forward.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Generates the overarching narrative and establishes quests, ensuring they encompass the kingdom‚Äôs magical essence.</li>
<li><code class="inline-code">generateQuestContent</code>: Produces the detailed structure and content for each individual quest, immersing adventurers in exploration.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Interprets and validates markdown tales to convert them into actionable quests.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Establishes a hero‚Äôs tale by invoking the LLM client and using project metadata as context.</li>
<li>Validates and applies the theme for the narrative, ensuring relevance to Codemyr‚Äôs magical lexicon.</li>
<li>Invokes lower-level functions (<code class="inline-code">generateWithLLM</code>) to compute story dynamics.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest, 
  theme: AdventureTheme, 
  codeContent: string, 
  questPosition?: number, 
  totalQuests?: number
): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    questPosition,
    totalQuests,
  }) + &#39;\n\nIMPORTANT: Respond with ONLY markdown content between explicit delimiters.&#39;;
  
  const response = await this.llmClient.generateResponse(prompt);
  return {adventure: response.content, fileExploration: &#39;&#39;, codeSnippets: [], hints: []};
}
</code></pre>
<ul>
<li>Crafts quest-specific environments using targeted code insights (<code class="inline-code">codeContent</code>).</li>
<li>Relies on prompts to seamlessly align quests within the overall narrative, maintaining positional coherence.</li>
<li>Enforces formatting conventions, ensuring consistency in output.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Forge‚Äôs Blueprint</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file provides tools for reading, parsing, and formatting the adventure‚Äôs configuration. It guarantees the stability of the narrative by aligning quest data (e.g., file paths, highlights) with project constraints.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Decodes <code class="inline-code">adventure.config.json</code>, serving as the foundation of the heroic framework.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Gathers all referenced files, ensuring smooth navigation of the realm‚Äôs domains.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the raw configuration data for compatibility with Codemyr‚Äôs magical LLM engine.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Safeguards the stability of quest initiation by parsing configuration files (<code class="inline-code">adventure.config.json</code>).</li>
<li>Handles malformed or missing data gracefully, emphasizing resilience in error-prone scenarios.</li>
<li>Converts raw JSON into actionable structure.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const uniquePaths = new Set&lt;string&gt;();
  // Recursively navigate configuration nodes, accumulating valid file paths.
  return Array.from(uniquePaths);
}
</code></pre>
<ul>
<li>Locates and verifies all file paths referenced in the realm‚Äôs blueprint.</li>
<li>Prevents redundancy through the use of a <code class="inline-code">Set</code> to eliminate duplicates.</li>
<li>Ensures that no unverified files disrupt the harmony of Codemyr.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Keep an eye on how quest content uses both project-wide and targeted code snippets to align adventures with their technological context.</li>
<li>Compare how different functions distribute responsibilities when initializing quests, generating stories, and validating configurations.</li>
<li>Use encountered techniques (e.g., caching or <code class="inline-code">Set</code> for uniqueness) in your own spellbinding coding projects.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>By the glowing anvil of creation and the sacred quill of destiny, thy valiant triumph in Quest 2: The Heroic Story Forge heralds thy ascendancy as a luminous bard of legends‚Äîpress onward, brave soul, for thy epic awaits to be fully awakened! üíé‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>