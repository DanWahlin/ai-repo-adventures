<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Guild of Analysis - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository: Chronicles of Code and Magic</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Guild of Analysis</h1>
<hr>
<p>In the mystical Kingdom of Code, the Guild of Analysis rules with their mastery of clarity and insight. Their chamber glimmers with glowing runes, each representing the threads of logic woven into the Repository of Knowledge. To unlock the artifact&#39;s potential, you must explore their hallowed halls and uncover how their spells transform raw data into actionable wisdom. Beware, for only a true architect can navigate their labyrinth of validations and extractions.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Rune Clarity</strong>: How does the <code class="inline-code">AdventureManager</code> utilize the <code class="inline-code">AdventureState</code> to maintain quest progress and manage data flow?</li>
<li>‚ö° <strong>Enchanted Integration</strong>: How does <code class="inline-code">parseAdventureConfig</code> interact with other functions to extract adventure configurations?</li>
<li>üõ°Ô∏è <strong>Error Safeguards</strong>: What mechanisms are in place to handle parsing errors in <code class="inline-code">adventure-config.ts</code>?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Quest operations and state management</h3>
<p>Here, the Guild&#39;s magical mechanisms are revealed through the <code class="inline-code">AdventureManager</code> and its harmonious connection to <code class="inline-code">AdventureState</code>. This code displays the orchestration of quest initialization and progression. <code class="inline-code">initializeAdventure</code> resets the state and generates new quests, while <code class="inline-code">AdventureState.progressPercentage</code> calculates progress. Look closely at how the <code class="inline-code">mergeQuestFilesFromConfig</code> function integrates the parsed configuration into the adventure&#39;s tapestry, ensuring the storyline aligns with external files.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: Handles story generation and state reset.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Calculates quest completion as a percentage.</li>
<li><code class="inline-code">AdventureManager.mergeQuestFilesFromConfig</code>: Integrates external file paths into generated quests.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration extraction and parsing</h3>
<p>This file showcases the Guild&#39;s intricate spellwork for extracting adventure details. Using <code class="inline-code">loadAdventureConfig</code>, the script reads the adventure&#39;s configuration file, while <code class="inline-code">parseAdventureConfig</code> parses it into usable structures. The <code class="inline-code">extractUniqueFilePaths</code> function identifies unique file paths referenced across quests, ensuring only verified magic (valid paths) makes its way into the system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses configuration text and handles potential errors.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Collects and validates file paths from the configuration.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Formats configuration data for clear use in prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string, customThemeData?: CustomThemeData): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>This is the Guild&#39;s ritual to reset the magical chart and summon new quests based on the chosen theme.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>A spell to determine the fraction of completed quests‚Äîa measurable reflection of progress.</p>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;
  
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;
  
  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;

  const configQuestFiles = new Map&lt;string, string[]&gt;();
  for (const configQuest of adventure.quests) {
    if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {
      const filePaths = configQuest.files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
      if (filePaths.length &gt; 0) configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);
    }
  }

  return quests.map((quest, index) =&gt; {
    const questTitleLower = quest.title.toLowerCase();
    for (const [configTitle, files] of configQuestFiles.entries()) {
      if (questTitleLower.includes(configTitle) || configTitle.includes(questTitleLower)) {
        return { ...quest, codeFiles: files };
      }
    }
    return quest;
  });
}
</code></pre>
<p>An alchemical mechanism to bind external artifacts (file paths) to the quests generated.</p>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>A delicate enchantment that deciphers the raw configuration, with safeguards against corruption.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>A systematic collection spell, ensuring valid paths connect to their respective quests.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;

    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }

    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p>This spell condenses adventure configurations into a coherent format, priming it for further exploration.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Organization will aid in deciphering the Guild&#39;s patterns; read each function purposefully to uncover interactions.</li>
<li>Pay attention to how configurations are parsed and integrated; errors might reveal overlooked opportunities.</li>
<li>Try exploring how <code class="inline-code">progressPercentage</code> affects adventure reports to provide directional insights.</li>
</ul>
<hr>
<p>Take pride, adventurer! The Guild of Analysis now acknowledges your capacity for clarity‚Äîa skill worthy of the Repository of Knowledge! Continue this quest to unite the guilds.</p>
<p>With the wisdom of the Guild of Analysis now etched into your heroic spirit, you ascend as a beacon of insight, charting the celestial path forward through the uncharted realms of knowledge‚Äîyour legend sparkles ever brighter! ‚ö°üëÅÔ∏èüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>