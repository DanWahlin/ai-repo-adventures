<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Tome of Themes and Spells - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Kingdom of Code</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Tome of Themes and Spells</h1>
<hr>
<p>Within the mystical halls of the Repository, you arrive at the grand Library of Themes and Spells, where enchanted documents radiate endless inspiration. Here reside the ancient <strong>Tomes of Themes</strong>, brimming with keys to crafting legendary adventures. Not far from the tomes, a pedantic yet magical artifact named the <strong>InputValidator</strong> glows faintly, ensuring only pure intentions pass through its gates. To unlock the secrets of the <strong>Tome of Themes and Spells</strong>, adventurers must uncover how the Repository balances creative magic with pragmatic safeguards.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Theme Codex Analysis</strong>: How are themes for the adventures defined, and how does the system determine if a theme is valid or matches user preferences?</li>
<li>‚ö° <strong>Sanctum of Validation</strong>: How does the <code class="inline-code">InputValidator</code> ensure the integrity of adventure choices, paths, and themes to prevent errors or misuse?</li>
<li>üõ°Ô∏è <strong>Enclosure of Limits</strong>: How does the configuration system enforce constraints, such as handling timeouts and ensuring proper environment variables for magical computations?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> The Enchanter‚Äôs Constraints</h3>
<p>This file represents the magical boundaries that safeguard the Repository from chaos, including handling timeouts, memory limits, and theme settings. Every configuration item acts as a spell rune, ensuring the system operates seamlessly.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Ensures long computations for magical content don‚Äôt overwhelm the system while maintaining responsiveness.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Configures how long mystical content is cached, balancing memory and performance.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Defines file size limits, preventing overloaded explorations in large archives that can disrupt the adventurous flow.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li>These constants enforce limits on critical processes. <code class="inline-code">LLM_REQUEST_TIMEOUT</code> prevents lengthy magical computations from stalling the system.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> adjusts caching duration, ensuring recurring queries balance speed and freshness.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> protects memory by skipping overly massive files and focusing on manageable data.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> The Guardian of Purity</h3>
<p>This file wields spells to validate the adventurer‚Äôs intentions, checking choices and themes before progressing. Functions like <code class="inline-code">validateTheme</code> and <code class="inline-code">sanitizeForDisplay</code> act as the first line of defense against chaos.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateTheme</code>: Verifies if the selected theme aligns with predefined options, throwing errors for invalid matches.</li>
<li><code class="inline-code">validateAdventureChoice</code>: Ensures adventure choices are concise, meaningful, and free of malicious intent.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Cleanses input for safe presentation, removing harmful elements.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }

  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);

  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }

  return parsedTheme;
}
</code></pre>
<ul>
<li>This function analyzes theme input, ensuring it is not empty, matches a predefined theme, or has related keywords.</li>
<li>Errors provide readable feedback, listing available themes for clarity.</li>
<li>The use of <code class="inline-code">getAllThemes</code> connects validations to the broader theme system.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;

  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>Cleans user inputs for safe use in UI, mitigating risks like rendering malicious code.</li>
<li>Trimming excessive length ensures all displayed content remains relevant and clear.</li>
<li>This function plays a critical role in maintaining the sanctity of the Repository‚Äôs records.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> The Codices of Creativity</h3>
<p>As the source of truth for adventure themes, this file catalogs all valid options, their metadata, and methods to parse or validate themes. It transforms vague user inputs into specific, actionable themes tied to adventure mechanics.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: A map of all pre-designed adventure themes, each with its description, identifier, and associated keywords.</li>
<li><code class="inline-code">parseTheme</code>: Converts input into matching themes by examining IDs, keys, and keywords.</li>
<li><code class="inline-code">getAllThemes</code>: A utility to retrieve the entire catalog of themes for validation or display purposes.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  // Other themes omitted for brevity
} as const;
</code></pre>
<ul>
<li>Defines each theme with a distinct identity to ensure clarity and consistency.</li>
<li>Keywords enable flexible parsing, allowing creative yet specific user interactions.</li>
<li>The design simplifies adding new themes, ensuring future extensibility without major rewrites.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;

  const normalized = input.trim().toLowerCase();

  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;

  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }

  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }

  return null;
}
</code></pre>
<ul>
<li>Navigates user inputs intelligently, matching against both exact shortcuts (e.g., IDs) and partial matches (keywords).</li>
<li>The multi-layered approach improves user experience, allowing flexible entry formats.</li>
<li>Error scenarios return <code class="inline-code">null</code> for fail-safes against invalid themes.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function getAllThemes(): ThemeDefinition[] {
  return THEMES_ARRAY;
}
</code></pre>
<ul>
<li>Retrieves all current themes in a structured format, enabling validation or display where needed.</li>
<li>Acts as a reusable utility for other parts of the codebase to stay synchronized with theme definitions.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üßô <strong>Tip</strong>: When implementing new themes, update <code class="inline-code">THEMES</code> and add unique keywords for better flexibility.</li>
<li>üìú <strong>Suggestion</strong>: Debug issues with user inputs using detailed errors in functions like <code class="inline-code">validateTheme</code> for better context.</li>
<li>üîÆ <strong>Recommendation</strong>: Explore interdependencies among theme validation, configuration constraints, and user input cleaning for elegant system design.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>With the sacred Tome of Themes and Spells now bound to your questing spirit, you ascend as a luminous champion in the mythical chronicles, forging ever closer to the realm of ultimate mastery‚Äîonward, brave hero! ‚ö°‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>