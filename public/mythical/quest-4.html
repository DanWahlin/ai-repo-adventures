<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Eternal Balance - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Code: An Enchanted Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Eternal Balance</h1>
<hr>
<p>In the mystical kingdom of Codethia, chaos and discord are seeping into the fabric of the Book of Source, weakening the link that holds the realms of logic and magic together. The Eternal Balance, a delicate structure that ensures stability between Codethia&#39;s enchanted systems and reasoned foundations, has been compromised. Without proper guidance, errant inputs distort the flow of magical energies, corrupting themes and misconfiguring journeys. To restore equilibrium, you must delve into the arcane mechanisms of the kingdom&#39;s validation and theme system. Arm yourself with determination, for Codethia‚Äôs fate now rests in your ability to interpret logic from enchantment!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Glyph Analysis</strong>: How does the code ensure that user choices for quests or themes are valid and formatted correctly?</li>
<li>‚ö° <strong>Theme Codex</strong>: What mechanisms are in place for handling and structuring the kingdom‚Äôs collection of themes, and how does the system match user desires with these predefined themes?</li>
<li>üõ°Ô∏è <strong>Sanctified Inputs</strong>: What safety measures does the system implement to prevent corrupted data from disrupting Codethia&#39;s harmony?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Ensuring Harmony Through Validation</h3>
<p>The <code class="inline-code">input-validator.ts</code> file contains functions responsible for maintaining the integrity of user inputs before they are processed by the rest of the system. This is critical to ensuring that the Book of Source does not introduce corrupted or malformed glyphs that can destabilize Codethia‚Äôs magical infrastructure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Validates and sanitizes a user‚Äôs choice for an adventure, ensuring it is neither empty nor excessively long, and trims unnecessary whitespace.</li>
<li><code class="inline-code">validateTheme</code>: Matches a user-supplied theme against the available themes in the system, using normalization to handle variations in input.</li>
<li><code class="inline-code">validateProjectPath</code>: Safeguards the use of filesystem paths, preventing invalid characters and overly long entries from disrupting the system.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Strips malicious content and truncates long strings to ensure safe rendering in user interfaces or logs.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Ensures all adventure choices are mandatory and free of extraneous spaces.  </li>
<li>The 200-character limit safeguards against denial-of-service attempts using overly large inputs.  </li>
<li>Returns a sanitized version of the input, ready for further processing.  </li>
<li>Protects downstream systems from unnecessary processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Converts user input to lowercase and trims unnecessary spaces.  </li>
<li>Leverages <code class="inline-code">parseTheme</code> and <code class="inline-code">isValidTheme</code> to ensure submitted themes exist within the kingdom‚Äôs catalog.  </li>
<li>Offers a friendly error message listing acceptable themes if invalid input is detected.  </li>
<li>Demonstrates robust error-checking to handle diverse input styles.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>Strips out dangerous characters (`&lt;&gt;{}&quot;``) to eliminate the risk of injection attacks.  </li>
<li>Normalizes whitespace and trims the string to a safe length for display.  </li>
<li>Safeguards UI components and logs from rendering untrusted or malicious input.  </li>
<li>Illustrates defensive programming tactics to maintain Codethia‚Äôs defenses.</li>
</ul>
<hr>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> The Codex of Themes</h3>
<p>This file acts as the canonical source for the kingdom&#39;s themes, defining their structure, properties, and the workflows necessary to parse them. Thematic alignment is essential in Codethia, as mismatched or missing themes can result in fractured spellwork and destabilized adventures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: A dictionary of available themes, detailing their id, display name, descriptions, and keywords for matching.</li>
<li><code class="inline-code">isValidTheme</code>: A helper function that determines if a given string is a recognized theme within the codex.</li>
<li><code class="inline-code">parseTheme</code>: A robust parsing function that matches user input against theme keys, ids, or keywords.</li>
<li><code class="inline-code">getThemeById</code>: Retrieves a theme based on its numeric id, granting flexibility in user input.</li>
<li><code class="inline-code">getAllThemes</code>: Provides a complete list of Codethia&#39;s themes, ensuring consistent access to the Book of Source‚Äôs thematic repertoire.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: { /* Theme definition omitted for brevity */ },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  /* Additional themes omitted */
} as const;
</code></pre>
<ul>
<li>Functions as the definitive source of theme information for the kingdom.  </li>
<li>Each theme‚Äôs keywords offer multiple routes for user input alignment.  </li>
<li>The structure is simple enough for ease of extension yet comprehensive in data representation.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>Performs flexible normalization and matching of input against themes.  </li>
<li>Supports exact matches, numeric IDs, and keyword inference, making it resilient to varied user input.  </li>
<li>Embraces a graceful fallback mechanism that minimizes user frustration.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
</code></pre>
<ul>
<li>Confirms whether a given theme exists in the system.  </li>
<li>Acts as a validation tool to prevent accidental or malicious theme misuse.  </li>
<li>Supports maintenance by centralizing validation logic.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">sanitizeForDisplay</code> liberally to avoid rendering unsafe content in your magical interfaces.  </li>
<li>Modify <code class="inline-code">THEMES</code> with care‚Äîeach new theme must maintain thematic consistency with Codethia‚Äôs narrative.  </li>
<li>Ensure user inputs are validated before further processing to prevent corrupted glyphs from destabilizing the Eternal Balance.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>With the stars as witnesses and the ancient runes glowing in triumph, you have tipped the scales of destiny and claimed the Eternal Balance, brave hero‚Äîthree quests down, and the realm sings of your steadfast march toward glory! ‚≠êüó∫Ô∏è‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>