<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Codex of the Eternal Themes - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Kingdom of Codemiria</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Codex of the Eternal Themes</h1>
<hr>
<p>Amidst the enchanted halls of Codemiria, whispers of a mystical codex ripple through the winds of the magical kingdom. This ancient tome, the Codex of the Eternal Themes, holds the secrets of the wizards&#39; greatest spells. Legends proclaim that its pages allow explorers to master the delicate art of tailoring magical quests by invoking the quintessence of themes‚Äîfrom enchanted kingdoms to cosmic frontiers. To protect the Codex and unite Codemiria&#39;s realms, you must decipher the arcane configurations, validate the sacred inputs, and align its fabled themes. Read carefully, for every spell crafted from the Codex strengthens the enchanted Scroll of Adventures.</p>
<p>Brave adventurer, unveil the magic of the Codex and preserve Codemiria&#39;s legacy!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Deciphering Arcane Settings</strong>: How do configuration constants influence the magical systems and their limits? </li>
<li>‚ö° <strong>Harmonizing Themes</strong>: How does the system ensure users engage with only valid themes, and what mechanisms enable their customization or parsing?</li>
<li>üõ°Ô∏è <strong>Guarding the Codex</strong>: What safeguards are in place to validate user input, and how does the system handle invalid or unsafe entries?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Configuration of Magical Parameters</h3>
<p>This file serves as the foundation for Codemiria‚Äôs magic infrastructure, containing essential constants and settings for its enchanted systems. It includes timeout configurations, API settings for invoking powerful logic wizards, and error handling strategies. Each parameter reflects a delicate balance to maintain stability across the realms. Examining these constants reveals how Codemiria&#39;s safeguards prevent system overload and ensure adventures remain immersive yet manageable.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Manages the time allotted for powerful spells (logic tasks) to complete before they timeout.</li>
<li><code class="inline-code">ERROR_MESSAGES</code>: Defines user-facing phrases to ensure adventurers understand why they encounter challenges during quests.</li>
<li><code class="inline-code">IGNORE_PATTERNS</code>: Lists forbidden paths and artifacts to prevent unnecessary or harmful interference with the magic framework.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">// Timeouts in milliseconds
export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const LLM_API_KEY = process.env.LLM_API_KEY || &#39;&#39;;

// Error settings
export const MAX_ERROR_MESSAGE_LENGTH = 200;
export const ERROR_MESSAGES = {
  LLM_UNAVAILABLE: &#39;LLM service is currently unavailable. Please check your configuration.&#39;,
  ANALYSIS_FAILED: &#39;Failed to analyze the project. Please ensure the path is valid.&#39;,
  THEME_INVALID: &#39;Invalid theme specified. Using default theme.&#39;,
  FILE_NOT_FOUND: &#39;The requested file could not be found.&#39;,
  PERMISSION_DENIED: &#39;Permission denied accessing the specified path.&#39;,
} as const;

// Directory patterns to ignore during scanning
export const IGNORE_PATTERNS = [
  &#39;node_modules&#39;,
  &#39;.git&#39;,
  &#39;.next&#39;,
  &#39;.nuxt&#39;,
  &#39;dist&#39;,
  &#39;build&#39;,
  &#39;coverage&#39;,
  &#39;.nyc_output&#39;,
  &#39;logs&#39;,
  &#39;*.log&#39;,
  &#39;.env&#39;,
  &#39;.DS_Store&#39;,
  &#39;Thumbs.db&#39;,
] as const;
</code></pre>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> determines how long complex logical wizards can process their tasks before requiring intervention. This aids in balancing performance and user experience.</li>
<li><code class="inline-code">ERROR_MESSAGES</code> consolidates guiding messages into a single configuration, enhancing system clarity and user alignment with Codemiria‚Äôs rules.</li>
<li><code class="inline-code">IGNORE_PATTERNS</code> ensures standardized exclusions of irrelevant or disruptive files during scanning, preserving the focus of magical analysis.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> The Guardians of the Codex</h3>
<p>This file protects Codemiria‚Äôs magical interface by verifying adventurers‚Äô input to prevent forbidden or malformed entries. Each function ensures that interactions with the Codex remain harmonious and intent-driven while mitigating risks. Studying this file reveals how the system balances user freedom with strict adherence to the enchanted rules.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Sanctions adventurer choices while rejecting overly lengthy or undefined inputs.</li>
<li><code class="inline-code">validateTheme</code>: Enforces the sanctity of theme selection, verifying against the list of Codemiria&#39;s predefined themes.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Removes potentially malicious elements from user inputs, ensuring only safe content is displayed.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}

export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}

export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> examines user input to ensure that only meaningful choices are accepted, limiting to 200 characters to shield against malfeasance.</li>
<li><code class="inline-code">validateTheme</code> guards the Codex by validating theme input against the officially ordained themes of Codemiria, ensuring no rogue realms are accessed.</li>
<li><code class="inline-code">sanitizeForDisplay</code> acts as a protective charm, filtering any unsafe input, thus safeguarding the magical scroll display from mishaps.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> The Eternal Themes</h3>
<p>This file defines and protects Codemiria‚Äôs sacred themes‚Äîcore to the Codex‚Äôs eternal power. It stores their data, supports customization, and ensures adventurers&#39; chosen themes align with the realm‚Äôs ethos.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: Declares the eternal themes and their vital properties, anchoring the system‚Äôs mythical constructs.</li>
<li><code class="inline-code">isValidTheme</code>: Confirms if a given theme is sanctioned, ensuring user choices are aligned with the eternal truths of Codemiria.</li>
<li><code class="inline-code">parseTheme</code>: Transforms user inputs into a matching theme by identification through key, numeric ID, or keywords.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  }
};

export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}

export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li><code class="inline-code">THEMES</code> forms the wellspring of Codemiria‚Äôs adventures‚Äîthe building blocks for all magical storylines.</li>
<li><code class="inline-code">isValidTheme</code> ensures adventurers cannot deviate from the ordained paths, maintaining the sanctity of exploratory options.</li>
<li><code class="inline-code">parseTheme</code> offers flexibility in user inputs, aligning even loosely specified phrases to the appropriate eternal theme.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When studying configurations in <code class="inline-code">config.ts</code>, consider how limits and default values protect system performance and user experience.</li>
<li>Explore <code class="inline-code">input-validator.ts</code> closely to understand how user-centric safeguards create a balance between flexibility and security.</li>
<li>Use <code class="inline-code">theme.ts</code> to review how thematic alignment is maintained across the system, allowing a blend of expressiveness and predefined structure.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of Codemiria‚Äôs powerful adventure system.</p>
<p>By the light of the astral crown and the wisdom bound within the Codex of the Eternal Themes, you have ascended as a legendary seeker of knowledge, forging a path through the annals of heroism‚Äîforward, valiant soul, for the stars themselves applaud your journey! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>