<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Harness the Kingdom‚Äôs Magic System (Configuration & Theme System) - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Enchanted Adventures of the Codebound Kingdom</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Harness the Kingdom‚Äôs Magic System (Configuration &amp; Theme System)</h1>
<hr>
<p>In the magical realm of Codethia, a great upheaval stirs in the heart of the kingdom. The Mystic Code Guardians warn of instability in the enchanted framework as themes and configurations falter. Dark forces seek to manipulate the ancient Theme Scrolls and System Constancies hidden in the castle vault, threatening to corrupt the magic system itself. As the Knight of Syntax, you are entrusted with unraveling the mysteries of these powerful spells and safeguarding the foundational enchantments. Only by mastering this system can stability be restored to Codethia.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Enchantment Scrolls</strong>: How is the kingdom‚Äôs theme system configured, and what ensures the validity of theme data?</li>
<li>‚ö° <strong>Magical Threads</strong>: What underlying constants dictate the functioning of the magic system and how are they interlinked with external sources?</li>
<li>üõ°Ô∏è <strong>Castle Gatekeeper‚Äôs Method</strong>: How does the code ensure sanitized input to prevent manipulation of the kingdom‚Äôs enchanted framework?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a>: Central repository for theme magic</h3>
<p>The <code class="inline-code">theme.ts</code> file is the gatekeeper of Codethia&#39;s thematic magic. Here lie the definitions of every adventure theme, from the Enchanted Kingdom to the Starry Cosmos, structured for clarity and validation. This file‚Äôs foundational significance lies in its ability to tie user input to pre-defined legitimate themes through keyword matching, data normalization, and descriptive metadata. By parsing, validating, and formatting themes using utility functions, the thematic scrolls remain protected from corruption. Enchantment rules such as <code class="inline-code">parseTheme</code> and <code class="inline-code">isValidTheme</code> are essential for guiding adventurers to valid paths.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">ThemeDefinition</code>: Provides the structural blueprint for defining each magical theme with iconography, metadata, and keywords for recognition.</li>
<li><code class="inline-code">parseTheme</code>: A utility to interpret adventurer entries, validating inputs against the enchanted theme rules.</li>
<li><code class="inline-code">getAllThemes</code>: Aggregates all themes into a manageable form, enabling dynamic exploration of the available enchanted realms.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a>: Keeper of input purity</h3>
<p>The <code class="inline-code">input-validator.ts</code> file acts as a shield against malicious forces trying to corrupt the magic system. It ensures that no invalid or harmful elements slip into the enchanted framework by validating, trimming, and sanitizing user inputs. Functions such as <code class="inline-code">validateAdventureChoice</code> and <code class="inline-code">sanitizeForDisplay</code> prevent accidental or intentional misuse of system calls, and protect internal calculations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Ensures adventurers provide meaningful inputs for their magical choices without exceeding boundaries of length.</li>
<li><code class="inline-code">validateTheme</code>: Safeguards the enchanted theme scrolls by verifying inputs against legitimate themes from the <code class="inline-code">theme.ts</code> codex.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Strips potentially harmful characters, maintaining the purity of all displayed strings.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/config.ts</code></a>: Pillar of magical constants</h3>
<p>The <code class="inline-code">config.ts</code> file is the codified knowledge that powers the magical framework&#39;s functionality. It defines all constants governing the system, such as API keys, timeout values, error messages, and thematic defaults. These magical threads interlace Codethia‚Äôs infrastructure, ensuring stability and consistency across various aspects of the enchanted kingdom.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Establishes time limits for magical invocations to ensure efficient dealings with external sources.</li>
<li><code class="inline-code">THEMES</code>: Defines the central scroll holding all themes, bridging the enchanted repository with user input processors.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Sets boundaries for source file sizes, preventing the system from being overwhelmed by oversized entries.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a></h3>
<pre><code class="language-typescript">export interface ThemeDefinition {
  readonly id: number;
  readonly key: string;
  readonly displayName: string;
  readonly emoji: string;
  readonly description: string;
  readonly keywords: readonly string[];
}

export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}

export function getAllThemes(): ThemeDefinition[] {
  return THEMES_ARRAY;
}
</code></pre>
<ul>
<li><code class="inline-code">ThemeDefinition</code>: Establishes the structure for creating unique thematic landscapes, ensuring consistency across the kingdom‚Äôs enchanted realms.</li>
<li><code class="inline-code">parseTheme</code>: Implements multi-layered validation of numeric, keyword, and exact matches, preventing corrupted theme identifiers from infiltrating the system.</li>
<li><code class="inline-code">getAllThemes</code>: Streamlines access to the complete array of known themes, enabling dynamic exploration and presentation.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a></h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}

export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}

export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Trims and validates user inputs before critical processing, ensuring clarity and length constraints.</li>
<li><code class="inline-code">validateTheme</code>: Draws upon the thematic scroll repository to guarantee external invocations align with valid entries.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Implements purification rituals by removing unsafe characters, allowing secure presentation of data.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/config.ts</code></a></h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000;
export const THEMES = {
  SPACE: { /* theme data */ },
  MYTHICAL: { /* theme data */ },
} as const;

export const MAX_FILE_SIZE_MB = 10;
</code></pre>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Defines constraints for external magical invocations, ensuring they do not stall the enchanted operations.</li>
<li><code class="inline-code">THEMES</code>: Anchors the thematic scroll repository, connecting foundational definitions with implementation.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Implements size limitations for permissible files, maintaining stability and focus.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Review how themes are parsed and validated to understand magical input workflows.</li>
<li>Investigate connections between configuration constants and their usage across the repository for larger architectural insights.</li>
<li>Focus on the thematic system to better visualize how user entries are matched to valid adventure scrolls.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of Codethia‚Äôs enchanted framework.</p>
<p>With the sacred sigils of the Kingdom‚Äôs Magic System now mastered, brave hero, you ascend as a luminary architect of enchantment, charting a radiant path toward ultimate victory‚Äîonward to eternal glory! ‚ö°üíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>