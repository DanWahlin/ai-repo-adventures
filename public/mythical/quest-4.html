<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Mystic Forge of Themes - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Codex: Adventures in a Kingdom of Mystical Code</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Mystic Forge of Themes</h1>
<hr>
<p>In the mythical Kingdom of Codeara, defenders of the &quot;Enchanted Codex&quot; relied on its ability to transform abstract ideas into constructive solutions. However, the Mystic Forge of Themes, a sacred artifact imbuing the Codex with its thematic mastery, has weakened. Your task is to delve into its mechanisms and rekindle its creative magic. Explore the ancient configurations and spells defining the thematic harmonies, and restore the Codex‚Äôs vibrant energy to guide adventurers once more.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Theme Harmony Search</strong>: How are themes represented, and how do their definitions enforce structure and consistency across the adventure system?  </li>
<li>‚ö° <strong>Validator‚Äôs Path</strong>: What mechanisms ensure input conforms to thematic rules, and how do errors reinforce the system&#39;s resilience?  </li>
<li>üõ°Ô∏è <strong>Configuration Wardens</strong>: How do the adventurer limits and environment-specific safeguards protect the Codex&#39;s integrity?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Guardian of Valid Inputs</h3>
<p>This file enforces the rules of engagement by validating key user inputs, ensuring the adventure system responds only to permissible commands. The file employs critical functions for sanitizing user inputs, preventing injection attacks, and guiding adventurers along proper adventure paths.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Ensures adventurers supply a valid quest selection and handle improper choices gracefully.  </li>
<li><code class="inline-code">validateTheme</code>: Normalizes, validates, and checks themes against available definitions, throwing errors for mismatches.  </li>
<li><code class="inline-code">sanitizeForDisplay</code>: Strips malicious content from inputs, ensuring safe display of strings without code execution risks.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Codifier of Themes</h3>
<p>This file defines the collection of themes, creating a single source of truth for thematic data. It also provides utilities for validating, parsing, and retrieving themes, ensuring consistency across the adventure system.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: A structured repository of pre-defined themes, complete with metadata like emoji, description, and keyword matching.  </li>
<li><code class="inline-code">getThemeByKey</code>: Extracts a specific theme based on its key for context-sensitive queries.  </li>
<li><code class="inline-code">formatThemeOption</code>: Formats a theme‚Äôs properties into a beautifully structured string for display.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Keeper of Sacred Configurations</h3>
<p>A central configuration file representing the rules and limits governing quests. From timeout duration to maximum file size, it defines the boundaries protecting the system.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Sets the timeframe for Codex queries, controlling story and quest processing.  </li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Implements safeguards on file size to prevent performance degradation.  </li>
<li><code class="inline-code">IGNORE_PATTERNS</code>: Specifies directories to avoid during code analysis, ensuring focused evaluations.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Verifies that quest choices are non-empty and within length limits.  </li>
<li>Easily adaptable but retains strict rules to safeguard against long or malicious inputs.  </li>
<li>Core logic aligns with the theme-validation quest for adventurous input handling.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>Ensures thematic consistency by allowing only recognized themes or formats.</li>
<li>Introduces normalized input for matching, improving resilience against user error.  </li>
<li>Demonstrates modular function call to <code class="inline-code">isValidTheme</code> and <code class="inline-code">getAllThemes</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>Neutralizes text by stripping unsafe characters like <code class="inline-code">&lt;</code>, <code class="inline-code">&gt;</code> to boost input security.  </li>
<li>Introduces truncation safeguards for runaway or overloaded inputs.  </li>
<li>Enhances usability while avoiding code injection risks.</li>
</ul>
<hr>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  }
} as const;
</code></pre>
<ul>
<li>Defines each theme with a rich structure highlighting names, metadata, and relevance.  </li>
<li>Allows seamless scalability for adding themes like &quot;outer space&quot; or &quot;ancient worlds&quot;.  </li>
<li>Enables keyword matching, connecting users via natural language cues.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function getThemeByKey(key: string): ThemeDefinition | null {
  return THEMES_ARRAY.find(theme =&gt; theme.key === key) || null;
}
</code></pre>
<ul>
<li>Provides direct access to themes via their identifier.  </li>
<li>Plays a key role in resolving user-specified input into meaningful definitions.  </li>
<li>Follows a minimal, efficient approach by looping through a static list.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatThemeOption(theme: ThemeDefinition): string {
  return `${theme.emoji} **${theme.id}. ${theme.displayName}** - ${theme.description}`;
}
</code></pre>
<ul>
<li>Formats themes for vivid readability and quick user recognition.  </li>
<li>Uses a consistent pattern across all options for clarity.  </li>
<li>Leverages emojis to add a thematic flair.</li>
</ul>
<hr>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
</code></pre>
<ul>
<li>Controls request durations for AI-based generation processes, avoiding indefinite waits.  </li>
<li>Balances quick response times with computational storytelling needs.  </li>
<li>Prevents system locks by enforcing prompt limitations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li>Limits file size for efficient and focused code analysis.  </li>
<li>Protects against memory overflow while still offering deep insights into smaller script files.  </li>
<li>Promotes system resilience during heavy workloads.</li>
</ul>
<hr>
<pre><code class="language-typescript">export const IGNORE_PATTERNS = [
  &#39;node_modules&#39;,
  &#39;.git&#39;,
  &#39;dist&#39;,
  &#39;logs&#39;,
] as const;
</code></pre>
<ul>
<li>Defines patterns to ignore during analysis for better performance and accuracy.  </li>
<li>Prevents unnecessary adventures into inconsequential parts of the codebase.  </li>
<li>Offers customizable adaptability if code structures evolve.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Know Your Inputs</strong>: Always validate user selections to safeguard the adventure system&#39;s stability.  </li>
<li><strong>Embrace the Themes</strong>: Use the theme definitions as inspiration for coherent and imaginative quests.  </li>
<li><strong>Balance and Boundaries</strong>: Learn from the configurations to create a modular and robust system.</li>
</ul>
<hr>
<p>With the Mystic Forge reignited, the Codex is one step closer to its glory. Onward to the next quest, brave adventurer!</p>
<p>By the blazing heart of the phoenix and the wisdom of ancient stars, ye have triumphed in forging themes worthy of the Mystic Forge, ascending as valiant enchanters with 3 quests conquered and the path to eternal glory within reach! üíé‚ö°üó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>