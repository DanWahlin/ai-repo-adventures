<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Castle‚Äôs Arcane Library - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository: A Hero's Tale</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Castle‚Äôs Arcane Library</h1>
<hr>
<p>In the heart of the kingdom lies a legendary castle that was once home to master sorcerers of old times. Its Arcane Library, hidden deep within the keep, holds ancient scrolls and enchanted tomes that whisper secrets of mystical algorithms. The Codex of Creation calls you to unravel these enchanted writings and master the spellbinding systems that govern the realm&#39;s magic. Will you venture into the labyrinth of arcane knowledge and recover the wisdom that safeguards the enchanted land?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Algorithmic Enrichment</strong>: How do timeout settings influence the functionality of system processes within <code class="inline-code">config.ts</code>, and what strategies ensure balance between performance and reliability?</li>
<li>‚ö° <strong>Theme Harmonization</strong>: How does the <code class="inline-code">theme.ts</code> system dynamically manage theme selection and validation, ensuring coherence with the mythical context?</li>
<li>üõ°Ô∏è <strong>Validation Safeguards</strong>: What mechanisms in <code class="inline-code">input-validator.ts</code> ensure user input, such as adventure choices and project paths, are properly sanitized and resilient to errors?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Configuration of Enchanted Parameters</h3>
<p>This file serves as the codex&#39;s enchanted backbone, establishing parameters for graceful timeouts, memory limits, and error handling. By defining constants like <code class="inline-code">LLM_API_VERSION</code>, <code class="inline-code">REPOMIX_SUBPROCESS_TIMEOUT</code>, and <code class="inline-code">MAX_FILE_SIZE_MB</code>, it ensures the balance of power between high-performance magical processes and system stability. It also invokes environmental variables for flexibility, linking the mystical realm&#39;s core functions with external systems like LLM services to generate coded narratives.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Determines the maximum duration for requests to LLM services, ensuring timely response during magical narrative creation.</li>
<li><code class="inline-code">IGNORE_PATTERNS</code>: Specifies directories to exclude during file analysis, preventing disruptions by unnecessary clutter in the enchanted environment.</li>
<li><code class="inline-code">ERROR_MESSAGES</code>: Provides predefined error responses, safeguarding the system from mysterious instability through clarity and user guidance.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const IGNORE_PATTERNS = [
  &#39;node_modules&#39;,
  &#39;.git&#39;,
  &#39;.next&#39;,
  &#39;.nuxt&#39;,
  &#39;dist&#39;,
  &#39;build&#39;,
  &#39;coverage&#39;,
  &#39;.nyc_output&#39;,
  &#39;logs&#39;,
  &#39;*.log&#39;,
  &#39;.env&#39;,
  &#39;.DS_Store&#39;,
  &#39;Thumbs.db&#39;,
] as const;
export const ERROR_MESSAGES = {
  LLM_UNAVAILABLE: &#39;LLM service is currently unavailable. Please check your configuration.&#39;,
  ANALYSIS_FAILED: &#39;Failed to analyze the project. Please ensure the path is valid.&#39;,
  THEME_INVALID: &#39;Invalid theme specified. Using default theme.&#39;,
  FILE_NOT_FOUND: &#39;The requested file could not be found.&#39;,
  PERMISSION_DENIED: &#39;Permission denied accessing the specified path.&#39;,
} as const;
</code></pre>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> ensures timely spell generation without exhausting system resources, maintaining balance in processing enchanted prompts.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> provides flexibility in magical content caching, reducing redundant computations.</li>
<li><code class="inline-code">IGNORE_PATTERNS</code> protects the Castle‚Äôs Arcane Library from unnecessary distractions, ensuring efficient focus on relevant code artifacts.</li>
<li><code class="inline-code">ERROR_MESSAGES</code> empowers users with clear responses, reducing confusion when the system encounters obstacles.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Arcane Theme Customization</h3>
<p>The <code class="inline-code">theme.ts</code> file is the mystical heart that defines and manages themes across the kingdom‚Äôs adventures. Featuring <code class="inline-code">THEMES</code> and utilities like <code class="inline-code">getThemeByKey</code>, it allows adventurers to adopt magical and mythical themes. The system validates input, parses keywords, and formats adventures with flair, ensuring the narrative remains captivating and on-theme.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: Defines all available themes, including &quot;mythical,&quot; linking user choices with detailed descriptions and magical identifiers.</li>
<li><code class="inline-code">parseTheme</code>: Parses user input to match themes, employing keyword searches and numerical ID handling for flexibility.</li>
<li><code class="inline-code">getFormattedThemeOptions</code>: Provides a user-friendly display of available themes, guiding adventurers in their quest context selection.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  }
} as const;

export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}

export function getFormattedThemeOptions(): string {
  return getAllThemes()
    .sort((a, b) =&gt; a.id - b.id)
    .map(formatThemeOption)
    .join(&#39;\n&#39;);
}
</code></pre>
<ul>
<li><code class="inline-code">THEMES</code> defines critical attributes like magical keywords and descriptions, ensuring seamless integration into adventure stories.</li>
<li><code class="inline-code">parseTheme</code> translates user input into valid adventures themes, safeguarding narrative coherence amidst complex configurations.</li>
<li><code class="inline-code">getFormattedThemeOptions</code> combines user-facing utilities with storytelling, transforming raw data into evocative displays of thematic possibilities.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Knightly Validation of User Input</h3>
<p>The <code class="inline-code">input-validator.ts</code> file protects the Codex from malformed entries and ensures graceful handling of adventurer input. Functions like <code class="inline-code">validateAdventureChoice</code> and <code class="inline-code">sanitizeForDisplay</code> cleanse and restructure user input, safeguarding the kingdom&#39;s enchanted operations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Ensures adventurers provide concise, well-formed adventure selections, avoiding confusion during quest initiation.</li>
<li><code class="inline-code">validateTheme</code>: Normalizes and validates user-input themes, safeguarding the spell system against disruptive mismatches.</li>
<li><code class="inline-code">sanitizeForDisplay</code>: Cleanses text to ensure safe rendering, avoiding errors caused by malicious formatting or overly lengthy entries.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}

export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}

export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> fortifies the mythic realm against unstructured or excessive user entries, ensuring adventures remain coherent and precise.</li>
<li><code class="inline-code">validateTheme</code> protects thematic coherence by verifying and normalizing user input, embracing the boundaries of magical themes.</li>
<li><code class="inline-code">sanitizeForDisplay</code> employs text cleansing techniques to preserve spell safety, avoiding errant rendering of mystical scripts.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Explore timeout settings to understand how magical processes are balanced between speed and reliability.</li>
<li>Study the theme parsing logic to appreciate the flexible handling of user input and thematic keyword matches.</li>
<li>Examine error handling and validation mechanisms to ensure safe navigation through the codebase.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries hidden in the Codex of Creation and safeguard the kingdom&#39;s enchanted future.</p>
<p>With the wisdom of ancient tomes now etched into your heroic spirit, you have triumphed over the Castle‚Äôs Arcane Library‚Äîmarch boldly, valiant seeker, for the stars themselves favor your ascent! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>