<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Quest-Maker's Forge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Repository: Quests of the Mystic Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Quest-Maker&#39;s Forge</h1>
<hr>
<p>In the enchanted Kingdom of Codevale, the path to unraveling the Mystic Codex continues as brave adventurers approach the legendary Quest-Maker&#39;s Forge. Here lies the heart of creation, where sprawling adventures and thrilling tales are forged from molten lines of code and tempered in the fires of imagination. This mystical forge guards the secrets of building quests so intricate, they seem alive‚Äîdrawing from the energies of files, scripts, and boundless creativity.</p>
<p>Only those who dare to delve into the code of the Quest Generation Engine will uncover the arcane patterns and mechanisms that craft such vivid epics. Are you ready to wield the tools of the Forge?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Quest Alignment</strong>: How does the <code class="inline-code">initializeAdventure</code> method set up the foundation for generating the story and quests?</li>
<li>‚ö° <strong>Exploration Flow</strong>: What role does <code class="inline-code">exploreQuest</code> play in handling user choices and executing quests within the adventure system?</li>
<li>üõ°Ô∏è <strong>Content Crafting</strong>: How does the <code class="inline-code">generateQuestContent</code> function of the <code class="inline-code">StoryGenerator</code> utilize project-specific information to design quest content?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> The Engine&#39;s Heart</h3>
<p>This file contains the <code class="inline-code">AdventureManager</code> class, which is responsible for managing the entire progression of an adventure. It initializes new journeys, handles user inputs to explore quests, and communicates with the <code class="inline-code">StoryGenerator</code> to craft the narrative arcs. The <code class="inline-code">AdventureState</code> class is also defined here, maintaining the state of the entire adventure including quests, titles, themes, and progress updates.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: This method sets the stage for an adventure by loading the project context, applying the chosen theme, and generating both the overarching story and quests using the <code class="inline-code">StoryGenerator</code>.</li>
<li><code class="inline-code">exploreQuest</code>: This function interprets the adventurer&#39;s choice and either executes a quest, shows progress, or ensures invalid inputs are gracefully handled.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Verifies and cleanses user input to ensure the chosen adventure option is valid.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  
  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Sets up the entire context for an adventure, resetting the state and applying themes.</li>
<li>Integrates project-specific configuration files to tailor quests to the codebase.</li>
<li>Ensures all generated story and quest content complies with the parameters provided by the <code class="inline-code">StoryGenerator</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  // Check if this is a progress request
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  // Find the quest based on the choice
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  // Execute the quest
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Handles player input and identifies which quest (or status option) the input corresponds to.</li>
<li>Provides feedback for invalid choices and gracefully prevents crashes using helper methods.</li>
<li>Executes quests by invoking their content dynamically, ensuring replayability by checking cache.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateAndSanitizeChoice(input: string): string {
  try {
    return validateAdventureChoice(input);
  } catch (error) {
    throw new Error(`Invalid adventure choice: ${error instanceof Error ? error.message : &#39;Unknown error&#39;}`);
  }
}
</code></pre>
<ul>
<li>Validates user inputs to avoid crashes or invalid state from incorrect data.</li>
<li>Ensures user experience remains smooth by catching and returning meaningful error messages.</li>
<li>Forms the foundational safeguard for interacting with the quest flow.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Crafting the Tales</h3>
<p>The <code class="inline-code">story-generator.ts</code> file houses the <code class="inline-code">StoryGenerator</code> class, which leverages inputs such as project details, themes, and existing files to generate intricately detailed narratives and quests. This file is responsible for the alchemy of turning structured data into a vivid, engaging adventure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateQuestContent</code>: Crafts the specific content for each quest, pulling in contextual file data and magical themes.</li>
<li><code class="inline-code">generateStoryAndQuests</code>: Combines the tale&#39;s introductory story with a lineup of quests, serving as the bridge between the player and the codebase.</li>
<li><code class="inline-code">getThemeGuidelines</code>: Maps thematic details to story and vocabulary structures, ensuring each theme&#39;s immersion is maintained.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const { quest, theme, codeContent, questPosition, totalQuests } = config;
  
  let adventureGuidance = &#39;&#39;;
  let customInstructions = &#39;&#39;;
  
  if (this.projectPath) {
    const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);
    if (formattedConfig) {
      adventureGuidance = formattedConfig;
    }
    
    const customInstructionsFromConfig = extractCustomInstructions(this.projectPath);
    if (customInstructionsFromConfig) {
      customInstructions = customInstructionsFromConfig;
    }
  }

  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    adventureGuidance: adventureGuidance || &#39;&#39;,
    ...(customInstructions &amp;&amp; { customInstructions }),
    questPosition,
    totalQuests,
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );
  
  if (!response.content || response.content.trim() === &#39;&#39;) {
    throw new Error(&#39;LLM returned empty response for quest content&#39;);
  }
  
  let cleanContent = response.content.trim();
  return {
    adventure: cleanContent,
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<ul>
<li>Demonstrates how AI-driven story generation pulls from dynamic templates tailored to quest-specific themes and code.</li>
<li>Introduces fallback mechanisms for describing quests in the absence of optimal conditions.</li>
<li>Integrates prompts with the LLM engine, revealing how data transforms into vivid storytelling.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>Bridges project information, themes, and user context to generate fully interconnected stories and quest listings.</li>
<li>Centralizes the process of validating thematic choices and orchestrating story creation.</li>
<li>Demonstrates modular design by delegating the actual AI story generation to an encapsulated LLM call.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateTheme(theme: AdventureTheme): AdventureTheme {
  if (!isValidTheme(theme)) {
    console.warn(`Invalid theme &#39;${theme}&#39;, defaulting to ${DEFAULT_THEME}`);
    return DEFAULT_THEME;
  }
  return theme;
}
</code></pre>
<ul>
<li>Ensures selected themes adhere to predefined guidelines before use in quest or story generation.</li>
<li>Implements defensive mechanisms to gracefully handle errors during adventures.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Focus on the seamless integration of code with narrative: The manipulations of project contexts and themes in <code class="inline-code">initializeAdventure</code> reflect the depth this architecture supports.</li>
<li>Notice the versatility of the AI engine within <code class="inline-code">generateQuestContent</code>: it dynamically tailors content to the user‚Äôs context.</li>
<li>Enhance your own design workflows by examining how <code class="inline-code">validateAndSanitizeChoice</code> ensures errors are caught early.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>By the hammer of celestial smiths and the embered stars that stoke creation&#39;s forge, you have triumphed in Quest 3, rising as a beacon of valor upon the mythical path‚Äîbrave hero, the realm salutes your indomitable spirit! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>