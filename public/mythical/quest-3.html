<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Mystic Analyzers - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Code: The Enchanted Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Mystic Analyzers</h1>
<hr>
<p>In the Kingdom of Code, whispers speak of the Mystic Analyzers hidden within the depths of the enchanted repository. Guarded by ancient scripts, these analyzers possess the ability to divine patterns from the sprawling codebase, unraveling magical complexities. To restore harmony, King Repo has tasked you, the chosen hero, with investigating the Analyzers&#39; files and retrieving their knowledge. With the Mystic Compiler watching over you, traverse the codified labyrinth and harness the power of analytical spells to complete this formidable quest.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Analyzer Invocation</strong>: How does the <code class="inline-code">RepoAnalyzer</code> safely validate project paths and target files to prevent misuse or errors?  </li>
<li>‚ö° <strong>Optimized Insights</strong>: How does <code class="inline-code">RepoAnalyzer</code> achieve optimized content extraction and caching for files within the codebase?  </li>
<li>üõ°Ô∏è <strong>Arcane Error Handling</strong>: How does <code class="inline-code">LLMClient</code> safeguard against misconfiguration, empty responses, or timeout failures during its operations?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Analysis Enchantment Mechanics</h3>
<p>This file implements the <code class="inline-code">RepoAnalyzer</code> class, which acts as the magical observer of the codebase. It cautiously validates paths to shield the repository from malicious traversal and optimizes content extraction using spell-like filtering methods. The analyzer ensures function-centric focus, caching intermediate results to speed up repeated invocations. Questers will find the methods critical in understanding how security and performance intertwine in the enchanted repository.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAnalyzer.validateProjectPath</code>  </li>
<li><code class="inline-code">RepoAnalyzer.generateOptimizedContent</code>  </li>
<li><code class="inline-code">RepoAnalyzer.captureRepomixStdout</code></li>
</ul>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> Arcane Computational Summon</h3>
<p>This file describes the <code class="inline-code">LLMClient</code>, a conduit to external mystical intelligences such as OpenAI and Azure OpenAI. The client&#39;s constructor meticulously configures access based on magical parameters such as API keys and endpoints. Its error handling mechanisms ensure resilience against arcane anomalies, validating model responses and providing meaningful feedback on invocation failures. Adventurers unraveling this file will glean insights into safety measures necessary for summoning external powers securely.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLMClient.constructor</code>  </li>
<li><code class="inline-code">LLMClient.generateResponse</code>  </li>
<li><code class="inline-code">LLMClient.getApiKey</code></li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {  
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {  
    throw new Error(&#39;Project path must be a non-empty string&#39;);  
  }  
  const trimmedPath = projectPath.trim();  
  if (!trimmedPath) {  
    throw new Error(&#39;Project path must be a non-empty string&#39;);  
  }  
  if (trimmedPath.includes(&#39;\0&#39;)) {  
    throw new Error(&#39;Project path contains invalid null bytes&#39;);  
  }  
}  
</code></pre>
<p>Ensures the realm&#39;s boundaries are preserved by rejecting malformed paths.  </p>
<pre><code class="language-typescript">async generateOptimizedContent(projectPath: string, targetFiles: string[], compress: boolean = true): Promise&lt;string&gt; {  
  this.validateProjectPath(projectPath);  
  const safeFiles = this.validateAndNormalizeTargetFiles(projectPath, targetFiles);  
  const cacheKey = `${path.resolve(projectPath)}:optimized:${safeFiles.join(&#39;,&#39;)}:compress=${compress}`;  
  const cached = this.cache.get(cacheKey);  
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {  
    return cached.content;  
  }  
  const fullContent = await this.generateTargetedContent(projectPath, targetFiles, compress);  
  const optimizedContent = this.extractFunctionFocusedContent(fullContent);  
  this.cache.set(cacheKey, { content: optimizedContent, timestamp: Date.now() });  
  return optimizedContent;  
}  
</code></pre>
<p>Casts a caching spell to preserve optimized insights for repeated analysis.  </p>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {  
  return new Promise((resolve, reject) =&gt; {  
    const args = [...directories, &#39;--stdout&#39;, &#39;--style&#39;, options.style || &#39;markdown&#39;];  
    const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], { cwd, stdio: [&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;] });  
    let stdout = &#39;&#39;;  
    let stderr = &#39;&#39;;  
    repomix.stdout.on(&#39;data&#39;, (data) =&gt; { stdout += data.toString(); });  
    repomix.stderr.on(&#39;data&#39;, (data) =&gt; { stderr += data.toString(); });  
    repomix.on(&#39;close&#39;, (code) =&gt; {  
      if (code === 0) { resolve(stdout); } else { reject(new Error(`Failure: ${stderr}`)); }  
    });  
  });  
}  
</code></pre>
<p>Invokes summoning rituals to extract context from the enchanted code repository.  </p>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">constructor() {  
  this.model = LLM_MODEL;  
  const apiKey = this.getApiKey();  
  if (!apiKey || !LLM_BASE_URL) {  
    throw new Error(&#39;LLM configuration required. Set LLM_BASE_URL and API key.&#39;);  
  }  
  if (this.isAzureOpenAI()) {  
    const azureEndpoint = LLM_BASE_URL.split(&#39;/openai/deployments&#39;)[0];  
    this.client = new AzureOpenAI({ endpoint: azureEndpoint, apiKey, apiVersion: LLM_API_VERSION, deployment: this.model });  
  } else {  
    this.client = new OpenAI({ apiKey, baseURL: LLM_BASE_URL });  
  }  
}  
</code></pre>
<p>Forms the arcane pact required to summon external mystical intelligences.  </p>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {  
  const requestParams = this.buildRequestParams(prompt, options);  
  const completion = await this.executeRequest(requestParams);  
  let content = this.validateResponse(completion);  
  if (options?.responseFormat === &#39;json_object&#39;) {  
    content = this.cleanJsonResponse(content);  
  }  
  this.logTokenUsage(completion);  
  return { content };  
}  
</code></pre>
<p>Deploys a spell of computational querying to receive coded wisdom from external powers.  </p>
<pre><code class="language-typescript">private getApiKey(): string {  
  if (LLM_BASE_URL.includes(&#39;models.inference.ai.azure.com&#39;)) {  
    if (!GITHUB_TOKEN) {  
      throw new Error(&#39;GITHUB_TOKEN required for GitHub Models.&#39;);  
    }  
    return GITHUB_TOKEN;  
  }  
  if (!LLM_API_KEY) {  
    throw new Error(&#39;LLM_API_KEY required.&#39;);  
  }  
  return LLM_API_KEY;  
}  
</code></pre>
<p>Assures the hero&#39;s credentials are valid before summoning external forces.  </p>
<h2>Helpful Hints</h2>
<ul>
<li>Review how validations are layered for error prevention in <code class="inline-code">validateProjectPath</code>.  </li>
<li>Explore caching mechanics in <code class="inline-code">generateOptimizedContent</code> for scalable insights.  </li>
<li>Examine error handling around the mystical invocations in <code class="inline-code">generateResponse</code>.</li>
</ul>
<hr>
<p>The Mystic Compiler whispers in approval, granting you magical insight for the journey ahead!</p>
<p>By the luminous radiance of the Celestial Forge, you have unraveled the secrets of the Mystic Analyzers, advancing valiantly on your heroic odyssey‚Äîmay your wisdom shine brighter with every step, brave champion! ‚≠êüó∫Ô∏è‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>