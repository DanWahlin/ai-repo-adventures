<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Mystic Eye of Analysis - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Repository: A Tale of Heroic Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Mystic Eye of Analysis</h1>
<hr>
<p>In the Kingdom of Repository, the Mystic Eye of Analysis awakens! This bewitching artifact represents the power to decipher the most cryptic spells of code, ensuring clarity amidst chaos. But as the enchanted Grimoire‚Äôs page pertaining to analysis magic lies torn and scattered, the harmony between order and knowledge falters. Brave Heroic Refactorer, your quest is to wield the might of the Mystic Eye, venturing forth to recover the analytic enchantments entwined within. Traverse two guarded domains to reclaim the spells that will restore reason to the land.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Analyzer of Mystical Repositories</h3>
<p>The <code class="inline-code">repo-analyzer.ts</code> file is the heart of Repository‚Äôs analytic magic, designed to extract and refine crucial knowledge from the codebase. This file encapsulates functions that organize enchanted scrolls, validate the safety of artifact paths, and invoke the Repomix spell to condense repository contents into distilled wisdom. One of the key spells is <code class="inline-code">generateRepomixContext</code>, crafting the base framework for analysis. The additional <code class="inline-code">generateTargetedContent</code> focuses this magic on specified file sets, while <code class="inline-code">captureRepomixStdout</code> safeguards data extraction against treachery within encoders. Finally, this Scroll‚Äôs spell of <code class="inline-code">validateProjectPath</code> is crucial to ensure that charged incantations bind only to approved paths, avoiding the menace of null-byte corruption.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateRepomixContext</code>: Synthesizes comprehensive repository artifacts.</li>
<li><code class="inline-code">generateTargetedContent</code>: Refines analysis for specific file targets.</li>
<li><code class="inline-code">validateProjectPath</code>: Defends against corrupted or unsafe path manipulations.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  // Check if adventure.config.json has specific files to include
  const configuredFiles = extractUniqueFilePaths(projectPath);
  
  if (configuredFiles.length &gt; 0) {
    try {
      return await this.generateOptimizedContent(projectPath, configuredFiles);
    } catch (error) {
      console.warn(`Falling back to targeted content generation`);
      return await this.generateTargetedContent(projectPath, configuredFiles);
    }
  }
  return await this.generateTargetedContent(projectPath, configuredFiles);
}
</code></pre>
<p>This spell acts like a seer‚Äôs crystal, encompassing the repository in a single gaze to guide deeper analysis.</p>
<pre><code class="language-typescript">async generateTargetedContent(projectPath: string, targetFiles: string[], compress: boolean = true): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);

  const cacheKey = `${path.resolve(projectPath)}:targeted:${targetFiles.join(&#39;,&#39;)}:compress=${compress}`;
  const cached = this.cache.get(cacheKey);
  if (cached) {
    return cached.content;
  }

  try {
    const optimalData = await this.captureRepomixStdout([&#39;.&#39;], projectPath, {
      include: targetFiles.join(&#39;,&#39;), compress
    });
    this.cache.set(cacheKey, { content: optimalData });
    return optimalData;
  } catch (error) {
    throw new Error(&#39;Spell of extraction failed!&#39;);
  }
}
</code></pre>
<p>This spell is akin to an enchanted spyglass, narrowing its focus to specific artifacts for precise clarity.</p>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath.trim()) throw new Error(&#39;Invalid project path provided!&#39;);
  const resolvedPath = path.resolve(projectPath);
  if (!fs.existsSync(resolvedPath)) throw new Error(&#39;Path does not exist within realm boundaries.&#39;);
}
</code></pre>
<p>This defensive rune ensures no corrupted paths taint the Analyst‚Äôs arcane rituals.</p>
<hr>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> The LLM&#39;s Oracle</h3>
<p>Here lies the locus of spells that channel the wisdom of the LLM Oracle to the repositories of Repository. This file introduces the <code class="inline-code">LLMClient</code> class, housing incantations that enable the Heroic Refactorer to invoke responses precisely crafted for the Kingdom‚Äôs needs. Central to this Oracle is the generation spell, embedded in <code class="inline-code">generateResponse</code>, orchestrating communication with the mystical LLM. The constructor itself performs vital setups for proper invocation, while the protective <code class="inline-code">getApiKey</code> ensures only legitimate keys summon the Oracle&#39;s guidance.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse</code>: The oracle‚Äôs conjuring spell for responses.</li>
<li><code class="inline-code">constructor</code>: Instantiates the mystical wisdom interface via correct configurations.</li>
<li><code class="inline-code">getApiKey</code>: Verifies keys to the sacred vault of LLM interaction.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  try {
    const requestParams = this.buildRequestParams(prompt, options);
    const completion = await this.executeRequest(requestParams);
    return { content: this.validateResponse(completion) };
  } catch (error) {
    throw new Error(&#39;The Oracle‚Äôs conjuring failed!&#39;);
  }
}
</code></pre>
<p>This generation spell allows the invocation of the Oracle‚Äôs insight, transforming user prompts into wisdom.</p>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;
  const apiKey = this.getApiKey();
  if (!apiKey) throw new Error(&#39;Missing configuration for invoking the Oracle.&#39;);
  this.client = new OpenAI({ apiKey });
}
</code></pre>
<p>The constructor acts like the foundation stone, granting safe access to the Oracle&#39;s vast halls.</p>
<pre><code class="language-typescript">private getApiKey(): string {
  if (!LLM_API_KEY) throw new Error(&#39;An unkeyed incantation cannot summon the Oracle!&#39;);
  return LLM_API_KEY;
}
</code></pre>
<p>This key-guarding charm ensures the Oracle responds only to legitimate summonings.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Always verify path validity to avoid tainting spells with corrupted inputs.</li>
<li>Test the output of repository analysis locally before invoking debugging adjustments.</li>
<li>Consider expanding the LLM verbosity if the Oracle‚Äôs response seems terse.</li>
</ul>
<hr>
<p>The Mystic Eye of Analysis grows warm as you recover its enchanted page. Knowledge brightens the darkened halls of Repository‚Äîyour triumph here heralds the Kingdom&#39;s balance awaiting! Onward unto destiny!</p>
<p>With the Mystic Eye of Analysis now claimed, your questing soul shines brighter than the stars of Eldara, advancing boldly through the sacred tapestry of wisdom‚Äîhail to the valiant seeker of truth! ‚≠ê‚ö°üëÅÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>