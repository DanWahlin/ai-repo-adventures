<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Arcane Texts of Adventure - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Chronicles of the Code Kingdom</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Arcane Texts of Adventure</h1>
<hr>
<p>In the heart of the Repository Tower lies the cryptic chamber known as the Chamber of Configurations. It is here where the Arcane Texts of Adventure slumber‚Äîthe enchanted records that dictate which paths are traversed, which magical scrolls are summoned, and what lore unravels with each quest. However, their magic is fragmented, leaving the kingdom perilously close to descending into chaos. To mend these ancient texts, you must delve into the Chamber, investigate their structure, and unlock their secrets with cunning and skill.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Scroll Decoding</strong>: How does the <code class="inline-code">parseAdventureConfig</code> method read and interpret the content of the Arcane Texts? What patterns are used to validate their structure?</li>
<li>‚ö° <strong>Path Discovery</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> ensure the integrity of pathways within the Arcane Texts? What process ensures references exist in reality?</li>
<li>üõ°Ô∏è <strong>Enchanted Formatting</strong>: How does the <code class="inline-code">formatAdventureConfigForPrompt</code> method condense the Arcane Texts while preserving their magical essence? What design ensures this is optimized for external use?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Arcane Texts Keeper</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file serves as the chamber script responsible for manipulating the enchanted texts that power each quest. It includes magical routines for reading, parsing, and optimizing the adventure configuration, transforming the raw texts into actionable insights that guide adventurers.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> processes raw Arcane Texts (JSON files) into a usable structure, playing a critical role in determining the state of quests and their attributes.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> ensures that all file paths referenced in the Arcane Texts are valid and exist, safeguarding the kingdom from phantom paths and chaotic errors.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> restructures the enchanted texts into a simplified form for external interpreters, reducing redundant data while maintaining their core essence.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This code invokes the <code class="inline-code">loadAdventureConfig</code> function to retrieve the raw Arcane Texts stored in the enchanted JSON file.</li>
<li>It encases the parsing process in a <code class="inline-code">try-catch</code> block to defend against malformed or corrupted texts, ensuring robustness in the kingdom‚Äôs magical protocols.</li>
<li>Key pattern: centralized validation ensures the magic flows cleanly without causing cascading failures downstream.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This code traverses the labyrinth of the Arcane Texts, validating each file path specified within their mystic structures.</li>
<li>A depth-first search (DFS) is conducted with the help of a <code class="inline-code">stack</code> to explore nodes, ensuring systematic processing of all nested configurations.</li>
<li>The approach guarantees only authentic file paths are considered, employing <code class="inline-code">fs.existsSync</code> to resolve references, thus protecting the kingdom from spell misfires.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function conjures a condensed format of the Arcane Texts, suitable for external spellcasters such as LLMs to interpret.</li>
<li>It traverses each quest within the configuration, recording file paths and significant functions within an organized structure for easy consumption.</li>
<li>The optimization removes extraneous details, streamlining communication while preserving the essential blueprints of adventure.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Always inspect the <code class="inline-code">try-catch</code> mechanisms guarding the Arcane Texts to understand how errors are mitigated.</li>
<li>Map the logic of <code class="inline-code">Set</code> usage within <code class="inline-code">extractUniqueFilePaths</code> to ensure you follow the patterns of duplication prevention.</li>
<li>Experiment with extending <code class="inline-code">formatAdventureConfigForPrompt</code> to include additional metadata for more powerful external spellcasting.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Repository Tower!</p>
<p>Huzzah, brave scholar, for thou hast unearthed the arcane wisdom from the enchanted realms of Quest 3, forging thy path through the starry tapestry of knowledge and earning thy place among legendary seekers‚Äîpress onward, for heroism grows with each step! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>