<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Chronicles of the Questwright - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Kingdom of Code</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Chronicles of the Questwright</h1>
<hr>
<p>As chaos spreads through the enchanted scrolls of Codethos, the essence of magic itself trembles. A shadow looms over the Great Repository, threatening the ancient wisdom concealed within. Your next challenge takes you to the heart of the repository‚Äôs inner sanctum, where the Questwright, a magical entity responsible for crafting tales and quests, has faltered. To restore balance, uncover the mechanisms powering its mystical storytelling and breathe life back into the corrupted chronicles.</p>
<h2>Quest Objectives</h2>
<p>Embark on a journey through these code files to investigate:  </p>
<ul>
<li>üîç <strong>The Essence of Creation</strong>: How does the <code class="inline-code">AdventureManager</code> initialize quests and weave them into the overarching narrative?  </li>
<li>‚ö° <strong>Transmutation Dynamics</strong>: What techniques are employed in <code class="inline-code">StoryGenerator</code> to transform prompts into themed quest structures across Codethos?  </li>
<li>üõ°Ô∏è <strong>Sanctuary Safeguards</strong>: What mechanisms in <code class="inline-code">adventure-config.ts</code> ensure data integrity for adventure creation and parsing?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuring the Mystic Scrolls</h3>
<p>This file serves as the cornerstone for loading and parsing the enchanted config scrolls that guide the Questwright. Its highlights include utilities for working with JSON files, extracting paths, and formatting them for prompts to help tailor quests to the kingdom‚Äôs needs.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads raw config data from the magical repository scroll, ensuring a seamless connection to Codethos wisdom.  </li>
<li><code class="inline-code">parseAdventureConfig</code>: Transforms raw scroll content into operable objects, wielding validation spells to prevent errors.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies all referenced files essential to adventures, guarding against corrupted paths.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {  
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);  
  return readFileIfExists(configPath);  
}  
</code></pre>
<ul>
<li>Reads the <code class="inline-code">adventure.config.json</code> file for the repository path.  </li>
<li>Ensures adventures are sourced dynamically based on project context.  </li>
<li>Root-level modularity enables reuse across multiple adventure types.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {  
  const raw = loadAdventureConfig(projectPath);  
  if (!raw) return null;  
  try {  
    return JSON.parse(raw);  
  } catch {  
    return null;  
  }  
}  
</code></pre>
<ul>
<li>Parses adventure scrolls into magical constructs.  </li>
<li>Uses a robust fallback mechanism for unreadable scrolls to avoid fatal errors.  </li>
<li>Data processed here flows downstream into all quest activities.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {  
  const parsed = parseAdventureConfig(projectPath);  
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];  
  
  const unique = new Set&lt;string&gt;();  
  const stack: any[] = [parsed];  
  
  while (stack.length) {  
    const node = stack.pop();  
    if (!node || typeof node !== &#39;object&#39;) continue;  
  
    if (typeof node.path === &#39;string&#39;) {  
      const rel = node.path.trim();  
      if (fs.existsSync(path.resolve(projectPath, rel))) {  
        unique.add(rel);  
      }  
    }  
  
    const children = Array.isArray(node) ? node : Object.values(node);  
    children.forEach(child =&gt; {  
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);  
    });  
  }  
  
  return Array.from(unique);  
}  
</code></pre>
<ul>
<li>Extracts file paths specified in scrolls, offering an inspection scope for adventurers.  </li>
<li>Validates paths, eliminating corrupted or mystical errors in file references.  </li>
<li>Utilizes <code class="inline-code">Set</code> for maintaining unique entries, preventing redundancy.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Orchestrating the Questwright</h3>
<p>The <code class="inline-code">AdventureManager</code> is central to conducting narratives, generating quests, and tracking progress‚Äîa pivotal pillar of Codethos.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Begins the magical quest sequence for project exploration, merging config wisdom with live generation.  </li>
<li><code class="inline-code">exploreQuest</code>: Guides adventurers through chosen quests, managing cached chronicles and interaction flow.  </li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Harmonizes file references from parsed scrolls with generated quests to ensure balance in the repository‚Äôs lore.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string, customThemeData?: CustomThemeData): Promise&lt;string&gt; {  
  this.state.reset();  
  this.state.projectInfo = projectInfo;  
  this.state.currentTheme = theme;  
  this.state.projectPath = projectPath || process.cwd();  
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {  
    this.storyGenerator.setCustomTheme(customThemeData);  
  }  
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);  
  this.state.title = storyResponse.title;  
  this.state.story = storyResponse.story;  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);  

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });  
}  
</code></pre>
<ul>
<li>Combines Codethos themes with project-specific contexts.  </li>
<li>Initializes quests dynamically by merging config file content.  </li>
<li>Tailored generation provides seamless exploration based on the storyline.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {  
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);  
  
  if (this.isProgressRequest(sanitizedChoice)) {  
    return this.getProgress();  
  }  
  
  const quest = this.findQuest(sanitizedChoice);  
  if (!quest) {  
    return this.createNotFoundResult();  
  }  
  
  return await this.executeQuest(quest);  
}  
</code></pre>
<ul>
<li>Allows adventurers to select their quest, resolving the choice intelligently.  </li>
<li>Handles progress inquiries and validates inputs to maintain exploratory precision.  </li>
<li>Ensures each quest played contributes to overarching narrative completion.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {  
  if (!projectPath) return quests;  
  const config = parseAdventureConfig(projectPath);  
  if (!config || typeof config !== &#39;object&#39;) return quests;  

  const adventure = (config as any).adventure;  
  if (!adventure || !Array.isArray(adventure.quests)) return quests;  

  return quests.map((quest, index) =&gt; {  
    if (index &lt; adventure.quests.length &amp;&amp; adventure.quests[index].files) {  
      const files = adventure.quests[index].files.map((f: any) =&gt; f.path).filter(Boolean);  
      if (files.length &gt; 0) return { ...quest, codeFiles: files };  
    }  
    return quest;  
  });  
}  
</code></pre>
<ul>
<li>Connects parsed scroll wisdom to generated quests by merging file references from the repository.  </li>
<li>Maintains alignment between the generated stories and the repository‚Äôs sacred records.  </li>
<li>Prevents quests from drifting away from Codethos integrity.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Validate paths from config files early when debugging adventure generation issues.  </li>
<li>Explore narrative formatting techniques to better understand merging of config data into interactive quests.  </li>
<li>Investigating <code class="inline-code">mergeQuestFilesFromConfig</code> offers insights into dynamic storytelling adaptations.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of Codethos and restore balance to the Great Repository.</p>
<p>Huzzah, valiant seeker of wisdom, for with Quest 3: The Chronicles of the Questwright conquered and your banner raised high, you stride ever closer to mastering the fabled Codex of Completion‚Äîmay your steadfast courage shine brighter than the North Star! ‚≠ê‚öîÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>