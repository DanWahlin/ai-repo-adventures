<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Sorcerer's Prism of Words - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Codebase of Eldoria</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Sorcerer&#39;s Prism of Words</h1>
<hr>
<p>As the radiant sun bathed the enchanted castle of Eldoria, a council of the realm‚Äôs wizards gathered within the shimmering Hall of Codex. The Oracle of Patterns had spoken of a mystical prism, the Sorcerer&#39;s Prism of Words, said to illuminate the truths buried deep within the code. This sacred artifact could parse the silent whispers of arcane scripts and distill their magical intent into essence. With quills and scrolls in hand, your journey now takes you to the castle‚Äôs grand library to unveil the secrets hidden in literature‚Äîthe breathtaking spells etched in the files of <code class="inline-code">adventure-config.ts</code>, <code class="inline-code">adventure-manager.ts</code>, and <code class="inline-code">story-generator.ts</code>. Courage, O seeker, for the prism awaits!</p>
<h2>Quest Objectives</h2>
<p>As you explore the arcane scrolls below, be guided by these investigative inquiries:</p>
<ul>
<li>üîç <strong>Prism Insights</strong>: How does the <code class="inline-code">extractUniqueFilePaths</code> function navigate the labyrinth of the adventures‚Äô config, and what key patterns define its traversal techniques?</li>
<li>‚ö° <strong>Crafting the Tales</strong>: What are the key mechanisms used within <code class="inline-code">AdventureManager.initializeAdventure</code> to orchestrate a cohesive story and linked quests across files and themes?</li>
<li>üõ°Ô∏è <strong>Weaving the Fabric of Lore</strong>: How does <code class="inline-code">StoryGenerator.generateQuestContent</code> balance detailed quest crafting with LLM integration, ensuring thematic consistency while parsing large inputs?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Enchanted Config Lore</h3>
<p>This file houses utilities for reading, parsing, and extracting insights from the adventure configuration file. It ensures that the arcane spells inscribed within the <code class="inline-code">adventure.config.json</code> manifest as structured guidance for the realm&#39;s quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Enchants the raw magical script from the disk, channeling it into raw text form.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Decipherer of scrolls, it transmutes raw text into validated mystical objects ready for interpretation.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: An unparalleled relic hunter that traverses deeply nested terrains within configs to locate uniquely referenced file paths.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This spell fetches the <code class="inline-code">adventure.config.json</code> file from the specified castle (project path).</li>
<li>Employs the <code class="inline-code">readFileIfExists</code> utility to avoid failure when the file is missing.</li>
<li>Returns the config text or null, letting magical operations proceed safely in its absence.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Here lies the Scroll Crafter‚Äîcapable of transforming the raw chant from <code class="inline-code">loadAdventureConfig</code> into an enchanted object.</li>
<li>Neutralizes potential corruption by enclosing JSON parsing within a try-catch spell.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This mighty artifact explorer navigates the mystical world of nested objects, unearthing valid file paths referenced in the adventure configuration.</li>
<li>Uses the <code class="inline-code">Set</code> object to guarantee file uniqueness.</li>
<li>Implements depth-first traversal through a stack, ensuring even the deepest nodes don‚Äôt escape its scrutiny.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> The Chronicler of Cycles</h3>
<p>This scroll governs the flow of the adventure, weaving storylines into quests and paths. It serves as the master orchestrator, invoking themes, combining contexts, and initiating new journeys.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Crafts a unique storyline and quest structure by blending themes, files, and generative magic.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Protects against foul user inputs, ensuring all spells are cast correctly.</li>
<li><code class="inline-code">exploreQuest</code>: Awakens dormant quests and reveals their legendary content by leveraging LLM.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Initializes a new adventure by cleansing prior state and configuring a theme-based directive.</li>
<li>Orchestrates quests by merging insights from adventure configuration with generative storytelling.</li>
<li>Adjusts the quest count to align with predefined configuration limits.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> The Weaver of Narratives</h3>
<p>This mystical script interfaces with the powerful LLM to construct storylines tailored to user input, themes, and context.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Synthesizes the overarching tale and quest blueprints by combining project specifics with LLM responses.</li>
<li><code class="inline-code">generateQuestContent</code>: Invokes advanced generative techniques to create rich, immersive adventures with embedded code.</li>
<li><code class="inline-code">removeLLMMetaCommentary</code>: Purges extraneous commentary from the text, ensuring a pure narrative form.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const { quest, theme, codeContent, questPosition, totalQuests } = config;
  let adventureGuidance = &#39;&#39;;
  let customInstructions = &#39;&#39;;
    
  if (this.projectPath) {
    const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);
    if (formattedConfig) {
      adventureGuidance = formattedConfig;
    }
    const customInstructionsFromConfig = extractCustomInstructions(this.projectPath);
    if (customInstructionsFromConfig) {
      customInstructions = customInstructionsFromConfig;
    }
  }

  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    adventureGuidance: adventureGuidance || &#39;&#39;,
    ...(customInstructions &amp;&amp; { customInstructions }),
    questPosition,
    totalQuests,
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  });

  const response = await this.withTimeout(
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })
  );

  const cleanContent = this.removeLLMMetaCommentary(response.content.trim());

  return {
    adventure: cleanContent,
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<ul>
<li>Uses LLM to intensively generate quest content.</li>
<li>Seamlessly incorporates project context and adventure configurations.</li>
<li>Ensures output purity through rigorous commentary removal.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Consider the traversal strategies in <code class="inline-code">extractUniqueFilePaths</code> to apply nested object iteration in your endeavors.</li>
<li>Pay close attention to user input validation in <code class="inline-code">adventure-manager.ts</code> to build safe, interactive applications.</li>
<li>Experiment with LLM prompts as seen in <code class="inline-code">story-generator.ts</code> to create structured and purpose-specific AI interactions.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>With the Sorcerer‚Äôs Prism of Words mastered, your quill illuminates like a phoenix‚Äôs flame, a magnificent trophy in your journey through the fabled Kingdom of Knowledge‚Äîonward, valiant wordsmith, for the realms yet await your brilliance!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>