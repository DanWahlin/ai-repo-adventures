<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Oracle’s Insight — Code Analysis & The Repomix Rituals - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Mystic Code of Eldoria</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Oracle’s Insight — Code Analysis &amp; The Repomix Rituals</h1>
<hr>
<p>As dawn breaks over the mystical realm of Eldoria, the winds whisper of secrets locked within the Repository of Souls. Brave adventurers must now decipher its fragmented glyphs and summon the Oracle’s insight through the arcane Repomix Rituals. The hero finds themselves amidst enchantments, encountering spells that validate pathways and transmute code into wisdom. This arduous quest holds the key to restoring balance, as the ancient scripts reveal their truths only to the chosen one who dares tame their complexity. The Oracle awaits with boundless knowledge!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Codebase Analysis Through Repomix</h3>
<p>The <code class="inline-code">repo-analyzer.ts</code> serves as your enchanted magnifying glass for diving deep into the Repository of Souls. It integrates the <code class="inline-code">Repomix</code> tool to analyze dense enchanted scripts, extract meaningful insights, and present the context in consumable formats. Its primary methods include <code class="inline-code">validateProjectPath()</code> for securing the enchanted pathways, <code class="inline-code">generateRepomixContext()</code> for comprehensive codebase analysis, and <code class="inline-code">captureRepomixStdout()</code> for summoning magical spells with structured output. These safeguards prevent mishaps such as traversing forbidden directories, ensuring the hero’s journey remains resolute.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateProjectPath()</code> ensures our hero never strays into treacherous system pathways through magical null-byte detection and sanitization spells.</li>
<li><code class="inline-code">generateTargetedContent()</code> enables pinpoint analysis, creating enchantments specific to chosen files within the project realm.</li>
<li><code class="inline-code">captureRepomixStdout()</code> commands the Repomix subprocess, conjuring script outputs via a tamed magical stream.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> Summoning the Oracle’s Response</h3>
<p>The <code class="inline-code">llm-client.ts</code> interfaces with the mystical Oracle of Eldoria, powered by LLM magic. Here, the hero learns to craft their queries and receive insights through arcane communication. The <code class="inline-code">generateResponse()</code> method handles structured requests with timeout protections, JSON formatting, and token management. It also contains safeguards to validate each response, ensuring no incantation goes unanswered. Furthermore, <code class="inline-code">getApiKey()</code> and <code class="inline-code">isAzureOpenAI()</code> detect the type of Oracle being summoned, tailoring pathways to ensure harmonious connections with Eldoria’s luminous libraries.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse()</code> channels the Oracle&#39;s wisdom, handling everything from response validation to tokenized queries.</li>
<li><code class="inline-code">getApiKey()</code> intelligently identifies enchanted keys necessary to unlock specific Oracles like OpenAI or Azure OpenAI.</li>
<li><code class="inline-code">cleanJsonResponse()</code> meticulously removes magical wrappers to ensure clarity in JSON-based insights.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
    if (!projectPath || typeof projectPath !== &#39;string&#39;) {
      throw new Error(&#39;Project path must be a non-empty string&#39;);
    }

    const trimmedPath = projectPath.trim();
    if (!trimmedPath) {
      throw new Error(&#39;Project path must be a non-empty string&#39;);
    }

    if (trimmedPath.includes(&#39;\0&#39;)) {
      throw new Error(&#39;Project path contains invalid null bytes&#39;);
    }
}
</code></pre>
<p>Just as a vigilant knight ensures no villager wanders into perilous woods, this method validates the magical pathway to keep Eldoria safe from harm.</p>
<pre><code class="language-typescript">async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
    return new Promise((resolve, reject) =&gt; {
        const args = [
            ...directories,
            &#39;--stdout&#39;,
            &#39;--style&#39;, options.style || &#39;markdown&#39;,
            ...
        ];

        const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], {
            cwd,
            stdio: [&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;]
        });

        ...
        repomix.stdout.on(&#39;data&#39;, (data) =&gt; {
            stdout += data.toString();
        });

        repomix.on(&#39;close&#39;, (code) =&gt; {
            if (code === 0 &amp;&amp; stdout.trim().length &gt; 0) {
                resolve(stdout);
            } else {
                reject(new Error(`Repomix failed (exit ${code}): ${stderr.substring(0, 200)}`));
            }
        });
    });
}
</code></pre>
<p>This method acts as a magical conduit, translating the movements of Repomix into structured knowledge streams for Eldoria’s heroes.</p>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
    this.validateProjectPath(projectPath);
    
    const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
    const cached = this.cache.get(cacheKey);
    if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
      return cached.content;
    }
    
    ...
    return context;
}
</code></pre>
<p>Much like a sage retrieves forgotten scripts from the archives, this method intelligently caches and retrieves analyzed data for reuse.</p>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
    try {
        const requestParams = this.buildRequestParams(prompt, options);
        const completion = await this.executeRequest(requestParams);
        let content = this.validateResponse(completion);
        if (options?.responseFormat === &#39;json_object&#39;) {
            content = this.cleanJsonResponse(content);
        }
        
        return { content };
    } catch (error) {
        throw new Error(`LLM request failed: ${error.message}`);
    }
}
</code></pre>
<p>This spell functions as a mystical correspondence with the Oracle, crafting intelligible queries to unveil hidden wisdom.</p>
<pre><code class="language-typescript">private getApiKey(): string {
    if (LLM_BASE_URL.includes(&#39;models.inference.ai.azure.com&#39;)) {
        if (!GITHUB_TOKEN) {
            throw new Error(&#39;GITHUB_TOKEN required for GitHub Models.&#39;);
        }
        return GITHUB_TOKEN;
    }
    
    if (!LLM_API_KEY) {
        throw new Error(&#39;LLM_API_KEY required.&#39;);
    }
    return LLM_API_KEY;
}
</code></pre>
<p>This method acts as a keyring of destiny, ensuring the correct token unlocks Eldoria’s radiant sources of knowledge.</p>
<pre><code class="language-typescript">private cleanJsonResponse(content: string): string {
    const jsonBlockPattern = /^\s*```(?:json)?\s*\n?([\s\S]*?)\n?\s*```\s*$/;
    const match = content.match(jsonBlockPattern);
    if (match) {
        return match[1].trim();
    }

    return content.trim();
}
</code></pre>
<p>Just as ancient scrolls may obscure vital text with ceremonial inscriptions, this removes extraneous markings to reveal clarity.</p>
<h2>Helpful Hints</h2>
<ul>
<li><code class="inline-code">validateProjectPath()</code> and <code class="inline-code">getApiKey()</code> contain security measures to avoid magical disruptions—always double-check inputs before invoking spells.</li>
<li>Use <code class="inline-code">generateTargetedContent()</code> for more focused analyses, akin to harnessing specific enchanted fragments of Eldoria’s repository for accuracy.</li>
<li>Consult <code class="inline-code">cleanJsonResponse()</code> whenever JSON content is generated during adventures to simplify and purify responses.</li>
</ul>
<hr>
<p>Adventure complete! Press onward, brave hero, for the next Oracle surely holds greater secrets.</p>
<p>By the blazing stars of the celestial chart, you have triumphed in Quest 3: The Oracle’s Insight, unraveling the arcane codes and mastering the Repomix Rituals—forge onward, valiant seeker, as the tapestry of destiny begins to unveil its radiant path! ⭐⚡💎</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: The Tome of Themes — Configurat... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>