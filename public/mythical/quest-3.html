<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Codex of Analytica - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Repository of Code Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Codex of Analytica</h1>
<hr>
<p>In the midst of your journey through the Enchanted Repository, you discover an ancient legend‚Äîthe Codex of Analytica. Esteemed by scholars, this arcane text harbors secrets of automated thought and precise crafting of adventurer&#39;s tales. However, the repository&#39;s guardian spirits demand proof of worth‚Äîonly those who master structured storytelling and logic may unlock the Codex&#39;s mystical powers. The stakes grow higher as shadows of unfinished quests surround you. Brave the Codex&#39;s trials, seek its hidden formulae, and bring balance to Codexia!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Codex Unification</strong>: How does <code class="inline-code">initializeAdventure</code> assemble the narrative and quests for an adventure?</li>
<li>‚ö° <strong>Mystic Execution</strong>: What steps are performed in <code class="inline-code">exploreQuest</code> to validate, locate, and execute a user&#39;s choice of quest?</li>
<li>üõ°Ô∏è <strong>Arcane Accuracy</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure the correctness of the parsed configuration? What validation techniques are used?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: The architect of quests</h3>
<p>The <code class="inline-code">AdventureManager</code> is the heart of the quest generation engine, orchestrating the transformation of project data into a dynamic adventure. It is responsible for initializing adventures, facilitating quest progression, and generating content. Key tasks include managing the <code class="inline-code">AdventureState</code>, which tracks progress, themes, and quest details. The <code class="inline-code">exploreQuest</code> function determines the user‚Äôs selected path and triggers the associated challenge.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Constructs a cohesive story and quest list, incorporating user-defined themes and custom configurations.</li>
<li><code class="inline-code">exploreQuest</code>: Handles user interaction by validating inputs, locating the corresponding quest, and executing it with appropriate pre-checks.</li>
<li><code class="inline-code">generateQuestContent</code>: Dynamically creates content for each quest, blending project context with magical themes.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme,  
  projectPath?: string, 
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>This function resets the <code class="inline-code">AdventureState</code> to ensure a clean slate for a new adventure.</li>
<li>It dynamically applies custom themes or themes selected by the user.</li>
<li>Integrates project data and optional configurations to create a robust storytelling framework.</li>
<li>Ensures consistency by merging and validating quest files defined in the adventure configuration.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates the user‚Äôs selection via <code class="inline-code">validateAndSanitizeChoice</code>.</li>
<li>Distinguishes between quest exploration and progress requests with <code class="inline-code">isProgressRequest</code>.</li>
<li>Locates the relevant quest based on title, ID, or order.</li>
<li>Executes the quest with pre-checks and caching optimization for already-completed quests.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async generateQuestContent(quest: Quest): Promise&lt;QuestContent&gt; {
  let codeContent: string;

  if (quest.codeFiles &amp;&amp; quest.codeFiles.length &gt; 0 &amp;&amp; this.state.projectPath) {
    try {
      codeContent = await repoAnalyzer.generateTargetedContent(
        this.state.projectPath,
        quest.codeFiles,
        false
      );
    } catch (error) {
      codeContent = this.state.projectInfo!.repomixContent;
    }
  } else {
    codeContent = this.state.projectInfo!.repomixContent;
  }

  const questPosition = this.state.quests.findIndex(q =&gt; q.id === quest.id) + 1;
  const totalQuests = this.state.quests.length;

  return await this.storyGenerator.generateQuestContent({
    quest,
    theme: this.state.currentTheme!,
    codeContent,
    questPosition,
    totalQuests
  });
}
</code></pre>
<ul>
<li>Generates vibrant quest content that integrates file-specific or general project data.</li>
<li>Makes efficient use of analytic tools like <code class="inline-code">repoAnalyzer</code> for targeted insights.</li>
<li>Ensures a tailored thematic experience through position-aware and sequential generation.</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Keeper of configurations</h3>
<p>The <code class="inline-code">adventure-config</code> module is vital for extracting and validating the adventure structure from user project files. It ensures robust parsing, valid paths, and concise formatting of details for various systems.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses the main adventure configuration file into a structured object and validates its format.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Identifies and resolves all unique files referenced in the configuration with proper validation.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses the configuration into a compact format suitable for prompts.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Reads the configuration file and converts it into a JavaScript object.</li>
<li>Handles parsing errors gracefully by returning <code class="inline-code">null</code>, ensuring non-critical failures do not break the system.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Recursively explores configuration nodes to extract unique paths.</li>
<li>Uses <code class="inline-code">fs.existsSync</code> for robust path validation, ensuring only existent files are included.</li>
<li>Provides a navigational framework for quests based on accurate file mappings.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts configuration into a concise, human-readable format for LLM compatibility.</li>
<li>Aggregates file paths and function highlights for easy contextual setup.</li>
<li>Optimizes the prompt size by removing redundancy, enhancing efficiency.</li>
</ul>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Forge your strategy</strong>: Focus on how quest content ties specific project context to thematic elements.</li>
<li><strong>Inspect the Codex</strong>: Trace configuration parsing to understand validation intricacies.</li>
<li><strong>Broaden your knowledge</strong>: Observe how logical layering in <code class="inline-code">exploreQuest</code> ensures seamless user interaction.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>By the decree of the Celestial Council, your triumphant acquisition of the Codex of Analytica hath illuminated the realms of knowledge, securing your path as a steadfast champion of the Great Quest‚Äîpress onward, valiant seeker, for glory most radiant lies ahead! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>