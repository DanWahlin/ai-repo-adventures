<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Enchanter‚Äôs Workshop - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Chronicles of the Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Enchanter‚Äôs Workshop</h1>
<hr>
<p>The winds of Codethia carry whispers of an ancient enchanter who resides within the labyrinthine chambers of the Codebase Castle. Legends tell of their workshop‚Äîa place where spells are forged to bring life to code and clarify the most confounding of puzzles. But this magical forge is shrouded in arcane mechanisms. Only those who comprehend the intricate patterns of mystic scrolls and the enchanted blueprints of adventure can harness its power. Can you decode its mysteries and wield the spells of creation?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>The Arcane Blueprint</strong>: How does the <code class="inline-code">initializeAdventure</code> function set the foundation for generating a new enchanter‚Äôs tale within the Codebase Castle?  </li>
<li>‚ö° <strong>Essence of a Quest</strong>: What processes are involved in the <code class="inline-code">exploreQuest</code> function as it breathes life into a chosen quest and connects it to other mystical parts of the code?  </li>
<li>üõ°Ô∏è <strong>Guarding the Workshop</strong>: What mechanisms in the <code class="inline-code">parseAdventureConfig</code> function ensure that invalid or malicious configurations remain banished from the enchanter‚Äôs domain?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> The Adventure Conductor</h3>
<p>The <code class="inline-code">AdventureManager</code> orchestrates the journey of coders through Codethia, invoking critical spells like <code class="inline-code">initializeAdventure</code> and <code class="inline-code">exploreQuest</code>. These functions bind the overall story to specific quests and ensure that the pathways to each are correctly woven. Combined with the <code class="inline-code">AdventureState</code>, this file manages progress, quest cache, and input validation‚Äîkey elements in maintaining the integrity of the magical adventure.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Establishes Codethia‚Äôs contextual spellwork by setting up the adventure with configuration, quests, and progress tracking.  </li>
<li><code class="inline-code">exploreQuest</code>: Channels energy into a specific quest, handling validation, cache, and execution to create a dynamic experience for heroes.  </li>
<li><code class="inline-code">get progressPercentage</code>: Retrieves the current magical progress as calculated from completed quests, ensuring adventurers stay informed of their triumphs.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Mystic Configurator</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file acts as the gateway to the lore stored in <code class="inline-code">adventure.config.json</code>. With its functions, the system can parse, extract, and ensure the validity of the scrolls defining each quest. It protects the Codebase Castle from chaotic configurations.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Deciphers the configuration scroll to ensure it is a valid mystical artifact suitable for use in generating adventures.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Gathers the sacred paths of files mentioned in the configuration, verifying their existence.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Transforms raw configuration lore into a succinct format for inclusion in LLM spells, optimizing clarity and efficiency.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Establishes or resets the adventure‚Äôs foundation using project context and selected theme.  </li>
<li>Integrates external configurations into generated quests for consistent and enriched experiences.  </li>
<li>Ensures progress tracking is synchronized with the quest structure, preventing misalignment.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Validates user options to ensure only recognized paths are explored, safeguarding against confusion.  </li>
<li>Dynamically identifies and delivers the requested quest experience, including previously completed ones.  </li>
<li>Powers the enchanter‚Äôs magical caching system to prevent redundant processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Simple yet critical in keeping adventurers informed of their journey‚Äôs completion.  </li>
<li>Converts progress data into meaningful insights using ratios and percentages.  </li>
<li>Enables dynamic responses based on state for a more immersive storytelling experience.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Prevents malformed or corrupted configurations from entering the system‚Äôs magical flow.  </li>
<li>Ensure resilience by gracefully handling missing or invalid entries without breaking the process.  </li>
<li>Forms the basis of a trustworthy interaction with user-defined adventure frameworks.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Safeguards against accessing non-existent files, ensuring quests can proceed smoothly.  </li>
<li>Collects and validates paths from the configuration JSON, preparing them for use across the system.  </li>
<li>Uses an iterative exploration approach to cover nested structures, maximizing flexibility in parsing.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts the dense adventure configuration into a concise and optimized format for automated prompts.  </li>
<li>Enables inclusion of critical files and function highlights directly in the generated quest narrative.  </li>
<li>Enhances interpretability while ensuring the configuration is as lightweight as possible.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When exploring dynamic quest generation, observe how dependencies between <code class="inline-code">adventure-manager.ts</code> and <code class="inline-code">story-generator.ts</code> ensure flexibility.  </li>
<li>Pay attention to the structure of <code class="inline-code">adventure.config.json</code> to protect against invalid configurations.  </li>
<li>Review how caching mechanisms in <code class="inline-code">exploreQuest</code> enhance efficiency.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries in Codethia‚Äôs enchanted kingdom.</p>
<p>With the wisdom of the Enchanter‚Äôs lore now woven into your heroic tapestry, you ascend closer to mastery, a true beacon in the mythical realms‚Äîonward, brave seeker of destiny! ‚ö°üíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>