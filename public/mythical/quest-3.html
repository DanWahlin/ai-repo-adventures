<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Seer‚Äôs Crystal of Analysis - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Enchanted Repository: The Chronicles of Code</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Seer‚Äôs Crystal of Analysis</h1>
<hr>
<p>To reclaim a shard of the Codex Regalium, you must journey to the enchanted Caverns of Algorithmia. A mystical Seer guards the Crystal of Analysis, an artifact capable of unraveling the truth hidden within tangled lines of corrupted magic. Only with its power can you decipher the ancient incantations used to restore balance to the Codex. Beware, for the Seer does not give her wisdom lightly. Prove your worth by mastering the arcane art of code interpretation.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Repository Analysis Module</h3>
<p>This file functions as the repository&#39;s crystal ball, constructing the framework for refining and analyzing enchanted paths of data. The <code class="inline-code">RepoAnalyzer</code> class contains vital methods to validate, normalize, and process intricate file structures. By leveraging the <code class="inline-code">generateRepomixContext</code> and <code class="inline-code">generateTargetedContent</code> functions, the Seer&#39;s magic can be focused, enabling precise extraction of knowledge. These methods work with additional safeguards, such as <code class="inline-code">validateProjectPath</code> and <code class="inline-code">captureRepomixStdout</code>, to ensure paths are pure and subprocesses return data safely under strict constraints.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAnalyzer.generateRepomixContext</code>: Summons the knowledge of the entire repository or a targeted subset.</li>
<li><code class="inline-code">RepoAnalyzer.generateTargetedContent</code>: Directs analysis only to specified enchanted files, ensuring efficiency.</li>
<li><code class="inline-code">RepoAnalyzer.captureRepomixStdout</code>: Engages a subprocess spell to conjure output for repository examination.</li>
<li><code class="inline-code">RepoAnalyzer.validateProjectPath</code>: Ensures paths are pure, cleansing them of null bytes and traversal attempts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  const configuredFiles = extractUniqueFilePaths(projectPath);
  if (configuredFiles.length &gt; 0) {
    try {
      return await this.generateTargetedContent(projectPath, configuredFiles);
    } catch (error) {
      console.warn(`Failed to generate targeted content, falling back: ${error.message}`);
    }
  }
  const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }
  try {
    const ignorePatterns = [&#39;node_modules&#39;, &#39;dist&#39;, &#39;build&#39;, &#39;.git&#39;];
    const cliOptions: CliOptions = {
      style: options.style || &#39;markdown&#39;,
      compress: options.compress !== false,
      ignore: ignorePatterns.join(&#39;,&#39;),
      removeComments: true,
      removeEmptyLines: true,
    };
    const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
    this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
    return context;
  } catch (error) {
    throw new Error(`Repomix execution failed: ${error.message}`);
  }
}
</code></pre>
<p>Generating the repository‚Äôs context is akin to invoking a cavern-sized orb, filtering through layers of mist to reveal clarity.</p>
<pre><code class="language-typescript">async generateTargetedContent(projectPath: string, targetFiles: string[], compress: boolean = true): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  if (!targetFiles.length) {
    throw new Error(&#39;Target files array cannot be empty&#39;);
  }
  const safeFiles = this.validateAndNormalizeTargetFiles(projectPath, targetFiles);
  if (!safeFiles.length) {
    throw new Error(&#39;No valid target files found after validation&#39;);
  }
  const cacheKey = `${path.resolve(projectPath)}:targeted:${safeFiles.join(&#39;,&#39;)}:compress=${compress}`;
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }
  try {
    const cliOptions: CliOptions = {
      style: &#39;markdown&#39;,
      compress,
      include: safeFiles.join(&#39;,&#39;),
      removeComments: compress,
      removeEmptyLines: compress,
    };
    const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
    this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
    return context;
  } catch (error) {
    throw new Error(`Targeted repomix execution failed: ${error.message}`);
  }
}
</code></pre>
<p>Targeting specific files mirrors focusing the Crystal of Analysis, directing its power to discern the truth within selected scrolls.</p>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [
      ...directories,
      &#39;--stdout&#39;,
      &#39;--style&#39;, options.style || &#39;markdown&#39;
    ];
    if (options.compress) args.push(&#39;--compress&#39;);
    if (options.removeComments) args.push(&#39;--remove-comments&#39;);
    if (options.removeEmptyLines) args.push(&#39;--remove-empty-lines&#39;);
    const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], { cwd, stdio: [&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;] });
    let stdout = &#39;&#39;;
    let stderr = &#39;&#39;;
    const timeout = setTimeout(() =&gt; {
      repomix.kill(&#39;SIGTERM&#39;);
      setTimeout(() =&gt; repomix.kill(&#39;SIGKILL&#39;));
      reject(new Error(`Timed out after ${REPOMIX_SUBPROCESS_TIMEOUT}ms`));
    }, REPOMIX_SUBPROCESS_TIMEOUT);
    repomix.stdout.on(&#39;data&#39;, (data) =&gt; {
      stdout += data.toString();
    });
    repomix.stderr.on(&#39;data&#39;, (data) =&gt; {
      stderr += data.toString();
    });
    repomix.on(&#39;close&#39;, (code) =&gt; {
      clearTimeout(timeout);
      if (code === 0 &amp;&amp; stdout.trim()) {
        resolve(stdout);
      } else {
        reject(new Error(`Repomix failed (exit ${code}): ${stderr}`));
      }
    });
  });
}
</code></pre>
<p>Harnessing the subprocess spell is akin to summoning an elemental; it demands precision and vigilance to avoid catastrophic outcomes.</p>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }
  if (projectPath.trim().includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid null bytes&#39;);
  }
}
</code></pre>
<p>Before the Seer&#39;s enchantments can be cast, the foundation must be pure and untainted by harmful magics.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">generateRepomixContext</code> for full repository insights and <code class="inline-code">generateTargetedContent</code> for specific areas.</li>
<li>Be wary of timeout constraints in long subprocess invocations.</li>
<li>Validate all inputs to guard against malicious interference.</li>
</ul>
<hr>
<p>The Seer&#39;s Crystal glimmers with newfound power, its brilliance illuminating your path. Another piece of the Codex Regalium restored. Press onward, adventurer!</p>
<p>With the Seer‚Äôs Crystal of Analysis now shimmering in your grasp, valiant hero, you have unlocked the wisdom of realms unknown and illuminated the path to glory‚Äî40% of your epic journey conquered, onward to destiny! ‚≠êüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: The Arcane Tome of Themes ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>