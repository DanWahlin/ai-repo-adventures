<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Scroll of Questcraft - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Chronicles of the Code-Kingdom</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Scroll of Questcraft</h1>
<hr>
<p>Brave adventurer, you have arrived at the heart of the enchanted Code-Kingdom of Syntaxia. Here lies the elusive Scroll of Questcraft, an artifact capable of weaving intricate stories and quests with its mystical syntax. To restore its fragment, you must traverse the terrain of the <strong>Quest Generation Engine</strong>, uncovering the secrets of logic and creativity buried within the files that shape adventure itself. Beware, for the path is fraught with ill-formed spells and parsers born of errors!</p>
<p>The fate of Syntaxia rests upon your discovery of how quests are forged. Take heart, for the Scroll‚Äôs magic awaits only the courageous.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>The Forge&#39;s Craft</strong>: How does the <code class="inline-code">initializeAdventure</code> function prepare the quest structure and incorporate external configs?</li>
<li>‚ö° <strong>Mystic Threads</strong>: How is the <code class="inline-code">generateQuestContent</code> function weaving together quest narrative and code insights?</li>
<li>üõ°Ô∏è <strong>Arcane Filters</strong>: What safety mechanisms ensure the <code class="inline-code">parseAdventureConfig</code> method handles errors during the configuration processing?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> The Storysmith‚Äôs Engine</h3>
<p>This file is the command center for adventure orchestration. The <code class="inline-code">AdventureManager</code> and its magical companion <code class="inline-code">AdventureState</code> dictate how quests bloom from an overarching narrative. You&#39;ll uncover initialization, merging of configurations, and quest execution mechanisms.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Prepares the tale from project context, merging config information and generating quests.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Combines external file paths into quests for enriched exploratory detail.</li>
<li><code class="inline-code">generateQuestContent</code>: Harnesses the story generator‚Äôs powers to craft individual quest content, weaving code insights and thematic context.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> The Scroll‚Äôs Voice</h3>
<p>This file constitutes the guiding hand behind the Scroll&#39;s quest-writing powers. It determines how raw ideas transform into structured stories and quests. Pay close attention to the interplay between structure, validation, and output.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateQuestContent</code>: Creates in-depth quest content by combining prompts, LLM responses, and project details.</li>
<li><code class="inline-code">generateCompletionSummary</code>: Crafts summaries to illuminate progress, blending theme and achievements into vibrant updates.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Translates mysterious markdown messages into structured quests, ensuring clear narrative flow.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Config Sage</h3>
<p>A humble yet pivotal file, it enables the configuration of the adventures and validates their alignment with Syntaxia&#39;s mystical framework. Here lies the foundation for customization.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Handles the accurate parsing of JSON configurations while safeguarding against errors.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Gathers every significant path mentioned in the configuration, ensuring no treasures are overlooked.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Prepares configuration data as input for storytelling, focusing on brevity and clarity.</li>
</ul>
<hr>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });
}
</code></pre>
<ul>
<li>Prepares the adventure core by resetting state, infusing project context, and utilizing external config files.</li>
<li>Combines thematic story generation with configuration-based quest detailing.</li>
<li>Offers ample hooks for customization with support for custom themes.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async generateQuestContent(quest: Quest): Promise&lt;QuestContent&gt; {
  let codeContent: string;
  
  if (quest.codeFiles &amp;&amp; quest.codeFiles.length &gt; 0 &amp;&amp; this.state.projectPath) {
    try {
      codeContent = await repoAnalyzer.generateTargetedContent(
        this.state.projectPath,
        quest.codeFiles,
        false
      );
    } catch {
      codeContent = this.state.projectInfo!.repomixContent;
    }
  } else {
    codeContent = this.state.projectInfo!.repomixContent;
  }

  const questPosition = this.state.quests.findIndex(q =&gt; q.id === quest.id) + 1;
  const totalQuests = this.state.quests.length;

  return await this.storyGenerator.generateQuestContent({
    quest,
    theme: this.state.currentTheme!,
    codeContent,
    questPosition,
    totalQuests
  });
}
</code></pre>
<ul>
<li>Balances code specificity by choosing between targeted and general content based on quest details.</li>
<li>Creates rich, context-aware quest content using a combination of LLM responses and project data.</li>
<li>Seamlessly blends narrative and technical elements into cohesive storytelling.</li>
</ul>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Provides a singular access point for converting raw configuration files into usable data structures.</li>
<li>Protects against errors with graceful fallback mechanisms when parsing fails.</li>
<li>Maintains simplicity while functioning as a critical link between configuration and execution.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Scales configuration processing by dynamically exploring nested path structures.</li>
<li>Uses robust validation to ensure only existing paths are included.</li>
<li>Facilitates integration of diverse file references into quest frameworks.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Review how <code class="inline-code">generateQuestContent</code> intelligently switches between general and targeted content‚Äîthis modularity can inspire scalable design patterns.</li>
<li>Trace <code class="inline-code">parseAdventureConfig</code> for implementing error-resilient JSON parsing in other contexts.</li>
<li>Evaluate how <code class="inline-code">mergeQuestFilesFromConfig</code> aligns thematic guidance with technical inputs for balanced storytelling.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>With valor unmatched and the wisdom of ancient titans, you have deciphered the Scroll of Questcraft, carving your name into the annals of heroic lore‚Äîonward, noble champion, for the stars of destiny beckon! ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>