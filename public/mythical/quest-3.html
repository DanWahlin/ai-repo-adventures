<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Forbidden Runes: The Arcane Analysis - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Mystic Codex of the Enchanted Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Forbidden Runes: The Arcane Analysis</h1>
<hr>
<p>In the mystical realm of the Enchanted Repository, the Codex has guided heroes for eons. Now, ancient and forbidden runes containing unparalleled arcane analyses have emerged. The Mage Guild urgently seeks a champion to harness these runes and peer into the heart of these cryptic spells. Using both the arcane tools of &quot;RepoAnalyzer&quot; and the mystical intellect of &quot;LLMClient,&quot; will you unravel the hidden wisdom of the Codex and wield its power to unite the Mystic Kingdom?</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> The Analyzer of the Arcane Repository</h3>
<p>This file holds the legendary <code class="inline-code">RepoAnalyzer</code>, which guards the secrets of analyzing and extracting knowledge from enchanted codebases. The class demonstrates the validation of project paths through enchanted safeguards, targeted extractions of vital content, and summoning Repomix incantations. Key highlights include <code class="inline-code">generateRepomixContext</code>, which crafts the overarching vision from scattered code fragments, and <code class="inline-code">captureRepomixStdout</code>, a ritual to harness subprocess powers without succumbing to chaos. Like a guide protecting adventurers through trials, <code class="inline-code">validateProjectPath</code> performs essential checks to keep the quest on a righteous path.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateRepomixContext</code>: Unites project knowledge into an enchanted vision.</li>
<li><code class="inline-code">captureRepomixStdout</code>: Channels subprocess energies to summon Repomix output.</li>
<li><code class="inline-code">validateProjectPath</code>: Establishes a spell of security for project path integrity.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  
  const configuredFiles = extractUniqueFilePaths(projectPath);
  if (configuredFiles.length &gt; 0) {
    console.log(`Using adventure.config.json: analyzing ${configuredFiles.length} configured files with optimization`);
    return await this.generateOptimizedContent(projectPath, configuredFiles);
  }
  
  console.log(&#39;No adventure.config.json found: analyzing full codebase (compressed)&#39;);
  const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
  
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }
  
  const cliOptions: CliOptions = {
    style: options.style || &#39;markdown&#39;,
    compress: options.compress !== false,
    ignore: [&#39;node_modules&#39;, &#39;dist&#39;, &#39;build&#39;],
    noDirectoryStructure: true
  };

  const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);

  this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
  return context;
}
</code></pre>
<p>Functions like a legendary scribe, uniting fragmented knowledge into a singular tome of wisdom.</p>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...directories, &#39;--stdout&#39;], { cwd });
    let stdout = &#39;&#39;;
    
    repomix.stdout.on(&#39;data&#39;, (data) =&gt; { stdout += data.toString(); });
    repomix.on(&#39;close&#39;, (code) =&gt; {
      if (code === 0) resolve(stdout.trim());
      else reject(new Error(`Repomix failed with code ${code}`));
    });
  });
}
</code></pre>
<p>Acts as a summoner, invoking subprocess power to retrieve invaluable data from the magical depths.</p>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }
  
  const trimmedPath = projectPath.trim();
  if (trimmedPath.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid null bytes&#39;);
  }
}
</code></pre>
<p>A vigilant guardian, ensuring only legitimate paths are traversed during the quest.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> The Mage’s Arcane Ally</h3>
<p>This file features the <code class="inline-code">LLMClient</code>, a magical assistant conjuring answers from the vast intellect of large language models. Like an adept mage drawing on ancient powers, it uses configurations to choose between the divine entities of OpenAI and Azure OpenAI. Key spells include <code class="inline-code">generateResponse</code>, a mechanism to request wisdom, and <code class="inline-code">getApiKey</code>, ensuring the mage has the key to unlock these ethereal constructs. With precision, it wields the mystical parameters of verbosity and reasoning effort to shape its incantations.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse</code>: Casts powerful spells to summon responses from the arcane.</li>
<li><code class="inline-code">constructor</code>: Initializes the mage’s tools for invoking great power.</li>
<li><code class="inline-code">getApiKey</code>: Unlocks the arcane key to the portal of vast wisdom.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  const requestParams = this.buildRequestParams(prompt, options);
  const completion = await this.executeRequest(requestParams);
  let content = this.validateResponse(completion);
  
  if (options?.responseFormat === &#39;json_object&#39;) {
    content = this.cleanJsonResponse(content);
  }

  return { content };
}
</code></pre>
<p>Employs incantation-like logic to transform mortal input into divine sources of text-based wisdom.</p>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;

  const apiKey = this.getApiKey();
  if (!apiKey || !LLM_BASE_URL) {
    throw new Error(&#39;LLM configuration required.&#39;);
  }

  if (this.isAzureOpenAI()) {
    this.client = new AzureOpenAI({
      endpoint: LLM_BASE_URL.split(&#39;/openai/deployments&#39;)[0],
      apiKey,
      apiVersion: LLM_API_VERSION,
      deployment: this.model
    });
  } else {
    this.client = new OpenAI({ apiKey, baseURL: LLM_BASE_URL });
  }
}
</code></pre>
<p>Functions as the setup of a mage&#39;s sanctum, preparing the tools and spells required for arcane success.</p>
<pre><code class="language-typescript">private getApiKey(): string {
  if (LLM_BASE_URL.includes(&#39;azure.com&#39;)) {
    if (!GITHUB_TOKEN) throw new Error(&#39;GITHUB_TOKEN required for GitHub Models.&#39;);
    return GITHUB_TOKEN;
  }
  
  if (!LLM_API_KEY) throw new Error(&#39;LLM_API_KEY required.&#39;);
  return LLM_API_KEY;
}
</code></pre>
<p>Secures the enchanted key that allows the mage access to mystical knowledge realms.</p>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Practical tip</strong>: Pass the correct API keys and ensure environment variables are set for smooth questing.</li>
<li><strong>Exploration recommendation</strong>: Start with smaller prompts to prevent overloading the arcane systems.</li>
<li><strong>Next steps</strong>: Integrate <code class="inline-code">RepoAnalyzer</code> and <code class="inline-code">LLMClient</code> to analyze a sample project and test LLM responses.</li>
</ul>
<hr>
<p>Your arcane skills have grown, adventurer. The Mystic Kingdom applauds your mastery of forbidden runes!</p>
<p>By the shining glory of the astral crown, you have unraveled the Forbidden Runes with wisdom befitting a true arcane hero—march boldly, for realms yet unknown await your triumphant discovery! ⭐⚡📡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">← Previous: Quest 2: The Enchanter’s Chron...</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: The Great Themekeeper... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>