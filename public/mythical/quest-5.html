<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Forgotten Foundation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Kingdom of Codemiria</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Forgotten Foundation</h1>
<hr>
<p>In the heart of Codemiria lies an ancient, forgotten magic‚ÄîThe Foundation‚Äîthat powers the enchanted kingdom‚Äôs very existence. This magic is hidden within the core principles of adventure configuration, a mystical art long overlooked by even the wisest wizards. As the Scroll of Adventures grows weak, the fate of Codemiria rests upon unlocking the secrets of the Foundation. Only those who can decipher its arcane scripts, validate its incantations, and harness its structured spells will restore the kingdom‚Äôs vitality. Are you brave enough to face this final trial?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Path of the Configurer</strong>: How does <code class="inline-code">parseAdventureConfig</code> safeguard the kingdom‚Äôs magic from invalid or missing configurations?</li>
<li>‚ö° <strong>The File-Seer&#39;s Vision</strong>: What approach does <code class="inline-code">extractUniqueFilePaths</code> use to traverse and validate the paths woven into the configuration?</li>
<li>üõ°Ô∏è <strong>Enchanter&#39;s Efficiency</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> optimize the arcane knowledge for magical entities like LLMs?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Delving into the Enchantment</h3>
<p>This file is the nexus of adventure configuration in Codemiria. It provides a suite of functions to load, parse, and format the deep magical blueprints‚Äîconfiguration data‚Äîthat shape quests. Its spells ensure the seamless functioning of the kingdom‚Äôs enchanted systems by validating inputs, managing file paths, and optimizing scripts for clarity and efficiency. Each function within is a tool for shaping the mystical foundation of Codemiria‚Äôs dynamic and evolving adventures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: This function deciphers the core adventure configuration, ensuring that it is a valid and properly formatted arcane artifact. If anything is amiss, it safely returns null to protect the system.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Here lies a spell for extracting and validating all the unique paths embedded within the configuration, ensuring accurate traversal of Codemiria‚Äôs enchanted directories.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: This incantation streamlines the adventure configuration, reducing it to its essential elements for efficient communication with magical entities like LLMs, minimizing unnecessary complexity.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function deciphers the raw configuration file into a structured object or null in cases of error.</li>
<li>The use of <code class="inline-code">try-catch</code> ensures graceful handling of invalid JSON without halting the system.</li>
<li>It centralizes parsing logic, offering a single entry point for all configuration validation spells.</li>
<li>The design assumes clear separation between file reading (<code class="inline-code">loadAdventureConfig</code>) and content parsing, ensuring modularity.</li>
<li>Safeguarding against invalid configurations prevents destabilizing Codemiria‚Äôs magical systems.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function traverses the parsed configuration to discover all valid file paths.</li>
<li>It employs a <code class="inline-code">Set</code> to ensure uniqueness, avoiding duplicate paths.</li>
<li>By recursively processing nested objects and arrays, it adapts to complex configurations.</li>
<li>Validation of file paths ensures the spell operates only on existing entities within the realm&#39;s file system.</li>
<li>This traversal mechanism empowers the kingdom with flexibility for future complex hierarchies.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function distills the configuration data into a concise format for external magical beings like LLMs.</li>
<li>By focusing on key elements such as file paths and functions, it avoids unnecessary verbosity.</li>
<li>Breaking the configuration into quests and files highlights the foundational structure of Codemiria‚Äôs adventures.</li>
<li>String manipulation techniques are used to construct a well-organized and readable output.</li>
<li>This approach boosts the efficiency of external tools analyzing the magic, ensuring seamless collaboration.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When validating path traversal, look for patterns ensuring safety against unexpected or invalid references.</li>
<li>Consider how the modular design of these functions facilitates their reusability.</li>
<li>Pay attention to the way recursion is safely handled in <code class="inline-code">extractUniqueFilePaths</code> to adapt to configuration complexity.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Codemiria‚Äôs enchanted systems! Your adventure is complete.</p>
<p>With the Forgotten Foundation reclaimed and its ancient wisdom shining once more, you stand as a valiant hero on the brink of legend, your banner flying high at 80% of this fabled odyssey‚Äîforge onward with the brilliance of a thousand stars! ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>