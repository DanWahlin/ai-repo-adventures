<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Forge of Foundations - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository of Aetheria</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Forge of Foundations</h1>
<hr>
<p>In the heart of Aetheria‚Äôs enchanted Repository of Codes lies the Forge of Foundations, where the very blueprints of adventure are created. This sacred forge is said to contain the spells and tools that preserve the kingdom‚Äôs magical harmony. Yet, the Chaos of Bugs seeks to undermine its stability, corrupting the core of Aetheria&#39;s system. Within its glowing embers rests the power to rebuild or destroy the Repository‚Äôs framework. As the apprentice mage, your final quest demands mastery of the Forge. Will you ignite the forge‚Äôs flames and unearth the secrets contained within its foundational spells?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Foundation Mapping</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function separate raw adventure configuration into structured data?</li>
<li>‚ö° <strong>Path Extraction</strong>: In what way does <code class="inline-code">extractUniqueFilePaths</code> traverse and validate paths in the configurations, and how does it handle recursion?</li>
<li>üõ°Ô∏è <strong>Prompt Optimization</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> condense adventure data while maintaining essential details for LLMs?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core foundation-handling functions</h3>
<p>This file underpins the configuration framework of Aetheria&#39;s adventures. It works like the magical sigils that translate the Repository&#39;s arcane scripts into actionable guidance. By loading, parsing, and extracting structured information from raw configuration files, these functions form the foundation on which quests are built. They also play a vital role in optimizing adventure formats for external processing, ensuring efficiency and clarity.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses a raw configuration file into a structured object while guarding against errors. Ensures the data is usable for subsequent operations.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Navigates through nested adventure configurations to extract unique file paths, validating their existence.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes quest configuration details for LLM processing, reducing verbosity while retaining key elements.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Converts raw JSON text from configuration files into a usable object.</li>
<li>Utilizes <code class="inline-code">loadAdventureConfig</code> to fetch a file‚Äôs raw content, ensuring separation of concerns.</li>
<li>Safeguards against JSON parsing errors with a <code class="inline-code">try-catch</code> block, avoiding runtime issues during quest execution.</li>
<li>If parsing fails, it gracefully returns <code class="inline-code">null</code> instead of crashing, reflecting robustness in its design.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses deeply nested adventure configurations to extract all <code class="inline-code">path</code> fields.</li>
<li>Uses a stack-based approach for recursion, avoiding stack overflow from large configurations.</li>
<li>Validates whether paths exist within the project&#39;s directory structure using <code class="inline-code">fs.existsSync</code>.</li>
<li>Deduplicates file paths via a <code class="inline-code">Set</code>, ensuring efficient handling of large configurations.</li>
<li>Handles edge cases, such as missing or malformed path properties, with graceful skips.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Reduces configuration data to an essential summary tailored for external systems like LLMs.</li>
<li>Focuses on quest titles, paths, and functions, filtering out verbose details.</li>
<li>Ensures resilience by first validating the presence of core properties like <code class="inline-code">adventure</code> and <code class="inline-code">quests</code>.</li>
<li>Transforms deeply nested structures into a readable list format, improving accessibility for automated tools.</li>
<li>Outputs a finalized string that captures the essence of each quest efficiently.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>To track how configuration data flows through the system, follow the chain from <code class="inline-code">loadAdventureConfig</code> to <code class="inline-code">parseAdventureConfig</code> and its downstream consumers.</li>
<li>Pay close attention to the <code class="inline-code">extractUniqueFilePaths</code> traversal method‚Äîit demonstrates effective recursion while protecting against infinite loops.</li>
<li>When optimizing structured data for AI systems, balance fidelity with brevity as done in <code class="inline-code">formatAdventureConfigForPrompt</code>.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Forge of Foundations! With this final victory, you have secured the enchanted Repository of Codes from the Chaos of Bugs. Aetheria owes its harmony and future to your heroic determination and mastery of magical spells. May your legend inspire mages for generations to come. The adventure is complete!</p>
<p>With the mighty anvil of wisdom struck and the Foundations forged in brilliance, your valor shines brighter than a celestial star‚Äîonward, noble champion, for the final quest beckons with eternal glory! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>