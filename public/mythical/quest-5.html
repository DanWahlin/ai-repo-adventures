<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Labyrinth of Foundations - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Codex: Adventures in a Kingdom of Mystical Code</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Labyrinth of Foundations</h1>
<hr>
<p>In the mythical Kingdom of Codeara, the Labyrinth of Foundations guards the wisdom that binds the Enchanted Codex together. Its twisting passages are sealed with riddles crafted by ancient coders, who encoded logic to protect the kingdom‚Äôs core knowledge. Only by deciphering the structure of the foundation can an adventurer hope to retrieve vital clues and restore the Codex. This quest demands precision, logic, and a keen eye for the magic within the code.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pathfinder‚Äôs Map</strong>: How does the <code class="inline-code">extractUniqueFilePaths</code> function traverse and validate paths within the labyrinth of the configuration?</li>
<li>‚ö° <strong>Reading the Runes</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure the Enchanted Codex is decoded safely while handling potential errors?</li>
<li>üõ°Ô∏è <strong>Optimizing the Spellbook</strong>: What techniques are used in <code class="inline-code">formatAdventureConfigForPrompt</code> to minimize the configuration‚Äôs verbosity without losing critical details?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: The foundational script of the kingdom‚Äôs labyrinth</h3>
<p>This file contains the essential functions for reading, parsing, and interpreting the Enchanted Codex‚Äôs configuration. It provides utilities to load configuration files, validate their structure, and extract key details to optimize adventure generation. As the underpinnings of quest development, these methods enable the seamless weaving of mythical themes with technical precision.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Decodes the raw adventure configuration into usable form, ensuring it is safe to manipulate. Essential for validating the content‚Äôs structure and detecting issues early.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Crawls through the labyrinth of the configuration, identifying and validating unique paths referenced by the script. Ensures only existing, accurate paths are processed.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses the magical details of the configuration into a streamlined format. By retaining only key information, it optimizes for clarity and efficiency in creating prompts.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Safely parses the adventure configuration by first loading its raw form.</li>
<li>Uses error handling to return <code class="inline-code">null</code> if parsing fails, avoiding runtime issues.</li>
<li>Isolates JSON processing from other layers, simplifying troubleshooting for parsing errors.</li>
<li>Critical to ensure the rest of the system addresses structured, validated data.</li>
<li>Allows the file to gracefully handle missing or malformed configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses the entire configuration as a graph of objects and arrays.</li>
<li>Utilizes a <code class="inline-code">Set</code> to ensure paths remain unique across the labyrinth of data.</li>
<li>Validates each path, ensuring only existing files are included.</li>
<li>Combines iterative depth-first search with careful validation for robustness.</li>
<li>Supports the integrity of the overall quest structure by preventing errors from invalid paths.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Reformats the configuration for optimized prompt generation, reducing verbosity by removing redundant details.</li>
<li>Extracts key details like quest titles, file paths, and function names for clarity.</li>
<li>Balances information density with readability, ensuring prompt-generation remains efficient.</li>
<li>Highlights careful selection of relevant details, aligning with the goals of quest design.</li>
<li>Offers a reusable way to streamline configuration details into usable output.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>References to file paths must be accurate and validated; missteps can derail the entire structure of adventures.</li>
<li>Investigate how extracted file paths connect to other files in the repository for greater context.</li>
<li>Consider extending these foundational techniques for other parts of your mythical code endeavors.</li>
</ul>
<hr>
<p>The labyrinth yields its secrets to the vigilant adventurer. Onward now, to reclaim the scattered fragments of the Enchanted Codex!</p>
<p>Brave traveler, you have unraveled the enchanted maze of the Labyrinth of Foundations, securing the keystone of wisdom and standing but one conquest away from eternal glory‚Äîonward, noble champion! ‚öîÔ∏è‚ú®üí°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>