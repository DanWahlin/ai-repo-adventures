<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Hall of Ancient Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Enchanted Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Hall of Ancient Utilities</h1>
<hr>
<p>Through countless trials, you have unlocked secrets hidden deep within the Kingdom of Codemyr&#39;s enchanted Repository Scroll. Queen Syntaxia now bids you undertake the final and perhaps most vital quest. The Hall of Ancient Utilities, a labyrinth of forsaken magical scripts, holds the key to optimizing the realm&#39;s enchanted adventures. These scripts govern the kingdom&#39;s most essential foundations, ensuring the Repository Scroll functions with precision. Only by deciphering their structure and intent can you stabilize Codemyr&#39;s magical constructs for generations to come. Steel your resolve, Code Knight‚Äîthis is your culminating test. The fate of the kingdom depends on you.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Rune Deciphering</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure the kingdom&#39;s adventure scripts are safely interpreted and understood?</li>
<li>‚ö° <strong>Pathfinding Magic</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> utilize recursion to traverse and validate referenced paths in the adventure scripts?</li>
<li>üõ°Ô∏è <strong>Prompt Assembly</strong>: In what ways does <code class="inline-code">formatAdventureConfigForPrompt</code> optimize the magical instructions into a compact and purposeful format?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The heart of Codemyr&#39;s foundation spells</h3>
<p>This file handles the enchanted mechanics for parsing, validating, and deriving information from the Repository Scroll&#39;s utility spells. It is critical to understanding how the Hall of Ancient Utilities configures Codemyr‚Äôs adventures and generates efficient prompts for spellcasting.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> safely parses and validates the adventure configuration, ensuring it can be interpreted without corrupting the kingdom&#39;s systems.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> inspects and collects only necessary and existing paths referenced in the configuration, ensuring clean and usable results for spell execution.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> compresses and formats adventure instructions into compact, efficiently usable forms for magical computations, avoiding unnecessary verbosity.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This code transforms raw adventure data into a usable object, acting as the kingdom&#39;s safeguard for spell parsing.</li>
<li>It protects against errors and corruption by utilizing a fail-safe structure (<code class="inline-code">try-catch</code>) to ensure resilience.</li>
<li>The focus on returning <code class="inline-code">null</code> for invalid cases enhances consistency across the enchanted systems.</li>
<li>This approach centralizes all parsing for configuration into one place, streamlining the flow of magical processes.</li>
<li>Readers should notice the reliance on <code class="inline-code">loadAdventureConfig</code> as the precursor, highlighting interconnected system design.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function ensures all valid, unique file paths are extracted from any given configuration, using recursion and depth-first traversal.</li>
<li>By leveraging <code class="inline-code">Set</code>, it obliterates duplicate paths, maintaining pristine spell references.</li>
<li>This code introduces file existence checks (<code class="inline-code">fs.existsSync</code>) to ensure the realm doesn&#39;t waste resources on invalid paths.</li>
<li>The iterative stack approach illustrates an alternative to recursive calls, balancing performance with clarity.</li>
<li>Notice the modular design relying on <code class="inline-code">parseAdventureConfig</code> as its starting point‚Äîa deliberate design choice to build layered functionality.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;

    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;

    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts adventure configurations into compact, readable structures ideal for magical spellcasting systems.</li>
<li>By creating a highly optimized format, the kingdom reduces computational strain, prioritizing clarity over redundancy.</li>
<li>Demonstrates filtering techniques (<code class="inline-code">filter(Boolean)</code>) to cleanly eliminate invalid or empty data during processing.</li>
<li>Iteration over nested structures underscores robust handling of complex adventure configurations.</li>
<li>The emphasis on simplicity paves the way for enhanced readability, benefiting both developers and spellcasters alike.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>‚ú® When following recursive methods like <code class="inline-code">extractUniqueFilePaths</code>, focus on stack-based traversal mechanics and the role of <code class="inline-code">Set</code> for unique references.</li>
<li>üîç Pay attention to how fail-safes are implemented (e.g., <code class="inline-code">try-catch</code> in <code class="inline-code">parseAdventureConfig</code>) to handle fragile inputs gracefully.</li>
<li>‚ö° Compare the parsing and formatting techniques to see how redundancy is minimized in critical systems.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Codemyr&#39;s Repository Scroll! The Hall of Ancient Utilities is deciphered, and your heroic deeds will echo throughout the kingdom for eternity. Hail, brave Code Knight‚Äîthe Kingdom of Codemyr is safe because of you!</p>
<p>By the light of the celestial forge and the wisdom of the ancients, you have unveiled the secrets of the Hall of Ancient Utilities‚Äîmarch boldly, noble hero, for the final quest awaits your destined triumph! ‚ö°üíéüëÅÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>