<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Spell of Configuration — Binding the Codex’s Essence - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Elder Codex: Chronicles of the Enchanted Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Spell of Configuration Binding the Codex’s Essence</h1>
<hr>
<p>The ancient Order of Developers has uncovered new whispers from the Elder Codex, urging the Chosen Architect to bind the fragments of its essence before chaos further destabilizes the Kingdom of Repoaether. With the Codex’s balancing enchantments faltering, its mystic energies point to an enigmatic spell within the Adventurous Grimoire. This tome, however, contains riddled guidance—hidden pathways and patterns that demand careful exploration. You must unlock the secrets of the Codex’s configuration and set right what is fraying. Venture forth, for the spell lies dormant, waiting for one brave enough to decipher its truth.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration system for guided adventures that enhance story generation</h3>
<p>This file is central to understanding how the kingdom&#39;s adventures are bounded by their magical grimoire: the <code class="inline-code">adventure.config.json</code>. Like a map chartered to guide the Order, this file ensures that each adventure aligns with the Elder Codex’s glyphs. The <code class="inline-code">loadAdventureConfig()</code> function is akin to casting a scrying spell, retrieving the raw text of this enchanting document to guide the Chosen Architect. Next, the <code class="inline-code">parseAdventureConfig()</code> function deciphers the cryptic patterns, validating their essence and translating them into an intelligible form for adventures to come. The peculiar charm of the <code class="inline-code">extractUniqueFilePaths()</code> function weaves through the grimoire, following clues to find the true locations where power resides—ensuring that no phantom paths lead the Architect astray. Finally, the <code class="inline-code">formatAdventureConfigForPrompt()</code> function elegantly transforms the parsed glyphs into a structure comprehensible enough for the mystical LLM oracles. Together, these functions form an intricate tapestry, binding the essence of the Codex’s wisdom into actionable magic.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig()</code>: Retrieves the raw enchantments from the <code class="inline-code">adventure.config.json</code>.</li>
<li><code class="inline-code">parseAdventureConfig()</code>: Interprets and validates the Codex’s glyphs into a usable map.</li>
<li><code class="inline-code">extractUniqueFilePaths()</code>: Tracks the true paths through the enchanted files referenced in the grimoire.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code>: Crafts a wizardly structure to summon clarity from the LLM oracles.</li>
<li>Ensures the Codex speaks only the truths found in the paths it names.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<p>This function operates like a crystal ball revealing the unfiltered truth of the <code class="inline-code">adventure.config.json</code>.</p>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>This parses raw data from <code class="inline-code">adventure.config.json</code> much like a translator interpreting ancient runes into clear directives.</p>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This scouts the enchanted roads through the Codex, ensuring that claimed paths actually lead to substantive destinations.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure Guidelines\n\n`;
  formatted += `**CRITICAL: Each quest MUST include dedicated file analysis sections**\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    formatted += `${quest.description}\n\n`;
    formatted += `**Required File Analysis Sections:**\n`;

    for (const file of quest.files) {
      if (!file.path || !file.description) continue;

      formatted += `\n**File: \`${file.path}\`**\n`;
      formatted += `- Description: ${file.description}\n`;

      if (Array.isArray(file.highlights)) {
        formatted += `- Key Functions/Areas to Highlight:\n`;
        for (const highlight of file.highlights) {
          if (highlight.name &amp;&amp; highlight.description) {
            formatted += `  • **${highlight.name}**: ${highlight.description}\n`;
          }
        }
      }
    }
    formatted += `\n`;
  }

  formatted += `\n**FORMATTING INSTRUCTIONS:**\n`;
  formatted += `- Each file mentioned in the quest structure above MUST have its own dedicated analysis section\n`;
  formatted += `- **MANDATORY**: Include at least 2-3 separate code snippet sections (## filename) with real code blocks\n`;
  formatted += `- Show actual function signatures, imports, class definitions, or key methods from the files\n`;
  formatted += `- Include real code snippets from the actual files (never invent code)\n`;
  formatted += `- Provide practical explanations using real-world analogies\n`;
  formatted += `- End with helpful hints and next steps\n`;

  return formatted;
}
</code></pre>
<p>This transforms an ordinary tome of quests into a structured guide, arranging its contents like a wizard preparing a spell scroll for a powerful invocation.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Remember to verify file paths while exploring the <code class="inline-code">path</code> fields—missteps can easily lead to magical waywardness.</li>
<li>If extending the adventure configuration system, ensure flexibility for additional fields to maintain its adaptability.</li>
<li>Begin experimenting with smaller configurations before crafting complex quests to better understand the Codex’s essence.</li>
</ul>
<hr>
<p>Hail, valiant seeker! With the Spell of Configuration mastered and the Codex’s essence bound, the arcane fabric of this realm bends to your will—forward to the final triumph, where eternal glory awaits! ⚡📜💎✨</p>

</div>


    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>