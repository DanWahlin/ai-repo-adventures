<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundation & Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Enchanted Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundation &amp; Utilities</h1>
<hr>
<p>Within the Castle of Config, you stride past shelves of rune-etched tomes toward a modest scroll that anchors the realm‚Äôs utilities. Here, enchanted quills like StoryGenerator and AdventureManager rely on quiet wards that parse lore, trace file paths through shadowed tunnels, and distill clarity for mystic oracles. The MCP gateway hums as knights of start_adventure and explore_quest report findings. In this chapter, you seek the bedrock spells that steady every grand tale: the reading of sigils, the mapping of caverns, and the trimming of verbose chants into crisp, quest-worthy incantations.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Sigil Reader‚Äôs Lens: How does <code class="inline-code">parseAdventureConfig</code> ensure a single, safe point of JSON parsing and gracefully return <code class="inline-code">null</code> when scrolls are missing or corrupted?</li>
<li>‚ö° Pathfinder‚Äôs Flow: What stack-driven traversal pattern does <code class="inline-code">extractUniqueFilePaths</code> use to find every <code class="inline-code">path</code> field across nested structures, and how does it validate existence with <code class="inline-code">fs.existsSync</code>?</li>
<li>üõ°Ô∏è Promptsmith‚Äôs Guard: How does <code class="inline-code">formatAdventureConfigForPrompt</code> compress quest details by extracting only titles, file paths, and function names, and what early returns protect against malformed configs?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core utilities to read, parse, traverse, and format adventure configuration</h3>
<p>Within this single grimoire, you will find the bedrock spells that the kingdom depends upon. The <code class="inline-code">parseAdventureConfig</code> function stands as the lone parser, invoking <code class="inline-code">loadAdventureConfig</code> which strictly reads bytes with <code class="inline-code">fs.readFileSync</code> and never parses. This separation keeps the ritual clean: raw text first, interpretation second. Errors vanish like illusions, returning <code class="inline-code">null</code> to signal a non-fatal absence. The <code class="inline-code">extractUniqueFilePaths</code> incantation roams the labyrinth of the parsed object with a stack-based walk. It inspects any object for a <code class="inline-code">path</code> string, trims it, resolves it with <code class="inline-code">path.resolve</code>, and only admits it to the <code class="inline-code">Set</code> if <code class="inline-code">fs.existsSync</code> confirms a real artifact in the caverns beneath <code class="inline-code">projectPath</code>. Children are gathered from arrays or object values, ensuring no corridor is left unexplored. Finally, <code class="inline-code">formatAdventureConfigForPrompt</code> acts as a promptsmith‚Äôs blade, shaving off ornate descriptions and preserving only essence: quest titles, listed file paths found under <code class="inline-code">quest.files</code>, and function highlight names from <code class="inline-code">quest.files[].highlights</code>. It guards the ritual with checks for object shape and arrays, bailing out with an empty string when the scroll fails structural tests. Together, these utilities uphold the foundations of the realm, ensuring reliable inputs for StoryGenerator, AdventureManager, and the LLMClient‚Äôs time-bound prophecies.</p>
<h4>Highlights</h4>
<ul>
<li>Single-point JSON parsing and null-on-failure behavior in <code class="inline-code">parseAdventureConfig</code></li>
<li>Stack-based traversal and file existence validation in <code class="inline-code">extractUniqueFilePaths</code></li>
<li>Minimal, defensive formatting of quest prompts in <code class="inline-code">formatAdventureConfigForPrompt</code></li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Like a careful scribe, this reads a scroll and, if the ink blurs, quietly sets it aside rather than alarming the court.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This is a knight exploring every corridor with a lantern, adding only real treasures to the vault.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths - LLM can see descriptions in actual code
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}n`;
    }
    
    // Just function names - LLM can understand purpose from implementation
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}n`;
    }
    
    formatted += `n`;
  }

  return formatted;
}
</code></pre>
<p>This is a court bard condensing a saga into crisp verses, keeping only names and routes the heroes must know.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Trace flow from <code class="inline-code">loadAdventureConfig</code> to <code class="inline-code">parseAdventureConfig</code> to see how raw text becomes safe, structured lore.</li>
<li>Follow the stack behavior in <code class="inline-code">extractUniqueFilePaths</code> and note the use of <code class="inline-code">Set</code> to avoid duplicate relics.</li>
<li>Compare the minimal output of <code class="inline-code">formatAdventureConfigForPrompt</code> to typical verbose configs; observe early returns that prevent malformed verses from reaching the oracle.</li>
</ul>
<hr>
<p>Your foundations are set, brave adventurer. With utilities honed and scrolls in order, the next spells will rise swiftly from your quill. Adventure awaits!</p>
<p>By the decree of ancient runes and the chorus of triumphant bards, you have vanquished Quest 5: Foundation &amp; Utilities‚Äîan 80% march through the saga‚Äîfortifying your kingdom‚Äôs bedrock with stellar utilities and rising as a valorous hero nearing the final rite of mastery!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>