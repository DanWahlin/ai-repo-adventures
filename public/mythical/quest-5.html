<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Enchanted Foundations - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Mystic Chronicles of Codethoria</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Enchanted Foundations</h1>
<hr>
<p>In the mystical land of Codethoria, where runes of code shape entire realities, the Enchanted Foundations hold all the fragments of ancient knowledge. These foundations are not mere stone and mortar, but a living, magical codebase ‚Äì guiding quests and forging stories. To harness their full power, you must delve into their structures, unearth hidden file paths, and decipher the arcane glyphs of optimization. As a Code Knight, you now stand at the threshold to unlock the deepest wisdom of Codethoria&#39;s enchanted core.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pathfinder&#39;s Survey</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> identify valid paths in the configuration, and what ensures these paths are unique and existing?</li>
<li>‚ö° <strong>The Parsing Spell</strong>: What strategies does <code class="inline-code">parseAdventureConfig</code> use to validate and safely parse raw configuration files into useful artifacts? </li>
<li>üõ°Ô∏è <strong>Optimization Alchemy</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> reduce size while retaining enough detail to support effective story generation?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core configuration utilities for adventure management and foundation building</h3>
<p>This file serves as the enchanted core governing the structure and optimization of adventure configurations. It processes raw configuration data, extracting paths, parsing content, and reformatting the underlying magical script. The file contains specific structural spells designed to ensure all components are valid, actionable, and optimized for external interactions. Each function contributes to the stable foundation necessary for summoning adventures with precision.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Decodes the raw configurations into structured data, while gracefully handling invalid or malformed input.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the configuration recursively, collecting unique and valid file paths referenced in the configuration to ensure thorough coverage.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Refines the adventure structure for streamlined consumption by LLMs, reducing unnecessary overhead for improved runtime efficiency.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Attempts to parse the raw configuration string into a structured object using <code class="inline-code">JSON.parse</code>, ensuring any errors or invalid data are handled gracefully by returning <code class="inline-code">null</code>.</li>
<li>Validates input early, checking for the absence of raw configurations before attempting further operations.</li>
<li>Protects the system from crashes caused by improperly formatted data or missing files, showcasing a robust error-handling pattern.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Iteratively traverses the parsed configuration using a stack-based approach, ensuring deep structures are fully explored without relying on recursion.</li>
<li>Employs a <code class="inline-code">Set</code> to guarantee file paths are stored uniquely and validates each path with <code class="inline-code">fs.existsSync</code> to confirm it exists.</li>
<li>Demonstrates modular design by building on the output of <code class="inline-code">parseAdventureConfig</code> and using it as an input, reinforcing the separation of concerns.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths - LLM can see descriptions in actual code
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
    
    // Just function names - LLM can understand purpose from implementation
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }
    
    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Reconstructs the adventure structure into a compact, human-readable format, discarding redundant details while retaining essential files and function names.</li>
<li>Uses conditional guards to prevent errors from malformed or empty configurations, promoting resilience and adaptability.</li>
<li>Enhances the output readability for downstream systems, ensuring configurations are concise and appropriate for LLM prompt usage.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üóÇÔ∏è When extracting file paths, ensure the configuration is valid and files actually exist before relying on their output.</li>
<li>üîÑ Practice modular design ‚Äì each function builds on others, creating a clear and maintainable workflow.</li>
<li>üìñ Investigate error-handling strategies used across all functions to avoid system failures caused by invalid input.</li>
</ul>
<hr>
<p>Congratulations, brave Code Knight! You now hold the blueprints for taming the Enchanted Foundations. Continue your journey to master Codethoria‚Äôs deepest mysteries!</p>
<p>With wisdom forged like celestial stardust and strength as steadfast as a dragon&#39;s heart, you have erected the Enchanted Foundations and now stand one quest away from claiming your rightful place among the eternal legends! ‚ö°üíéüó∫Ô∏è‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>