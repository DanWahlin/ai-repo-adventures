<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundation & Utilities - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository of Living Quests</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundation &amp; Utilities</h1>
<hr>
<p>In the citadel beneath the kingdom of code, runes of foundation and humble utilities uphold every saga. Here, a quiet archivist tends <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>, a grimoire that reveals which scrolls matter, which paths are real, and how to compress lore for swift counsel. As dragons of complexity stir, the archivist‚Äôs spells decide what to load, what to discard, and how to whisper the essentials to the mystic scribe. Ready your quill, hero, for truth lies in simple enchantments that bind the entire realm.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç Pathfinder‚Äôs Lens: How does <code class="inline-code">extractUniqueFilePaths</code> traverse nested objects and arrays to gather all valid <code class="inline-code">path</code> entries without duplication?</li>
<li>‚ö° Rune Distiller: In what ways does <code class="inline-code">formatAdventureConfigForPrompt</code> reduce verbosity while preserving quest structure, and how does it validate presence of <code class="inline-code">adventure.quests</code>?</li>
<li>üõ°Ô∏è Scroll Safeguard: How does <code class="inline-code">parseAdventureConfig</code> protect the realm from malformed JSON or missing files, and where does parsing responsibility begin and end?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Utilities that load, parse, distill, and extract adventure configuration</h3>
<p>Within this parchment, the archivist casts lightweight spells to read <code class="inline-code">adventure.config.json</code>, gracefully ignore missing scrolls, and convert raw lore into safe objects. The <code class="inline-code">parseAdventureConfig(projectPath)</code> function centralizes JSON parsing and gracefully returns <code class="inline-code">null</code> when the scroll is absent or ill-formed, ensuring the rest of the kingdom never crashes on bad ink. The <code class="inline-code">extractUniqueFilePaths(projectPath)</code> incantation walks the entire configuration tree using a stack-based traversal, discovering every <code class="inline-code">path</code> rune across nested arrays and objects, verifying existence on disk, and returning only unique, valid entries. Finally, <code class="inline-code">formatAdventureConfigForPrompt(projectPath)</code> distills quests into a concise brief for the LLM oracle, listing just quest titles, file paths, and function names. These utilities emphasize single-responsibility, fail-soft design, and minimal dependencies, serving as the bedrock upon which the StoryGenerator and AdventureManager marshal their greater magics. Note how file IO is isolated, validation is cautious, and the output remains consistent even when the scroll is sparse. Together, these functions ensure robust preparation: controlled parsing, verified references, and trimmed summaries for swift and safe enchantments elsewhere in the realm.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> centralizes JSON parsing, returning <code class="inline-code">null</code> on missing or invalid scrolls to prevent cascading failures across the realm.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> traverses nested config structures, validates existence via <code class="inline-code">fs.existsSync</code>, and returns deduplicated, trustworthy file runes.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> compresses the adventure into a lean outline of quests, files, and functions, enabling efficient prompting without excess lore.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Centralizes and contains all JSON parsing for the adventure config, returning <code class="inline-code">null</code> on failure for resilience.</li>
<li>Uses a narrow try/catch to avoid throwing and instead signals errors upstream safely.</li>
<li>Delegates file reading to <code class="inline-code">loadAdventureConfig</code>, keeping concerns separated and testable.</li>
<li>Ensures downstream utilities can depend on a consistent <code class="inline-code">null-or-object</code> contract.</li>
<li>Prevents brittle coupling by avoiding format assumptions beyond basic JSON validity.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Performs iterative depth exploration using a stack to traverse objects and arrays without recursion limits.</li>
<li>Validates each discovered <code class="inline-code">path</code> both for non-empty strings and on-disk existence to ensure reliability.</li>
<li>Deduplicates results via a <code class="inline-code">Set</code>, preventing redundant file processing in later stages.</li>
<li>Treats arbitrary structure robustly by pushing object values and array items alike.</li>
<li>Returns a stable array, suitable for consumers that need deterministic iteration.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Produces a compact prompt-friendly outline, focusing on quest titles, file paths, and function names only.</li>
<li>Validates presence and shape of <code class="inline-code">adventure.quests</code>, returning an empty string when structure is missing.</li>
<li>Avoids heavy descriptions to reduce token usage while preserving essential references.</li>
<li>Leverages array mapping and flattening to gather function names from each file‚Äôs <code class="inline-code">highlights</code>.</li>
<li>Provides stable, human-scannable formatting for downstream LLM interactions.</li>
</ul>
<h2>Helpful Hints</h2>
<ul>
<li>Validate assumptions early: if structure is missing, return graceful fallbacks rather than throwing.</li>
<li>When exploring nested shapes, prefer iterative traversal to handle arbitrary depth without risk.</li>
<li>Keep prompt formatting minimal and consistent to save tokens and improve clarity.</li>
</ul>
<hr>
<p>You have mastered all the secrets of this enchanted code realm! Your adventure is complete.</p>
<p>By the decree of the arcane council, your mastery of Quest 5: Foundation &amp; Utilities is forged like a dragon-tempered blade‚Äîan 80% odyssey complete‚Äîraising your banner high as a hero of the realm, poised to conquer the final trial with valor and star-lit resolve ‚≠ê‚ö°üöÄ.</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>