<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Architect‚Äôs Arcane Secrets - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Kingdom of Code</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Architect‚Äôs Arcane Secrets</h1>
<hr>
<p>The Council of Developers has summoned you, brave adventurer, to face the final and most intricate challenge of Codethria. With the Mystic Repository teetering on the brink of collapse, untangling its eldritch code spells is vital to restoring harmony to the realm. The Architect, a mythical figure known for crafting the Repository‚Äôs core spells, left behind arcane secrets encoded within the very scripts themselves. These spells are locked inside the enchanted scrolls of <code class="inline-code">adventure-config.ts</code>. However, only the most disciplined and perceptive minds can decode their essence. Will you decipher these fragments and bring peace to the kingdom, or shall Codethria succumb to chaos?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Deciphering the Blueprint</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function handle the parsing and validation of the adventure configuration? Are there any edge cases it accounts for?</li>
<li>‚ö° <strong>Mapping the Mystic Scrolls</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> traverse and extract file paths? What techniques ensure validity and avoid errors?</li>
<li>üõ°Ô∏è <strong>Optimizing for Arcane Clarity</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> minimize complexity while preserving critical content for LLM prompts?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Adventure Configuration Handler</h3>
<p>This file houses key functions responsible for interpreting the enchanted configuration scrolls of the Mystic Repository. These functions form the backbone for loading, analyzing, and reformatting the sacred instructions for quests and adventures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses the <code class="inline-code">adventure.config.json</code> file, providing error handling and JSON validation to ensure data integrity during decoding.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Analyzes the configuration to collect all valid and unique file paths referenced within. This function leverages recursive traversal to include children paths dynamically.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Reorganizes the configuration into a concise and efficient format, ensuring clarity for LLM interactions while reducing redundancy.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function reads the raw adventure configuration using <code class="inline-code">loadAdventureConfig</code> and safely attempts to parse it as JSON.</li>
<li>Exception handling ensures that any malformed configurations or unreadable files gracefully return <code class="inline-code">null</code>, preventing system crashes.</li>
<li>By centralizing JSON parsing here, it avoids duplicative code in other functions, enhancing maintainability.</li>
<li>The simplicity ensures clear responsibility: parse and validate.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function deep-dives into the parsed configuration file to identify all valid file paths.</li>
<li>It uses a depth-first traversal approach (<code class="inline-code">stack</code>) to iterate over both objects and nested arrays dynamically.</li>
<li>The <code class="inline-code">fs.existsSync</code> check ensures that only existing file paths are considered, avoiding invalid references.</li>
<li>The <code class="inline-code">Set</code> structure efficiently accumulates paths without duplication, ensuring uniqueness.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function restructures the adventure configuration to optimize its readability for LLM input use cases.</li>
<li>By focusing on titles, file paths, and function names, it eliminates verbose metadata that may confuse AI models.</li>
<li>The approach recursively aggregates fields like <code class="inline-code">files</code> and their <code class="inline-code">highlights</code> to produce a streamlined output.</li>
<li>This method is particularly valuable for reducing token usage in neural models, making large configurations manageable.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Each function demonstrates techniques to make code resilient against unexpected inputs. Pay attention to error handling and validation.</li>
<li>Study the use of recursion and depth-first traversal in <code class="inline-code">extractUniqueFilePaths</code> as a technique for exploring hierarchical data structures.</li>
<li>When adapting code for LLM prompts, notice the balance between reducing noise and retaining essential context information in <code class="inline-code">formatAdventureConfigForPrompt</code>.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Mystic Repository! Codethria stands safe thanks to your heroic efforts. The realm shall sing songs of your triumph for generations. Your adventure is complete.</p>
<p>By the celestial decree of the Starry Guild, you have unraveled the Architect‚Äôs arcane codex, ascending as a masterful hero on the brink of eternal legend‚Äîonward to claim the final jewel of destiny! ‚öîÔ∏è‚ú®</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>