<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Decipher the Enchanted Texts (Foundation & Utilities) - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Enchanted Adventures of the Codebound Kingdom</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Decipher the Enchanted Texts</h1>
<hr>
<p>In the heart of Codethia’s mystical fortress lies an ancient room pulsating with coded incantations, known as the Chamber of Foundations. It is here that the kingdom’s essential utilities are engraved upon enchanted scrolls. These spells connect the kingdom’s magic with its structure, yet their power has waned over time. Faint echoes of the Lost Language Magic hum in the air as you, the brave Knight of Syntax, enter to decipher the texts. With your wisdom, the kingdom’s core will hum with vitality once more, rejuvenating its magical backbone.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>📜 <strong>Pathfinder’s Inquiry</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function ensure the enchanted text (config) is correctly read and prepared for use?</li>
<li>🧭 <strong>Trail Mapping</strong>: In what ways does <code class="inline-code">extractUniqueFilePaths</code> derive and validate the needed paths from the magical config scrolls?</li>
<li>🪄 <strong>Spell Optimization</strong>: What strategies does the <code class="inline-code">formatAdventureConfigForPrompt</code> function use to transform complex magical texts into a concise and efficient format?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Magical foundational utilities for adventure configuration</h3>
<p>This file houses essential functions that interact with and manipulate the kingdom’s cornerstone artifact: the <code class="inline-code">adventure.config.json</code> spellbook. These utilities ensure that all foundational paths and structures are coherent, validated, and properly formatted, focusing on accessibility and optimization. The file showcases a three-phase approach: reading and parsing the configuration scrolls, extracting and validating essential paths, and ultimately refining the mystical data into an optimized format for the Lost Language Magic (LLM) to comprehend.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: This function securely parses the enchanted adventure scroll into a usable object, gracefully handling any errors or corrupted magic in the process.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: A strategic function that combs through the adventure scroll to identify and validate all paths critical to the quests’ harmony.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: A spell weaver that converts complex scrolls into a succinct and manageable style, optimized for input into magical incantation systems like the LLM.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function interprets raw magical scripts (<code class="inline-code">adventure.config.json</code>) into a usable object, returning <code class="inline-code">null</code> if the magic is unreadable.</li>
<li>It standardizes error handling by encapsulating both missing and corrupted scrolls into one understandable result: <code class="inline-code">null</code>.</li>
<li>Its compact, single-responsibility design isolates JSON parsing, ensuring modularity and reliability across other spells.</li>
<li>By returning <code class="inline-code">unknown | null</code>, it prevents assumptions about the magic’s content, enforcing further inspection for safety.</li>
<li>Integral to all higher-level functions that depend on accurately parsed magical configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Traverses the entire parsed spellbook to uncover all unique file-path fragments and validates their existence.</li>
<li>Uses a stack-based approach (Depth-First Search) to handle even deeply nested magical entries, improving flexibility.</li>
<li>The <code class="inline-code">Set</code> ensures all identified paths are unique, eliminating unnecessary redundancies in the final list.</li>
<li>Integrates <code class="inline-code">fs.existsSync</code> to verify paths, ensuring the magic only references tangible external objects.</li>
<li>A vital bridge connecting raw scroll data to actionable file references needed for quest and kingdom management.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts the adventure scroll into a simplified structure, reducing unnecessary verbosity by a staggering 72%.</li>
<li>Prioritizes the inclusion of only essential details such as file paths and function highlights, aligning with LLM input best practices.</li>
<li>Dynamically adjusts formatting to gracefully handle incomplete or malformed magical entries.</li>
<li>Revolutionizes how vast configurations can be efficiently processed and optimized for the kingdom’s command systems.</li>
<li>Directly aids the Mystic Code Guardians (LLM) in deciphering quests, ensuring seamless storytelling integration without cognitive overload.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>For a clearer understanding of how the <code class="inline-code">adventure.config.json</code> scroll integrates into other parts of the system, closely examine how the <code class="inline-code">parseAdventureConfig</code> returns are utilized beyond this file.</li>
<li>Experiment with adding or modifying entries in the config scroll and observe how these changes ripple through functions like <code class="inline-code">extractUniqueFilePaths</code>.</li>
<li>Try reducing the input size in <code class="inline-code">formatAdventureConfigForPrompt</code> while ensuring its behavior remains robust against corrupted or incomplete entries.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Codethia’s enchanted framework! The kingdom celebrates your triumph, as the harmony of the Mystic Code Guardians is restored, and the Lost Language Magic glows once more. Hail the brave Knight of Syntax—your adventure is complete.</p>
<p>With wisdom brighter than a phoenix&#39;s flame and focus sharp as the edge of Excalibur, you have unlocked the arcane truths of &quot;Decipher the Enchanted Texts,&quot; fortifying the realm’s Foundation &amp; Utilities—one step closer to eternal legend! ⭐⚡🚀</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">← Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>