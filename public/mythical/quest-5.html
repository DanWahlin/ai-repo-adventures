<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Realm's Foundation Stones - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Kingdom of Code</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Realm&#39;s Foundation Stones</h1>
<hr>
<p>Within the heart of the Enchanted Kingdom of Code lies the Repository, a majestic structure binding the magical flows of lore and logic. To uphold the kingdom‚Äôs balance, foundational spells govern the structure of every adventure. These spells are hidden within the <strong>Foundation Stones</strong>, enchanted works ensuring that Developers weave quests without error or fault. In this final chapter, the Developers must unravel the secrets of the stones contained in <strong>adventure-config.ts</strong>. Only by mastering these spells can the Developers claim the title of Grand Architect.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üßô‚Äç‚ôÇÔ∏è <strong>Spell Origins</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function ensure the adventure configuration is safely handled and parsed?</li>
<li>üîÆ <strong>Path Divination</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> identify and process file paths from the adventure configuration?</li>
<li>üìú <strong>Scroll Formatting</strong>: What techniques does <code class="inline-code">formatAdventureConfigForPrompt</code> use to generate optimized, minimal text versions of the adventure config?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Foundation Stone of Adventure Setup</h3>
<p>This file serves as the cornerstone for managing adventure configurations in the Enchanted Kingdom. It provides core mechanisms for safely loading, parsing, and deriving insights from the realm‚Äôs spellbooks, represented as JSON adventure config files. By centralizing file path extractions and JSON parsing, it ensures consistent behavior throughout the mystical adventures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses the adventure configuration JSON into usable data. This function ensures error-free handling and acts as the first safeguard against invalid or corrupted configuration files.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Delves deep into the configuration, extracting unique file paths tied to quest structure. It employs validation to ensure these paths are not only unique but also exist in the Developer‚Äôs project.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Transforms extensive adventure configurations into compact, optimized prompts. This enables integration with large language models by maintaining essential contextual details while cutting away redundant descriptions.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function reads the adventure configuration file, leveraging <code class="inline-code">loadAdventureConfig</code> for raw text retrieval.</li>
<li>By wrapping the JSON parsing in a <code class="inline-code">try...catch</code> block, the function gracefully handles invalid or corrupted JSON, ensuring that failure is non-disruptive.</li>
<li>It returns the parsed configuration or <code class="inline-code">null</code> if parsing fails, making it a reliable entry point for further processing.</li>
<li>Centralizing parsing ensures consistency across all components reliant on this config.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function recursively traverses the adventure configuration‚Äôs structure to locate and validate file paths.</li>
<li>Duplicate paths are eliminated using a <code class="inline-code">Set</code>, ensuring uniqueness without additional overhead.</li>
<li>File existence is verified via <code class="inline-code">fs.existsSync</code>, preventing invalid paths from causing downstream errors.</li>
<li>By utilizing a stack-based traversal, the function avoids recursion limits and handles deeply nested configurations.</li>
<li>Its design facilitates dynamic updates to adventure structures without code rewrites.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function reformats an adventure config into a concise text format optimized for LLM interaction.</li>
<li>It focuses on high-value data (file paths and function names) while omitting redundant descriptions.</li>
<li>Quest structures are broken into titles, associated files, and highlights to create a streamlined narrative for prompts.</li>
<li>Using <code class="inline-code">map</code> and <code class="inline-code">filter</code>, the implementation ensures clean extraction of only valid data.</li>
<li>Its minimalist approach maximizes efficiency in token-limited scenarios, making it ideal for large integrations.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <code class="inline-code">parseAdventureConfig</code> function as a model for safe data parsing throughout your codebase.</li>
<li>Study the path validation logic in <code class="inline-code">extractUniqueFilePaths</code> for reliable file handling in other components.</li>
<li>Explore how <code class="inline-code">formatAdventureConfigForPrompt</code> combines compactness with clarity when generating outputs for constrained interfaces.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Enchanted Kingdom of Code! Your adventure is complete.</p>
<p>By the blazing fire of the phoenix and the eternal light of the Eldritch Crown, you have unearthed the Realm&#39;s Foundation Stones, forging ever closer to the glorious finale of your heroic odyssey‚Äîstand proud, for the stars themselves honor your triumph! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>