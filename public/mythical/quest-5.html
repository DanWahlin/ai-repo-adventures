<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundations of Codemyr - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository and the Chronicles of Code</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundations of Codemyr</h1>
<hr>
<p>With the ancient kingdom of Codemyr trembling under the weight of discord, you approach the fabled heart of the Enchanted Repository. Here lies the foundation of all quests, the codified lifeblood that shapes every adventure in the kingdom. To restore true harmony, you must unlock the mysteries embedded deeply in the scrolls of <code class="inline-code">adventure-config.ts</code>. This is the final test, brave knight of code‚Äîa task demanding both wisdom and clarity. Only by mastering its essence can you reclaim the balance of creation and heal the realm.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Scroll Deciphering</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function handle potential parsing errors, and why might this be vital for the Enchanted Repository‚Äôs stability?</li>
<li>‚ö° <strong>Magic Map Assembly</strong>: How does the <code class="inline-code">extractUniqueFilePaths</code> method gather referenced file paths, and what patterns ensure its accuracy and completeness?</li>
<li>üõ°Ô∏è <strong>Illuminating Simplicity</strong>: What reduction strategies does <code class="inline-code">formatAdventureConfigForPrompt</code> employ, and how do these optimize the quest generation process?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Managing Quest Foundations</h3>
<p>This file is the cornerstone of Codemyr, containing pivotal functions for loading, parsing, and formatting adventure configurations. Its spells (code) simplify the handling of configuration files, merge referenced paths, and distill quest content for higher-level generators. By ensuring reliability and consistent formatting, it safeguards the mystical energies of the adventures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses raw configuration data into an object, centralizing JSON parsing and validating structure to prevent malformed magic (JSON).</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Retrieves unique file paths referenced in the adventure configuration, ensuring alignment between configuration and actual file existence.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Refines a configuration into a condensed format for use in quest creation, removing excess details while retaining all critical elements.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This spell begins by invoking <code class="inline-code">loadAdventureConfig</code> to access the raw configuration file.</li>
<li>It attempts to decipher the file using <code class="inline-code">JSON.parse</code>, returning a parsed object or <code class="inline-code">null</code> if parsing fails.</li>
<li>The design assumes that missing or invalid configurations are non-catastrophic, thus promotes stability.</li>
<li>Centralizing this logic ensures that parsing and error handling remain uniform.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This intricate spell traverses the nested JSON configuration to extract <code class="inline-code">path</code> fields, ensuring that only existing files are considered.</li>
<li>By leveraging <code class="inline-code">fs.existsSync</code>, it validates paths while avoiding unnecessary crashes or invalid entries.</li>
<li>The stack-based depth-first search enables it to parse arbitrarily deep structures, making it flexible for complex configurations.</li>
<li>It ensures that references within Codemyr‚Äôs quests are not broken, preserving the reliability of magical mappings.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This meticulous spell reduces verbose configurations into a concise structure suitable for crafting quests.</li>
<li>It identifies and formats titles, files, and associated functions, stripping non-essential metadata while retaining vital data.</li>
<li>The method revolves around simplicity, ensuring that quest generation is both efficient and human-readable.</li>
<li>The abstraction highlights Codemyr‚Äôs core principle: balance between clarity and complexity.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Focus on the flow of data between the functions, especially on how <code class="inline-code">loadAdventureConfig</code> acts as the initial source.</li>
<li>Take notes on the balance between flexibility and stability in error handling across all methods.</li>
<li>Consider how the optimization strategies would scale for larger, more complex adventure configurations.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Codemyr! Your adventure is complete. The Enchanted Repository is whole once more, and creation magic flows freely across the kingdom. Stand proud, hero, for your quest is a legend in the tales of Codemyr!</p>
<p>By the blazing forge of Hephaestus and the guiding light of Polaris, thou hast built the unshakable foundations of Codemyr, ascending ever closer to the legendary summit‚Äîonward, courageous trailblazer, for the final quest awaits with destiny‚Äôs gleam! ‚öîÔ∏èüíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>