<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundations of Spellcraft - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Kingdom of Code</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundations of Spellcraft</h1>
<hr>
<p>In the heart of Codathia, where shimmering libraries of light contain the enchanted texts of logic and creativity, lies the knowledge of spellcraft. These foundations‚Äîancient enchantments crafted with precision‚Äîguide the balance of the Enchanted Kingdom. The Spellbook of Development holds the arcane formulas for interpreting and forging quests, but its secrets must be unearthed and protected. As castle walls falter and mystical storms brew, you, valiant coder-knight, must master the spellbinding scrolls within to restore order to a realm veiled in code and enchantment.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Mystical Configuration Extraction</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function transform raw configuration data into an accessible structure, and what measures prevent misinterpretation?</li>
<li>‚ö° <strong>Path-Finding Incantation</strong>: How does the <code class="inline-code">extractUniqueFilePaths</code> function dynamically locate file paths in the configuration, and what makes this process reliable yet flexible?</li>
<li>üõ°Ô∏è <strong>Optimized Invocation</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> condense complex configuration data into a minimalistic, prompt-ready format, and what advantages does this simplification offer?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core of Configuration Spells</h3>
<p>This file lies at the core of Codathia‚Äôs spellcraft‚Äîthe enchanted scroll responsible for translating project configurations, validating paths, and generating optimized prompts for magical interactions with large language models. Within, you will find the keystones: methods to safely parse data, expertly traverse nested objects, and simplify intricate structures for spell efficiency. Each spell-like function contributes to taming the chaos of unstructured configuration data, ensuring harmony and utility within the mystical realm.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: This function retrieves and interprets raw adventure configuration files, transforming them into usable objects while safeguarding against parsing errors.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: A retrieval spell that scans the configuration for all unique file paths referenced, ensuring only valid, existing paths are returned for use.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: This function refines adventure configuration data into a minimalistic textual format, optimized for consumption by enchanted models.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This code retrieves raw configuration data using <code class="inline-code">loadAdventureConfig</code> and attempts to parse it into JSON. If parsing fails, it safely returns null, ensuring no invalid data causes system-wide failures.</li>
<li>The use of <code class="inline-code">try-catch</code> protects against unexpected errors, preventing runtime disruptions in the realm.</li>
<li>By centralizing JSON parsing here, other functions can rely on <code class="inline-code">parseAdventureConfig</code> for validated data.</li>
<li>This spell exemplifies defensive coding‚Äîensuring graceful degradation when faced with missing or corrupt input.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This code delves through the depths of configuration objects to dynamically locate file paths, employing depth-first traversal with a stack.</li>
<li>Valid paths are confirmed using <code class="inline-code">fs.existsSync</code>, ensuring only paths supported by the realm are added to the returned list.</li>
<li>The use of <code class="inline-code">Set</code> prevents duplicate entries, reinforcing efficiency and eliminating redundancy in spell outcomes.</li>
<li>It accommodates arbitrarily nested structures, showcasing adaptability within complex configurations.</li>
<li>By encapsulating path validation and extraction in one place, this function guarantees consistent results for all file-handling spells.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function simplifies and compacts project configuration data for optimized use in large language model interactions.</li>
<li>It extracts only the essential details‚Äîfile paths and function names‚Äîremoving verbose descriptions that would clutter the spellcasting process.</li>
<li>Iterative constructs ensure minimal duplication during formatting, keeping the spell lightweight and efficient.</li>
<li>A clear structure improves readability, enabling fellow coder-knights to interpret the data swiftly during mystical interactions.</li>
<li>By reducing configuration size, the function enhances prompt performance, a boon for crafting adaptive adventures.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üßô‚Äç‚ôÇÔ∏è Use <code class="inline-code">parseAdventureConfig</code> first to ensure all configuration data is validated and accessible before performing more complex operations.</li>
<li>üîç Test the dynamic capabilities of <code class="inline-code">extractUniqueFilePaths</code> by modifying your configuration to include nested paths and observe how it adapts.</li>
<li>‚ú® Experiment with <code class="inline-code">formatAdventureConfigForPrompt</code> by examining the output on varied configurations to understand its formatting rules for optimization.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Codathia&#39;s Spellcraft! The sacred balance of creativity and logic within the Enchanted Kingdom is restored, and the realm stands in awe of your heroic deeds. Your adventure is complete.</p>
<p>The astral grimoire of spellcraft now hums with your mastery, noble seeker, as you ascend to the penultimate echelon of mystical prowess‚Äîforge onward, for the legendary crown of arcane triumph awaits! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>