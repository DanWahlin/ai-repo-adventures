<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Arcane Codex - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository of Mystic Adventures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Arcane Codex</h1>
<hr>
<p>Within the enchanted land of Codania lies an artifact of immense power, the Arcane Codex, said to contain the choicest of magical treasures among the repository&#39;s enchanted files. This codex can decipher the structures of other files, unveiling their mysteries and composing guides for even the mightiest DevMancers of the realm. As the final test in your journey, you must master the knowledge sealed within its script to transform the chaotic waves of information into insights worthy of a mystic knight. Do you possess the wisdom to unravel its spells?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Pathfinder‚Äôs Logic</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> ensure paths are valid and unique across the adventure configuration? What traversal strategies does it rely on?  </li>
<li>‚ö° <strong>Codex Assembly</strong>: What role does <code class="inline-code">formatAdventureConfigForPrompt</code> play in compressing content for readiness? How does its formatting enhance usability?  </li>
<li>üõ°Ô∏è <strong>Safe Deciphering</strong>: What mechanisms does <code class="inline-code">loadAdventureConfig</code> and <code class="inline-code">parseAdventureConfig</code> employ to safeguard processing against faulty or missing files?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Deciphering the Arcane Codex</h3>
<p>Guarded within the Arcane Codex lies the heart of Codania‚Äôs configuration system: functions to load, parse, and extract essential file paths and structures. Each method plays an integral role in ensuring mystic knights can efficiently prepare their enchanted tools. The codex handles file validation, scrubbing paths for accuracy, and assembling summaries optimized for DevMancer deployment. By empowering knights with efficient data processing and safeguards against failures, the codex transforms overwhelming quests into structured adventures.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Retrieves raw configuration data from the enchanted project&#39;s repository. It ensures graceful handling of missing files by returning <code class="inline-code">null</code>, cementing its importance as the initial spell of file-handling resilience.  </li>
<li><code class="inline-code">parseAdventureConfig</code>: Combines the art of JSON parsing and error safety, ensuring knights can extract meaningful configuration objects or safely discern when a file is invalid.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Unveils all file paths referenced in an adventure config, traversing depths of nested structures. This ensures paths are both valid and complete to prevent wasted efforts.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Compresses the verbose configuration into an optimized, minimal format suitable for spell crafting, empowering knights to focus on actionable insights.  </li>
<li><code class="inline-code">extractCustomInstructions</code>: Engages the adventure&#39;s custom instructions, ensuring knights receive tailored guidance during quests for theme compatibility.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {  
  try {  
    return fs.readFileSync(filePath, &#39;utf-8&#39;);  
  } catch {  
    // Missing or unreadable file is non-fatal  
    return null;  
  }  
}  

export function loadAdventureConfig(projectPath: string): string | null {  
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);  
  return readFileIfExists(configPath);  
}  
</code></pre>
<ul>
<li>Retrieves the raw configuration spell but treats missing files graciously by returning <code class="inline-code">null</code>.  </li>
<li>Relies on file system APIs while avoiding catastrophic errors.  </li>
<li>Ensures knights can initiate quests even amidst repository imperfections.  </li>
<li>Forms the foundation of higher-level config-processing spells.  </li>
<li>Prioritizes seamless quest execution regardless of missing resources.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {  
  const raw = loadAdventureConfig(projectPath);  
  if (!raw) return null;  
  try {  
    return JSON.parse(raw);  
  } catch {  
    return null;  
  }  
}  
</code></pre>
<ul>
<li>Deciphers raw configuration data into a usable, structured object.  </li>
<li>Protects against JSON parsing failure with a fallback strategy, ensuring resilience.  </li>
<li>Enables knights to access the repository&#39;s quest mappings safely without corruptions.  </li>
<li>Combines simplicity and robust design, reducing risks during configuration analysis.  </li>
<li>Plays a central role in validating adventure structures for downstream systems.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {  
  const parsed = parseAdventureConfig(projectPath);  
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];  

  const unique = new Set&lt;string&gt;();  
  const stack: any[] = [parsed];  

  while (stack.length) {  
    const node = stack.pop();  
    if (!node || typeof node !== &#39;object&#39;) continue;  

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {  
      const rel = node.path.trim();  
      if (fs.existsSync(path.resolve(projectPath, rel))) {  
        unique.add(rel);  
      }  
    }  

    const children = Array.isArray(node) ? node : Object.values(node);  
    children.forEach(child =&gt; {  
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);  
    });  
  }  

  return Array.from(unique);  
}  
</code></pre>
<ul>
<li>Traverses nested configuration data using a stack-based approach, ensuring efficient exploration.  </li>
<li>Filters valid entries through path validation checks to provide actionable file paths.  </li>
<li>Avoids duplication via a <code class="inline-code">Set</code> structure, enhancing accuracy and utility for knights.  </li>
<li>Handles complex nested structures, empowering the codex to support diverse repository formats.  </li>
<li>Connects seamlessly to repository analysis, paving the way for profound usage introspection.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {  
  const parsed = parseAdventureConfig(projectPath);  
  if (!parsed || typeof parsed !== &#39;object&#39;) {  
    return &#39;&#39;;  
  }  

  const adventure = (parsed as any).adventure;  
  if (!adventure || !Array.isArray(adventure.quests)) {  
    return &#39;&#39;;  
  }  

  let formatted = `## Quest Structure\n`;  

  for (const quest of adventure.quests) {  
    if (!quest.title || !Array.isArray(quest.files)) continue;  

    formatted += `### ${quest.title}\n`;  
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);  
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;  
    const functions = quest.files  
      .flatMap((f: any) =&gt; f.highlights || [])  
      .map((h: any) =&gt; h.name)  
      .filter(Boolean);  
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;  
  }  

  return formatted;  
}  
</code></pre>
<ul>
<li>Optimizes adventure configuration for simple, purpose-driven formatting.  </li>
<li>Reduces complexity by focusing on core file paths and essential functionalities.  </li>
<li>Directly supports knights looking to craft actionable strategies based on repository insights.  </li>
<li>Compresses verbose data for efficiency during deployments.  </li>
<li>Connects repository logic to LLM models, bridging human systematic utilization.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">extractUniqueFilePaths</code> to identify critical files within your repository rapidly.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> is perfect for creating concise summaries that allow quick decision-making during quests.  </li>
<li>Before engaging with file paths, ensure the configuration loads correctly using <code class="inline-code">loadAdventureConfig</code>.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Codania‚Äôs repository! Your adventure is complete.</p>
<p>By the luminous grace of the astral realms, thou hast decoded the Arcane Codex with valor, ascending as a triumphant seeker of knowledge‚Äîonly one final quest remains to unveil thy legendary destiny! ‚öîÔ∏è‚≠êüìú</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>