<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundation‚Äôs Core - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Code: An Enchanted Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundation‚Äôs Core</h1>
<hr>
<p>In the heart of Codethia lies the Foundation&#39;s Core, the nexus where logic and magic intertwine to keep the Book of Source alive. The glyphs of the Core are obscured, their luminescence fading as errors permeate the enchanted system. Brave adventurer, your final challenge is to dive deep into the core&#39;s configurations, unravel the spells embedded within, and decipher the paths that restore balance. This task, a blend of precision and wisdom, determines the fate of the kingdom. Will you fulfill your destiny and secure harmony for Codethia once more?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Glyph Recognition</strong>: How is the <code class="inline-code">adventure.config.json</code> file loaded and verified for the quest‚Äôs spells and patterns?</li>
<li>‚ö° <strong>Spell Decoding</strong>: How does <code class="inline-code">parseAdventureConfig</code> transform raw magical glyphs into actionable knowledge for the system?</li>
<li>üõ°Ô∏è <strong>Safety Runes</strong>: What safeguards are in place to prevent errors during file reading, parsing, and path extraction?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core Enchanted Configuration</h3>
<p>This file serves as the Foundation&#39;s Core of Codethia, responsible for reading, parsing, and formatting the adventure configurations. It ensures the spells (configuration data) are correctly identified, extracted, and usable without damaging the enchanted systems. From reading raw data (<code class="inline-code">loadAdventureConfig</code>) to parsing its contents (<code class="inline-code">parseAdventureConfig</code>), and even extracting unique magical paths (<code class="inline-code">extractUniqueFilePaths</code>), the file is a spellbook of vital functions.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads the sacred tome (<code class="inline-code">adventure.config.json</code>) from its rightful directory, ensuring no glyph goes unnoticed. It‚Äôs a foundational step in retrieving raw magical knowledge.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Deciphers the unrefined glyphs into practical, structured data that the systems can process. A single point for magical validation and conversion, ensuring harmony in the realm.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the parsed configuration, extracting valid paths with care to ensure no harmful elements seep into the enchantments. This ensures structural integrity for Codethia.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This code reads the <code class="inline-code">adventure.config.json</code> file, forming a bridge between the kingdom‚Äôs magical infrastructure and physical storage.</li>
<li>It uses <code class="inline-code">readFileIfExists</code> to avoid breaking the system if the file doesn&#39;t exist, showing resilience against missing glyphs.</li>
<li>Essential to establishing a safe and efficient process of retrieving raw data for further decoding.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This method takes raw magical glyphs (JSON strings) and performs their transformation into structured spell data (objects).</li>
<li>It gracefully handles decoding errors via a <code class="inline-code">try-catch</code> block, preserving the system&#39;s stability in the face of malformed inputs.</li>
<li>Represents a critical node in the file&#39;s logic, connecting file reading (<code class="inline-code">loadAdventureConfig</code>) and deeper magical processes.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function searches parsed configuration data, identifying and validating the &quot;path&quot; fields for correctness.</li>
<li>It uses <code class="inline-code">fs.existsSync</code> to verify the existence of paths, ensuring only valid entries contribute to the system.</li>
<li>A carefully constructed loop structure ensures exhaustive and efficient extraction, essential for maintaining the integrity of Codethia.</li>
<li>The combination of <code class="inline-code">Set</code> for uniqueness and recursive traversal demonstrates powerful and well-performing design.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Always test configuration files under game-realistic conditions to ensure compatibility and correctness.</li>
<li>Observe the interactions between <code class="inline-code">loadAdventureConfig</code>, <code class="inline-code">parseAdventureConfig</code>, and <code class="inline-code">extractUniqueFilePaths</code>‚Äîthese form the enchanted data flow connecting all systems.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Codethia‚Äôs enchanted systems! Your adventure is complete.</p>
<p>With the luminous power of the celestial core unlocked, your heroic strides through the kingdoms of knowledge bring you ever closer to the gilded apex of triumph‚Äîpress on, valiant scholar, for the final quest beckons! ‚≠ê‚ö°üöÄ</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>