<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundations of Adventure - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Code: The Enchanted Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundations of Adventure</h1>
<hr>
<p>In the mythical Kingdom of Code, the very foundation of every journey begins within the depths of the enchanted adventure scrolls. Hidden among these ancient texts are the secrets to understanding how quests are structured and how their paths are illuminated. As the chosen hero, you now face the challenge of decoding these foundations, written within <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>. Your mission is to uncover how the mystical system reads, processes, and presents the configuration that drives adventures. Mighty challenges await, but the knowledge gained here will be a cornerstone of your journey to unify the kingdom once again!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pathfinder‚Äôs Map</strong>: How does the <code class="inline-code">extractUniqueFilePaths</code> function explore and verify file paths while traversing the configuration?</li>
<li>‚ö° <strong>Scroll Parsing Ritual</strong>: What validations and transformations occur within <code class="inline-code">parseAdventureConfig</code>, and how does it ensure a safe configuration object is returned?</li>
<li>üõ°Ô∏è <strong>Protection Charm</strong>: How does <code class="inline-code">loadAdventureConfig</code> handle missing or unreadable configuration files gracefully?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Configurations of Adventure</h3>
<p>In this file resides the heart of adventure initialization: methods for loading, parsing, and analyzing the <code class="inline-code">adventure.config.json</code> file. The functions here ensure the kingdom‚Äôs adventures are guided by a consistent and reliable structure. They emphasize safe file reading, strict parsing, and extracting relevant information essential for the broader quest system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Manages reading the configuration file and handling failures without disrupting the heroic flow.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Safely transforms raw configuration text into a usable object, encapsulating crucial validation logic.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the adventure configuration to collect and validate all file paths, ensuring only existing paths are allowed.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<p>Like a wizard carefully opening a scroll, <code class="inline-code">loadAdventureConfig</code> retrieves the textual content of the adventure configuration or gracefully returns null if the scroll is missing or cannot be read.</p>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>The <code class="inline-code">parseAdventureConfig</code> function acts as a translator for arcane scripts, converting raw JSON text into an object while blocking corrupted scrolls with robust error handling.</p>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>The <code class="inline-code">extractUniqueFilePaths</code> function is the kingdom‚Äôs cartographer, meticulously mapping all valid paths within the configuration using recursive exploration and validation.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Make use of <code class="inline-code">extractUniqueFilePaths</code> as a reliable tool for discovering referenced files in your adventures.</li>
<li>For debugging, consider testing the <code class="inline-code">parseAdventureConfig</code> function with varying JSON structures to uncover its full resilience.</li>
<li>Store configurations in a secure and easily accessible place to avoid unhandled read issues.</li>
</ul>
<hr>
<p>The Kingdom of Code applauds your courage, brave knight! By mastering the foundations of adventure, you edge closer to assembling the scrolls and restoring balance to the realm. Ride forth, for your next quest awaits!</p>
<p>By the decree of the stars and the wisdom of the ancients, your heroic triumph in Quest 5: The Foundations of Adventure has solidified your place as a luminous champion on the verge of eternal glory‚Äîonward, valiant seeker, for the final realm awaits! ‚ö°üíéüöÄ</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>