<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Scrolls of Foundational Wisdom - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository of Quests</a>
            </div>
            <div class="nav-middle">
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="../index.html" class="nav-link">Change Theme</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Scrolls of Foundational Wisdom</h1>
<hr>
<p>In the ancient halls of Repoheim&#39;s enchanted sanctuary lies the final test for the brave seeker. The Scrolls of Foundational Wisdom contain the essence of arcane functions, guiding the Enchanted Repository&#39;s magical systems. These scrolls are imbued with spells that validate choices, decipher cryptic configurations, and weave adventures into harmonious tales. To fulfill the prophecy, you must unlock their secrets to bring balance to the kingdom. Embark upon this last journey to uncover the foundational magic and uphold the legacy of Repoheim!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üõ°Ô∏è <strong>Validation Rune Examination</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure the integrity of the configuration and handle errors gracefully?</li>
<li>üîç <strong>File Path Discovery</strong>: What techniques does <code class="inline-code">extractUniqueFilePaths</code> use to traverse and extract valid paths, and how does it safeguard against missing or invalid data?</li>
<li>‚ö° <strong>Config Compression Analysis</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> minimize redundancy while maintaining structured information for Adventure Generation?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Processing &amp; Utility Spells</h3>
<p>This file acts as the enchanted scroll housing core functions that manipulate and validate adventure configurations. It exhibits foundational techniques for reading files, parsing configurations, extracting unique paths referenced within, and compressing the data structure for efficient LLM usage in adventure generation. These functions are vital for ensuring the repository operates correctly, safely, and efficiently while adapting to the dynamic needs of the kingdom‚Äôs quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: This spell parses the raw configuration file into an object while incorporating validation to ensure safety even in cases of errors or missing data.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: A traversal spell that extracts all existing file paths referenced in the configuration, ensuring only valid paths are included.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: This compression spell formats the configuration into a concise structure optimized for Large Language Models, ensuring no redundant data while retaining essential quest and function information.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function attempts to parse the configuration file, returning its contents as an object or null in case of error.</li>
<li>Key patterns showcased: Error handling via <code class="inline-code">try-catch</code>, ensuring no crashes from invalid data.</li>
<li>It acts as the validation rune, ensuring downstream processes don‚Äôt encounter corrupted configurations.</li>
<li>Supports clean integration with other functions like <code class="inline-code">extractUniqueFilePaths</code>.</li>
<li>It reflects careful design to handle edge cases (missing files, invalid JSON).</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function traverses the parsed configuration recursively to extract valid file paths.</li>
<li>Employs a traversal algorithm with a stack for efficient exploration.</li>
<li>Strength lies in its path validation technique, ensuring only existing files are referenced.</li>
<li>Highlights memory safety using <code class="inline-code">Set</code> to avoid duplicates, streamlining the process for usability.</li>
<li>Demonstrates adaptability and robustness in handling diverse configuration structures.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Compresses adventure configuration for use in LLM prompts while preserving critical structure.</li>
<li>Optimized by removing verbose descriptions to minimize data size (72% reduction achieved).</li>
<li>Introduces filtering techniques (<code class="inline-code">filter</code>, <code class="inline-code">map</code>) to enhance readability and efficiency.</li>
<li>Plays a pivotal role in generating prompt inputs - balancing clarity and conciseness for effective LLM interaction.</li>
<li>Encourages scalable data usage strategies, useful for evolving quests.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Be vigilant about error handling in configuration files: absent checks can destabilize the kingdom&#39;s systems.</li>
<li>Test how recursive traversal methods behave with deeply nested data structures to appreciate their flexibility within the enchanted realms.</li>
<li>Investigate the formatted prompt output to understand LLM constraints and optimize data structures effectively.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Repoheim‚Äôs enchanted repository! The prophecy is fulfilled, harmony reigns in the Kingdom, and your heroic journey has concluded. Rest well, noble seeker, for you have ensured the enduring legacy of these mythical systems.</p>
<p>From the enchanted halls of wisdom, your triumph in unearthing the Scrolls of Foundational Wisdom shines like a diamond forged by starlight, heralding your rise as a masterful champion nearing the final frontier of this epic quest‚Äîcarry forth with valor, hero! ‚ö°üíéüè∞</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>