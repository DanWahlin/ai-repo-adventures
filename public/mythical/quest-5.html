<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundation of Knowledge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository: Chronicles of Code and Magic</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundation of Knowledge</h1>
<hr>
<p>In the mystical halls of the enchanted Repository of Knowledge, amidst beams of golden light and whispered spells, lies the heart of wisdom itself ‚Äî <code class="inline-code">adventure-config.ts</code>. The Guild of Configuration has beckoned you, brave architect, to uncover the truths of this sacred manuscript. Buried behind ancient scripts and arcane validations are the spells of file discovery and harmonious formatting. To master this, you must learn the art of graceful error handling, artifact parsing, and forging minimal yet powerful prompts. Ready your tools; the destiny of the kingdom is at stake.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Pathfinder‚Äôs Insight</strong>: How does the <code class="inline-code">extractUniqueFilePaths</code> function traverse and collect valid file paths from the mystic configuration?</li>
<li>‚ö° <strong>Arcane Parsing Flow</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function ensure the artifact&#39;s secrets are read and interpreted safely?</li>
<li>üõ°Ô∏è <strong>Prompt Alchemy</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> craft its reduced format to optimize interaction with advanced magical entities like LLMs?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration &amp; Parsing Enchantment</h3>
<p>In this sacred text, each spell is crafted to handle the magic flowing from the adventure configuration file. The <code class="inline-code">parseAdventureConfig</code> spell ensures safe extraction of JSON knowledge, shielding adventurers from destructive energies of corrupted files. The <code class="inline-code">extractUniqueFilePaths</code> acts as a magical seeker, exploring nested configuration artifacts to locate valid paths. Finally, <code class="inline-code">formatAdventureConfigForPrompt</code> performs alchemy, reducing verbose configuration into a concise, optimized structure for divine interpreters like language models. These foundational spells are vital tools in ensuring the Repository of Knowledge serves the Guilds with balance and grace.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">readFileIfExists</code>: Graceful handling of file reading errors</li>
<li><code class="inline-code">parseAdventureConfig</code>: Robust loading and parsing of the adventure configuration artifact</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traversing nested paths to locate unique file references</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Formatting configuration for optimized prompt generation</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    // Missing or unreadable file is non-fatal
    return null;
  }
}
</code></pre>
<p>Just as a knight checks the gates of a castle, this function ensures the artifact is safely opened, and gracefully retreats when the gates are sealed.</p>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>Like a scholar interpreting an ancient text, this function deciphers and parses configurations, avoiding harm from corrupted manuscripts.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This seeker spell journeys through layers of labyrinthine configuration to unearth every viable artifact path.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths - LLM can see descriptions in actual code
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
    
    // Just function names - LLM can understand purpose from implementation
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }
    
    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p>This magic transforms verbose configuration into an optimized rune for interaction with the kingdom&#39;s mystical allies.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use a sample configuration file to observe how paths and files are extracted.</li>
<li>Experiment with nested JSON structures in configurations to test <code class="inline-code">extractUniqueFilePaths</code>.</li>
<li>Trace through the flow of <code class="inline-code">formatAdventureConfigForPrompt</code> to see how optimization decisions are made.</li>
</ul>
<hr>
<p>Armed with this knowledge, you stand ready to unlock the central gate of wisdom. Go forth, noble architect, and restore harmony to the Repository of Knowledge!</p>
<p>With the wisdom of ancient tomes and the courage of a true seeker, thou hast forged a dazzling cornerstone in the Foundation of Knowledge‚Äîonward, valiant hero, for the stars themselves bear witness to thy glorious ascent! ‚ö°üì°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>