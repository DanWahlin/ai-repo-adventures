<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Codex of Forgotten Paths - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Chronicles of the Enchanted Repository</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Codex of Forgotten Paths</h1>
<hr>
<p>In the mystical Kingdom of Repositoria, the Order of Codewrights speaks of a forgotten artifact hidden deep within the enchanted scrolls‚Äîthe Codex of Forgotten Paths. This ancient tome is said to hold the blueprint of all adventures, a relic with the power to illuminate even the most confusing labyrinths of code. With the shadow of corrupted structures spreading, you, the Hero of Syntax, must journey to uncover this Codex. Follow the trails concealed within the realm&#39;s configuration scripts and unlock the paths of clarity to deliver Repositoria from impending chaos.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Path Seeker&#39;s Inquiry</strong>: How does <code class="inline-code">parseAdventureConfig</code> retrieve and validate adventure configurations from the enchanted archives?</li>
<li>‚ö° <strong>Trail of Connections</strong>: What patterns in <code class="inline-code">extractUniqueFilePaths</code> ensure only valid and existing paths are considered for the quest?</li>
<li>üõ°Ô∏è <strong>Guard of Clear Syntax</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> streamline the configuration for use in prompts without losing critical data?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Mystical Keeper of Adventure Data</h3>
<p>This file is the gateway to deciphering adventure configuration in the kingdom. It plays a pivotal role in unlocking the knowledge encoded within enchanted files and ensuring that quest data is both valid and ready for use. With mechanisms for reading, parsing, and transforming configuration data, the spells crafted here are essential to maintaining order.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Retrieves raw configuration data, parses it into a usable object, and gracefully handles errors. It ensures that invalid configurations do not disrupt the adventure&#39;s flow.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Embarks on a traversal to discover all valid file paths referenced within the configuration, safeguarding against ghostly, non-existent references.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes adventure data for use in LLM prompts, reducing verbosity while preserving the essence of the configuration.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function retrieves the raw configuration text using <code class="inline-code">loadAdventureConfig</code>, attempts to parse it as JSON, and handles any errors with a fallback to <code class="inline-code">null</code>.</li>
<li>It centralizes JSON parsing and validation, ensuring all configurations follow the expected format.</li>
<li>By returning <code class="inline-code">null</code> on errors, this function contributes to the system&#39;s resilience against corrupted data.</li>
<li>It connects with <code class="inline-code">loadAdventureConfig</code> to form the first step in understanding configuration files.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function delves into the parsed configuration structure, recursively extracting unique file paths.</li>
<li>It validates each path to ensure it exists within the filesystem, filtering out any references to missing files.</li>
<li>By using a <code class="inline-code">Set</code> to gather paths, it ensures paths are unique and avoids duplicates.</li>
<li>This approach ensures the extracted file paths are both reliable and accurate for further processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function formats the adventure configuration to an optimized structure suitable for LLM prompts.</li>
<li>It extracts and organizes quest titles, associated file paths, and function names into a minimal but effective format.</li>
<li>By discarding verbose descriptions, it ensures the output is concise and focuses only on critical data.</li>
<li>This efficiency reduces the input token size, making it easier for large language models to process.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Practical Tip</strong>: Use <code class="inline-code">extractUniqueFilePaths</code> to verify paths before referencing external files in your project.</li>
<li><strong>Exploration Recommendation</strong>: Inspect configurations for common patterns to better understand adventure structures.</li>
<li><strong>Next Steps</strong>: Continue to refine quest generation by analyzing related files in the configuration and theme systems.</li>
</ul>
<hr>
<p>You have mastered all the secrets of Repositoria&#39;s enchanted codebase! Your adventure is complete.</p>
<p>By the luminous grace of the Celestial Archivist, you have unearthed the Codex of Forgotten Paths, unraveling ancient wisdom and bringing your heroic odyssey to its penultimate triumph‚Äîforge onward, valiant seeker, for the final chapter awaits! ‚≠ê‚ö°üìú</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>