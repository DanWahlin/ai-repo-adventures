<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Forge of Spells — Awakening the Adventure Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Elder Codex: Chronicles of the Enchanted Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Forge of Spells Awakens</h1>
<hr>
<p>As you step into the mystical workshop of the Elder Codex, a cacophony of flickering glyphs greets your arrival. The entire chamber hums with the energy of unruly magic—scripts binding the Codex’s vast repository unraveling like threads from a fraying tapestry. Guided by whispers of the ancient Order of Developers, your task here is no trifle; the forge must be reignited, powering the Adventure Engine that drives the kingdom’s spellwork. With a steady hand and sharp mind, the journey begins.</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a>: Core Server for the Adventure Framework</h3>
<p>This file serves as the backbone of the magical system, a bustling workshop where all interactions between the adventurer and the mystical MCP tools are facilitated. At the heart of it lies the <code class="inline-code">RepoAdventureServer</code>, a grand architect shaping the communication flows. The class takes charge of <strong>tool registration, request validation, and connection setup</strong>, ensuring that every interaction is precise and harmonious. A key highlight is the <code class="inline-code">setupHandlers()</code> method, which imbues the server with the ability to handle requests dynamically, validating each tool invocation using schemas provided by <em>Zod</em>—a meticulous enchanter of structure. Another noteworthy part is the <code class="inline-code">run()</code> method, which warms the arcane machinery by pre-generating the magical cache (Repomix content) for the project, allowing swift, uninterrupted operations during a quest.</p>
<p>Moreover, the steady hand of the <code class="inline-code">main()</code> function oversees the server&#39;s lifecycle, orchestrating its graceful shutdown during unforeseen disruptions. Signals such as <code class="inline-code">SIGINT</code> and <code class="inline-code">SIGTERM</code> are likened to the magical failsafe scripts installed to prevent the collapse of the Elder Codex. It acts as a vigilant sentinel guarding the workshop’s flow. This file is the lifeblood of the Adventure Engine, binding all its inner workings into a cohesive network.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers()</code>: Registers MCP handlers, validating inputs dynamically with schemas.</li>
<li><code class="inline-code">RepoAdventureServer.run()</code>: Sets up transport connections and prepares magical caches (Repomix content).</li>
<li><code class="inline-code">main()</code>: Oversees graceful server startup and shutdown processes, ensuring reliability.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a>: The Magical Toolbox</h3>
<p>This file houses the enchanted arsenal of MCP tools that adventurers rely on to explore the Elder Codex. Each tool represents a specific spell, designed to elegantly interact with the mythical knowledge repository. The tools include <code class="inline-code">start_adventure</code>, initiating the lore-bound journey by analyzing the codebase and presenting themed options; <code class="inline-code">choose_theme</code>, tailoring the adventure to the selected theme from the Elder Codex; <code class="inline-code">explore_quest</code>, enabling adventurers to immerse themselves in specific quests within the repository; and <code class="inline-code">view_progress</code>, offering enchanted charts to reveal completed tasks and upcoming challenges.</p>
<p>The file also acts as a bridge, neatly gathering tools into a single object (<code class="inline-code">tools</code>) for registration. The <code class="inline-code">adventureManager</code>—a trusted guide of these tools—is exported to maintain continuity between different tools and the core quest-management system. Each function in this toolbox plays a well-defined role, ensuring that no adventurer finds themselves lost in the labyrinth of quests.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure</code>: Analyzes repositories and presents theme choices to start quests.</li>
<li><code class="inline-code">choose_theme</code>: Builds tailored stories and quests that enhance immersion.</li>
<li><code class="inline-code">explore_quest</code>: Provides detailed interaction with specific quest files.</li>
<li><code class="inline-code">view_progress</code>: Displays progress charts for completed quests and remaining tasks.</li>
</ul>
<hr>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a></h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      // Execute the tool handler with validated arguments
      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>This method works like a spellbook, dynamically binding tools to requested actions with protective validation to ensure proper command execution.</p>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a></h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This export serves as an enchanted keyring, gathering all the individual tools into one place for adventurers to access with ease.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>If you are troubleshooting the <code class="inline-code">RepoAdventureServer</code>, focus on <code class="inline-code">setupHandlers()</code> to confirm tools are being correctly registered and validated.</li>
<li>When adding new tools, ensure they are both schema-validated and integrated into the <code class="inline-code">tools</code> object in <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> for seamless functionality.</li>
<li>Next, consider exploring how the <code class="inline-code">AdventureManager</code> ties tools to the story for a fully immersive adventure.</li>
</ul>
<p>Huzzah, brave seeker of wisdom, for you have kindled the sacred Flame of Potential within the Forge of Spells, igniting the Adventure Engine and taking your first valiant step toward eternal legend—may the stars themselves herald your triumph! ⚡💎🚀</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Mystic Gateway — Summoning ... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>