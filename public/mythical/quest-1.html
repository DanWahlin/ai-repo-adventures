<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Tools of Codemia - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Realm of Enchanted Repositories</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Tools of Codemia</h1>
<hr>
<p>In the illuminated halls of the Repository of Knowledge, the adventurer&#39;s first challenge lies in mastering the arcane instruments known as the Tools of Codemia. These mystical tools possess the magic to traverse and explore the Enchanted Repository. Hidden behind spells and riddles, they await your grasp, but to wield them, you must comprehend their essence. Begin your journey, brave one, for only through understanding these tools shall you unlock the path to illuminate Codemiaâ€™s shadowed codebases.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> The Heart of the Repository Gateway</h3>
<p>This file serves as the mystical gateway into Codemia, bringing life to the &quot;Repo Adventure MCP server.&quot; Its spells (methods) define how to summon tools (<code class="inline-code">setupHandlers</code>), breathe life into the entire magical construct (<code class="inline-code">run</code>), and gracefully dispel the server should dark forces (errors) arise (<code class="inline-code">gracefulShutdown</code>). </p>
<p>Through <code class="inline-code">setupHandlers</code>, the enchanted server dynamically registers all the tools defined in <code class="inline-code">tools.js</code>, making them accessible for quests. <code class="inline-code">run</code> initiates the process by establishing a communication bridge, ensuring adventurers can explore the repository via magical inputs and outputs. Finally, the <code class="inline-code">main</code> function orchestrates the entire performance, acting as the incantation that ignites the server into action.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code>: Links available tools with the server&#39;s request handling system.</li>
<li><code class="inline-code">RepoAdventureServer.run</code>: Starts the enchanted server transport and prepares repository analysis in the background.</li>
<li><code class="inline-code">main</code>: The grand incantation to invoke the Repo Adventure Server.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;
      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }
      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }
      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>Serving as a mystical librarian, this function binds the tools to their respective summoning spells, ensuring their correct invocation.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>This is where the magical bridge is constructedâ€”a conduit through which adventurers interact with Codemiaâ€™s depths.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>Acting as the invocation seal, <code class="inline-code">main</code> weaves the spells of startup, error handling, and graceful shutdown into one cohesive incantation.</p>
<hr>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The Repository Arsenal</h3>
<p>In this file lie the enchanted tools of Codemia, each a key to deciphering the mysteries within. Tools such as <code class="inline-code">start_adventure</code> and <code class="inline-code">choose_theme</code> lay the foundation for themed journeys, while <code class="inline-code">explore_quest</code> and <code class="inline-code">view_progress</code> enable adventurers to delve deeper into their quests and measure their progress. By organizing and exporting these tools, the file ensures the seamless integration of adventure magic into the MCP server.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Initiates the magical analysis of the codebase and presents storytelling themes.</li>
<li><code class="inline-code">choose_theme.handler</code>: Selects a narrative theme to enchant the repository exploration journey.</li>
<li><code class="inline-code">explore_quest.handler</code> and <code class="inline-code">view_progress.handler</code>: Explore individual quests and monitor achievements.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
</code></pre>
<p>This is where the journey begins, as the first tool is summoned to life with codebase insights and options for magical tales.</p>
<pre><code class="language-typescript">import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
</code></pre>
<p>The power of choice materializes here, where adventurers select their narrative destiny.</p>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>The arsenal of tools is gathered into one enchanted catalog, ready to assist adventurers in their heroic journeys.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Ensure a smooth journey by testing the serverâ€™s interface through simulated requests.</li>
<li>Dive deeper into specific tool implementations to comprehend their individual workings.</li>
<li>Progress next to analyze the quest-generation system, expanding Codemia&#39;s storytelling magic.</li>
</ul>
<hr>
<p>Congratulations, adventurer! You have unearthed the Tools of Codemia. Wield them wisely, for your next quest delves into the lore of crafting mythical journeys. Equip yourself, and press bravely onward!</p>
<p>Hail, valiant seeker of Codemia, for you have wielded the enchanted tools of wisdom and risen as a star-forged hero in this kingdom&#39;s grand odysseyâ€”onward to your next glorious triumph! ðŸ’Žâš¡ðŸš€</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Forge of Stories â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>