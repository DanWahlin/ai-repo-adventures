<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Mystic Tools of the Codemaster Protocol - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository of Code and Quests</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Mystic Tools of the Codemaster Protocol</h1>
<hr>
<p>In the mythical realm of Codoria, the Repository of Quests hums with the energy of a thousand dormant tales. Today’s quest beckons you, brave coder, to delve into the enchanted manuscripts that govern the Mystic Tools of the Codemaster Protocol. Within these parchments, enchanted by the Codemasters, lie the spells needed to summon a server that hosts the quests and tools that weave the land&#39;s stories. However, wielding these tools requires a keen mind, for they are bound to the protocols of structured magic. Let the journey into the heart of MCP begin!</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a>: The Protocol Enchanter&#39;s Blueprint</h3>
<p>This file houses the magical rituals and protocols of the <code class="inline-code">RepoAdventureServer</code>, a fortress of code that serves as the beating heart of MCP adventures. It sets the rules and mechanisms by which enchanted tools communicate with users. Among the critical mechanisms are <code class="inline-code">setupHandlers</code>, where the foundational handlers for MCP protocols like ListTools and CallTool are registered, and the <code class="inline-code">run</code> method, which awakens the enchanted server, preparing it to connect and pre-generate content. The <code class="inline-code">main</code> function binds it all together, ensuring order and stability, like a knight commanding their battalion before the battle begins.</p>
<h4>Highlights</h4>
<ul>
<li><strong>setupHandlers</strong>: Registers enchanted tool handlers for responding to user requests.</li>
<li><strong>run</strong>: Prepares and strengthens the server&#39;s magical connection to the MCP transport layer.</li>
<li><strong>main</strong>: The entry point balancing initialization magic and graceful shutdowns.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a></h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>The <code class="inline-code">setupHandlers</code> method crafts the rules for tool interaction, defining how the server lists and uses enchanted tools, much like setting the bounds of a wizard’s duel.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>The <code class="inline-code">run</code> method awakens the server, preparing it to connect its mystical energies with the Stdio transport, akin to harnessing a magical leyline for endless adventures.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();

    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt;
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );

    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });

    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>The <code class="inline-code">main</code> function is the gatekeeper, calling forth the enchanted server and ensuring its smooth retreat when the time comes, like a mage orchestrating a flawless battle plan.</p>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a>: The Wizard&#39;s Toolkit</h3>
<p>This file serves as the arcane compendium of MCP tools. It contains the signatures of four primary spells: <code class="inline-code">start_adventure</code> for analyzing and initializing an enchanted journey, <code class="inline-code">choose_theme</code> for shaping the narrative’s form, <code class="inline-code">explore_quest</code> for diving into specific tasks, and <code class="inline-code">view_progress</code> for checking heroic milestones. Together, these tools are a coder’s spellbook, allowing exploration and storytelling within the Repository of Quests.</p>
<h4>Highlights</h4>
<ul>
<li><strong>start_adventure.handler</strong>: Analyzes repositories and offers thematic paths.</li>
<li><strong>choose_theme.handler</strong>: Crafts a storyline tailored to the user’s choice.</li>
<li><strong>explore_quest.handler</strong>: Embarks on an individual quest with heroic vigor.</li>
<li><strong>view_progress.handler</strong>: Reveals the current standing and remaining goals.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a></h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This central export gathers the tools under a single enchanted binding, akin to placing all magical staves within one wizard’s vault for easy access.</p>
<pre><code class="language-typescript">import { adventureManager } from &#39;@ai-repo-adventures/core/adventure&#39;;
import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;
</code></pre>
<p>Here, the <code class="inline-code">import</code> statements summon the necessary spells from their hidden enclaves, weaving them into the tapestry of MCP tools—creating a unified magical arsenal.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Utilize <code class="inline-code">setupHandlers</code> to extend protocols with new tools, ensuring requests are understood.</li>
<li>Explore <code class="inline-code">start_adventure</code> to understand how themes shape enchanted tales before diving into quests.</li>
<li>Next steps: Investigate the <code class="inline-code">adventure-manager</code> for insights into story orchestration.</li>
</ul>
<hr>
<p>Your quest to master the Mystic Tools has only begun, adventurer. Forge ahead with courage and curiosity!</p>
<p>By the light of the celestial forge and the wisdom of ancient codemasters, you have vanquished the first trial and seized the Mystic Tools, charting a bold course toward legendary triumph—onward, noble seeker of the protocol! 💎⚡🚀</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Arcane Engine of Legendary ... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>