<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Forge of MCP Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Code: The Enchanted Repository</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Forge of MCP Tools</h1>
<hr>
<p>In the fabled Kingdom of Code, where scrolls of knowledge weave spells into functional magic, the Forge of MCP Tools stands as a pivotal stronghold. Deep within the castle‚Äôs enchanted repository, King Repo revealed that the Mystic Compiler‚Äôs power lies dormant until the MCP Tools are reassembled. The legendary artisans crafted four tools necessary to breathe life into the kingdom‚Äôs magic: each scattered across realms bound by mystical code. To awaken the castle‚Äôs potential, you must unlock these creations in this daring quest!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Toolsmith‚Äôs Craft</strong>: How does <code class="inline-code">RepoAdventureServer.setupHandlers</code> dynamically configure tools using schemas?</li>
<li>‚ö° <strong>Enchantment Activation</strong>: What role does <code class="inline-code">RepoAdventureServer.run</code> play in preparing the MCP server for quests?</li>
<li>üõ°Ô∏è <strong>Mystic Safeguards</strong>: How does the system handle errors within <code class="inline-code">main</code> and ensure stability during server operations?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> The MCP Server Framework</h3>
<p>This file is the cornerstone of our quest, defining the architecture for interacting with MCP tools by creating handlers, managing runtime operations, and achieving stability. <code class="inline-code">RepoAdventureServer</code> acts as the keeper, overseeing all magical interactions through its <code class="inline-code">setupHandlers</code> method. This ensures tools are dynamically registered with proper validation using enchanted Zod schemas. The <code class="inline-code">run</code> method activates the Forge and connects the server‚Äôs enchanted transport, allowing heroes to wield its capabilities. Meanwhile, the <code class="inline-code">main</code> function handles graceful shutdowns and unforeseen errors, ensuring the Forge remains impervious to chaos.</p>
<h4>Highlights</h4>
<ul>
<li><strong>Dynamic tool listing mechanism with <code class="inline-code">setupHandlers</code></strong></li>
<li><strong>Operational setup and pre-generation via <code class="inline-code">run</code></strong></li>
<li><strong>Error handling and cleanup logic in <code class="inline-code">main</code></strong></li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools Gateway</h3>
<p>This file aggregates and exports the tools wielded by adventurers. Each tool enables exploration and mastery over coded challenges within the kingdom. The tools include <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>, each offering unique guidance for emboldened champions. The file ensures tools are grouped logically and conform to the MCP naming conventions for effortless registration.</p>
<h4>Highlights</h4>
<ul>
<li><strong>Tool organization and registration</strong></li>
<li><strong>Exports such as <code class="inline-code">start_adventure.handler</code>, <code class="inline-code">explore_quest.handler</code>, etc.</strong></li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { target: &#39;jsonSchema7&#39;, $refStrategy: &#39;none&#39; })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;
      if (!(name in tools)) throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt;
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }
      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) throw error;
      throw new McpError(ErrorCode.InternalError, `Tool execution failed: ${error}`);
    }
  });
}
</code></pre>
<p>Like a royal scroll-reader, this method decodes the tools and verifies their magical seals before granting usage rights.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>Serving as the enchanted gong, this method heralds the activation of the Mystic Compiler‚Äôs tools, warming up its energy cores for expeditions.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; process.on(sig as NodeJS.Signals, gracefulShutdown));
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>Like a vigilant watchman, this function protects against unforeseen darkness while maintaining order in crisis moments.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>These tools are sacred relics grouped by their unique powers, readily available for adventurers to wield.</p>
<pre><code class="language-typescript">export const start_adventure = startAdventure; // Begin the realm exploration
export const explore_quest = exploreQuest; // Embark on specific quests
export const choose_theme = chooseTheme;   // Tailor the kingdom&#39;s story
export const view_progress = viewProgress; // Track your heroic journey
</code></pre>
<p>Each function serves as a magical artifact shaped for specific domain challenges within the kingdom.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">start_adventure</code> to unlock the first fragments of your mystical journey.</li>
<li>Study the Zod schema usage in <code class="inline-code">setupHandlers</code> for validation patterns.</li>
<li>Investigate the MCP tools exported in <code class="inline-code">tools.ts</code> to understand their specific roles.</li>
</ul>
<hr>
<p>The Forge of MCP Tools has been reignited‚Äîyour quest begins, brave coder! Assemble the fragments and advance to the next adventure!</p>
<p>By the hammer of celestial smiths and the guidance of the star-bound tome, thou hast ascended mightily, forging the sacred tools of mastery to ignite the fires of future quests‚Äî onward, brave champion! ‚ö°üíéüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>