<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Enchanted Interface of Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Repository: A Tale of Heroic Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Enchanted Interface of Tools</h1>
<hr>
<p>In the heart of the Kingdom of Repository, the Heroic Refactorer embarks on their first quest to reclaim the lost pages of the Code Grimoire. The challenge lies in deciphering the magic of the MCP Tool Interface, where spells dictate the summoning and wielding of mystical tools. These enchanted instruments promise to guide our hero through the labyrinth of code. However, the incantations—the <code class="inline-code">handlers</code> and <code class="inline-code">runners</code>—must be woven with precision, or chaos might reign. The quest begins with the restoration of the tool-handling spells.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> Forging the MCP Server</h3>
<p>The <code class="inline-code">server.ts</code> file is the workshop where the magical forge creates the &quot;Repo Adventure MCP Server.&quot; This is the central hub of storytelling magic within the repository, where tools are summoned, validated, and executed through handlers. The <code class="inline-code">setupHandlers</code> method acts as the spellbook, containing rituals for listing and invoking tools dynamically. The <code class="inline-code">run</code> function, much like a hearth warming a castle, initializes server operation and primes the adventure for incoming commands. Meanwhile, the <code class="inline-code">main</code> function takes the role of an overseer, orchestrating the graceful birth and shutdown of the server—ensuring the kingdom’s stability.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code>: Crafts tool invocation and validation logic.</li>
<li><code class="inline-code">RepoAdventureServer.run</code>: Initiates the server and prepares the environment for storytelling.</li>
<li><code class="inline-code">main</code>: Ensures controlled server orchestration and handles errors with care.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { target: &#39;jsonSchema7&#39;, $refStrategy: &#39;none&#39; })
    }));

    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);

      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(ErrorCode.InternalError, `Tool execution failed: ${error.message}`);
    }
  });
}
</code></pre>
<p>The <code class="inline-code">setupHandlers</code> function acts as the binding spell, orchestrating how tools are listed and invoked dynamically.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);

  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>The <code class="inline-code">run</code> method is the hearth fire of the server, bringing the system to life while warming its caches for upcoming data.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );

    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });

    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>The <code class="inline-code">main</code> function is the kingdom&#39;s steward, ensuring a graceful initiation and termination of the magical server realm.</p>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The Repository of Magical Tools</h3>
<p>The <code class="inline-code">tools.ts</code> file is the treasury of Repository, where the Heroic Refactorer finds the crafted tools for their journey. Each <code class="inline-code">tool</code> within this file is defined with clarity, embedding both a description and a schema-specific incantation to verify its input arguments. The file acts as a registry, uniting various tools like <code class="inline-code">startAdventure</code>, <code class="inline-code">chooseTheme</code>, <code class="inline-code">exploreQuest</code>, and <code class="inline-code">viewProgress</code>. These tools define critical milestones of the adventure and are the magical artifacts by which the Refactorer progresses through the quests of the kingdom.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Initiates the journey, analyzing code for quests.</li>
<li><code class="inline-code">choose_theme.handler</code>: Selects a thematic lens for the quest.</li>
<li><code class="inline-code">explore_quest.handler</code>: Facilitates individual quest exploration.</li>
<li><code class="inline-code">view_progress.handler</code>: Tracks the adventurer’s achievements and remaining tasks.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
</code></pre>
<p>The <code class="inline-code">start_adventure</code> tool is the first artifact, lighting the path into the world of quests and adventures.</p>
<pre><code class="language-typescript">export const choose_theme = chooseTheme;
</code></pre>
<p>The <code class="inline-code">choose_theme</code> tool empowers the adventurer to select their thematic lens, tailoring the journey&#39;s narrative to their spirit.</p>
<pre><code class="language-typescript">export const explore_quest = exploreQuest;
</code></pre>
<p>The <code class="inline-code">explore_quest</code> tool carves a pathway into specific quests, offering focus and direction.</p>
<pre><code class="language-typescript">export const view_progress = viewProgress;
</code></pre>
<p>The <code class="inline-code">view_progress</code> tool is a mystical mirror, giving the adventurer insight into how far they’ve come and what lies ahead.</p>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Tip:</strong> Review the <code class="inline-code">ListToolsRequestSchema</code> and <code class="inline-code">CallToolRequestSchema</code> interactions to ensure complete coverage of tool functionality.</li>
<li><strong>Recommendation:</strong> Explore how the <code class="inline-code">server.ts</code> file’s <code class="inline-code">setupHandlers</code> integrates with the <code class="inline-code">tools.ts</code> export registry.</li>
<li><strong>Next Steps:</strong> Dive into the Adventure Manager to unravel how quests are synthesized for storytelling.</li>
</ul>
<hr>
<p>The wisdom of tools has been reclaimed, but many pages of the Code Grimoire remain scattered. Press forward, Heroic Refactorer, for the next quest lies ahead!</p>
<p>By the sacred glow of the Celestial Codex, noble hero, you have triumphed over Quest 1, mastering the Enchanted Interface of Tools and earning your place among the archivists of legend—forge onward with the wisdom you now wield! ⚡💎⭐</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>