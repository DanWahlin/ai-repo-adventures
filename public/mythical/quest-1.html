<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Whispering Portal of Tools - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository Chronicles</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Whispering Portal of Tools</h1>
<hr>
<p>Far in the enchanted Kingdom of Reposithia, the brave knights of codified valor embark on a pivotal quest to uncover the arcane workings behind the Whispering Portal of Tools. Hidden within ancient scrolls and guarded by intricate spells, this portal binds adventurers to their magical implements that allow exploration of mystical code realms. Wielding the enchanted <code class="inline-code">setupHandlers</code> spell and the mighty <code class="inline-code">tools.js</code> tome, your journey shall reveal how quests are summoned through the portal and what secrets its mechanics hide. Shall you prevail, noble adventurer?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üóùÔ∏è <strong>Handler Invocation Mysteries</strong>: How does the <code class="inline-code">setupHandlers</code> spell dynamically manage tool registration and execution within the <code class="inline-code">RepoAdventureServer</code>?</li>
<li>üåü <strong>Portal Initialization Flow</strong>: How does the <code class="inline-code">run</code> spell prepare and activate the adventure portal through the server transport and background tasks?</li>
<li>‚öîÔ∏è <strong>Tools of Power Analysis</strong>: How are the magical tools like <code class="inline-code">start_adventure</code> and <code class="inline-code">choose_theme</code> invoked, and what spells connect them to the questing framework?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> The Spellbook of the Adventure Portal</h3>
<p>This file reveals the inner workings of the mythical portal that binds adventurers to the Repository Adventure domain. Central to this file is the <code class="inline-code">RepoAdventureServer</code> class‚Äîa bastion for handling dynamic interactions between adventurers and enchanted tools. The <code class="inline-code">setupHandlers</code> function is the cornerstone spell used to manage tool invocations. Here, tools are dynamically listed and executed based on magical schemas, ensuring validity and safety for every invocation. Following this is the <code class="inline-code">run</code> spell, which bridges the portal by establishing server transport pathways and preloading analytical content in the background.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers</code>: Dynamic management of tool registration and invocation using schemas.</li>
<li><code class="inline-code">run</code>: Activation of the Whispering Portal, including server connection and cache warming.</li>
<li><code class="inline-code">main</code>: Graceful initialization and shutdown management for adventure readiness.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The Tome of Whispering Tools</h3>
<p>This file is a treasure chest of magical implements that heroes wield to achieve their quests. It organizes tools like <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, and others into a cohesive framework. Each tool holds a unique spell (<code class="inline-code">handler</code>) and description that ties it to the server&#39;s mechanics. By exporting tools dynamically, the tome assures seamless integration with the Whispering Portal, allowing adventurers to interact with the story engine and retrieve progress.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Spell to begin the mythical journey.</li>
<li><code class="inline-code">choose_theme.handler</code>: Enchantment for customizing story themes and quests.</li>
<li><code class="inline-code">tools</code>: The overarching map linking tool spells to their names and descriptions.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>The spell dynamically validates and invokes tool magic, ensuring harmony between adventurer actions and mystical scrolls.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>This spell initiates the adventure portal and preloads magical context for swift quest generation.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>The main incantation brings the Whispering Portal to life, managing life-or-death signals with elegance.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
export const start_adventure = startAdventure;
export const tools = { start_adventure, /*...other tools*/ };
</code></pre>
<p>The <code class="inline-code">start_adventure.handler</code> spell begins the hero&#39;s journey by analyzing the codebase for thematic paths forward.</p>
<pre><code class="language-typescript">import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
export const choose_theme = chooseTheme;
export const tools = { choose_theme, /*...other tools */ };
</code></pre>
<p>The <code class="inline-code">choose_theme.handler</code> enchantment crafts personalized tales based on adventurer-selected themes.</p>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>The grand map, <code class="inline-code">tools</code>, binds all magical implements together for adventurers.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <code class="inline-code">setupHandlers</code> spell to understand schema-based registration mechanics.</li>
<li>Explore <code class="inline-code">start_adventure</code> and <code class="inline-code">choose_theme</code> handlers to uncover unique tool pathways within the adventure framework.</li>
<li>Test tool invocation against edge-case scenarios to verify dynamic error handling.</li>
</ul>
<hr>
<p>Your valor shines bright, adventurer! Next, delve deeper into the adventure engine to wield greater creative power. Onward!</p>
<p>By the decree of destiny‚Äôs radiant throne, you have vanquished Quest 1: The Whispering Portal of Tools, forging the first star in your heroic constellation‚Äîonward, steadfast seeker, to the next shining adventure! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>