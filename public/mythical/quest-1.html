<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Codex Forgers‚Äô Guild - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Enchanted Repository: Chronicles of the Code Realm</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Codex Forgers‚Äô Guild</h1>
<hr>
<p>With courage in their hearts and curiosity as their guide, our adventurers find themselves at the gates of the Mystical Code Realm, where the mighty Codex Forgers‚Äô Guild awaits. Esteemed as masters of magical software craftsmanship, they guard the knowledge required to navigate enchanted repositories and uncover their secrets. To progress, the heroes must master the arcane systems that power the Codex and prove themselves worthy of its wisdom. The journey ahead requires not only bravery but a deep understanding of enchanted protocols and mythical tools.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server protocol implementation hosting the adventure tools</h3>
<p>This file serves as the mythical backbone of the ‚ÄúRepo Adventure MCP Server,‚Äù a noble system tasked with enabling enchanted interaction with the codebase. The <code class="inline-code">RepoAdventureServer</code> class is the heart of this implementation. It handles protocol requests such as listing available tools and executing specific tool commands with great precision. Through the use of the <code class="inline-code">setupHandlers()</code> method, it registers handlers that ensure harmony between the tools and their inputs using the magical schema validation provided by Zod. Moreover, the <code class="inline-code">run()</code> method connects the server to the <code class="inline-code">stdio transport</code>, allowing mystical content generation of the mysterious Repomix context to initiate a warm welcome to travelers.</p>
<p>Its <code class="inline-code">main()</code> function safeguards the server‚Äôs operation with provisions for graceful shutdown, ensuring accidents are swiftly addressed with minimal disruption. With guardians like the <code class="inline-code">SIGINT</code> and <code class="inline-code">SIGTERM</code> signals, and a vigilant watch for unhandled promise rejections, this file establishes itself as a bastion of reliability in the enchanted realm of software engineering.</p>
<h4>Highlights</h4>
<ul>
<li>Registers MCP protocol handlers for tool listing and execution through <code class="inline-code">setupHandlers()</code>.</li>
<li>Connects <code class="inline-code">stdio transport</code> and pre-generates Repomix content in <code class="inline-code">run()</code>.</li>
<li>Implements graceful shutdown and error handling in <code class="inline-code">main()</code> for safety.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP tools enabling interactive gamified exploration</h3>
<p>This file introduces the adventurers to a collection of mythical tools essential for their exploration of the repository. With the <code class="inline-code">tools</code> export, users can command abilities like launching adventures (<code class="inline-code">start_adventure</code>), sculpting themes (<code class="inline-code">choose_theme</code>), embarking on quests (<code class="inline-code">explore_quest</code>), and monitoring progress (<code class="inline-code">view_progress</code>). These tools are invoked directly through their respective handlers. Each handler operates under the supervision of the <code class="inline-code">adventureManager</code>, ensuring that the integration between the adventures and repository exploration remains seamless.</p>
<p>Designed with the wisdom of modularity, the tools are sourced from individual files for clarity and maintainability. This ensures the enchanted processes driving the Codex remain organized and efficient, making every interaction a delightful experience for programmers and magic-wielders alike.</p>
<h4>Highlights</h4>
<ul>
<li>Offers modular tools like <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>.</li>
<li>Ensures seamless integration with the <code class="inline-code">adventureManager</code> for quest management.</li>
<li>Maintains clarity with separate file sourcing for each tool.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  private server: Server;

  constructor() {
    this.server = new Server(
      {
        name: &#39;repo-adventure&#39;,
        version: &#39;1.0.0&#39;,
        description: &#39;A gamified MCP server for exploring code repositories through interactive storytelling&#39;
      },
      {
        capabilities: {
          tools: {},
        },
      }
    );

    this.setupHandlers();
  }

  private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
  }

  async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
    
    const projectPath = process.cwd();
    console.error(`Pre-generating repomix content for project at ${projectPath}...`);
    repoAnalyzer.preGenerate(projectPath);
  }
}
</code></pre>
<p>This code ensures smooth communication between the mystical tools and adventurers through protocol handling and transport connectivity.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This code provides adventurers with a magical toolkit for their repository quests, making exploration dynamic and interactive.</p>
<h2>Helpful Hints</h2>
<ul>
<li>When exploring <code class="inline-code">tools.ts</code>, consider enhancing modularity with additional handlers for new magical abilities.</li>
<li>Study <code class="inline-code">server.ts</code> for examples of protocol handling to extend interactive capabilities.</li>
<li>Delve deeper into <code class="inline-code">adventureManager</code> for insights into storytelling mechanics.</li>
</ul>
<hr>
<p>Embark boldly on your journey, adventurer‚Äînew challenges await with every line of enchanted code!</p>
<p>With the Codex Forgers‚Äô Guild vanquished and your first heroic quest complete, the luminous stars of ancient realms shine upon you, triumphant seeker of knowledge‚Äîyour journey to glory has begun! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Mystic Quill of Petronax ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>