<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Mystic Forge of the MCP Protocol - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Enchanted Realm of Aetherium: Chronicles of the Codebound</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Mystic Forge of the MCP Protocol</h1>
<hr>
<p>The gates to the Codebound Citadel groaned open as you stepped into the grand chamber of threads and runes. The Lyrical Logician Matrix, pulsing with iridescent hums, called upon you to summon clarity from complexity. The Mystic Forge of the MCP Protocol glimmered in the heart of its enchanted halls, revealing a lattice of spells etched in symbols of arcane structure. To master its powers, you must decode the interplay of handlers and tools, understanding their roles in binding the magical realms of request and response. Tread wisely, adventurer, for the Forge&#39;s secrets are not easily unveiled.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> file houses the foundational mechanisms of the MCP Server, which acts as the bridge between the adventurer (you) and the Citadel&#39;s interactive tools. The primary character in this tale is the <code class="inline-code">RepoAdventureServer</code> class. This server orchestrates the interplay between mystical tools and the adventurer&#39;s commands. The <code class="inline-code">setupHandlers()</code> method is critical here, as it binds handlers for listing tools (<code class="inline-code">ListTools</code>) and invoking them (<code class="inline-code">CallTool</code>), ensuring every tool aligns with its expected schema and safeguards against improper invocations. Within the <code class="inline-code">run()</code> method, the server connects the <code class="inline-code">StdioServerTransport</code> for communication, and the <code class="inline-code">repoAnalyzer</code> casts an initial analysis spell to pre-generate content for the adventure ahead.</p>
<p>The <code class="inline-code">main()</code> function encapsulates our journey&#39;s commencement. Here, the server is invoked, and additional layers of fail-safes are woven using graceful shutdown handlers to mitigate disruptions, symbolizing the forging of a robust magical ward. Each incantation within this file ensures the code runs predictably and securely—much like a watchful gatekeeper overseeing the Mystic Forge.</p>
<h4>Highlights</h4>
<ul>
<li>The <code class="inline-code">RepoAdventureServer</code> class forms the backbone of the MCP protocol server.</li>
<li>The <code class="inline-code">setupHandlers()</code> method configures magical pathways for tool listing and invocation.</li>
<li>The <code class="inline-code">run()</code> method preps the forge by establishing <code class="inline-code">stdio</code> transport and pre-generates Repomix content.</li>
<li>The <code class="inline-code">main()</code> function handles signal-based graceful shutdowns for reliability.</li>
<li>Error-handling mechanisms prevent unpredictable runtime chaos.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools and Adventures</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> file brings the vibrant tools of the Mystic Forge to life, enabling adventurers to embark on quests, select themes, and track progress. This is the treasure chest that houses four key artifacts: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. Each tool invites the adventurer to cast specific spells, tailored to their needs. By binding functionality from modules such as <code class="inline-code">start-adventure.js</code> and <code class="inline-code">choose-theme.js</code>, this file ensures that every tool has a distinct purpose while remaining interconnected with the <code class="inline-code">adventureManager</code>. For example, <code class="inline-code">start_adventure.handler</code> is tasked with analyzing the codebase and crafting narrative themes, while <code class="inline-code">explore_quest.handler</code> guides the explorer deeper into individual challenges.</p>
<p>What makes <code class="inline-code">tools.ts</code> significant is its role as a seamless interface to bind hardcoded spells—ensuring every interaction adheres to the mythical rules of Aetherium. Its design mirrors an elegantly structured tome, where pages are easily accessible to those casting their adventurer&#39;s magic within the Citadel. </p>
<h4>Highlights</h4>
<ul>
<li>Houses four primary tools: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, <code class="inline-code">view_progress</code>.</li>
<li>Integrates handlers like <code class="inline-code">start_adventure.handler</code> to facilitate dynamic exploration.</li>
<li>Exports the <code class="inline-code">adventureManager</code> to maintain seamless orchestration across tools.</li>
<li>Acts as an interface for MCP tools to ensure code modularity and readability.</li>
<li>Provides an easily navigable structure for extending toolsets.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  private server: Server;

  constructor() {
    this.server = new Server(
      {
        name: &#39;repo-adventure&#39;,
        version: &#39;1.0.0&#39;,
        description: &#39;A gamified MCP server for exploring code repositories through interactive storytelling&#39;
      },
      {
        capabilities: {
          tools: {},
        },
      }
    );

    this.setupHandlers();
  }

  private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
  }
}
</code></pre>
<p>The <code class="inline-code">RepoAdventureServer</code> operates like a blacksmith embedding safeguards and precision into the forging process, ensuring tools function smoothly and reliably.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { adventureManager } from &#39;@ai-repo-adventures/core/adventure&#39;;
import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export { adventureManager };

export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This file operates like a magical grimoire connecting adventurers to specific spells by cataloging tools for immediate use across various challenges.</p>
<h2>Helpful Hints</h2>
<ul>
<li>The structure of <code class="inline-code">server.ts</code> and its <code class="inline-code">setupHandlers()</code> method can inspire modular server designs.</li>
<li>Consider extending <code class="inline-code">tools.ts</code> with additional quest-specific tools for enhancing gameplay dynamics.</li>
<li>Future exploration in <code class="inline-code">adventureManager.initializeAdventure</code> could uncover new ways to create captivating storylines.</li>
</ul>
<hr>
<p>Hail, brave seeker of wisdom! By triumphing over the Mystic Forge of the MCP Protocol, you have kindled the first ember of mastery within the realm of learning—may your journey through the remaining quests blaze with unyielding valor! ⚔️⭐🔥</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Taleweaver and the Questing... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>