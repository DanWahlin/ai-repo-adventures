<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öîÔ∏è Quest 5: The Eternal Sentinel of the Repository - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <script>
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">üè∞ The Enchanted Repository: Chronicles of Codethia</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1><span class="header-prefix">‚öîÔ∏è Quest 5:</span> The Eternal Sentinel of the Repository</h1>
<hr>
<p>The enchanted Repository of Codethia loomed before you, the air heavy with the hum of protective wards layered over centuries. Deep within, the Eternal Sentinel waited‚Äîa mystical construct of logic and lore, guarding the Repomix Grimoire‚Äôs secrets. Only the Codewalker, armed with enchanted tools, could face the challenges of this sacred place. As faint whispers of forgotten spells echoed off the obsidian walls, you knew that unraveling the mysteries of the repository&#39;s configuration was crucial to restoring balance to the disarrayed realms.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">src/shared/adventure-config.ts:</span> Configuration system for guided adventures</h3>
<p>This file acts as the cornerstone for managing adventure configurations across Codethia&#39;s quests. At its heart is the logic for reading, parsing, and formatting adventure data stored in <code class="inline-code">adventure.config.json</code>. The configurations ensure that each challenge in the repository aligns closely with the overarching goals of the quest. By traversing nested structures, it extracts paths to files that the Codewalker must analyze, validating their presence and filtering out noise. Furthermore, it transforms intricate configurations into perfectly structured prompts that can guide mystic artifices like the LLM toward crafting immersive adventures. The power of this file lies in its sanctity as a trusted map-reading tool, charting the pathways through the enchanted codebase.</p>
<h4>Highlights</h4>
<ul>
<li><strong>loadAdventureConfig</strong>: Retrieves raw adventure configuration data for validation and safe parsing.</li>
<li><strong>extractUniqueFilePaths</strong>: Navigates through nested objects to collect and deduplicate file paths referenced in the configuration, ensuring no sigil-marked scroll goes unnoticed.</li>
<li><strong>formatAdventureConfigForPrompt</strong>: Transforms structured adventure details into a clear prompt for magical storytelling.</li>
</ul>
<h2>Code</h2>
<h3>src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">const ADVENTURE_CONFIG_FILE = &#39;adventure.config.json&#39;;

function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    // Missing or unreadable file is non-fatal
    return null;
  }
}

/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<p>Just as an adventurer might consult a weathered map before traversing a forest, this code ensures configurations are retrieved safely before undertaking significant steps.</p>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This function is akin to a mystic diviner patiently sifting through sands to locate shards of hidden truth, ensuring that every thread of adventurer lore is accounted for.</p>
<pre><code class="language-typescript">/**
 * Formats adventure config into a readable format for LLM prompts
 * This ensures structured sections always appear in quest content
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure Guidelines\n\n`;
  formatted += `**CRITICAL: Each quest MUST include dedicated file analysis sections**\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    formatted += `${quest.description}\n\n`;
    formatted += `**Required File Analysis Sections:**\n`;

    for (const file of quest.files) {
      if (!file.path || !file.description) continue;

      formatted += `\n**File: \`${file.path}\`**\n`;
      formatted += `- Description: ${file.description}\n`;
      
      if (Array.isArray(file.highlights)) {
        formatted += `- Key Functions/Areas to Highlight:\n`;
        for (const highlight of file.highlights) {
          if (highlight.name &amp;&amp; highlight.description) {
            formatted += `  ‚Ä¢ **${highlight.name}**: ${highlight.description}\n`;
          }
        }
      }
    }
    formatted += `\n`;
  }

  formatted += `\n**FORMATTING INSTRUCTIONS:**\n`;
  formatted += `- Each file mentioned in the quest structure above MUST have its own dedicated analysis section\n`;
  formatted += `- **MANDATORY**: Include at least 2-3 separate code snippet sections (## filename) with real code blocks\n`;
  formatted += `- Show actual function signatures, imports, class definitions, or key methods from the files\n`;
  formatted += `- Include real code snippets from the actual files (never invent code)\n`;
  formatted += `- Provide practical explanations using real-world analogies\n`;
  formatted += `- End with helpful hints and next steps\n`;

  return formatted;
}
</code></pre>
<p>In the same way a scribe might meticulously prepare a scroll for a grand tale, this function transforms raw data into an eloquent, compelling narrative for the repository‚Äôs magical systems.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Clear and consistent formatting of adventure configurations maximizes their utility across both quests and storytelling.</li>
<li>Consider expanding <code class="inline-code">extractUniqueFilePaths</code> with additional validation layers to ensure its adaptability to future repository changes.</li>
<li>Dive into <code class="inline-code">story-generator.ts</code> next to see how these formatted prompts manifest in Codethia&#39;s enchanting narratives.</li>
</ul>
<hr>
<p>Hail, valiant hero, for with unyielding resolve and wisdom shining brighter than stars upon the astral tapestry, you have vanquished the Eternal Sentinel of the Repository and drawn ever closer to the final triumph of your legendary odyssey! ‚≠ê‚öîÔ∏èüíé</p>

</div>


    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/mcp-repo-adventure" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>