<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Crystal Citadel of Revelations - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Codebase of Eldoria</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Crystal Citadel of Revelations</h1>
<hr>
<p>The time has come, noble adventurer! You stand at the gates of the Crystal Citadel of Revelations, a shimmering stronghold of forbidden knowledge and glittering truths. Towering above the enchanted kingdom of Eldoria, this magical fortress houses the most intricate treasures of the legendary codebase. But beware‚Äîonly those with unwavering determination and a sharp mind can uncover the final secrets within its radiant walls. To breach its defenses means diving into the heart of the kingdom‚Äôs enchanted systems, unraveling their mysteries, and revealing the truths that bind this world together. Steel yourself, for this is the final chapter of your mythical journey!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>The Codex Timestamps</strong>: How does the system enforce and manage time-sensitive parameters across quest file handling and requests?</li>
<li>‚ö° <strong>Dragon‚Äôs Payload</strong>: What safeguards exist to handle excessive data loads or malformed inputs during the quest generation process?</li>
<li>üõ°Ô∏è <strong>The Heart of the Citadel</strong>: How does the system ensure that themes and adventure validation remain consistent, even when custom configurations are introduced?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Adventure configuration utilities</h3>
<p>This file serves as the foundation for handling the Citadel‚Äôs magical settings‚Äîparsing JSON-based adventure configurations while exposing various facilities to validate and browse included file paths. These tools ensure that quests can dynamically adapt to the unique themes of Eldoria! With key methods like <code class="inline-code">formatAdventureConfigForPrompt</code>, <code class="inline-code">parseAdventureConfig</code>, and <code class="inline-code">extractUniqueFilePaths</code>, this file shapes the storytelling capabilities of the enchanted repository.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Converts configuration data into a concise, AI-optimized format, crucial for reducing payload size and improving system comprehension during generation.</li>
<li><code class="inline-code">parseAdventureConfig</code>: A single entry point for safely parsing and validating adventure settings, ensuring resilience to corrupted or missing configuration data.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Recursively traverses adventure configurations to identify valid path entries, enforcing checks for existence and removing redundancy.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Constructs condensed adventure instructions for AI systems, emphasizing brevity and precision.</li>
<li>Combines format rules into a single process, eliminating redundant data while maintaining readability.</li>
<li>Reduces payload size significantly, optimizing interaction with the generative system.</li>
<li>Handles null or malformed data defensively, a critical feature for maintaining consistent operations.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Ensures safe parsing of adventure configurations without exposing errors externally.</li>
<li>Filters missing or invalid input early in the pipeline, improving overall system robustness.</li>
<li>Demonstrates straightforward error handling through defensive coding patterns.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Implements depth-first search logic to process adventure paths dynamically.</li>
<li>Validates the existence of file paths while simultaneously ensuring idempotency via a <code class="inline-code">Set</code>.</li>
<li>Balances traversal flexibility with sturdy validation measures to prevent invalid references from propagating.</li>
</ul>
<h2>Helpful Hints</h2>
<ul>
<li>üßô <strong>Map Your Journey</strong>: Focus on how <code class="inline-code">formatAdventureConfigForPrompt</code> contributes to tailored narratives across adventures.</li>
<li>üõ°Ô∏è <strong>Guard Against the Void</strong>: Study the defensive coding techniques in <code class="inline-code">parseAdventureConfig</code> for handling invalid inputs.</li>
<li>üîÆ <strong>Uncover the Paths</strong>: Trace the recursive logic in <code class="inline-code">extractUniqueFilePaths</code>‚Äîa critical mechanism for ensuring robust file processing.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the enchanted kingdom‚Äôs systems! The Crystal Citadel of Revelations has bestowed upon you its ultimate wisdom. Your adventure is complete.</p>
<p>By the grace of the Celestial Oracles and with the brilliance of the Crystal Citadel&#39;s revelations now etched in your mind, you stand as a star-forged hero, just one trial away from eternal glory‚Äîonward to your grand destiny! ‚≠ê üíé üëÅÔ∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>