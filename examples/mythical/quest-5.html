<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Spellbook of Configuration - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Repository Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Spellbook of Configuration</h1>
<hr>
<p>In the heart of Codethia, where the lines between technology and magic blur, the Spellbook of Configuration lies bound within the Enchanted Repository. This ancient tome holds the incantations to control the kingdom&#39;s most powerful systems‚Äîdetermining the limits of their knowledge, the speed of their spells, and the depth of their explorations. Only those who dare to unravel its structured secrets may wield its power to forge order from chaos. But beware, for the dragons of misconfiguration lurk in the shadows, ready to sow discord.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>Configuration Limits</strong>: How key constraints like file size and timeout durations are enforced for stability.</li>
<li>üîç <strong>Theme Abstraction</strong>: How themes are represented as structured data and dynamically parsed for user input.</li>
<li>‚ö° <strong>Validation Patterns</strong>: How input validation ensures safe and predictable interactions with the system.</li>
<li>üí° <strong>Dynamic File Parsing</strong>: How adventure configurations are loaded, parsed, and transformed into actionable content.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/config.ts</code></a></h3>
<p>The <code class="inline-code">config.ts</code> file is the grimoire of system-wide constants and environment variables, governing timeouts, resource limits, and LLM configuration. Its design ensures the system remains robust and adaptable, centralizing all critical parameters to simplify debugging and fine-tuning.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> defines the maximum duration for story generation, balancing complexity with responsiveness.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> specifies the cache duration for repository analysis results, optimizing performance.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> sets the upper limit for file size, preventing memory exhaustion during analysis.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = parseInt(process.env.REPO_ADV_LLM_REQUEST_TIMEOUT || &#39;60000&#39;); // 60 seconds
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPO_ADV_REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds cache
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than 10MB
</code></pre>
<ul>
<li>These constants enforce boundaries to maintain system performance and reliability.</li>
<li>The use of environment variables allows for flexible overrides in different environments.</li>
<li>Centralized configuration simplifies changes and ensures consistent behavior across the codebase.</li>
<li>The constraints guard against resource overuse, ensuring the system remains responsive under heavy loads.</li>
<li>Constants are explicitly typed, ensuring clarity and preventing errors during usage.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a></h3>
<p>The <code class="inline-code">theme.ts</code> file is the codex of enchanted themes, defining the structure and attributes of each adventure&#39;s aesthetic. It provides the logic for theme selection, parsing, and formatting, ensuring that user input aligns with the available options.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code> encapsulates all predefined themes as structured data, each with unique identifiers and descriptions.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L93" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseTheme</code></a> dynamically matches user input to a valid theme, offering flexibility in how themes are selected.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L120" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatThemeOption</code></a> generates user-friendly descriptions for display in the CLI.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: { id: 1, key: &#39;space&#39;, displayName: &#39;Space Exploration&#39;, emoji: &#39;üöÄ&#39;, description: &#39;Journey through cosmic codebases...&#39; },
  MYTHICAL: { id: 2, key: &#39;mythical&#39;, displayName: &#39;Enchanted Kingdom&#39;, emoji: &#39;üè∞&#39;, description: &#39;Explore magical realms...&#39; },
  ANCIENT: { id: 3, key: &#39;ancient&#39;, displayName: &#39;Ancient Civilization&#39;, emoji: &#39;üè∫&#39;, description: &#39;Discover lost temples...&#39; }
};
</code></pre>
<ul>
<li>Themes are defined as objects, making them easily extendable with new properties.</li>
<li>The use of <code class="inline-code">id</code>, <code class="inline-code">key</code>, and <code class="inline-code">description</code> ensures themes are accessible and descriptive.</li>
<li>Each theme is tied to an emoji, adding a visual element that enhances user engagement.</li>
<li>The structure is simple yet powerful, enabling dynamic theme parsing and validation.</li>
<li>This abstraction separates theme logic from other system components, promoting modularity.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  const normalized = input.trim().toLowerCase();
  return THEMES_ARRAY.find(theme =&gt; theme.key === normalized || theme.keywords.some(k =&gt; normalized.includes(k)))?.key || null;
}
</code></pre>
<ul>
<li>This function normalizes and validates user input, ensuring robust theme selection.</li>
<li>It supports multiple ways to match themes, enhancing flexibility and user experience.</li>
<li>By using keywords, the system can interpret vague user input intelligently.</li>
<li>The implementation minimizes errors by returning <code class="inline-code">null</code> for invalid themes.</li>
<li>Parsing logic is decoupled from other components, making it reusable and easily testable.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a></h3>
<p>The <code class="inline-code">input-validator.ts</code> file is the shield of Codethia, defending the system from malicious or invalid input. Its functions ensure that all data entering the system adheres to strict validation rules, safeguarding against errors and exploits.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L9" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateAdventureChoice</code></a> ensures user adventure choices are non-empty and within length constraints.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a> verifies that selected themes are valid and supported by the system.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L37" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateProjectPath</code></a> sanitizes and normalizes project paths for safe file operations.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  if (input.length &gt; VALIDATION_MAX_CHOICE_LENGTH) {
    throw new Error(`Choice too long (max ${VALIDATION_MAX_CHOICE_LENGTH} characters)`);
  }
  return input.trim();
}
</code></pre>
<ul>
<li>This function prevents empty or excessively long inputs, enforcing strict user input constraints.</li>
<li>Error messages are descriptive, guiding users to provide valid inputs.</li>
<li>The use of <code class="inline-code">trim</code> ensures that leading and trailing spaces do not cause validation issues.</li>
<li>Centralizing validation logic improves maintainability and reduces duplication.</li>
<li>Validation errors are thrown early, preventing invalid data from propagating through the system.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  if (input.length &gt; VALIDATION_MAX_PATH_LENGTH) {
    throw new Error(`Project path too long (max ${VALIDATION_MAX_PATH_LENGTH} characters)`);
  }
  return input.trim();
}
</code></pre>
<ul>
<li>This function ensures project paths are valid and defaults to the current directory when none is provided.</li>
<li>Length checks prevent excessively large paths that could cause system errors.</li>
<li>Returning normalized paths enhances consistency and prevents file system issues.</li>
<li>The use of <code class="inline-code">process.cwd</code> as a default ensures usability while maintaining safety.</li>
<li>Error handling provides clear feedback, helping users correct their inputs.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<p>The <code class="inline-code">adventure-config.ts</code> file is the mapmaker of Codethia, transforming raw configuration data into actionable quests. It handles file reading, JSON parsing, and extracting key information for the adventure system.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L19" target="_blank" rel="noopener noreferrer"><code class="inline-code">loadAdventureConfig</code></a> reads and returns raw configuration data, ensuring the file exists and is accessible.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L28" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseAdventureConfig</code></a> parses the configuration into a structured object, handling errors gracefully.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a> prepares a condensed configuration summary for use in LLM prompts.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, &#39;adventure.config.json&#39;);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This function abstracts file reading, ensuring missing files do not crash the system.</li>
<li>The use of <code class="inline-code">path.join</code> ensures cross-platform compatibility.</li>
<li>Returning <code class="inline-code">null</code> for missing files provides a clear contract for error handling in caller functions.</li>
<li>The design supports reuse in multiple contexts, making it a versatile utility.</li>
<li>Encapsulation of file access simplifies testing and debugging.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }
  let formatted = `## Quest Structure\n`;
  const quests = (parsed as any).adventure?.quests || [];
  quests.forEach((quest: any) =&gt; {
    formatted += `### ${quest.title}\nFiles: ${quest.files?.map((f: any) =&gt; f.path).join(&#39;, &#39;) || &#39;&#39;}\n`;
  });
  return formatted;
}
</code></pre>
<ul>
<li>This function transforms a complex configuration into a concise, readable format.</li>
<li>The output is optimized for LLMs, reducing redundancy while preserving essential information.</li>
<li>Iterating over quests and files demonstrates a clear and structured approach to data extraction.</li>
<li>The fallback to empty strings ensures robustness against missing or incomplete data.</li>
<li>Formatting logic is decoupled from other components, promoting reusability.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Study the configuration constants in <code class="inline-code">config.ts</code> to understand the system&#39;s boundaries and how they can be adjusted.</li>
<li>Explore the theme parsing logic in <code class="inline-code">theme.ts</code> to see how user input maps to structured data.</li>
<li>Test the validation functions in <code class="inline-code">input-validator.ts</code> to understand how they protect the system from invalid inputs.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><p><strong>Add a New Theme</strong>: Extend the <code class="inline-code">THEMES</code> object with a new theme, including an emoji, description, and keywords. Update the corresponding validation logic to support it.</p>
</li>
<li><p><strong>Modify Adventure Config Parsing</strong>: Add a new field to the <code class="inline-code">adventure.config.json</code> structure and update the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a> function to include it in the output.</p>
</li>
<li><p><strong>Enhance Validation Feedback</strong>: Modify the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a> function to suggest the closest matching theme if the input is invalid. Use the <code class="inline-code">keywords</code> array for similarity checks.</p>
</li>
</ol>
<hr>
<p>You have mastered all the secrets of Codethia&#39;s configuration systems! Your adventure is complete.</p>
<p>With the wisdom of the ancients and the bravery of a true hero, you have unlocked the arcane secrets of the Spellbook of Configuration, propelling your quest toward legendary glory at an awe-inspiring 80% completion‚Äîshine on, noble champion! ‚ö°‚≠êüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>