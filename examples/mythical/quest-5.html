<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Castle‚Äôs Magical Foundation - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Repository of Adventures</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Castle‚Äôs Magical Foundation</h1>
<hr>
<p>The final tower of the Castle looms before you, its spires glowing with mystical auras. This is the heart of the kingdom‚Äôs magic: the Foundation. Here, enchanted scrolls dictate the rules of the land, from the speed of Messenger Spirits to the strength of Dragon Hoards. To master this realm, you must decode the ancient spells that govern the castle&#39;s harmony. These scrolls hold the secrets to themes, configurations, and validations that ensure the kingdom‚Äôs balance. Can you wield this power to secure Codehaven&#39;s future?</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>Theme Configuration</strong>: How themes are defined and managed as reusable, structured configurations.</li>
<li>üîç <strong>Validation Patterns</strong>: Techniques to validate user inputs and ensure safe, predictable system behavior.</li>
<li>‚ö° <strong>Dynamic CSS Generation</strong>: How theme-specific styles are dynamically combined and applied for customization.</li>
<li>üí° <strong>Adventure Config Parsing</strong>: How JSON-based configurations are loaded, parsed, and used to drive dynamic content generation.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a></h3>
<p>This file defines the kingdom‚Äôs magical themes, each represented as a unique configuration. Themes like &quot;Space&quot; or &quot;Mythical&quot; are structured as immutable definitions, with properties such as <code class="inline-code">id</code>, <code class="inline-code">key</code>, and <code class="inline-code">description</code>. These themes guide the visual and experiential elements of the quests, ensuring consistency and adaptability. The file also includes helper functions for parsing and validating themes, making it a central hub for theme-related logic.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L74" target="_blank" rel="noopener noreferrer"><code class="inline-code">getThemeById</code></a> retrieves a theme by its unique ID, ensuring precise access to predefined themes.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L88" target="_blank" rel="noopener noreferrer"><code class="inline-code">isValidTheme</code></a> acts as a magical gatekeeper, verifying if a given theme key is valid.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts#L120" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatThemeOption</code></a> formats theme details for display, enhancing user experience during theme selection.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function getThemeById(id: number): ThemeDefinition | null {
  return THEMES_ARRAY.find(theme =&gt; theme.id === id) || null;
}
</code></pre>
<ul>
<li>This function searches the <code class="inline-code">THEMES_ARRAY</code> for a theme matching the provided <code class="inline-code">id</code>.</li>
<li>It uses a simple, efficient <code class="inline-code">find</code> operation to ensure fast lookups.</li>
<li>Returning <code class="inline-code">null</code> for invalid IDs prevents errors, promoting defensive programming.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
</code></pre>
<ul>
<li>This function checks if a given string matches any theme key in <code class="inline-code">THEMES_ARRAY</code>.</li>
<li>It uses the <code class="inline-code">some</code> method for a concise validation approach.</li>
<li>The type guard ensures type safety when working with theme keys.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatThemeOption(theme: ThemeDefinition): string {
  return `${theme.emoji} **${theme.id}. ${theme.displayName}** - ${theme.description}`;
}
</code></pre>
<ul>
<li>This function formats a theme&#39;s details into a user-friendly string.</li>
<li>It combines emojis, IDs, and descriptions for clear, engaging output.</li>
<li>This enhances usability, especially in CLI or UI-based theme selection.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/generator/src/cli/theme-manager.ts</code></a></h3>
<p>The <code class="inline-code">ThemeManager</code> is a mystical artisan, crafting the visual essence of adventures. It handles theme-specific CSS generation, GitHub logo selection, and icon management. This file showcases how themes influence the aesthetics of the generated adventures, ensuring each quest feels unique and immersive.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L58" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateThemeCSS</code></a> combines multiple CSS files into a single, cohesive stylesheet for a theme.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L49" target="_blank" rel="noopener noreferrer"><code class="inline-code">getGitHubLogo</code></a> selects the appropriate logo based on theme characteristics.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L81" target="_blank" rel="noopener noreferrer"><code class="inline-code">getThemeIcons</code></a> maps each theme to its specific set of icons for consistent visual representation.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">generateThemeCSS(theme: AdventureTheme, outputDir: string): void {
  const cssFiles = [
    path.join(this.themesDir, &#39;base.css&#39;),
    path.join(this.themesDir, &#39;homepage.css&#39;), 
    path.join(this.themesDir, &#39;animations.css&#39;),
    path.join(this.themesDir, `${theme}.css`)
  ];
  
  let combinedCSS = &#39;&#39;;
  
  cssFiles.forEach(cssFile =&gt; {
    if (fs.existsSync(cssFile)) {
      combinedCSS += fs.readFileSync(cssFile, &#39;utf8&#39;) + &#39;\\n\\n&#39;;
    }
  });
  
  const cssPath = path.join(outputDir, &#39;assets&#39;, &#39;theme.css&#39;);
  fs.writeFileSync(cssPath, combinedCSS);
}
</code></pre>
<ul>
<li>This function reads and combines multiple CSS files into a single output.</li>
<li>It ensures each theme has a unified visual style by layering base and theme-specific styles.</li>
<li>The use of <code class="inline-code">fs.existsSync</code> prevents errors from missing files.</li>
</ul>
<hr>
<pre><code class="language-typescript">getGitHubLogo(theme: AdventureTheme): string {
  return this.isLightTheme(theme) 
    ? &#39;assets/shared/github-mark.svg&#39; 
    : &#39;assets/shared/github-mark-white.svg&#39;;
}
</code></pre>
<ul>
<li>This function selects the appropriate GitHub logo based on the theme&#39;s brightness.</li>
<li>It demonstrates how small visual details can be dynamically adjusted for aesthetics.</li>
<li>The logic is simple yet effective, ensuring consistent branding.</li>
</ul>
<hr>
<pre><code class="language-typescript">getThemeIcons(theme: AdventureTheme): { theme: string; quest: string } {
  const themeIcons = {
    space: { theme: &#39;üöÄ&#39;, quest: &#39;‚≠ê&#39; },
    mythical: { theme: &#39;üè∞&#39;, quest: &#39;‚öîÔ∏è&#39; },
    ancient: { theme: &#39;üè∫&#39;, quest: &#39;üìú&#39; },
    developer: { theme: &#39;üíª&#39;, quest: &#39;üîß&#39; },
    custom: { theme: &#39;üé®&#39;, quest: &#39;‚≠ê&#39; }
  };

  return (themeIcons as any)[theme] || themeIcons.space;
}
</code></pre>
<ul>
<li>This function maps themes to their respective icons for visual consistency.</li>
<li>It uses a simple object lookup for efficient and readable code.</li>
<li>The fallback to the &quot;space&quot; theme ensures robustness.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a></h3>
<p>The <code class="inline-code">InputValidator</code> is a vigilant castle guard, ensuring all inputs are safe and valid before entering the system. It validates user choices, themes, and project paths, preventing errors and maintaining harmony in the kingdom.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L9" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateAdventureChoice</code></a> ensures user choices are non-empty and within length limits.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a> parses and validates theme inputs, guiding users to valid options.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L53" target="_blank" rel="noopener noreferrer"><code class="inline-code">sanitizeForDisplay</code></a> cleans inputs for safe display, removing potentially harmful characters.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; VALIDATION_MAX_CHOICE_LENGTH) {
    throw new Error(`Choice too long (max ${VALIDATION_MAX_CHOICE_LENGTH} characters)`);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>This function checks if a user-provided choice is valid and within length limits.</li>
<li>It uses <code class="inline-code">trim</code> to remove unnecessary whitespace, ensuring clean inputs.</li>
<li>Throwing errors for invalid inputs enforces strict validation.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li>This function validates and normalizes theme inputs.</li>
<li>It combines parsing and validation for a robust approach.</li>
<li>Providing valid theme options in error messages improves user experience.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function sanitizeForDisplay(input: string, maxLength = VALIDATION_MAX_DISPLAY_LENGTH): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li>This function removes potentially harmful characters from inputs.</li>
<li>It ensures safe display of user-provided data, preventing injection attacks.</li>
<li>The optional <code class="inline-code">maxLength</code> parameter allows flexible usage.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Review how <code class="inline-code">THEMES</code> is structured to understand how configuration objects can be used as single sources of truth.</li>
<li>Examine the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L58" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateThemeCSS</code></a> function to see how dynamic file operations can simplify customization.</li>
<li>Explore the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L686" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateTheme</code></a> function to learn how to combine parsing and validation for robust input handling.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><p><strong>Add a New Theme</strong>: Create a new theme called &quot;Cyberpunk&quot; with unique properties. Update the <code class="inline-code">THEMES</code> object and ensure it integrates seamlessly with existing functions.</p>
<ul>
<li>Example: Add keywords like &quot;neon&quot; and &quot;cyber&quot; and test the theme parser.</li>
</ul>
</li>
<li><p><strong>Enhance Validation</strong>: Modify <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts#L9" target="_blank" rel="noopener noreferrer"><code class="inline-code">validateAdventureChoice</code></a> to provide more descriptive error messages. Include examples of valid choices in the error output.</p>
</li>
<li><p><strong>Dynamic Icons</strong>: Extend <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/generator/src/cli/theme-manager.ts#L81" target="_blank" rel="noopener noreferrer"><code class="inline-code">getThemeIcons</code></a> to support dynamic loading of custom icons based on a configuration file. Test it by adding new icon sets.</p>
</li>
</ol>
<hr>
<p>You have mastered all the secrets of Codehaven‚Äôs magical foundation! Your adventure is complete.</p>
<p>By the light of the astral phoenix and the wisdom of ancient runes, you have fortified the Castle‚Äôs Magical Foundation with unparalleled valor‚Äîforge ahead, brave hero, for the final quest awaits! ‚ö°üíé‚≠ê</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>