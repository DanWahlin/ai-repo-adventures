<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest Generation Systems - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Cosmic Codebase Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Quest Generation Systems</h1>
<hr>
<p>The Starship Codex accelerates toward the Repository Nebula&#39;s heart, where the Quest Generation Engine hums with cosmic energy. This advanced system deciphers the mysteries of raw code and transforms them into structured, interactive adventures. As part of the crew, your mission is to navigate the intricate algorithms that generate quests, ensuring they are cohesive, educational, and aligned with the ship&#39;s themes. The nebula&#39;s secrets are vast, but with the right tools, you can chart an unforgettable journey through the galaxy of code.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>Quest Generation Logic</strong>: How adventures and quests are dynamically created based on codebase analysis.</li>
<li>üîç <strong>Content Optimization</strong>: Techniques for efficient content processing and chunking in large codebases.</li>
<li>‚ö° <strong>Theme Integration</strong>: How themes influence quest narratives and formatting.</li>
<li>üí° <strong>Config Parsing</strong>: Methods for extracting and validating adventure-related configurations.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<p>The <code class="inline-code">AdventureManager</code> orchestrates the creation and execution of quests, acting as the backbone of the Starship Codex&#39;s quest generation system. This file demonstrates how quests are initialized, validated, and dynamically tailored to the project&#39;s structure and theme. It also handles user interactions, caching completed quests, and managing progress tracking.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L59" target="_blank" rel="noopener noreferrer"><code class="inline-code">initializeAdventure</code></a>: Resets state, generates story and quests, and merges configuration files into quest data.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L109" target="_blank" rel="noopener noreferrer"><code class="inline-code">exploreQuest</code></a>: Executes a chosen quest, validates prerequisites, and retrieves cached content for completed quests.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Dynamically creates quest content based on codebase context and chunked processing.</li>
<li><code class="inline-code">progressPercentage</code>: Calculates progress as a percentage of completed quests.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L377" target="_blank" rel="noopener noreferrer"><code class="inline-code">mergeQuestFilesFromConfig</code></a>: Integrates configuration-defined files into generated quests for enhanced targeting.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This method initializes the quest generation process by resetting the state and setting the theme.</li>
<li>It integrates custom data for custom themes and generates story and quests using the <code class="inline-code">StoryGenerator</code>.</li>
<li>Configuration-defined files are merged into generated quests, ensuring tailored exploration.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>This method handles user interactions by validating their choices and determining the appropriate quest to execute.</li>
<li>It checks for progress requests and retrieves cached content for completed quests, ensuring efficiency.</li>
<li>The modular design allows seamless integration of new quest types.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<p>The <code class="inline-code">StoryGenerator</code> is responsible for creating the narrative and quest content. It leverages AI models to generate structured markdown responses, ensuring adventures are engaging and aligned with the selected theme. This file showcases advanced techniques in prompt engineering, content parsing, and chunked processing.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L299" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateStoryAndQuests</code></a>: Generates the initial story and quests using AI, including validation and markdown parsing.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Handles chunked content processing to create detailed quest narratives.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L524" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractMarkdownContent</code></a>: Cleans AI responses to ensure proper markdown formatting.</li>
<li><code class="inline-code">processChunkedQuestContent</code>: Iteratively processes large codebases in chunks for optimal quest generation.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L438" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateCompletionSummary</code></a>: Creates summaries for completed quests to enhance user experience.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<ul>
<li>This method initializes story generation by validating the theme and leveraging AI for dynamic content creation.</li>
<li>It ensures the generated story aligns with the project&#39;s structure and theme, providing a cohesive experience.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async processChunkedQuestContent(
  quest: Quest,
  theme: AdventureTheme,
  chunkResult: ChunkResult,
  adventureGuidance: string,
  customInstructions: string,
  questPosition?: number,
  totalQuests?: number
): Promise&lt;QuestContent&gt; {
  let accumulatedContent = &#39;&#39;;
  let contextSummary = &#39;&#39;;

  for (let i = 0; i &lt; chunkResult.chunks.length; i++) {
    const chunk = chunkResult.chunks[i];
    const isFirstChunk = i === 0;
    const isLastChunk = i === chunkResult.chunks.length - 1;

    let prompt: string;
    if (isFirstChunk) {
      prompt = loadQuestContentPrompt({
        theme,
        adventureTitle: quest.title,
        codeContent: chunk.content,
        storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
        adventureGuidance: adventureGuidance || &#39;&#39;,
        ...(customInstructions &amp;&amp; { customInstructions }),
        questPosition,
        totalQuests,
        ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
      });
    } else if (isLastChunk) {
      prompt = `Finalize the adventure based on the last chunk of code.`;
    } else {
      prompt = `Expand the adventure based on the next chunk of code.`;
    }

    const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST, context: &#39;quest chunk&#39; });
    accumulatedContent = this.extractMarkdownContent(response.content);
  }

  return { adventure: accumulatedContent, fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };
}
</code></pre>
<ul>
<li>This method processes large codebases in chunks, ensuring the AI generates coherent and detailed quest content.</li>
<li>It uses iterative prompts to build upon previous context, creating a seamless narrative.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<p>The <code class="inline-code">adventure-config.ts</code> file provides utilities for handling adventure-specific configurations. It ensures quests are aligned with project-defined parameters and validates file paths referenced in the configuration.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L19" target="_blank" rel="noopener noreferrer"><code class="inline-code">loadAdventureConfig</code></a>: Reads the raw configuration file from the project directory.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L28" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseAdventureConfig</code></a>: Parses and validates the configuration into usable objects.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L41" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractUniqueFilePaths</code></a>: Extracts all unique file paths referenced in the configuration.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a>: Formats the configuration for use in AI prompts.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L111" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractCustomInstructions</code></a>: Retrieves custom instructions from the configuration for tailored quest generation.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This method parses the adventure configuration file, ensuring it is correctly formatted and usable for quest generation.</li>
<li>It provides a single point of validation, reducing the risk of errors in downstream processes.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\nFiles: ${quest.files.map((f: any) =&gt; f.path).join(&#39;, &#39;)}\nFunctions: ${quest.files.flatMap((f: any) =&gt; f.highlights || []).map((h: any) =&gt; h.name).join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This method formats the adventure configuration for AI prompts, optimizing it for efficient processing and clarity.</li>
<li>It reduces redundancy by focusing on essential details like file paths and function names.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Review how <code class="inline-code">AdventureManager</code> integrates configuration files into generated quests for targeted exploration.</li>
<li>Study the chunking logic in <code class="inline-code">StoryGenerator</code> to understand how large codebases are processed efficiently.</li>
<li>Observe the validation patterns in <code class="inline-code">adventure-config.ts</code> for ensuring configuration integrity.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><strong>Add Custom Quest Files</strong>: Modify the <code class="inline-code">adventure.config.json</code> to include specific file paths and functions for a new quest. Observe how these changes influence quest generation.</li>
<li><strong>Trace Chunk Processing</strong>: Add logging statements in <code class="inline-code">processChunkedQuestContent</code> to track how each chunk contributes to the final quest content. Analyze the iterative prompts used.</li>
<li><strong>Enhance Config Formatting</strong>: Improve the <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a> function to include additional metadata, such as quest prerequisites or estimated difficulty.</li>
</ol>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Starship Codex&#39;s systems.</p>
<p>Mission accomplished, star voyager! üöÄ You&#39;ve charted the cosmos of Quest Generation Systems, propelling your learning odyssey to 40% completion‚Äîkeep reaching for the stars! ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>