<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest Generation Core - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tk53e05gf2");
    </script>
    
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }

        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Stellar Repository Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Adventure</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Galactic Quest Generation Engine</h1>
<hr>
<p>You find yourself aboard the Codebreaker NX-2023, orbiting a vibrant nebula teeming with quantum code clusters. The ship&#39;s Quest Generation Core hums with energy as it prepares to synthesize new adventures from the swirling repository data. As the navigator, your task is to ensure the crew&#39;s progress through the galaxy by mastering the quest generation engine, which transforms raw code into captivating journeys.</p>
<h2>Key Takeaways</h2>
<p>After completing this quest, you will understand:</p>
<ul>
<li>üéØ <strong>Quest Generation Flow</strong>: How quests are dynamically generated using repository data and LLM integration.</li>
<li>üîç <strong>State Management</strong>: How <code class="inline-code">AdventureState</code> tracks progress and caches quest content for efficiency.</li>
<li>‚ö° <strong>LLM Integration</strong>: How the StoryGenerator interacts with LLMs to create structured adventures.</li>
<li>üí° <strong>Config Optimization</strong>: How adventure configurations reduce processing overhead and enhance quest targeting.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<p>The <code class="inline-code">AdventureManager</code> serves as the captain of the Quest Generation Engine, orchestrating the initialization of adventures, quest execution, and tracking overall progress. This class demonstrates robust state management and dynamic content generation using sophisticated caching and validation strategies.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L59" target="_blank" rel="noopener noreferrer"><code class="inline-code">initializeAdventure</code></a>: Sets up the adventure by resetting state, generating story and quests, and merging configuration data.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L109" target="_blank" rel="noopener noreferrer"><code class="inline-code">exploreQuest</code></a>: Executes a chosen quest, utilizing cached content when available for efficiency.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Dynamically generates quest-specific content using file analysis and LLM.</li>
<li><code class="inline-code">progressPercentage</code>: Calculates the current progress based on completed quests.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L377" target="_blank" rel="noopener noreferrer"><code class="inline-code">mergeQuestFilesFromConfig</code></a>: Integrates quest-specific files from configuration for targeted exploration.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This function resets the adventure state to ensure clean initialization for each new mission.</li>
<li>It dynamically integrates custom themes and uses LLMs to generate stories and quests tailored to the repository.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L377" target="_blank" rel="noopener noreferrer"><code class="inline-code">mergeQuestFilesFromConfig</code></a> enhances quests with specific file targets, improving the relevance of generated content.</li>
<li>The modular design allows future extensions, such as additional themes or quest types.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L109" target="_blank" rel="noopener noreferrer"><code class="inline-code">exploreQuest</code></a> method validates user input, checks for progress requests, and executes quests based on sanitized choices.</li>
<li>It ensures efficient quest handling through caching, reducing redundant LLM calls for completed quests.</li>
<li>The modular design supports flexible input types (ID, number, or title) for seamless user experience.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async generateQuestContent(quest: Quest): Promise&lt;QuestContent&gt; {
  let codeContent = this.state.projectInfo!.repomixContent;
  const chunkResult = ContentChunker.chunkContent(codeContent);

  return await this.storyGenerator.generateQuestContent({
    quest,
    theme: this.state.currentTheme!,
    chunkResult,
    questPosition: this.state.quests.findIndex(q =&gt; q.id === quest.id) + 1,
    totalQuests: this.state.quests.length
  });
}
</code></pre>
<ul>
<li>This method generates quest-specific content by chunking repository data for optimal processing.</li>
<li>It integrates LLM responses to craft detailed narratives and actionable insights for each quest.</li>
<li>The use of content chunking ensures scalability, allowing the system to handle large codebases efficiently.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<p>The <code class="inline-code">StoryGenerator</code> acts as the ship&#39;s storyteller, transforming repository analysis into structured adventures. It dynamically generates stories and quests using LLM prompts and fallback templates.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L299" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateStoryAndQuests</code></a>: Creates the overarching story and quest list using repository data and LLM prompts.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L269" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateQuestContent</code></a>: Produces detailed content for individual quests, handling both single and multichunk scenarios.</li>
<li><code class="inline-code">buildStoryGenerationPrompt</code>: Constructs prompts for LLMs, incorporating repository context and theme guidelines.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts#L524" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractMarkdownContent</code></a>: Cleans and extracts structured data from LLM responses.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L438" target="_blank" rel="noopener noreferrer"><code class="inline-code">generateCompletionSummary</code></a>: Produces summaries for completed quests, enhancing user engagement and progress tracking.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent: projectInfo.repomixContent || &#39;No repomix content available&#39;,
  });
  const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY, context: &#39;story &amp; quests&#39; });

  const parsed = parseMarkdownToStoryResponse(response.content.trim());
  StoryResponseSchema.parse(parsed);

  return parsed;
}
</code></pre>
<ul>
<li>This function uses formatted prompts to generate stories and quests tailored to the repository and theme.</li>
<li>It ensures data integrity by validating LLM responses with Zod schemas.</li>
<li>The modular structure allows seamless integration of new themes and prompt formats.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(config: QuestGenerationConfig): Promise&lt;QuestContent&gt; {
  const chunkResult = config.chunkResult;
  const response = await this.llmClient.generateResponse(
    loadQuestContentPrompt({
      theme: config.theme,
      codeContent: chunkResult.chunks[0].content,
      questPosition: config.questPosition,
      totalQuests: config.totalQuests,
    }),
    { maxTokens: LLM_MAX_TOKENS_QUEST, context: &#39;quest content&#39; }
  );

  return { adventure: response.content.trim(), fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };
}
</code></pre>
<ul>
<li>The method handles both single-chunk and multichunk quest generation, ensuring comprehensive content coverage.</li>
<li>It leverages LLM prompts to create engaging narratives that align with the selected theme.</li>
<li>The streamlined approach minimizes processing overhead, enhancing system performance.</li>
</ul>
<hr>
<h3><span class="header-prefix">File:</span> <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<p>The <code class="inline-code">adventure-config.ts</code> module provides utility functions for loading and parsing adventure configurations, integrating quest-specific files and highlights into the generation process.</p>
<h4>Highlights</h4>
<ul>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L28" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseAdventureConfig</code></a>: Parses configuration files into structured objects for easy access.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a>: Reduces configuration verbosity for efficient LLM processing.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L41" target="_blank" rel="noopener noreferrer"><code class="inline-code">extractUniqueFilePaths</code></a>: Identifies unique file paths referenced in the configuration for targeted analysis.</li>
<li><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L19" target="_blank" rel="noopener noreferrer"><code class="inline-code">loadAdventureConfig</code></a>: Loads raw configuration data from the project directory.</li>
</ul>
<h4>Code</h4>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function parses raw JSON configuration files, ensuring resilience against malformed inputs.</li>
<li>It provides a single point of validation, reducing complexity in downstream processing.</li>
<li>The modular design supports future extensions, such as additional configuration formats.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\nFiles: ${quest.files.map((f: any) =&gt; f.path).join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function optimizes adventure configurations for LLM prompts by removing redundant data.</li>
<li>The streamlined format enhances prompt clarity and reduces token usage.</li>
<li>It ensures alignment between configuration data and generated content.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Review how <code class="inline-code">AdventureState</code> caches quest content to minimize redundant LLM calls.</li>
<li>Study the modular design of <code class="inline-code">StoryGenerator</code> to understand prompt construction and response handling.</li>
<li>Explore how <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L75" target="_blank" rel="noopener noreferrer"><code class="inline-code">formatAdventureConfigForPrompt</code></a> transforms verbose configurations into concise prompts.</li>
</ul>
<h2>Try This</h2>
<p>Challenge yourself to deepen your understanding:</p>
<ol>
<li><p><strong>Add a Custom Theme</strong>: Create a new custom theme by defining unique keywords and visual elements. Update the <code class="inline-code">StoryGenerator</code> and <code class="inline-code">AdventureManager</code> to integrate this theme into story generation.</p>
</li>
<li><p><strong>Trace Quest Execution</strong>: Add debug logs to <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts#L109" target="_blank" rel="noopener noreferrer"><code class="inline-code">exploreQuest</code></a> and follow the flow of a quest execution, from user input to LLM response. Observe how cached content is reused for completed quests.</p>
</li>
<li><p><strong>Optimize Config Parsing</strong>: Modify <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts#L28" target="_blank" rel="noopener noreferrer"><code class="inline-code">parseAdventureConfig</code></a> to handle nested configurations and validate required fields. Test the function with complex configuration files.</p>
</li>
</ol>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of the Codebreaker NX-2023&#39;s systems.</p>
<p>Quest Generation Core successfully ignited its cosmic engines, propelling you to 40% completion on your interstellar journey‚Äîkeep blazing through the stars, starship commander! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>