<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Sacred Configurations - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Repository Chronicles: Secrets of the Ancient Codex</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Sacred Configurations</h1>
<hr>
<p>The final leg of your journey takes you to the heart of the codex, an ancient hub of intricate scripts and algorithms. Here lies the Sacred Configurations: the foundation upon which all knowledge generation is structured. These configurations dictate the behavior and limits of the Repository&#39;s systems, from file size allowances to timeout intervals. To wield the full potential of the Sacred Configurations, you must traverse scripts that map its design, investigate the mechanics of adventurous themes, and unveil the strict rules governing inputs. Each revelation brings you closer to the codex&#39;s ultimate purpose.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configuration Secrets</strong>: How are the core constants such as <code class="inline-code">MAX_FILE_SIZE_MB</code> and <code class="inline-code">LLM_REQUEST_TIMEOUT</code> initialized, and what role do environment variables play in adapting the system?</li>
<li>‚ö° <strong>Thematic Alignment</strong>: How does <code class="inline-code">ThemeManager.generateThemeCSS</code> integrate multiple stylesheets to craft a cohesive visual identity for an adventure?</li>
<li>üõ°Ô∏è <strong>Validation Crypts</strong>: How do functions like <code class="inline-code">validateTheme</code> and <code class="inline-code">validateAdventureChoice</code> ensure that only valid inputs are accepted?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> A repository of foundational constants and environmental configurations</h3>
<p>Within this file lies the critical parameters that guide and supervise the behavior of the entire system. From API timeouts to file size constraints, each constant acts as a safeguard to ensure smooth operation. The file emphasizes simplicity by maintaining a flat structure for easy readability and access. Discovering how it incorporates <code class="inline-code">dotenv</code> to adapt defaults with environment variables provides insight into its flexibility and adaptability.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> specifies the allowable time for an API request, guiding system responsiveness and user experience.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> determines the upper file size limit for analysis, protecting against memory overload.</li>
<li><code class="inline-code">IGNORE_PATTERNS</code> lists default directories and files excluded from processing, optimizing performance.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = parseInt(process.env.LLM_REQUEST_TIMEOUT || &#39;60000&#39;); // 60 seconds for complex story generation with large prompts, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
export const IGNORE_PATTERNS = [
  &#39;node_modules&#39;,
  &#39;.git&#39;,
  &#39;.next&#39;,
  &#39;.nuxt&#39;,
  &#39;dist&#39;,
  &#39;build&#39;,
  &#39;coverage&#39;,
  &#39;.nyc_output&#39;,
  &#39;logs&#39;,
  &#39;*.log&#39;,
  &#39;.env&#39;,
  &#39;.DS_Store&#39;,
  &#39;Thumbs.db&#39;,
] as const;
</code></pre>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> adjusts dynamically based on an environment variable, allowing fine-grained control of timeout limits.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> prevents excessive memory usage by skipping overly large files, ensuring a stable analysis process.</li>
<li><code class="inline-code">IGNORE_PATTERNS</code> defines a comprehensive list of directories and files to bypass, enhancing focus and performance during scanning.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> A central hub for theme management and customization</h3>
<p>This file encapsulates the power of the system&#39;s thematic versatility. Themes drive the immersive experience by defining unique identities through keywords, descriptions, and even emojis. The <code class="inline-code">THEMES</code> constant offers five predefined themes, including <code class="inline-code">ancient</code>, while utility functions like <code class="inline-code">getAllThemes</code> aid in retrieving theme data dynamically.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code> serves as the definitive source of theme metadata, offering identifiers, descriptions, and visual accents.</li>
<li><code class="inline-code">isValidTheme</code> ensures that only recognized theme keys or IDs are accepted, reinforcing input integrity.</li>
<li><code class="inline-code">parseTheme</code> provides robust mapping logic to identify themes based on keys, IDs, or keywords.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical and mythical realms where databases are dragon hoards and functions are powerful spells&#39;,
    keywords: [&#39;mythical&#39;, &#39;magic&#39;, &#39;enchanted&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;fantasy&#39;, &#39;medieval&#39;, &#39;kingdom&#39;]
  },
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  }
} as const;

export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}

export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;

  const normalized = input.trim().toLowerCase();

  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;

  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }

  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }

  return null;
}
</code></pre>
<ul>
<li><code class="inline-code">THEMES</code> allows for a rich and highly interactive experience based on predefined or custom themes.</li>
<li><code class="inline-code">isValidTheme</code> enforces strict adherence to acceptable input, preventing mismatched themes or unintentional errors.</li>
<li><code class="inline-code">parseTheme</code> dynamically maps user inputs to established themes, ensuring flexibility without sacrificing reliability.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Guardians of system integrity through input validation</h3>
<p>Input validation guards the system against errant data and malicious attempts. This file contains utility functions that ensure only well-formed and allowable inputs are processed. Each validator has a clear purpose, simplifying its role within the system&#39;s architecture.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateTheme</code> applies strict checks to ensure chosen themes are legitimate and supported.</li>
<li><code class="inline-code">validateAdventureChoice</code> guarantees well-formed input for player choices, preventing overflow errors or malicious data.</li>
<li><code class="inline-code">sanitizeForDisplay</code> strips harmful characters to prevent injection attacks while preparing output for display.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}

export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}

export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> prevents overflow errors by limiting input length, promoting robust engineering.</li>
<li><code class="inline-code">validateTheme</code> performs dual checks: first normalizing user input, then validating it against approved options.</li>
<li><code class="inline-code">sanitizeForDisplay</code> safeguards against injection attacks by scrubbing malicious characters and lengthy content.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">dotenv</code> to test alternate <code class="inline-code">LLM_REQUEST_TIMEOUT</code> values and observe how it impacts story generation latency.</li>
<li>Experiment with <code class="inline-code">THEMES</code> keywords to see how <code class="inline-code">parseTheme</code> resolves ambiguous inputs intelligently.</li>
<li>Validate your inputs with <code class="inline-code">sanitizeForDisplay</code> to appreciate its role in securing user-facing data.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Sacred Repository! Your adventure is complete, and the knowledge of the ancient civilization now flows through your veins.</p>
<p>Hark, valiant seeker, thou hast traversed the labyrinth of the Sacred Configurations and art now but one trial away from ascending to the hallowed sanctum of ancient enlightenment‚Äîthy wisdom radiates like the eternal ‚≠ê of the heavens!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="summary.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>