<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Oracle of Quests - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Lost Codex of Repositories</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Oracle of Quests</h1>
<hr>
<p>In a sunlit clearing amidst the dense jungle, the remnants of an ancient civilization come alive as you unearth the glowing sigil of the &quot;Oracle of Quests.&quot; Intricate carvings whisper promises of wisdom to adventurers who dare to decode the secrets of its sacred glyphs. But beware—the path ahead is riddled with choices, puzzles to solve, and tools to master. The Oracle is said to be the eternal architect of themed adventures, and only those who truly understand its file-bound messages may proceed toward enlightenment in the labyrinthine temple of code.  </p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure orchestration management</h3>
<p>The <code class="inline-code">AdventureManager</code> in this file elegantly bridges the user’s narrative experience with the underlying codebase analysis, offering seamless exploration of themed adventures. The pivotal methods, <code class="inline-code">initializeAdventure()</code> and <code class="inline-code">exploreQuest()</code>, set the stage for the adventure&#39;s beginning and progression. Upon initialization, <code class="inline-code">initializeAdventure()</code> resets previous data, processes the adventure story, and sets quests tailored to the user’s coding project, blending logic with creative storytelling. Similarly, <code class="inline-code">exploreQuest()</code> validates user choices and executes quests, dynamically switching between cached and fresh quest data. By maintaining progress tracking and tapping into auxiliary functions like <code class="inline-code">mergeQuestFilesFromConfig()</code> and <code class="inline-code">enforceConfigQuestCount()</code>, this file ensures quests remain structured and engaging while reducing redundancy. The architecture of adventure orchestration underpins a balance of high-level storytelling and technical prowess—a contrast as harmonious as ancient carvings on opposing walls.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure()</code>: Kickstarts adventures by merging storytelling with project analysis.  </li>
<li><code class="inline-code">exploreQuest()</code>: Ensures quest execution aligns with user choices and cached results.  </li>
<li><code class="inline-code">mergeQuestFilesFromConfig()</code>: Integrates predefined quest guidelines from configuration files seamlessly.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> LLM-powered creation of themed narratives</h3>
<p>This file unveils the creative engine of adventure design through its class, <code class="inline-code">StoryGenerator</code>. The <code class="inline-code">generateStoryAndQuests()</code> method employs the large language model (LLM) to weave code-centric narratives based on themes—<code class="inline-code">ancient</code>, <code class="inline-code">space</code>, or even custom-defined realms. It draws upon structured prompts to generate cohesive, educational adventures. By extracting context from project repo files and themes, it makes adventuring feel cohesive while grounding storytelling in usable technical exploration. Key secondary functions like <code class="inline-code">generateQuestContent()</code> and <code class="inline-code">generateCompletionSummary()</code> enhance the immersive experience by producing detailed scenarios and summarizing triumphs elegantly. Drawing inspiration from the age-old concept of interactive epics, this generator allows developers to journey into their codebases with intrigue brewing in every corner.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests()</code>: Synthesizes code analysis into engaging quests with thematic narratives.  </li>
<li><code class="inline-code">generateQuestContent()</code>: Enriches each quest with detailed coding tasks and insights.  </li>
<li><code class="inline-code">generateCompletionSummary()</code>: Wraps up adventures with appropriate acknowledgments and percentage progress.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration system for guided adventures</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file stands as the guiding stone tablet for adventures, holding structured directives that shape quests. By parsing the <code class="inline-code">adventure.config.json</code>, it extracts the rules and paths relevant to adventure creation. Functions like <code class="inline-code">formatAdventureConfigForPrompt()</code> translate this configuration into structured templates that the LLM leverages during quest generation—ensuring coherence and systematic exploration. Additionally, it supports targeted file analysis through <code class="inline-code">extractUniqueFilePaths()</code>, enabling multi-faceted exploration within specific project boundaries. Here lies the wisdom of structuring prompts beyond brute-force text dumping, a testament to the ancient art of interweaving logic with creativity.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig()</code>: Reads and validates the adventure configuration file for quest control.  </li>
<li><code class="inline-code">extractUniqueFilePaths()</code>: Gathers unique paths for surgical exploration of the codebase.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code>: Prepares configuration snippets for thematic alignment within quests.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">/**
 * Initialize the adventure with project context and generate story + quests
 */
async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>Functionality akin to assembling an elaborate treasure map—combining pieces from different sources to shape an adventure tailored to the seeker’s journey.</p>
<hr>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">/**
 * Generate the initial story and quests using LLM
 */
async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  const repomixContent = projectInfo.repomixContent || &#39;No repomix content available&#39;;

  let adventureGuidance = &#39;&#39;;
  if (projectPath) {
    adventureGuidance = formatAdventureConfigForPrompt(projectPath) || &#39;&#39;;
  }

  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent,
    ...(adventureGuidance &amp;&amp; { adventureGuidance }),
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  });

  const response = await this.withTimeout(this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY }));
  
  let parsed = parseMarkdownToStoryResponse(response.content.trim());
  StoryResponseSchema.parse(parsed);
  
  this.currentStoryContent = typeof parsed.story === &#39;string&#39; ? parsed.story : parsed.story.content;
  return parsed;
}
</code></pre>
<p>Generating adaptive narratives feels like breathing life into ancient scrolls, where every tale resonates with its reader’s intent.  </p>
<hr>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return &#39;&#39;;

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return &#39;&#39;;
  
  let formatted = `## Quest Structure Guidelines\n\n`;
  formatted += `**CRITICAL: Each quest MUST include dedicated file analysis sections**\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    formatted += `${quest.description}\n\n`;
    formatted += `**Required File Analysis Sections:**\n`;

    for (const file of quest.files) {
      if (!file.path || !file.description) continue;

      formatted += `\n**File: \`${file.path}\`**\n`;
      formatted += `- Description: ${file.description}\n`;
    }
    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<p>Formatting directives into structured guidelines mirrors organizing a sacred ritual—precise and unyielding to chaos.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Explore how the adventure-manager manages both functional and creative aspects for user engagement.  </li>
<li>Dive deeper into how the story-generator uses LLM prompts to craft educational yet enjoyable quests.  </li>
<li>Consider experimenting with custom themes to tailor the narrative experience for diverse user bases.</li>
</ul>
<hr>
<p>Hark, seeker of sacred truths, thou hast ascended the first summit of enlightenment by unveiling the Oracle of Quests—thy wisdom glimmers like a celestial jewel amidst the stars of antiquity, ever guiding thee towards ultimate triumph!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Analyzing Monolith →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>