<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Artifacts of Command - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-ancient">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Secrets of the Lost Repository</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Artifacts of Command</h1>
<hr>
<p>In the heart of the jungle, amidst towering trees and ancient ruins, a grand chamber lies concealed. This Chamber of Artifacts is whispered to hold powerful relics - coded fragments buried deep within the Repository of Ages. To navigate its sacred depths and summon its wisdom, the guardians of the chamber require mastery over commands and the ability to weave intricate rituals from artifacts discovered. Those who can assemble the Puzzle of Command unlock boundless insight. Your expedition must venture further into the labyrinth of code to unravel its arcane operations.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>The Ritual of Initialization</strong>: What strategies does <code class="inline-code">AdventureManager.initializeAdventure</code> use to reset the system and configure the adventure context?</li>
<li>‚ö° <strong>Mapping Artifacts</strong>: How does <code class="inline-code">AdventureManager.mergeQuestFilesFromConfig</code> ensure a connection between quests and their associated artifacts (i.e., file paths)?</li>
<li>üõ°Ô∏è <strong>Sanctity of Selection</strong>: What mechanisms in <code class="inline-code">AdventureManager.validateAndSanitizeChoice</code> ensure that user inputs are both secure and valid?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Core orchestration of adventures</h3>
<p>This file houses the <code class="inline-code">AdventureManager</code> class, which orchestrates code exploration adventures. It integrates project context, manages quests, and dynamically generates content. The class is pivotal in ensuring a synchronized journey, utilizing both project settings and codebase analysis. Key methods initialize adventures, explore quests, and enforce artifact alignment. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Configures a new adventure with essential project context, resets states, and generates dynamic quests.</li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Protects against invalid user input by sanitizing and validating choices.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Integrates external adventure configuration by mapping quests to file paths specified in <code class="inline-code">adventure.config.json</code>.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();

  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;

  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Resets all prior adventure progress to ensure a clean slate.</li>
<li>Dynamically applies the selected theme, including custom configurations.</li>
<li>Merges generated quests with artifacts from <code class="inline-code">adventure.config.json</code> to maintain alignment.</li>
<li>Uses <code class="inline-code">storyGenerator</code> to craft narrative elements and embed project relevance into quests.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateAndSanitizeChoice(input: string): string {
  try {
    return validateAdventureChoice(input);
  } catch (error) {
    throw new Error(`Invalid adventure choice: ${error instanceof Error ? error.message : &#39;Unknown error&#39;}`);
  }
}
</code></pre>
<ul>
<li>Leverages <code class="inline-code">validateAdventureChoice</code> to ensure user input adheres to predefined rules.</li>
<li>Defensive coding prevents invalid inputs from causing runtime errors.</li>
<li>Promotes security by guarding against malformed or potentially malicious inputs.</li>
</ul>
<hr>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;

  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;

  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;

  const configQuestFiles = new Map&lt;string, string[]&gt;();
  for (const configQuest of adventure.quests) {
    if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {
      const filePaths = configQuest.files
        .filter((f: any) =&gt; f.path)
        .map((f: any) =&gt; f.path);
      if (filePaths.length &gt; 0) {
        configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);
      }
    }
  }

  return quests.map((quest, index) =&gt; {
    const configQuests = adventure.quests;
    if (index &lt; configQuests.length &amp;&amp; configQuests[index] &amp;&amp; configQuests[index].files) {
      const files = configQuests[index].files
        .filter((f: any) =&gt; f.path)
        .map((f: any) =&gt; f.path);
      if (files.length &gt; 0) {
        return { ...quest, codeFiles: files };
      }
    }

    const questTitleLower = quest.title.toLowerCase();
    for (const [configTitle, files] of configQuestFiles.entries()) {
      if (questTitleLower.includes(configTitle) || configTitle.includes(questTitleLower)) {
        return { ...quest, codeFiles: files };
      }
    }

    return quest;
  });
}
</code></pre>
<ul>
<li>Bridges in-code quests and external artifact definitions to ensure the alignment of desired exploration targets.</li>
<li>Performs case-insensitive matching to improve resilience to naming variations.</li>
<li>Uses fallback strategies to ensure that all quests receive meaningful context, even if exact matches are missing.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When reading <code class="inline-code">mergeQuestFilesFromConfig</code>, pay attention to how it prioritizes artifact matching by index and title.</li>
<li>Consider how extending the <code class="inline-code">validateAndSanitizeChoice</code> function might enhance security for complex adventure environments.</li>
<li>Explore how resetting the state in <code class="inline-code">initializeAdventure</code> impacts multi-run adventures.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Through valor and wisdom, thou hast claimed the sacred Artifacts of Command, ascending the temple‚Äôs ancient path with triumph‚Äî40% complete and the stars now align for thy noble journey ahead! ‚≠ê‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>