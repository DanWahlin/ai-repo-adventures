<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Oracle of the Glyphs - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Lost Pyramid of Codexis</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Oracle of the Glyphs</h1>
<hr>
<p>Hidden within the labyrinthine depths of the Pyramid of Codexis lies a sacred chamber, the Sanctum of Glyphs. It is said that the ancient Oracle resides within, its power tied to the enigmatic glyphs that adorn the walls—glyphs encoding the rituals of perfect software craftsmanship. To reach the Oracle, you must navigate the treacherous Repository Tunnels and decipher its sacred rites. Through wisdom and persistence, you may unlock the Oracle’s power to restore balance to the coding realms, unraveling mysteries that have lingered since the dawn of the digital age.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Code repository analyzer for extracting project context</h3>
<p>The <code class="inline-code">RepoAnalyzer</code> is a map to the hidden treasures within a repository, distilling its essence into actionable insights. This class focuses on parsing repository structures, ensuring safety checks for file paths, and employing targeted optimizations for extracting contextual information. The class utilizes caching strategies to speed up repeated access—mimicking ancient inscriptions preserved in stone tablets.</p>
<p>Key methods like <code class="inline-code">generateRepomixContext</code> filter the noise, revealing sacred highlights. Meanwhile, <code class="inline-code">validateProjectPath</code> ensures that explorers tread only within sanctified paths. The <code class="inline-code">captureRepomixStdout</code> serves as a conduit for invoking <code class="inline-code">repomix</code>, capturing the encoded wisdom hidden in the jungle of code.</p>
<h4>Highlights</h4>
<ul>
<li><strong><code class="inline-code">RepoAnalyzer.generateRepomixContext</code></strong>: Generates comprehensive or targeted context from a repository to aid in exploration.</li>
<li><strong><code class="inline-code">RepoAnalyzer.captureRepomixStdout</code></strong>: Bridges raw content collection via the repomix subprocess.</li>
<li><strong><code class="inline-code">RepoAnalyzer.validateProjectPath</code></strong>: Guards traversing sanctified paths, preventing unsafe journeys.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  
  const configuredFiles = extractUniqueFilePaths(projectPath);
  
  if (configuredFiles.length &gt; 0) {
    console.log(`Using adventure.config.json: analyzing ${configuredFiles.length} configured files with optimization`);
    return await this.generateOptimizedContent(projectPath, configuredFiles);
  }
  
  console.log(&#39;No adventure.config.json found: analyzing full codebase (compressed)&#39;);
  
  const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }
  
  const cliOptions: CliOptions = {
    style: options.style || &#39;markdown&#39;,
    compress: options.compress !== false,
    ignore: [&#39;node_modules&#39;, &#39;dist&#39;, &#39;build&#39;, &#39;.git&#39;, &#39;coverage&#39;, &#39;.nyc_output&#39;].join(&#39;,&#39;),
    removeComments: true,
    removeEmptyLines: true,
    noDirectoryStructure: true
  };
  
  const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
  this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
  return context;
}
</code></pre>
<p>This method is the cartographer&#39;s tool, creating a map of the repository’s depths and efficiently caching its sacred glyphs.</p>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [
      ...directories,
      &#39;--stdout&#39;,
      &#39;--style&#39;, options.style || &#39;markdown&#39;,
      options.compress ? &#39;--compress&#39; : &#39;&#39;,
      options.removeComments ? &#39;--remove-comments&#39; : &#39;&#39;,
    ];
    
    const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], { cwd });
    
    let stdout = &#39;&#39;;
    repomix.stdout.on(&#39;data&#39;, (data) =&gt; { stdout += data.toString(); });
    
    repomix.on(&#39;close&#39;, (code) =&gt; {
      if (code === 0) resolve(stdout);
      else reject(new Error(`Repomix failed with code ${code}`));
    });
  });
}
</code></pre>
<p>This subprocess invocation channels wisdom shared by external tools, weaving raw content into structured repositories of knowledge.</p>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39; || projectPath.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Invalid project path&#39;);
  }
  
  const trimmedPath = projectPath.trim();
  if (!fs.existsSync(trimmedPath)) {
    throw new Error(&#39;Project path does not exist&#39;);
  }
}
</code></pre>
<p>This safeguard ensures aspirants tread only valid paths, avoiding traps of misconfiguration or dangerous byways.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> Interface to language models for code assistance</h3>
<p>The <code class="inline-code">LLMClient</code> serves as an ancient Oracle interpreter, connecting to sacred entities like OpenAI and Azure OpenAI to decode the wisdom hidden in prompts. Whether through invoking distant temples (APIs) or translating glyph-symbolic responses, it shepherds the journey from query to enlightenment.</p>
<p>Key functions clarify the Oracle’s response, guard important decisions like selecting API tokens, and shape requests tailored to specific temples. The constructor sets the stage by configuring access credentials, ensuring seekers approach the Oracle in reverence.</p>
<h4>Highlights</h4>
<ul>
<li><strong><code class="inline-code">LLMClient.generateResponse</code></strong>: Invokes the Oracle to unravel mysteries from prompts.</li>
<li><strong><code class="inline-code">LLMClient.constructor</code></strong>: Sanctifies the class, enabling safe and structured Oracle consultation.</li>
<li><strong><code class="inline-code">LLMClient.getApiKey</code></strong>: Retrieves the key to access esoteric temples, ensuring secure and authenticated entry.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  const requestParams = this.buildRequestParams(prompt, options);
  const completion = await this.executeRequest(requestParams);
  let content = this.validateResponse(completion);
  
  if (options?.responseFormat === &#39;json_object&#39;) {
    content = this.cleanJsonResponse(content);
  }
  
  this.logTokenUsage(completion);
  return { content };
}
</code></pre>
<p>This method acts as a ritual to pose questions to the Oracle, carefully crafting their structure and verifying divine answers.</p>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;
  
  const apiKey = this.getApiKey();
  if (!apiKey || !LLM_BASE_URL) {
    throw new Error(&#39;LLM configuration required.&#39;);
  }

  this.client = LLM_BASE_URL.includes(&#39;azure.com&#39;)
    ? new AzureOpenAI({ endpoint: LLM_BASE_URL, apiKey })
    : new OpenAI({ apiKey, baseURL: LLM_BASE_URL });
}
</code></pre>
<p>The constructor establishes a sacred bond with the chosen entity, creating a conduit for the flow of ancient wisdom.</p>
<pre><code class="language-typescript">private getApiKey(): string {
  if (LLM_BASE_URL.includes(&#39;models.inference.ai.azure.com&#39;)) {
    if (!GITHUB_TOKEN) {
      throw new Error(&#39;GITHUB_TOKEN required for GitHub Models.&#39;);
    }
    return GITHUB_TOKEN;
  }
  
  if (!LLM_API_KEY) {
    throw new Error(&#39;LLM_API_KEY required.&#39;);
  }
  return LLM_API_KEY;
}
</code></pre>
<p>This guardian ensures only those equipped with the sacred keys (API credentials) may proceed to approach the Oracle.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Be wary of paths not aligned with project expectations; validate thoroughly before starting a quest.</li>
<li>When interacting with the Oracle, ensure prompts are streamlined for the most lucid insights.</li>
<li>Use caching to revisit safely well-traveled knowledge pathways without redundancy.</li>
</ul>
<hr>
<p>You feel the glyphs resonate—the Oracle appears. The wisdom of craftsmanship is within your grasp.</p>
<p>Through thy steadfast pursuit and sacred wisdom, thou hast unveiled the ancient glyphs of the oracle—rejoice, for the path to enlightenment shines brighter with each triumphant step, noble seeker! ⚡💎🗺️</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">← Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>