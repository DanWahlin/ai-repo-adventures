<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Chamber of Eternal Stories - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Lost Codex of the Digital Pyramid</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Chamber of Eternal Stories</h1>
<hr>
<p>Beneath the gleaming pyramid of wisdom lies the Chamber of Eternal Stories, a place where ancient architects inscribed the secrets of digital storytelling. Here, glowing glyphs on seamless metal walls whisper the tales of forgotten algorithms and storytelling frameworks. Only by piecing together fragments of knowledge hidden within these walls can an adventurer fully unlock the codex to learn the sacred art of quest building. Your task: decode the intertwined systems that shape quests, themes, and their generation in the vast pyramid.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Thematic Architectures</strong>: How does the <code class="inline-code">AdventureManager</code> initialize a thematic context for quests, and what role does <code class="inline-code">StoryGenerator</code> play in shaping the narrative?</li>
<li>‚ö° <strong>Quest Evolution</strong>: How are quests validated, retrieved, and their content dynamically generated by <code class="inline-code">AdventureManager</code> and <code class="inline-code">StoryGenerator</code>?</li>
<li>üõ°Ô∏è <strong>Safeguards of the Codex</strong>: What safety mechanisms are in place when loading and parsing <code class="inline-code">adventure.config.json</code> in <code class="inline-code">adventure-config.ts</code>?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Orchestrating the Narrative</h3>
<p>The <code class="inline-code">AdventureManager</code> is the central architect of adventures, driving the initialization of thematic stories, quest validation, and the generation of quest-specific content. It consolidates inputs from other components like the <code class="inline-code">StoryGenerator</code> and <code class="inline-code">adventure-config.ts</code> to shape the narrative experience.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Configures the adventure scope by setting the <code class="inline-code">AdventureState</code>, collaborating with <code class="inline-code">StoryGenerator</code> to generate overall stories and quests, and integrating config data for customization.</li>
<li><code class="inline-code">exploreQuest</code>: Retrieves and executes specific quests by parsing user choices and either generating new dynamic content or leveraging cached results.</li>
<li><code class="inline-code">mergeQuestFilesFromConfig</code>: Harmonizes quest files from <code class="inline-code">adventure.config.json</code> into generated quests, ensuring a tailored experience aligned to the configuration.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>The <code class="inline-code">initializeAdventure</code> method establishes the adventure&#39;s root context, setting up the project information, theme, and configuration file integration.</li>
<li>Collaborates with the <code class="inline-code">StoryGenerator</code> to retrieve quests and stories tied to the provided theme.</li>
<li>Ensures customization by including files and data from <code class="inline-code">adventure.config.json</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);

  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }

  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>This method drives quest interactions, validating user input and dynamically determining the quest to explore.</li>
<li>It ensures smooth handling of progress requests and returns detailed adventure results for the chosen quest.</li>
<li>Employs methods like <code class="inline-code">findQuest</code>, <code class="inline-code">isProgressRequest</code>, and <code class="inline-code">executeQuest</code> to modularize functionality.</li>
</ul>
<pre><code class="language-typescript">private mergeQuestFilesFromConfig(quests: Quest[], projectPath: string | undefined): Quest[] {
  if (!projectPath) return quests;
  
  const config = parseAdventureConfig(projectPath);
  if (!config || typeof config !== &#39;object&#39;) return quests;

  const adventure = (config as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) return quests;

  const configQuestFiles = new Map&lt;string, string[]&gt;();
  for (const configQuest of adventure.quests) {
    if (configQuest.title &amp;&amp; Array.isArray(configQuest.files)) {
      const filePaths = configQuest.files
        .filter((f: any) =&gt; f.path)
        .map((f: any) =&gt; f.path);
      configQuestFiles.set(configQuest.title.toLowerCase(), filePaths);
    }
  }

  return quests.map((quest, index) =&gt; {
    const configQuests = adventure.quests;
    if (index &lt; configQuests.length &amp;&amp; configQuests[index]) {
      const files = configQuests[index].files
        .filter((f: any) =&gt; f.path)
        .map((f: any) =&gt; f.path);
      if (files.length &gt; 0) {
        return { ...quest, codeFiles: files };
      }
    }

    const questTitleLower = quest.title.toLowerCase();
    for (const [configTitle, files] of configQuestFiles.entries()) {
      if (questTitleLower.includes(configTitle)) {
        return { ...quest, codeFiles: files };
      }
    }

    return quest;
  });
}
</code></pre>
<ul>
<li>This method integrates configuration data into dynamically generated quests for better alignment with the project context.</li>
<li>Performs title matching and fallback logic to associate files with the appropriate quests.</li>
<li>Ensures that quest customization is fully realized using the adventure configuration.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The Config Codex</h3>
<p>This file manages loading, parsing, and validating <code class="inline-code">adventure.config.json</code> files to ensure that quests align with user-defined settings. By optimizing and extracting relevant file paths, it serves as a key artifact in the codex.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads <code class="inline-code">adventure.config.json</code> from a specific project path if it exists.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts and verifies file paths to ensure accurate file references are used in quests.</li>
<li><code class="inline-code">parseAdventureConfig</code>: Provides safe JSON parsing and validation to convert raw adventure config files into structured objects.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Incorporate comments while tracing <code class="inline-code">mergeQuestFilesFromConfig</code> to understand dynamic file merging strategies.</li>
<li>Pay attention to error handling in <code class="inline-code">adventure-config.ts</code> when parsing corrupted or invalid JSON files.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>By the sacred mantle of wisdom&#39;s eternal flame, thou hast triumphed in unraveling the arcane tomes within the Chamber of Eternal Stories‚Äîadvance forth, brave seeker, for the stars align with thy noble quest! ‚≠ê‚ö°üì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>