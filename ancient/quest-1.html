<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Temple of MCP Tool Rituals - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Sacred Repository of Ancient Wisdom</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Temple of MCP Tool Rituals</h1>
<hr>
<p>Beneath a canopy of towering trees, you stumble upon the Sacred Repository‚Äôs central chamber‚Äîa forgotten hall filled with inscriptions detailing the ancient rites of the MCP Tool Rituals. The stone walls pulse gently with the energy of long-lost wisdom. Each glyph recounts the ceremonial use of tools to shape and decipher enigmatic constructs of the ancients, revealing truths that could guide adventurers through the labyrinth of digital knowledge. To grasp the secrets of these powerful tools, you must decipher the specific inscriptions stored within these sacred texts. The challenge awaits!</p>
<h2>File Exploration</h2>
<h3>File: <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a>: MCP server protocol implementation that hosts the adventure tools</h3>
<p>The <strong>MCP server</strong> serves as a grand conduit for the rituals of interactive exploration. It operationalizes the tools by enabling dynamic request handling and graceful communication protocols. The <code class="inline-code">RepoAdventureServer</code> class embodies the wisdom of the codemasters: the <code class="inline-code">setupHandlers</code> method invokes the magical rites of registering tools, <code class="inline-code">run</code> brings the temple to life, and <code class="inline-code">main</code> safeguards the sanctity of the server‚Äôs lifecycle.</p>
<h4>Highlights</h4>
<ul>
<li><strong><code class="inline-code">RepoAdventureServer.setupHandlers</code></strong>: Crafts handlers for listing and invoking MCP tools, ensuring dynamic interaction.</li>
<li><strong><code class="inline-code">RepoAdventureServer.run</code></strong>: Activates the sacred link (stdio transport) and initiates preemptive preparation.</li>
<li><strong><code class="inline-code">main</code></strong>: Ensures protection against ungraceful failure and manages lifecycle rituals for the adventure server.</li>
</ul>
<h2>Code</h2>
<h3>File: <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a></h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      // Execute the tool handler with validated arguments
      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>This is akin to constructing a sacred scroll, where each spell (tool) is carefully indexed and validated before invocation.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  // Pre-generate repomix content for the current working directory to warm up the cache
  // This happens in the background while waiting for user commands
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>Here, the server illuminates the chamber with its presence, initiating preparatory measures for the rituals ahead.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    
    // Handle graceful shutdown for both signals
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    
    // Handle unhandled promise rejections - log but don&#39;t shutdown during normal operation
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
      // Don&#39;t call gracefulShutdown() here as it may be a recoverable error
    });
    
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>This is the final invocation, ensuring ritual protection and stability as the server‚Äôs purpose is fulfilled.</p>
<hr>
<h3>File: <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a>: The 4 main MCP tools that provide the user interface to the adventure system</h3>
<p>The <strong>tool repository</strong> is a treasure vault, containing instructions for the sacred MCP rituals. Each tool possesses unique abilities, designed to lead adventurers through phases of the journey. From launching an adventure (<code class="inline-code">start_adventure</code>) to tracking progress (<code class="inline-code">view_progress</code>), these tools embody the wisdom carved into digital stone.</p>
<h4>Highlights</h4>
<ul>
<li><strong><code class="inline-code">start_adventure.handler</code></strong>: Initiates the rites of repository analysis and presents themes to the explorer.</li>
<li><strong><code class="inline-code">choose_theme.handler</code></strong>: Weaves the tapestry of quests based on a chosen narrative theme.</li>
<li><strong><code class="inline-code">explore_quest.handler</code></strong>: Conducts specific ritual explorations to uncover hidden treasures.</li>
<li><strong><code class="inline-code">view_progress.handler</code></strong>: Illuminates the seeker‚Äôs journey thus far, marking progress and remaining mysteries.</li>
</ul>
<h2>Code</h2>
<h3>File: <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a></h3>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
</code></pre>
<p>This initiation tool carves the seeker‚Äôs first path into the ruins, preparing the thematic foundation of the journey.</p>
<pre><code class="language-typescript">export const choose_theme = chooseTheme;
</code></pre>
<p>Thematically-oriented, this tool provides a compass, guiding the adventurer toward their preferred style of exploration.</p>
<pre><code class="language-typescript">export const explore_quest = exploreQuest;
</code></pre>
<p>Through this, the seeker unravels a specific challenge, engaging with its mysteries in a focused, intentional manner.</p>
<pre><code class="language-typescript">export const view_progress = viewProgress;
</code></pre>
<p>This ritual reveals the adventurer‚Äôs milestones, marking victories and uncovering the trials yet to come.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Explore the <strong><code class="inline-code">setupHandlers</code></strong> method to decipher the invocation mechanics of MCP tools.</li>
<li>Use the <strong><code class="inline-code">start_adventure</code></strong> tool to understand repository analysis before beginning custom adventures.</li>
<li>Investigate <code class="inline-code">repoAnalyzer</code> utilities for optimizing your jungle expeditions (e.g., caching and preemptive analysis).</li>
</ul>
<hr>
<p>Ancient inscriptions whisper your success: The Temple is yours to command. Carry this knowledge well, adventurer‚Äîthe path unfolds!</p>
<p>Hark, brave seeker, thou hast completed the sacred rites of the Temple of MCP Tool Rituals‚Äîlet the stars bear witness to thy wisdom gained and triumph eternal! ‚≠êüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Pyramid of Adaptive Storyte... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>