<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Chamber of Rituals - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Pyramid of Code: An Archaeological Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Chamber of Rituals</h1>
<hr>
<p>In the heart of the Pyramid of Code lies the Chamber of Rituals, an opulent and intricate sanctum adorned with carvings of enigmatic glyphs. The air is heavy with the scent of ancient incense as you approach an altar enshrouded in golden light. Artifacts of immense power are scattered about‚Äîa sacred server hums, whispering mysteries, while crystalline tablets project holographic tools awaiting invocation. Unlocking this chamber‚Äôs wisdom requires delving into the ancient scripts inscribed within the chamber walls and deciphering the essence of the tools that animate this sanctified repository.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Core Implementation</h3>
<p>This file acts as the cornerstone of the Pyramid, symbolizing the altar where code rituals come to life. It constructs and controls the <code class="inline-code">RepoAdventureServer</code>, configuring its sacred rites (handlers) and preparing the domain for adventurers. Distinct portions of the text, such as <code class="inline-code">setupHandlers</code> and <code class="inline-code">run</code>, represent practical implementations of chamber rituals that bring the tools to life. The <code class="inline-code">main</code> method acts as the ceremonial invocation for initiating all these interconnected rites.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers</code>: Defines protocols (handler rituals) for interacting with tools and validates their invocations.</li>
<li><code class="inline-code">run</code>: Orchestrates the server&#39;s connectivity and prepares the groundwork for further quests.</li>
<li><code class="inline-code">main</code>: Embodies the final invocation sequence to summon the sacred server.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;
        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }
        const tool = tools[name as keyof typeof tools];
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }
        return await tool.handler(validationResult.data as any);
      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
}
</code></pre>
<p>This corresponds to carving ceremonial commands onto the chamber walls, ensuring accurate invocations of tools and safeguarding their usage.</p>
<pre><code class="language-typescript">async run() {
    const transport = new StdioServerTransport();
    await this.server.connect(transport);
    console.error(&#39;Repo Adventure MCP server running on stdio&#39;);

    const projectPath = process.cwd();
    console.error(`Pre-generating repomix content for project at ${projectPath}...`);
    repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>Like adorning the chamber altar with powerful energies, this prepares the chamber with functional interfaces and primes it for interaction with adventurers.</p>
<pre><code class="language-typescript">async function main() {
    try {
        const server = new RepoAdventureServer();
        [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt;
            process.on(sig as NodeJS.Signals, gracefulShutdown)
        );
        process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
            console.error(&#39;Unhandled promise rejection:&#39;, reason);
            console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
        });
        await server.run();
    } catch (error) {
        console.error(&#39;Fatal error starting MCP server:&#39;, error);
        process.exit(1);
    }
}
</code></pre>
<p>This final act is akin to performing a sacred chant, calling forth the chamber&#39;s life and awakening its latent powers.</p>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools Entry</h3>
<p>Serving as the Chalice of Rituals, this file defines the critical instruments available within the Pyramid. Each tool is a dynamic artifact, inscribed with an ancient methodology and equipped to guide travelers through their quest. The tools exported‚Äî<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>‚Äîact as versatile aids toward understanding and conquering the codebase‚Äôs mysteries.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Defines the entrance rite, introducing the Pyramid‚Äôs realms.</li>
<li><code class="inline-code">choose_theme.handler</code>: Customizes the chamber‚Äôs rituals into meaningful, thematic explorations.</li>
<li><code class="inline-code">explore_quest.handler</code> and <code class="inline-code">view_progress.handler</code>: Facilitates deep dives into quests and tracking progress.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const start_adventure = startAdventure;
</code></pre>
<p>This inaugurates the adventurer‚Äôs journey into the Pyramid, initializing its first rites and possibilities.</p>
<pre><code class="language-typescript">export const choose_theme = chooseTheme;
</code></pre>
<p>This artifact molds the rituals into unique thematic formats, offering pathways tailored to an adventurer&#39;s desires.</p>
<pre><code class="language-typescript">export const explore_quest = exploreQuest;
export const view_progress = viewProgress;
</code></pre>
<p>These artifacts sustain the quest journey, allowing adventurers to interact with challenges and monitor their ritualistic progress.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">start_adventure</code> for initiating your tale and uncovering the roots of the repository.</li>
<li>Experiment with <code class="inline-code">choose_theme</code> to adapt the ancient mysteries to your preferred style.</li>
<li>Remember to periodically invoke <code class="inline-code">view_progress</code> to maintain awareness of your standing within the Chamber of Rituals.</li>
</ul>
<hr>
<p>Keep the fires of the ancient chamber alive, adventurer. Your treasure awaits‚Äîforge ahead!</p>
<p>Through thy sacred endeavor in the Chamber of Rituals, thou hast unlocked the first wisdom of ages, an auspicious beginning to the odyssey ahead‚Äîhail thy triumph, seeker of ancient truths! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>