<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Temple of the Four Relics - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Lost Scrolls of Repoa: Unearthing the Codebound Mysteries</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Temple of the Four Relics</h1>
<hr>
<p>The sun filters through the dense canopy of the Repoa jungle, casting shimmering mosaics onto the ancient stones beneath your feet. Before you looms the entrance to the Temple of the Four Relics. Vines and moss cling to its towering walls, while whispering winds murmur of secrets buried deep within. The glyphs etched onto the temple door seem familiar yet alien‚Äîa fusion of patterns suggesting order and chaos. With the Scrolls of Codebound Wisdom scattered across the land, the temple beckons you to uncover the hidden relics that hold the power to harmonize the building blocks of ancient systems.  </p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>This file is the beating heart of the system, where the grand adventure begins to take shape. It introduces the <code class="inline-code">RepoAdventureServer</code>, a critical class responsible for orchestrating the connection between the user and the adventure tools. With <code class="inline-code">stdio</code> transport as its communication conduit, the server sets up protocols to list tools dynamically and execute them by interpreting user requests. Functions such as <code class="inline-code">setupHandlers()</code> ensure that the tools are accessible and validated, ensuring no adventurer strays into forbidden paths. The <code class="inline-code">run()</code> method undertakes a ceremonial-like pre-generation of &quot;repomix content,&quot; a process akin to preparing sacred texts for exploration. To preserve the journey‚Äôs integrity, the system includes mechanisms for graceful shutdown in response to signals like <code class="inline-code">SIGINT</code> and <code class="inline-code">SIGTERM</code>, ensuring the temple leaves no stone overturned when the expedition ends.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers()</code>: Registers handlers for dynamic tool listing and execution.  </li>
<li><code class="inline-code">RepoAdventureServer.run()</code>: Initializes <code class="inline-code">stdio</code> transport and pre-generates content as setup for the code adventure.  </li>
<li><code class="inline-code">main()</code>: Manages entry points and supports graceful shutdown to handle unexpected interruptions.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Adventure Tools Entry Point</h3>
<p>This file embodies the essence of the adventurer&#39;s toolkit. The tools forge the bridge between the user and the mysteries of the sacred code. With functions like <code class="inline-code">start_adventure.handler</code>, the adventurer is greeted with a wealth of options and themes after repository analysis. From there, <code class="inline-code">choose_theme.handler</code> allows the selection of the narrative cloak under which the journey unfolds. <code class="inline-code">explore_quest.handler</code> dives into specific challenges within the repository‚Äîscaling puzzles and solving riddles hidden in the files. At each step, <code class="inline-code">view_progress.handler</code> serves as the adventurer&#39;s map, revealing milestones reached and paths yet untraveled. By encapsulating these tools and export structures, this file sets the stage for a rich, dynamic quest experience.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Launches the journey by analyzing the codebase and offering themes.  </li>
<li><code class="inline-code">choose_theme.handler</code>: Empowers adventurers to choose their preferred story-based narrative.  </li>
<li><code class="inline-code">explore_quest.handler</code>: Unravels specific quest challenges within the codebase, fostering continued exploration.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {  
  private server: Server;  

  constructor() {  
    this.server = new Server(  
      {  
        name: &#39;repo-adventure&#39;,  
        version: &#39;1.0.0&#39;,  
        description: &#39;A gamified MCP server for exploring code repositories through interactive storytelling&#39;  
      },  
      {  
        capabilities: {  
          tools: {},  
        },  
      }  
    );  

    this.setupHandlers();  
  }  

  private setupHandlers() {  
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {  
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({  
        name,  
        description: tool.description,  
        inputSchema: zodToJsonSchema(tool.schema, {  
          target: &#39;jsonSchema7&#39;,  
          $refStrategy: &#39;none&#39;  
        })  
      }));  

      return { tools: toolList };  
    });  
  }  

  async run() {  
    const transport = new StdioServerTransport();  
    await this.server.connect(transport);  
    console.error(&#39;Repo Adventure MCP server running on stdio&#39;);  

    const projectPath = process.cwd();  
    console.error(`Pre-generating repomix content for project at ${projectPath}...`);  
    repoAnalyzer.preGenerate(projectPath);  
  }  
}  
</code></pre>
<p>The <code class="inline-code">RepoAdventureServer</code> acts as the adventure guide, directing explorers to the right paths and preparing them for the marvels ahead.  </p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {  
  start_adventure,  
  choose_theme,  
  explore_quest,  
  view_progress  
};  

import { startAdventure } from &#39;./tools/start-adventure.js&#39;;  
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;  
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;  
import { viewProgress } from &#39;./tools/view-progress.js&#39;;  

export const adventureManager = {  
  start_adventure,  
  choose_theme,  
  explore_quest,  
  view_progress  
};  

export { adventureManager };  
</code></pre>
<p>This code equips the adventurer with tools that enable repository exploration, theme customization, and progress monitoring‚Äîall within the boundaries of the ancient jungle&#39;s wisdom.  </p>
<h2>Helpful Hints</h2>
<ul>
<li>Remember to ensure that your <code class="inline-code">stdio</code> transport remains secure and accessible when setting up the server.  </li>
<li>When modifying the adventure tools, explore how functions interact within <code class="inline-code">tools.ts</code> to maintain smooth workflow compatibility.  </li>
<li>Dive deeper into the <code class="inline-code">repoAnalyzer</code> methods to better understand the pre-generation routines and capabilities.</li>
</ul>
<hr>
<p>Hark, noble seeker, thou hast ascended the hallowed grounds of the Temple of the Four Relics, unlocking the first luminous shard of ancient wisdom‚Äîmay thy path glow ever brighter! üè∫üíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Chamber of Narrative Keeper... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>