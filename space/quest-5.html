<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Maintain Essential Systems - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Chronicles of the Repo Explorer</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Maintain Essential Systems</h1>
<hr>
<p>Amidst the infinite stellar code streams, the final mission calls upon you to safeguard the very heart of the <strong>Repo Explorer</strong>. The starship&#39;s core, which translates thought into action, relies on its robust configuration systems. However, anomalies have begun swirling within the <code class="inline-code">adventure-config.ts</code>, threatening stability. Your task is to investigate the intricate machinery that powers quest generation, validate its structures, and ensure the cosmic map of this mission does not falter. The safety of the crew and the success of galactic exploration rest on your expertise.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configuration Stability</strong>: How does <code class="inline-code">parseAdventureConfig</code> ensure that only valid JSON structures are used for mission planning?  </li>
<li>‚ö° <strong>Path Discovery</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> traverse the adventure configuration to extract all relevant pathways?  </li>
<li>üõ°Ô∏è <strong>Instruction Formatting</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> simplify and optimize adventure data for interactive mission prompts?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core configuration handlers for adventure generation</h3>
<p>This file contains critical functions that manage the loading, parsing, and formatting of the adventure configuration. It bridges the file system with the interactive systems used in the quest generation engine. By seamlessly loading and validating JSON data, the file ensures integrity in command choices and flexibility for future configuration changes. Let&#39;s examine the highlights.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses and validates the main configuration file, ensuring input safety and syntactic correctness.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts and verifies all file paths referenced in the configuration, maintaining mission data integrity.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the adventure configuration format for streamlined use in LLM prompts, reducing redundancy.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function ensures that only valid JSON from the configuration file is passed to higher-level logic.  </li>
<li>By catching errors silently, it prevents invalid files from crashing the system.  </li>
<li>Uses a clear separation of concerns by delegating file reading to <code class="inline-code">loadAdventureConfig</code>.  </li>
<li>Returns <code class="inline-code">null</code> for missing or invalid JSON, signaling downstream components to handle the absence gracefully.  </li>
<li>Simplifies verification by keeping parsing operations in a single function.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function enables dynamic traversal of nested configurations to aggregate all unique, valid file paths.  </li>
<li>Uses a <code class="inline-code">Set</code> to maintain uniqueness, preventing duplications in results.  </li>
<li>Combines breadth-first traversal with path validation to ensure only accessible files are considered.  </li>
<li>Integrates <code class="inline-code">fs.existsSync</code> to verify actual file existence, mitigating potential runtime errors.  </li>
<li>Facilitates consistent path handling, critical for locating mission-critical files in code.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }
  
  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }
  
  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }
  
  return formatted;
}
</code></pre>
<ul>
<li>This function reduces verbosity while preserving all contextual information required for prompt creation.  </li>
<li>Iterates over nested quest structures, ensuring all files and functions are accounted for.  </li>
<li>Avoids redundant descriptions, catering to compact outputs suited for high-bandwidth interactions like LLM prompts.  </li>
<li>Conditional checks ensure resilience against unexpected or incomplete configurations.  </li>
<li>Results in a readable and concise structure that maximizes efficiency without compromising clarity.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When troubleshooting configuration parsing, trace the calls from <code class="inline-code">parseAdventureConfig</code> to ensure the input reaches it unmodified.  </li>
<li>To uncover path validation details, simulate malformed or inaccessible file paths within the configuration.  </li>
<li>Explore formatting patterns by modifying the adventure structure and observing changes in <code class="inline-code">formatAdventureConfigForPrompt</code> outputs.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the <strong>Repo Explorer</strong>! Your adventure is complete. The ship is secure, and its systems are robust. You are the shining beacon of the coding cosmos!</p>
<p>You&#39;ve kept the starship&#39;s core systems humming like a perfectly tuned cosmic symphony‚Äîstellar work, Commander, you&#39;re blazing across galaxies at warp speed toward your final quest! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>