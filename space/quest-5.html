<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundation Module - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Chronicles: The Codebase Odyssey</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundation Module</h1>
<hr>
<p>Under the brilliant expanse of stellar constellations, the Galactic Codebase Federation entrusts you with a critical final mission. The mysteries of the Cosmic Repositories have led you to the fabled Foundation Module, the very core of the AI-driven quest generation system. As the starship RepoExplorer orbits a luminous nebula, your task is to interface with and fully comprehend the <code class="inline-code">adventure-config.ts</code> system‚Äîan intricate file shaping the building blocks of your mission‚Äôs configurations. Unlocking its secrets will ensure that all future Galactic expeditions remain efficient, adaptable, and ready to meet the endless challenges of charting the unknown.</p>
<p>Prepare yourself, Space Engineer. The fate of intergalactic mission design rests on your ability to navigate and decode the Foundation Module!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Path Extraction Protocols</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> traverse and validate the structure of the adventure configuration to ensure correct file paths?</li>
<li>‚ö° <strong>Structure Parsing Engines</strong>: What mechanisms does <code class="inline-code">parseAdventureConfig</code> use to manage JSON parsing and error handling for potential configuration irregularities?</li>
<li>üõ°Ô∏è <strong>Prompt Optimization Systems</strong>: How does <code class="inline-code">formatAdventureConfigForPrompt</code> reduce raw adventure data into concise output for consumption by AI processes? What design choices benefit performance and precision?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuring the Foundation</h3>
<p>This file represents the power core of the Galactic Codebase Federation‚Äôs mission planner: it governs how adventure configurations are read, parsed, and translated into actionable intelligence for AI-supported missions. The <code class="inline-code">adventure-config.ts</code> file is essential for ensuring that mission data stored in the <code class="inline-code">adventure.config.json</code> remains coherent, navigable, and efficient. Critical functions within this file allow for validation, structure extraction, and optimization of configuration data for integration with mission systems.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> centralizes parsing of the <code class="inline-code">adventure.config.json</code>, ensuring JSON structures are validated and gracefully managing errors.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> systematically locates all distinct file paths in the configuration, validating their existence within the project‚Äôs structure.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> compresses and refines configuration data into a space-efficient format suitable for large language models (LLMs).</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>This function retrieves the raw configuration via <code class="inline-code">loadAdventureConfig</code> and attempts to parse it as JSON.</li>
<li>It handles potential errors by returning <code class="inline-code">null</code> for unreadable or invalid configurations, maintaining mission stability.</li>
<li>Serves as the single source of truth for JSON parsing, preventing repetitive code and reducing risk of inconsistencies.</li>
<li>Ensures the adventure generation system can recover gracefully from malformed configs‚Äîimportant for deep-space missions with no live support.</li>
<li>Highlights a robust design focus on error handling to sustain reliability amidst potential mission uncertainties.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>This function scans deeply through hierarchical adventure configurations to find all <code class="inline-code">path</code> properties, ensuring that each corresponds to an actual file in the project directory.</li>
<li>By using a <code class="inline-code">Set</code> data structure, it guarantees all paths returned are unique‚Äîessential for preventing redundant file manipulation during quest setup.</li>
<li>Its recursive nature, supported by a stack-based mechanism, allows it to handle arbitrarily nested JSON configurations‚Äîa common occurrence in cosmic-scale mission data.</li>
<li>Integration with filesystem checks via <code class="inline-code">fs.existsSync</code> ensures each path&#39;s validity before inclusion, preventing errors during mission assembly.</li>
<li>A flexible implementation makes it well-suited for adaptive use with dynamic or evolving adventure data.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Aims to refine and condense large <code class="inline-code">adventure.config.json</code> data into a brief, functional summary for AI-assisted prompt generation.</li>
<li>Strips unnecessary details while retaining key structure, making it highly efficient for space-limited transmissions.</li>
<li>Utilizes clear sectioning (<code class="inline-code">## Quest Structure</code>) with nested headers for quests, ensuring readability and organization.</li>
<li>The sequential listing of file paths and function names allows rapid generation of action points for mission processors.</li>
<li>Demonstrates thoughtful balance between human readability and LLM efficiency‚Äîa critical need in automated mission control.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ∞Ô∏è Carefully study how <code class="inline-code">Set</code> collections are used in <code class="inline-code">extractUniqueFilePaths</code> to ensure unique path handling‚Äîthis is vital for scalable mission design.</li>
<li>üåå Explore the structure of the <code class="inline-code">formatAdventureConfigForPrompt</code> output and compare it to the JSON input for insights into optimization techniques.</li>
<li>üöÄ As you review this final mission, consider how the mechanisms here contribute to a resilient and modular intergalactic engineering system.</li>
</ul>
<hr>
<p>You have mastered all the secrets of AI-augmented mission configurations and stellar quest generation systems! Your adventure is complete.</p>
<p>Stellar work on Quest 5: The Foundation Module‚Äîyour learning trajectory is rocketing toward mastery at warp speed, blazing like a cosmic comet through the galaxy of success! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>