<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Core Configuration Matrix - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Lumina: Expedition of Code Horizons</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Core Configuration Matrix</h1>
<hr>
<p>The crew of the <strong>Starship Lumina</strong> gathered on the bridge, their faces illuminated by the soft glow of nearby data constellations. This time, their mission demanded utter precision: they were tasked with unraveling the secrets of the <strong>Core Configuration Matrix</strong>, a vital system responsible for interpreting and enhancing the starship&#39;s adventures through the digital galaxy. With the <strong>MCP Command Core</strong> as their compass, they would chart a path through the labyrinth of configuration files, ensuring the starship&#39;s journey remained on course. The stakes had never been higher‚Äîmissteps could obscure clarity amid waves of chaotic data energy.</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Centralized Configuration Logic</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file serves as the backbone of the <strong>Core Configuration Matrix</strong>, managing the parsing, loading, and formatting of the <code class="inline-code">adventure.config.json</code> file‚Äîa key directive for guiding quests. This file ensures the <strong>Starship Lumina</strong> always has clear mission goals and structured prompts for the onboard AI. Among its notable functions, <code class="inline-code">loadAdventureConfig()</code> retrieves raw configuration data from the appropriate file path, while <code class="inline-code">parseAdventureConfig()</code> ensures the extracted JSON data is transformed into a valid object. Beyond this, <code class="inline-code">extractUniqueFilePaths()</code> acts as a cosmic cartographer, scanning the configuration&#39;s pathways for all relevant files, ensuring no critical files are missed. Finally, the <code class="inline-code">formatAdventureConfigForPrompt()</code> function formats the configuration into a user-friendly structure, preparing it for integration with language models during quest generation.</p>
<p>This is a masterful piece of code architecture‚Äîbalancing data access, validation, and organization into a cohesive framework. Each function operates like a stellar waypoint, ensuring the crew can safely traverse the complexity of the <strong>Core Configuration Matrix</strong>.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig()</code>: Safely retrieves raw configuration data, ensuring files are accessible.</li>
<li><code class="inline-code">parseAdventureConfig()</code>: Transforms the raw configuration into a usable object and validates structure.</li>
<li><code class="inline-code">extractUniqueFilePaths()</code>: Efficiently maps out all unique file paths referenced in the configuration.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code>: Formats the configuration for seamless alignment with quests.</li>
<li>Modular design ensures flexible and reusable utilities for evolving configurations.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    return null;
  }
}

export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}

export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<p>This code ensures that all pathways across the configuration galaxy are validated and traced, like plotting star maps to prevent losing data in the void.</p>
<h3>packages/core/src/shared/adventure-config.ts (continued)</h3>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure Guidelines\n\n`;
  formatted += `**CRITICAL: Each quest MUST include dedicated file analysis sections**\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    formatted += `${quest.description}\n\n`;
    formatted += `**Required File Analysis Sections:**\n`;

    for (const file of quest.files) {
      if (!file.path || !file.description) continue;

      formatted += `\n**File: \`${file.path}\`**\n`;
      formatted += `- Description: ${file.description}\n`;
      
      if (Array.isArray(file.highlights)) {
        formatted += `- Key Functions/Areas to Highlight:\n`;
        for (const highlight of file.highlights) {
          if (highlight.name &amp;&amp; highlight.description) {
            formatted += `  ‚Ä¢ **${highlight.name}**: ${highlight.description}\n`;
          }
        }
      }
    }
    formatted += `\n`;
  }

  formatted += `\n**FORMATTING INSTRUCTIONS:**\n`;
  formatted += `- Each file mentioned in the quest structure above MUST have its own dedicated analysis section\n`;
  formatted += `- **MANDATORY**: Include at least 2-3 separate code snippet sections (## filename) with real code blocks\n`;
  formatted += `- Provide practical explanations using real-world analogies\n`;
  formatted += `- End with helpful hints and next steps\n`;

  return formatted;
}
</code></pre>
<p>This section demonstrates how the structured configurations align seamlessly with the ship&#39;s mission directives, acting like a translator between the crew&#39;s objectives and the ship&#39;s AI.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Ensure all file paths referenced in the configuration exist, avoiding null errors during parsing.</li>
<li>Modularize the adventure configuration functions further to enhance flexibility in larger projects.</li>
<li>Investigate how the <code class="inline-code">formatAdventureConfigForPrompt()</code> function affects downstream processes and ensures compatibility with new quest structures.</li>
</ul>
<hr>
<p>Mission accomplished, stellar navigator! You‚Äôve powered through the Core Configuration Matrix and are now 80% closer to your intergalactic triumph‚Äîprepare for the final quest and ignite your cosmic legacy! üöÄ‚≠ê‚ö°</p>

</div>


    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>