<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Galactic HTML Forge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Code Chronicles: The Repository Odyssey</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Galactic HTML Forge</h1>
<hr>
<p>The starship <em>Code Voyager</em> has docked at the Orbiting Code Platform, ready for its first mission. Today, the mission control deck is abuzz with anticipation as the crew prepares to decode cosmic templates and resupply intergalactic repositories with optimized adventure files. Your task is to explore vital files to generate HTML adventures, query placeholder patterns, investigate asset managers, and ensure all systems are stable for interstellar navigation.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Placeholder Pattern Analysis</strong>: How does <code class="inline-code">replacePlaceholders</code> in <code class="inline-code">template-engine.ts</code> dynamically handle variable substitution within templates?</li>
<li>‚ö° <strong>Asset Flow Deployment</strong>: What operational steps are involved in <code class="inline-code">copyGlobalAssets</code> and <code class="inline-code">copyQuestNavigator</code> across <code class="inline-code">asset-manager.ts</code> to ensure completeness during asset transport?</li>
<li>üõ°Ô∏è <strong>Server Transport Activation</strong>: How does <code class="inline-code">startHttpServer</code> in <code class="inline-code">html-generator.ts</code> manage server initialization and secure file handling for generated output?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> Template processing and rendering</h3>
<p>This file houses the <code class="inline-code">TemplateEngine</code> class, critical for decoding HTML through template management and placeholder substitution. It dynamically loads cached templates from file storage, replaces placeholders using key-value mappings, and facilitates rendering intricate multi-layered pages efficiently.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadTemplate</code>: Fetches template files from the file system, caching them for reuse. Essential for minimizing file access overhead, especially during multi-file operations in vast codebases.</li>
<li><code class="inline-code">replacePlaceholders</code>: Replaces templated placeholders with dynamic values, enabling seamless conversion of abstract templates into finished pages.</li>
<li><code class="inline-code">renderPage</code>: Combines base and content templates into a complete output, allowing nested template rendering with centralized control over placeholders.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">private loadTemplate(templateName: string): string {
  if (this.templateCache.has(templateName)) {
    return this.templateCache.get(templateName)!;
  }

  const templatePath = path.join(this.templatesDir, templateName);
  
  try {
    const content = fs.readFileSync(templatePath, &#39;utf-8&#39;);
    this.templateCache.set(templateName, content);
    return content;
  } catch (error) {
    throw new Error(`Failed to load template ${templateName}: ${error}`);
  }
}
</code></pre>
<ul>
<li>Efficient caching reduces redundant file reads and enhances performance.</li>
<li>Clear error handling ensures traceable failures in template loading.</li>
<li>Centralized management of the <code class="inline-code">templatesDir</code> ensures consistent file access.</li>
</ul>
<hr>
<pre><code class="language-typescript">private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;

  for (const [key, value] of Object.entries(variables)) {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, &#39;g&#39;), value || &#39;&#39;);
  }

  return result;
}
</code></pre>
<ul>
<li>Iterative approach ensures every placeholder is replaced dynamically, allowing runtime customization.</li>
<li>Regular expressions ensure pattern matching for placeholder keys, creating a flexible system for template adjustments.</li>
<li>Ensures compatibility with varying values, including empty strings.</li>
</ul>
<hr>
<pre><code class="language-typescript">renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  const pageVariables = { ...variables, CONTENT: renderedContent };
  
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>Combines content and base templates, creating coherent multi-layered outputs.</li>
<li>Centralized rendering context simplifies the integration of nested content layers.</li>
<li>Supports adaptability by using key-value mappings to merge dynamic content precisely.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> Asset transportation and replication</h3>
<p>The <code class="inline-code">AssetManager</code> class handles dynamic replication of essential assets (images, navigators, shared resources) to ensure availability across generated themes and files. Its operations are key for maintaining the interconnectivity of HTML adventures.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyGlobalAssets</code>: Deploys shared resources across the entire adventure output while ensuring directory consistency.</li>
<li><code class="inline-code">copyQuestNavigator</code>: Handles theme-specific asset duplication, crucial for maintaining modularity in single-theme operations.</li>
</ul>
<hr>
<h3>Code</h3>
<h4>packages/generator/src/cli/asset-manager.ts</h4>
<pre><code class="language-typescript">copyGlobalAssets(outputDir: string): void {
  try {
    const globalAssetsDir = path.join(outputDir, &#39;assets&#39;);
    const targetImagesDir = path.join(globalAssetsDir, &#39;images&#39;);
    fs.mkdirSync(targetImagesDir, { recursive: true });

    const globalSharedDir = path.join(outputDir, &#39;assets&#39;, &#39;shared&#39;);
    fs.mkdirSync(globalSharedDir, { recursive: true });
    
    const globalImages = [&#39;github-mark.svg&#39;, &#39;github-mark-white.svg&#39;];
    globalImages.forEach(file =&gt; {
      const sourcePath = path.join(this.sourceDir, &#39;assets&#39;, &#39;shared&#39;, file);
      if (fs.existsSync(sourcePath)) {
        const targetPath = path.join(globalSharedDir, file);
        fs.copyFileSync(sourcePath, targetPath);
      }
    });
  } catch (error) {
    console.log(chalk.yellow(&#39;‚ö†Ô∏è Warning: Could not copy global images&#39;));
  }
}
</code></pre>
<ul>
<li>Ensures consistent directory structure with <code class="inline-code">mkdirSync</code> calls.</li>
<li>Patterns demonstrate robust handling of shared resources like images and icons.</li>
<li>Fallback logging prevents silent failures.</li>
</ul>
<hr>
<pre><code class="language-typescript">copyQuestNavigator(outputDir: string): void {
  const templatesDir = path.join(this.sourceDir, &#39;templates&#39;);
  const cssSource = path.join(templatesDir, &#39;quest-navigator.css&#39;);
  const jsSource = path.join(templatesDir, &#39;quest-navigator.js&#39;);
  const svgSource = path.join(templatesDir, &#39;compass-icon.svg&#39;);

  const assetsDir = path.join(outputDir, &#39;assets&#39;);
  fs.mkdirSync(assetsDir, { recursive: true });

  if (fs.existsSync(cssSource)) {
    fs.copyFileSync(cssSource, path.join(assetsDir, &#39;quest-navigator.css&#39;));
  }
  if (fs.existsSync(jsSource)) {
    fs.copyFileSync(jsSource, path.join(assetsDir, &#39;quest-navigator.js&#39;));
  }
  if (fs.existsSync(svgSource)) {
    fs.copyFileSync(svgSource, path.join(assetsDir, &#39;compass-icon.svg&#39;));
  }
}
</code></pre>
<ul>
<li>Modular replication ensures logical separation of theme-specific assets.</li>
<li>Includes adaptive logic for CSS, JS, and SVG files, ensuring full dependency transport.</li>
<li>Signals last-mile connectivity integrity across adventures.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> Adventure output generation and serving</h3>
<p>This file oversees the <em>Code Voyager&#39;s</em> HTML generation operations, including compiling adventures into HTML files, setting up runtime directories, and launching servers for quest journeys.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">startHttpServer</code>: Hosts generated adventures through an HTTP server, vital for user exploration.</li>
<li><code class="inline-code">generateAdventure</code>: Orchestrates the entire HTML output setup while deploying templates and assets.</li>
</ul>
<hr>
<h3>Code</h3>
<h4>packages/generator/src/cli/html-generator.ts</h4>
<pre><code class="language-typescript">async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
  const server = http.createServer((req, res) =&gt; {
    let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);

    if (!filePath.startsWith(this.outputDir)) {
      res.writeHead(403);
      res.end(&#39;Forbidden&#39;);
      return;
    }

    const extname = path.extname(filePath);
    let contentType = &#39;text/html&#39;;
    switch (extname) {
      case &#39;.js&#39;: contentType = &#39;text/javascript&#39;; break;
      case &#39;.css&#39;: contentType = &#39;text/css&#39;; break;
      case &#39;.png&#39;: contentType = &#39;image/png&#39;; break;
      case &#39;.svg&#39;: contentType = &#39;image/svg+xml&#39;; break;
    }

    fs.readFile(filePath, (err, content) =&gt; {
      if (err) {
        if (err.code === &#39;ENOENT&#39;) {
          res.writeHead(404);
          res.end(&#39;File not found&#39;);
        } else {
          res.writeHead(500);
          res.end(&#39;Server error&#39;);
        }
      } else {
        res.writeHead(200, { &#39;Content-Type&#39;: contentType });
        res.end(content, &#39;utf-8&#39;);
      }
    });
  });

  server.listen(port, () =&gt; {
    console.log(chalk.green(`üåê HTTP server started on http://localhost:${port}`));
  });
}
</code></pre>
<ul>
<li>Prioritizes security by validating file paths before access.</li>
<li>Streamlines content type handling for common file extensions.</li>
<li>Implements robust error code differentiation (<code class="inline-code">404</code>, <code class="inline-code">500</code>) for clear diagnostics.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateAdventure(): Promise&lt;void&gt; {
  const repomixContent = await repoAnalyzer.generateRepomixContext(this.projectPath);
  const projectInfo = createProjectInfo(repomixContent);

  const storyContent = await this.adventureManager.initializeAdventure(
    projectInfo, 
    this.selectedTheme, 
    this.projectPath,
  );

  this.extractQuestInfo();
  this.generateThemeCSS();
  this.copyQuestNavigator();
  this.generateIndexHTML();
  await this.generateQuestPages();
  await this.generateSummaryHTML();
}
</code></pre>
<ul>
<li>Integrates multiple subsystems (<code class="inline-code">RepoAnalyzer</code>, <code class="inline-code">TemplateEngine</code>, <code class="inline-code">AssetManager</code>) into a cohesive flow.</li>
<li>Dynamically adjusts operations based on theme-specific configurations.</li>
<li>Ensures the adventure&#39;s core structure is consistent across output.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use caching strategies like <code class="inline-code">loadTemplate</code> to reduce redundant file reads for large projects.</li>
<li>Prioritize modular structures for assets using <code class="inline-code">copyQuestNavigator</code> to maintain flexibility across themes.</li>
<li>When setting up servers (e.g., <code class="inline-code">startHttpServer</code>), implement robust security checks to prevent unauthorized access.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Quest 1: Galactic HTML Forge COMPLETE‚Äîyour cosmic coding engines are firing at warp speed, Commander, as you ignite your path to digital stardom! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>