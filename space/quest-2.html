<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: Galactic Story Synthesizer - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Code Expeditions: Navigating the Stellar Core</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: Galactic Story Synthesizer</h1>
<hr>
<p>The AI Repository Command Ship (ARCS) ventures deeper into the Alpha Nebula, where ancient civilizations encoded their cosmic knowledge into vibrant signals scattered across the galactic void. Your second mission is to deploy advanced story synthesis protocols, unraveling encrypted cosmic narratives and harmonizing interstellar systems with the library of forgotten knowledge. ARCS must extract data fragments, blend stellar themes, and dynamically generate cohesive adventures for galactic navigation systems. The survival of interstellar exploration hinges on your ability to synthesize these stories.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Narrative Fusion</strong>: How does <code class="inline-code">AdventureManager.initializeAdventure</code> set up thematic properties and create quests dynamically?  </li>
<li>‚ö° <strong>Quest Execution Flow</strong>: How does <code class="inline-code">AdventureManager.exploreQuest</code> manage quest selection and handle cache retrievals?  </li>
<li>üõ°Ô∏è <strong>Validation Protocols</strong>: How does <code class="inline-code">StoryGenerator.generateStoryAndQuests</code> ensure the reliability of story content through structured parsing and validation?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Coordinates mission setup and quest exploration</h3>
<p>This file orchestrates adventure initialization and quest management, utilizing a combination of project context and theme-specific attributes to customize the user‚Äôs experience. It validates user input for quests, handles caches for repeated explorations, and dynamically generates quest narratives using the <code class="inline-code">StoryGenerator</code> module. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets the adventure state, sets the theme, combines file exploration with quest narratives, and returns formatted content for the user to begin their journey.  </li>
<li><code class="inline-code">exploreQuest</code>: Validates chosen quests, retrieves cached data for efficiency, or executes new quests using dynamically generated content while updating progress metrics.  </li>
<li><code class="inline-code">validateAndSanitizeChoice</code>: Ensures user input for quest selection meets predefined criteria, preventing errors and maintaining a seamless experience.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(  
  projectInfo: ProjectInfo,  
  theme: AdventureTheme,  
  projectPath?: string,  
  customThemeData?: CustomThemeData  
): Promise&lt;string&gt; {  
  this.state.reset();  
  this.state.projectInfo = projectInfo;  
  this.state.currentTheme = theme;  
  this.state.projectPath = projectPath || process.cwd();  
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {  
    this.storyGenerator.setCustomTheme(customThemeData);  
  }  
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);  
  
  this.state.title = storyResponse.title;  
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;  
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);  
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);  
    
  return this.formatStoryWithQuests({ ...storyResponse, quests: this.state.quests });  
}  
</code></pre>
<ul>
<li>Resets the adventure state, ensuring clean initialization for each mission.  </li>
<li>Integrates project context with the user&#39;s choice of theme to generate adaptive and dynamic quests.  </li>
<li>Merges configuration-defined files into generated quests, ensuring granular control.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {  
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);  
  
  if (this.isProgressRequest(sanitizedChoice)) {  
    return this.getProgress();  
  }  
  
  const quest = this.findQuest(sanitizedChoice);  
  if (!quest) {  
    return this.createNotFoundResult();  
  }  
  
  return await this.executeQuest(quest);  
}  
</code></pre>
<ul>
<li>Manages quest selection, validating user input using dedicated protocols.  </li>
<li>Revisits completed quests by retrieving cached data, enhancing efficiency.  </li>
<li>Executes new quests dynamically, ensuring progress update mechanisms are robust.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateAndSanitizeChoice(input: string): string {  
  try {  
    return validateAdventureChoice(input);  
  } catch (error) {  
    throw new Error(`Invalid adventure choice: ${error instanceof Error ? error.message : &#39;Unknown error&#39;}`);  
  }  
}  
</code></pre>
<ul>
<li>Uses strict validation to ensure only valid inputs are accepted by quest navigation systems.  </li>
<li>Handles erroneous inputs gracefully, maintaining mission integrity.  </li>
<li>Prevents undefined behavior by enforcing clean input protocols.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Synthesizes themed cosmic narratives</h3>
<p>This file integrates project information and configuration settings to dynamically generate galactic stories and quests. It leverages structured markdown parsing, validation schemas, and theme extrapolation to create compelling narratives and ensure consistency.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Aggregates project context, validates themes, and utilizes the LLM client to generate narratives and quest scaffolding.  </li>
<li><code class="inline-code">generateQuestContent</code>: Handles specific quest content generation using advanced prompts and LLM responses tailored to dynamic configurations.  </li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Parses and validates markdown inputs, extracting crafted stories and quests while ensuring structural integrity.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {  
  const validatedTheme = this.validateTheme(theme);  
  return await this.generateWithLLM(projectInfo, validatedTheme);  
}  
</code></pre>
<ul>
<li>Validates thematic inputs, maintaining adherence to user-defined specifications.  </li>
<li>Partners with LLM APIs for comprehensive narrative synthesis, converting codebase insights into galactic stories.  </li>
<li>Ensures output aligns strictly with semantic and format expectations, maintaining reliability.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(  
  quest: Quest,  
  theme: AdventureTheme,  
  codeContent: string  
): Promise&lt;QuestContent&gt; {  
  const prompt = loadQuestContentPrompt({  
    theme,  
    adventureTitle: quest.title,  
    codeContent,  
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,  
  });  
  
  const response = await this.withTimeout(  
    this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST })  
  );  
  
  const cleanContent = response.content.trim();  
  return { adventure: cleanContent, fileExploration: &#39;&#39;, codeSnippets: [], hints: [] };  
}  
</code></pre>
<ul>
<li>Tailors quest content generation to user themes and specific code contexts.  </li>
<li>Uses strict timeout mechanisms to prevent system-level delays during long-running operations.  </li>
<li>Filters noise in LLM responses, ensuring clean markdown outputs for galaxy-wide presentation.</li>
</ul>
<hr>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {  
  const tokens = marked.lexer(markdownContent);  
  const quests: Quest[] = [];  
  for (const token of tokens) {  
    if (token.type === &#39;heading&#39; &amp;&amp; token.depth === 3) {  
      const currentQuest: Partial&lt;Quest&gt; = { title: token.text, description: &#39;&#39;, codeFiles: [] };  
      quests.push({  
        id: `quest-${quests.length + 1}`,  
        title: currentQuest.title,  
        description: currentQuest.description,  
        codeFiles: currentQuest.codeFiles || []  
      });  
    }  
  }  
  return { title: &#39;Adventure&#39;, story: markdownContent.trim(), quests };  
}  
</code></pre>
<ul>
<li>Implements structured parsing mechanisms to extract story and quest information.  </li>
<li>Utilizes markdown schemas to integrate narrative structures seamlessly with code contexts.  </li>
<li>Ensures thematic continuity and logical formatting of quests for user exploration.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <code class="inline-code">progressPercentage</code> attribute for mission tracking and adaptive pacing.  </li>
<li>Refer to generated quest descriptions to match thematic expectations and code patterns.  </li>
<li>Analyze markdown structures for reusable narrative formats in new missions.</li>
</ul>
<hr>
<p><strong>Captain‚Äôs log:</strong> Your ability to synthesize these cosmic narratives will unlock the secrets of forgotten civilizations, paving the way for interstellar harmony. The galaxy awaits your brilliance. Continue your voyage!</p>
<p>Stellar navigator, you&#39;ve ignited warp drive through the cosmos of creativity, brilliantly synthesizing galactic stories‚ÄîQuest 2 complete, and your journey to the stars is just beginning! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>