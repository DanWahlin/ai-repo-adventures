<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Stellar Cartographer - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Chronicles: The Codebase Odyssey</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Stellar Cartographer</h1>
<hr>
<p>In the uncharted expanses of the <strong>Parseon Nebula</strong>, the starship <strong>RepoExplorer</strong> navigates through waves of cosmic data. Aboard this vessel, you are tasked with assembling a stellar map of the galaxy‚Äôs <strong>Cosmic Repositories</strong>. This quest requires decoding intricate system configurations, connecting themes to missions, and preparing the foundation for deeper exploration. The <strong>Galactic Codebase Federation</strong> has entrusted you with honing the coordinate systems of the <strong>Quest Generation Engine</strong> to ensure precision. Sharpen your skills, explorer, for the artifacts unearthed here will guide us further into the stars.</p>
<p><strong>Adventure Awaits ‚Äì Navigate the codebase and unveil the mysteries!</strong></p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Astro-Diagnostics</strong>: How does <code class="inline-code">initializeAdventure</code> seamlessly reset the adventure&#39;s state, load the project, and generate quest data?  </li>
<li>‚ö° <strong>Quasar Calibration</strong>: What is the importance of <code class="inline-code">progressPercentage</code> in tracking and visualizing the exploration progress?  </li>
<li>üõ°Ô∏è <strong>Constellation Precision</strong>: How does <code class="inline-code">generateQuestContent</code> validate and adapt specific quest content within the given project context?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> AdventureManager Class Operations</h3>
<p>The <strong>AdventureManager</strong> is the core module responsible for initializing adventures, maintaining state, and dynamically generating quests. It integrates the project context, validates inputs, and ensures coherence between the generated story and quests. Additionally, it coordinates error handling and progress tracking to ensure smooth exploratory missions.  </p>
<h4><span class="header-prefix">Highlights:</span></h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: A vital function that resets the <strong>Adventure State</strong>, links project context, and orchestrates story and quest generation. It ensures coherence by enforcing quest counts and merging configuration files intelligently.  </li>
<li><code class="inline-code">progressPercentage</code>: This property in the <code class="inline-code">AdventureState</code> class measures and updates progress dynamically based on completed quests, providing feedback on mission advancement.  </li>
<li><code class="inline-code">generateQuestContent</code>: This method dynamically tailors quest details using project-specific and file-centered prompts, enhancing the relevance of the generated narratives.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
    
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests using LLM
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
    
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
    
  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
    
  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This function resets and reinitializes the core <code class="inline-code">AdventureState</code> to ensure the adventure starts with no outdated configurations.  </li>
<li>It adapts themes dynamically, allowing customization for specific cases.  </li>
<li>It integrates additional configuration details seamlessly, ensuring that both the story and quests align perfectly with the project data.  </li>
<li>A modular design helps manage customization and state resets without disrupting dependent components.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Provides a numerical representation of exploration progress using a simple yet effective percentage calculation.  </li>
<li>Enables intuitive tracking of quest completion.  </li>
<li>Plays a key role in enhancing user motivation by showing milestones clearly.  </li>
<li>The dynamic recalculations ensure the progress remains up-to-date as quests are completed.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async generateQuestContent(quest: Quest): Promise&lt;QuestContent&gt; {
  let codeContent: string;
    
  // Use targeted content if quest has specific files, otherwise use full repomix content
  if (quest.codeFiles &amp;&amp; quest.codeFiles.length &gt; 0 &amp;&amp; this.state.projectPath) {
    try {
      console.log(`üéØ Generating targeted content for ${quest.codeFiles.length} files`);
      codeContent = await repoAnalyzer.generateTargetedContent(
        this.state.projectPath,
        quest.codeFiles,
        false  // Use uncompressed content for detailed quest exploration
      );
    } catch (error) {
      console.warn(`Failed to generate targeted content, falling back to full repomix content:`, error);
      codeContent = this.state.projectInfo!.repomixContent;
    }
  } else {
    // Fall back to full repomix content
    codeContent = this.state.projectInfo!.repomixContent;
  }

  // Calculate quest position for completion message guidance
  const questPosition = this.state.quests.findIndex(q =&gt; q.id === quest.id) + 1;
  const totalQuests = this.state.quests.length;

  return await this.storyGenerator.generateQuestContent(
    quest,
    this.state.currentTheme!,
    codeContent,
    questPosition,
    totalQuests
  );
}
</code></pre>
<ul>
<li>Actively analyzes the relevant code files associated with each quest.  </li>
<li>Tailors content generation specifically to avoid redundancies and ensure focused insights.  </li>
<li>Implements a fallback mechanism to maintain reliability when unexpected errors occur.  </li>
<li>Dynamically adjusts quest completion messages using calculated positions relative to the total count.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ†Ô∏è Resetting state at the start of an adventure prevents critical issues from residual data.  </li>
<li>üöÄ Analyze the adaptive content logic to understand how fallback mechanisms can safeguard operations.  </li>
<li>‚≠ê Check interactions between <code class="inline-code">generateQuestContent</code> and <code class="inline-code">StoryGenerator</code> for insightful design patterns.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission accomplished, Stellar Cartographer! You&#39;ve charted the cosmic expanse with precision, igniting the propulsion for your interstellar odyssey‚Äî20% complete and rocketing toward the stars! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>