<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: Galactic Analyzer Systems - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Cosmic Code Chronicles: A stellar voyage into exploration systems</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: Galactic Analyzer Systems</h1>
<hr>
<p>Your starship&#39;s data processors have begun to hum with activity as you approach the edge of the intergalactic repository. The repository is known as the &quot;Stellar Atlas&quot;, a vast network of information streams containing the secrets of the universe. Your mission is to use the Galactic Analyzer Systems to process this cosmic repository, extract key patterns, and transform them into actionable data for your AI systems. Sophisticated engines such as the <code class="inline-code">RepoAnalyzer</code> and <code class="inline-code">LLMClient</code> modules are at your disposal to decode the unknown. As an astronaut entrusted with the fate of the mission, you must uncover and optimize the intergalactic knowledge hidden within.</p>
<p>Prepare for a stellar analytical journey, where every function is a star, and every pattern is a constellation awaiting discovery.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üåå <strong>Interstellar Pipeline</strong>: How does the <code class="inline-code">RepoAnalyzer</code> validate and refine project paths and files before processing?</li>
<li>üå† <strong>Stellar Signal Optimization</strong>: What techniques does <code class="inline-code">RepoAnalyzer</code> use to optimize content extraction from the repository?</li>
<li>üõ∞Ô∏è <strong>Cosmic Query Execution</strong>: How does <code class="inline-code">LLMClient</code> handle an AI request and ensure responses are validated, logged, and robust?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> The Galactic Repository Decoder</h3>
<p>The <code class="inline-code">RepoAnalyzer</code> class is your mission&#39;s stellar engine for analyzing repository files. It validates inputs, optimizes targeted content, and extracts structured data that is essential for handling cosmic data streams. This file is rich with safety mechanisms, including validation checks to prevent invalid file operations and techniques for extracting function-focused content to optimize processing.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateProjectPath</code>: Ensures the given project path is valid, sanitized, and safe for operations.</li>
<li><code class="inline-code">validateAndNormalizeTargetFiles</code>: Handles validation, path normalization, deduplication, and security checks for target files.</li>
<li><code class="inline-code">generateOptimizedContent</code>: Extracts function-focused content for efficient processing without unnecessary overhead.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }

  const trimmedPath = projectPath.trim();
  if (!trimmedPath) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }

  if (trimmedPath.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid null bytes&#39;);
  }
}
</code></pre>
<ul>
<li>Verifies that the project path is a valid string.</li>
<li>Strips unnecessary whitespace and prevents null byte injection to avoid file system vulnerabilities.</li>
<li>Ensures the path is not empty, guarding against invalid configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">private validateAndNormalizeTargetFiles(projectPath: string, targetFiles: string[]): string[] {
  const MAX_TARGET_FILES = 50;
  const projectRoot = path.resolve(projectPath);
  
  const safeFiles = [...new Set(targetFiles)]
    .slice(0, MAX_TARGET_FILES)
    .map(file =&gt; {
      if (typeof file !== &#39;string&#39; || !file.trim()) return null;

      const trimmed = file.trim();
      if (trimmed.includes(&#39;\0&#39;) || trimmed.includes(&#39;..&#39;)) {
        console.warn(`Rejecting potentially unsafe file path: ${trimmed}`);
        return null;
      }

      const fullPath = path.resolve(projectPath, file);
      if (!fullPath.startsWith(projectRoot + path.sep) &amp;&amp; fullPath !== projectRoot) {
        console.warn(`Rejecting file outside project directory: ${file}`);
        return null;
      }

      if (!fs.existsSync(fullPath)) {
        console.warn(`Skipping non-existent file: \`${file}\``);
        return null;
      }

      return path.relative(projectPath, fullPath);
    })
    .filter((file): file is string =&gt; file !== null)
    .sort();

  return safeFiles;
}
</code></pre>
<ul>
<li>Implements security checks to reject null bytes and directory traversal threats.</li>
<li>Limits the number of target files to a configurable cap, protecting system performance.</li>
<li>Resolves and validates files, ensuring the paths are inside the project directory.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateOptimizedContent(projectPath: string, targetFiles: string[], compress: boolean = true): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);

  if (!targetFiles || targetFiles.length === 0) {
    throw new Error(&#39;Target files array cannot be empty&#39;);
  }

  const safeFiles = this.validateAndNormalizeTargetFiles(projectPath, targetFiles);
  if (safeFiles.length === 0) {
    throw new Error(&#39;No valid target files found after validation&#39;);
  }

  const cacheKey = `${path.resolve(projectPath)}:optimized:${safeFiles.join(&#39;,&#39;)}:compress=${compress}`;
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }

  try {
    const fullContent = await this.generateTargetedContent(projectPath, targetFiles, compress);
    const optimizedContent = this.extractFunctionFocusedContent(fullContent);
    this.cache.set(cacheKey, { content: optimizedContent, timestamp: Date.now() });
    return optimizedContent;
  } catch (error) {
    throw new Error(`Optimized content generation failed: ${error instanceof Error ? error.message : String(error)}`);
  }
}
</code></pre>
<ul>
<li>Validates inputs and applies file-specific optimizations for efficient token usage.</li>
<li>Caches results with an expiration time to improve performance on repetitive tasks.</li>
<li>Optimizes the content by focusing only on essential code elements.</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> The Cosmic Query Processor</h3>
<p>The <code class="inline-code">LLMClient</code> is a precision tool for handling interstellar queries sent to AI systems. It ensures requests are valid, handles configurations for API providers like OpenAI and Azure, and processes responses while enforcing timeouts and error handling.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse</code>: Sends prompts to the AI, processes the response, and validates the output.</li>
<li><code class="inline-code">constructor</code>: Configures the client for different APIs with tailored initialization.</li>
<li><code class="inline-code">getApiKey</code>: Retrieves the correct API key securely depending on the provider.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  try {
    const requestParams = this.buildRequestParams(prompt, options);
    const completion = await this.executeRequest(requestParams);
    let content = this.validateResponse(completion);

    if (options?.responseFormat === &#39;json_object&#39;) {
      content = this.cleanJsonResponse(content);
    }
    
    this.logTokenUsage(completion);

    return { content };
  } catch (error) {
    this.logDetailedError(error, prompt);

    const message = error instanceof Error ? error.message : &#39;Unknown error&#39;;
    throw new Error(`LLM request failed: ${message}`);
  }
}
</code></pre>
<ul>
<li>Sends a prompt to the AI system and retrieves a processed response.</li>
<li>Handles both normal and JSON responses, validating against errors and malformed data.</li>
<li>Logs token usage for in-depth tracking of AI resource consumption.</li>
</ul>
<hr>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;

  const apiKey = this.getApiKey();
  if (!apiKey || !LLM_BASE_URL) {
    throw new Error(&#39;LLM configuration required. Please set LLM_BASE_URL and appropriate API key (LLM_API_KEY or GITHUB_TOKEN).&#39;);
  }

  if (this.isAzureOpenAI()) {
    const azureEndpoint = LLM_BASE_URL.split(&#39;/openai/deployments&#39;)[0];
    this.client = new AzureOpenAI({
      endpoint: azureEndpoint,
      apiKey,
      apiVersion: LLM_API_VERSION,
      deployment: this.model
    });
  } else {
    this.client = new OpenAI({
      apiKey,
      baseURL: LLM_BASE_URL
    });
  }
}
</code></pre>
<ul>
<li>Configures the client with the right API settings for OpenAI or Azure integrations.</li>
<li>Safeguards against missing environmental variables or API keys.</li>
<li>Dynamically tailors initialization based on the provider to ensure smooth operation.</li>
</ul>
<hr>
<pre><code class="language-typescript">private getApiKey(): string {
  if (LLM_BASE_URL.includes(&#39;models.inference.ai.azure.com&#39;)) {
    if (!GITHUB_TOKEN) {
      throw new Error(&#39;GITHUB_TOKEN required for GitHub Models. Set GITHUB_TOKEN environment variable.&#39;);
    }
    return GITHUB_TOKEN;
  }

  if (!LLM_API_KEY) {
    throw new Error(&#39;LLM_API_KEY required. Set LLM_API_KEY environment variable.&#39;);
  }
  return LLM_API_KEY;
}
</code></pre>
<ul>
<li>Determines the correct API key to use based on the backend provider (Azure/GitHub or OpenAI).</li>
<li>Validates the presence of required environmental settings.</li>
<li>Ensures flexibility to handle different configurations seamlessly.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Always validate inputs early to prevent cascading failures in complex pipelines.</li>
<li>Leverage caching mechanisms to reduce repetitive computations and improve efficiency.</li>
<li>When working with AI systems, robust logging and error handling are critical for debugging and operational stability.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Mission accomplished, cosmic explorer ‚Äî you&#39;ve successfully navigated through the starlit complexities of Galactic Analyzer Systems, powering your learning odyssey to 60% completion like a supernova igniting the void! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>