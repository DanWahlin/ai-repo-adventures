<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Cosmic Analyzers - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Codex: Adventures Across the Codebase Nebula</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Cosmic Analyzers</h1>
<hr>
<p>Drifting through the enigmatic currents of the Codebase Nebula, <em>The Refactored Voyager</em> approaches its next stellar waypoint‚Äîthe Cosmic Repository of Knowledge. This installation, known as the &#39;Analyzer Core,&#39; harbors the ability to refine raw code archives and channel them into optimized intelligence streams. Your mission involves activating two precision tools, the <code class="inline-code">RepoAnalyzer</code> and the <code class="inline-code">LLMClient</code>, to generate pathways through the repository&#39;s obfuscated framework. Beware: cosmic turbulence threatens the clarity of your mission data. Proceed with acute vigilance, brave explorers!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Repository Analysis Engine</h3>
<p>This file governs the refinement and transformation of code data into usable contexts. The <code class="inline-code">RepoAnalyzer</code> class functions as the vessel&#39;s onboard data miner, regulating access to critical repository paths, applying optimization strategies, and caching results to conserve computational energy. The class is fortified with validation processes to ensure the security and relevance of project paths. Through its strategic methods‚Äîsuch as <code class="inline-code">generateRepomixContext</code> and <code class="inline-code">generateTargetedContent</code>‚Äîit distills dense repositories into actionable tokens for interstellar analytics. It employs subprocess execution (<code class="inline-code">captureRepomixStdout</code>) to harvest repository outputs while defending against memory overloads and runtime errors.</p>
<h4>Highlights</h4>
<ul>
<li>Validate file paths using <code class="inline-code">validateProjectPath</code> to enforce integrity and security.</li>
<li>Optimize file content extraction with <code class="inline-code">generateTargetedContent</code>.</li>
<li>Execute subprocess operations safely via <code class="inline-code">captureRepomixStdout</code>.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">/**
 * Basic validation for project path - minimal checks for actual use case
 */
private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }

  const trimmedPath = projectPath.trim();
  if (!trimmedPath) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }

  if (trimmedPath.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid null bytes&#39;);
  }
}
</code></pre>
<p>[Just as starship navigators vet their stellar maps for accuracy, this method validates project trajectories, enforcing safe exploration boundaries.]</p>
<pre><code class="language-typescript">/**
 * Generate targeted repomix content for specific files
 */
async generateTargetedContent(projectPath: string, targetFiles: string[], compress: boolean = true): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  
  if (!targetFiles || targetFiles.length === 0) {
    throw new Error(&#39;Target files array cannot be empty&#39;);
  }

  const safeFiles = this.validateAndNormalizeTargetFiles(projectPath, targetFiles);
  if (safeFiles.length === 0) {
    throw new Error(&#39;No valid target files found after validation&#39;);
  }

  const cacheKey = `${path.resolve(projectPath)}:targeted:${safeFiles.join(&#39;,&#39;)}:compress=${compress}`;
  const cached = this.cache.get(cacheKey);
  
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }
  
  const cliOptions: CliOptions = {
    style: &#39;markdown&#39;,
    stdout: true,
    compress: compress,
    include: safeFiles.join(&#39;,&#39;)
  };
  
  const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
  
  this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
  return context;
}
</code></pre>
<p>[Much like a cosmic refinery extracting key elements from asteroid debris, this function filters and processes only trusted files for precise analytics.]</p>
<pre><code class="language-typescript">/**
 * Use repomix CLI as subprocess to capture stdout with timeout and memory protection
 */
private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [&#39;repomix&#39;, ...directories, &#39;--stdout&#39;, &#39;--style&#39;, options.style];
    if (options.compress) args.push(&#39;--compress&#39;);
    const repomix = spawn(&#39;npx&#39;, args, { cwd, stdio: [&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;] });

    let stdout = &#39;&#39;;
    let stdoutSize = 0;
    const timeout = setTimeout(() =&gt; {
      repomix.kill();
      reject(new Error(`Repomix subprocess timed out`));
    }, REPOMIX_SUBPROCESS_TIMEOUT);

    repomix.stdout.on(&quot;data&quot;, data =&gt; {
      const chunk = data.toString();
      stdoutSize += chunk.length;
      if (stdoutSize &gt; REPOMIX_MAX_BUFFER_SIZE) {
        repomix.kill();
        reject(new Error(&quot;Output buffer exceeded maximum limit.&quot;));
      }
      stdout += chunk;
    });

    repomix.on(&quot;close&quot;, code =&gt; {
      clearTimeout(timeout);
      if (code === 0) resolve(stdout);
      else reject(new Error(&quot;Repomix failed.&quot;));
    });
  });
}
</code></pre>
<p>[Similar to sending probes to collect space radiations with proper safeguards, this subprocess elegantly handles repository data extraction while shielding against overloads.]</p>
<h2>Helpful Hints</h2>
<ul>
<li>Adjust <code class="inline-code">REPOMIX_CACHE_TTL</code> for iterative testing in dense codebases.</li>
<li>Use <code class="inline-code">generateTargetedContent</code> for focused analysis on mission-critical directories.</li>
<li>Ensure subprocess parameters are calibrated to prevent timeout issues when capturing large repositories.</li>
</ul>
<hr>
<p>The repository‚Äôs stellar essence lies within your grasp‚Äî<em>The Refactored Voyager</em> awaits your next command.</p>
<p>Stellar work completing Quest 3: Cosmic Analyzers‚Äîyour trajectory is locked, your engines are firing, and you&#39;re rocketing through this learning galaxy at warp speed! üöÄ‚≠êüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>