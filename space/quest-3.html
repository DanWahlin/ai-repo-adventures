<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Cosmic Analysis Hub - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Galactic Codex: The Adventures of RepoQuest</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Cosmic Analysis Hub</h1>
<hr>
<p>As the journey across the galaxy unfolds, the Galactic Codex reveals cryptic celestial readings pointing to a hidden repository of intricate star charts. To navigate deeper into this uncharted territory, you must engage the Cosmic Analysis Hub aboard the <em>RepoQuest</em>. This mission requires leveraging data streams from the Codex and utilizing long-range scanners to decode the mysterious patterns. Your objective: refine the Codex&#39;s star mapping, extract patterns with precision, and interpret the encoded wisdom buried within the stars. The galaxy&#39;s truths, concealed within the cosmic winds, await your command.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Repository Analysis and Content Optimization</h3>
<p>This critical file introduces the <code class="inline-code">RepoAnalyzer</code> class, designed to extract and process content from the codebase. It safeguards against invalid file inputs and optimizes the content for efficient consumption. Central to this mission are functions like <code class="inline-code">generateRepomixContext</code>, essential for universal content generation, and <code class="inline-code">generateTargetedContent</code>, which focuses on selective extraction. Additionally, the <code class="inline-code">captureRepomixStdout</code> function provides the backbone for interacting with the <code class="inline-code">repomix</code> subprocess, ensuring data is securely and efficiently retrieved. Together, these functions enable advanced code workflows while ensuring dependability.</p>
<h4>Highlights</h4>
<ul>
<li>Implements the <code class="inline-code">RepoAnalyzer.generateRepomixContext</code> function to enable full content generation for a repository.</li>
<li>Demonstrates the security-conscious <code class="inline-code">captureRepomixStdout</code> function, which interfaces with external tools for context generation.</li>
<li>Features the validation-focused <code class="inline-code">validateProjectPath</code> function to ensure paths are sanitized and secure.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);

  // Check if adventure.config.json has specific files to include
  const configuredFiles = extractUniqueFilePaths(projectPath);

  if (configuredFiles.length &gt; 0) {
    try {
      return await this.generateOptimizedContent(projectPath, configuredFiles);
    } catch (error) {
      console.warn(`Failed to generate optimized content: ${error.message}`);
    }
  }

  const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
  const cached = this.cache.get(cacheKey);

  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }

  const ignorePatterns = [
    &#39;node_modules&#39;, &#39;dist&#39;, &#39;.git&#39;, &#39;.nyc_output&#39;
  ];

  const cliOptions: CliOptions = {
    style: options.style || &#39;markdown&#39;,
    stdout: true,
    compress: options.compress !== false,
    ignore: ignorePatterns.join(&#39;,&#39;)
  };

  try {
    const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
    this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
    return context;
  } catch (error) {
    throw new Error(`Repomix execution failed: ${error.message}`);
  }
}
</code></pre>
<p>This method acts as the core engine, assembling full context from the codebase by combining validation, caching, and external subprocess handling.</p>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [
      ...directories,
      &#39;--stdout&#39;,
      &#39;--style&#39;, options.style || &#39;markdown&#39;
    ];

    if (options.compress) args.push(&#39;--compress&#39;);

    const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], {
      cwd,
      stdio: [&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;]
    });

    let stdout = &#39;&#39;;

    repomix.stdout.on(&#39;data&#39;, (data) =&gt; {
      stdout += data.toString();
    });

    repomix.on(&#39;close&#39;, (code) =&gt; {
      if (code === 0) resolve(stdout.trim());
      else reject(new Error(&#39;Repomix execution failed&#39;));
    });
  });
}
</code></pre>
<p>This subprocess interface streams and processes <code class="inline-code">repomix</code> data safely, ensuring stable content retrieval even with external dependencies.</p>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }
  const trimmedPath = projectPath.trim();
  if (!trimmedPath) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }
  if (trimmedPath.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid null bytes&#39;);
  }
}
</code></pre>
<p>This function ensures the safety and validity of directory paths before they are processed, reducing the risk of filesystem vulnerabilities.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> Language Model Communications</h3>
<p>This file encapsulates the communication logic for interacting with language models, such as GPT-4 and GPT-5. The centerpiece, <code class="inline-code">LLMClient</code>, facilitates building and sending requests while managing error handling, validating responses, and optimizing token usage. The <code class="inline-code">generateResponse</code> function demonstrates prompt-driven workflows suited for the Codex&#39;s cosmic analyses. Additionally, the constructor&#39;s model initialization underscores compatibility across cloud-based AI providers like OpenAI and Azure.</p>
<h4>Highlights</h4>
<ul>
<li>Implements the <code class="inline-code">LLMClient.generateResponse</code> function to facilitate AI-driven prompt completion workflows.</li>
<li>Features the <code class="inline-code">LLMClient.constructor</code> function to initialize cloud AI compatibility and secure API integration.</li>
<li>Integrates <code class="inline-code">LLMClient.getApiKey</code> to handle multi-provider authentication dynamically.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  try {
    const requestParams = this.buildRequestParams(prompt, options);
    const completion = await this.executeRequest(requestParams);
    let content = this.validateResponse(completion);
    
    if (options?.responseFormat === &#39;json_object&#39;) {
      content = this.cleanJsonResponse(content);
    }
    
    this.logTokenUsage(completion);
    return { content };
  } catch (error) {
    this.logDetailedError(error, prompt);
    throw new Error(`LLM request failed: ${error.message}`);
  }
}
</code></pre>
<p>This dynamic request handler communicates with the language model, validating output to ensure the Codex receives usable insights.</p>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;
  const apiKey = this.getApiKey();

  if (this.isAzureOpenAI()) {
    const azureEndpoint = LLM_BASE_URL.split(&#39;/openai/deployments&#39;)[0];
    this.client = new AzureOpenAI({
      endpoint: azureEndpoint,
      apiKey,
      apiVersion: LLM_API_VERSION,
      deployment: this.model
    });
  } else {
    this.client = new OpenAI({
      apiKey,
      baseURL: LLM_BASE_URL
    });
  }
}
</code></pre>
<p>The constructor initializes the language model client and determines compatibility with various service providers.</p>
<pre><code class="language-typescript">private getApiKey(): string {
  if (LLM_BASE_URL.includes(&#39;models.inference.ai.azure.com&#39;)) {
    if (!GITHUB_TOKEN) {
      throw new Error(&#39;GITHUB_TOKEN required for GitHub Models.&#39;);
    }
    return GITHUB_TOKEN;
  }
  if (!LLM_API_KEY) {
    throw new Error(&#39;LLM_API_KEY required.&#39;);
  }
  return LLM_API_KEY;
}
</code></pre>
<p>This function dynamically retrieves the appropriate API key, ensuring seamless integration across multiple providers.</p>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Cache Strategies</strong>: For optimal performance, preloading mission data using <code class="inline-code">preGenerate</code> can expedite Codex analyses.</li>
<li><strong>Validation Levels</strong>: Both files demonstrate rigorous input validation to reduce mission-critical errors.</li>
<li><strong>Model-Specific</strong>: Always check if default models or parameters fit your galaxy&#39;s data complexity.</li>
</ul>
<hr>
<p>Mission complete, Captain! Good luck harnessing the Codex&#39;s knowledge. Onward to the next cosmic frontier!</p>
<p>Congratulations, Star Explorer! Your mastery of the Cosmic Analysis Hub has charted new stellar pathways, propelling you to 40% galactic mission completionâ€”keep your engines roaring toward the stars! ðŸš€ðŸŒŸðŸ“¡âš¡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: Stellar Configuration Nexus â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>