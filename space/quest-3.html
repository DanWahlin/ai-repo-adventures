<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Repomix Core: Mapping the Code Nebula - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Galactic Navigator: Secrets of the Code Nebula</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Repomix Core: Mapping the Code Nebula</h1>
<hr>
<p>In this exhilarating chapter of our space adventure, the <strong>Code Nebula</strong> hides secrets deep within its fragmented codebases, and the <strong>Galactic Navigator</strong> is on the brink of an extraordinary revelation. The <strong>Repomix Core</strong> hums with computational might, tasked with decoding tangled layers of syntax amidst cosmic chaos. As initiates of the <strong>Adventure System</strong>, your mission is simple yet daunting: delve into the repository&#39;s data streams, analyze targeted patterns, and guide the Navigator to safety through the stormy nebulas of logic and syntax. Will you unlock the map and decipher the Nebula‚Äôs mysteries? Engage thrust‚Äîexploration awaits!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>This file is the cosmic command center for the <strong>Mission Control Protocol (MCP)</strong> tools, hosting the lifeline of intergalactic adventure systems. The <code class="inline-code">RepoAdventureServer</code> is the backbone, managing critical interactions with tools across vast layers of protocols. The <code class="inline-code">setupHandlers()</code> method strategically registers handlers for vital requests like <code class="inline-code">ListTools</code> and <code class="inline-code">CallTool</code>, ensuring every tool in the MCP arsenal functions with precision. <code class="inline-code">RepoAdventureServer.run()</code> coordinates operative readiness, connecting its command loops via <code class="inline-code">stdio</code> transport, which serves as the spacecraft‚Äôs communication tether. The <code class="inline-code">main()</code> function acts as the entry portal, integrating error recovery mechanics in preparation for uncharted galaxies. The entire file embodies an astronaut‚Äôs discipline: it&#39;s methodical, safety-first, and highly adaptable. </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code> orchestrates MCP handler registrations.</li>
<li><code class="inline-code">RepoAdventureServer.run</code> connects <code class="inline-code">stdio</code> transport and prepares Repomix data processing.</li>
<li>Includes robust error handling for graceful shutdown during turbulent cosmic explorations.</li>
<li>Processes tool execution requests and integrates them seamlessly with server protocols.</li>
<li>Built to handle adventures with minimal downtime and maximized interactivity.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> MCP Tools Interface</h3>
<p>This file houses the <strong>four pivotal tools</strong> of the MCP suite, each tailored for specific interstellar operations. The <code class="inline-code">start_adventure.handler</code> kicks off exploration, presenting repositories and their adventure possibilities to the users. The <code class="inline-code">choose_theme.handler</code> converts user inputs into thematic journeys‚Äîcreating the narrative thread that binds every adventure. <code class="inline-code">explore_quest.handler</code> validates quest progress and directs users on detailed exploration paths, akin to starship navigation systems plotting hyperspace routes. Lastly, <code class="inline-code">view_progress.handler</code> offers real-time mission updates, akin to a cosmic dashboard tracking steps taken and galaxies conquered. This file elevates user interactivity, blending interstellar storytelling with practical coding insights, like mapping galaxies with a keen eye for detail.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code> enables repository analysis and adventure selection.</li>
<li><code class="inline-code">choose_theme.handler</code> crafts thematic stories based on user choices.</li>
<li><code class="inline-code">explore_quest.handler</code> tracks quest progression via structured exploration tasks.</li>
<li><code class="inline-code">view_progress.handler</code> provides completion percentages and goal-oriented feedback.</li>
<li>Bridges repository data with engaging user interfaces for seamless interactivity.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Repomix Integration</h3>
<p>The <code class="inline-code">repo-analyzer.ts</code> is the <strong>navigation system</strong> enabling precise mapping of the Code Nebula. It leverages <code class="inline-code">Repomix</code>, a tool that consolidates codebases, removes unnecessary debris (like comments and empty lines), and highlights essential paths. Its primary methods, <code class="inline-code">generateRepomixContext()</code> and <code class="inline-code">generateTargetedContent()</code>, provide either holistic views or precise, laser-focused analyses of selected repository files. Meanwhile, <code class="inline-code">validateProjectPath()</code> operates like shields against dangerous traversals‚Äîno unauthorized detours into system directories. This file is a stellar mix of efficiency and safety, ensuring the adventure stays tightly on the plotted course while avoiding cosmic hazards.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateRepomixContext</code> creates full repository contexts, filtering content with efficiency.</li>
<li><code class="inline-code">generateTargetedContent</code> extracts in-depth analysis for specific files using include patterns.</li>
<li><code class="inline-code">validateAndNormalizeTargetFiles</code> deduplicates and verifies paths for security.</li>
<li>Provides robust caching mechanisms to optimize repeated LLM queries.</li>
<li>Integrates smoothly with <code class="inline-code">repomix</code> subprocess execution for detailed coding insights.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">class RepoAdventureServer {
  setupHandlers() {
    this.handlers[&#39;ListTools&#39;] = this.listToolsHandler.bind(this);
    this.handlers[&#39;CallTool&#39;] = this.callToolHandler.bind(this);
  }

  run() {
    transport.connect();
    repoAnalyzer.preGenerate(this.projectPath);
  }
}

function main() {
  const server = new RepoAdventureServer();
  process.on(&#39;SIGINT&#39;, () =&gt; server.gracefulShutdown());
  process.on(&#39;SIGTERM&#39;, () =&gt; server.gracefulShutdown());
  server.run();
}
</code></pre>
<p>Just like a spacecraft‚Äôs control system coordinates mission protocols and safety procedures, this code synchronizes multiple tool interactions and establishes critical connections for seamless operation.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">interface ToolHandler {
  start_adventure.handler(request: StartAdventureRequest) {
    // Analyze repo and present themes
  }

  choose_theme.handler(request: ChooseThemeRequest) {
    // Generate epic space stories
  }

  explore_quest.handler(request: ExploreQuestRequest) {
    // Track quest progress
  }

  view_progress.handler(request: ViewProgressRequest) {
    // Update user with completion stats
  }
}
</code></pre>
<p>This file acts like a celestial toolbox, offering explorers their choice of tools to progress through the cosmic adventure while staying informed and motivated.</p>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">export class RepoAnalyzer {
  async generateRepomixContext(projectPath: string, options: RepomixOptions): Promise&lt;string&gt; {
    this.validateProjectPath(projectPath);
    const ignorePatterns = [&#39;node_modules&#39;, &#39;.git&#39;];
    const cliOptions: CliOptions = { ignore: ignorePatterns.join(&#39;,&#39;), compress: true };
    const context = await this.captureRepomixStdout([&#39;.&#39;], projectPath, cliOptions);
    this.cache.set(cacheKey, { content: context, timestamp: Date.now() });
    return context;
  }

  private validateProjectPath(projectPath: string): void {
    const trimmedPath = projectPath.trim();
    if (trimmedPath.includes(&#39;\0&#39;)) throw new Error(&#39;Invalid path detected.&#39;);
  }
}
</code></pre>
<p>Much like a spaceship‚Äôs navigation software plots courses through asteroid fields, this code ensures safe and strategic traversal of repository paths using repomix.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Review how <code class="inline-code">RepoAdventureServer</code> handles protocol connections and preprocesses repomix content for adventure initiation.</li>
<li>Experiment with <code class="inline-code">generateRepomixContext()</code> by customizing include patterns to analyze focused code sections.</li>
<li>Explore how thematic journeys are generated via <code class="inline-code">choose_theme.handler</code>, creating engaging narratives through structured prompts.</li>
</ul>
<hr>
<p>Congratulations, Star Voyager‚Äîyour brilliant navigation through the Code Nebula has illuminated the Repomix Core and propelled your mission to 50% completion‚Äîkeep soaring toward the stars! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: The Hyperdrive of Themes: Prope... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>