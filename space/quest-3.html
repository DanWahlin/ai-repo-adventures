<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Scan the Galactic Signals - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Cosmic Chronicles of the Repo Explorer</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Scan the Galactic Signals</h1>
<hr>
<p>The <strong>Repo Explorer</strong> sails into a dense sector of the coding galaxy, where faint and cryptic galactic signals echo through the ether. These signals represent mysteries waiting to be unraveled by your starship&#39;s onboard tools. As the pilot, your task is to engage the cutting-edge systems‚Äîthe <code class="inline-code">RepoAnalyzer</code> and the <code class="inline-code">LLMClient</code>‚Äîto scan, interpret, and decode these signals. Each fragment of data you uncover will illuminate hidden coding patterns and streamline future interstellar missions. The crew awaits your skillful command‚Äîlet the scanning begin!</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Signal Composition</strong>: How does the <code class="inline-code">LLMClient</code> construct the requests sent to language model APIs, and what customization options are available for different scenarios?</li>
<li>‚ö° <strong>Transmission Stability</strong>: How does <code class="inline-code">RepoAnalyzer</code> handle the dynamic validation of project paths and target files to ensure safe and secure analysis processes?</li>
<li>üõ°Ô∏è <strong>Error Navigation</strong>: What strategies does the <code class="inline-code">LLMClient</code> employ to handle and log errors, especially when processing galactic transmissions?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> Galactic Signal Decoder</h3>
<p>This file houses the <code class="inline-code">LLMClient</code>, the system responsible for communicating with advanced language models. It encompasses functions that build payloads, handle complex model-specific configurations (e.g., GPT-5 parameters), and manage error reporting in case of signal transmission issues. The flexibility of its design allows it to adapt to various model backends, such as OpenAI and Azure OpenAI.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse</code>: Sends prompts to the language model, validates responses, and ensures proper formatting of returned content.</li>
<li><code class="inline-code">constructor</code>: Initializes the <code class="inline-code">LLMClient</code> with appropriate API configurations based on the platform (Azure vs others), ensuring a smooth signal handshake.</li>
<li><code class="inline-code">getApiKey</code>: Dynamically selects the API key based on the platform, securing the communication channels against misconfigurations.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Starship&#39;s Analytical Array</h3>
<p>The <code class="inline-code">RepoAnalyzer</code> is the onboard system responsible for analyzing coding nebulae and optimizing signal decoding. This analyzer validates project directories, ensures safe processing of target files, and integrates caching mechanisms to minimize resource exhaustion while maximizing efficiency.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateRepomixContext</code>: Generates a complete contextual map of a project, pulling in configuration files and applying compression and structure optimizations.</li>
<li><code class="inline-code">validateProjectPath</code>: Validates the project&#39;s root directory, preventing invalid or malicious file paths from cluttering the analysis systems.</li>
<li><code class="inline-code">captureRepomixStdout</code>: Executes a subprocess to retrieve raw context data, ensuring robust and safe integration with external tools.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  try {
    const requestParams = this.buildRequestParams(prompt, options);
    const completion = await this.executeRequest(requestParams);
    let content = this.validateResponse(completion);

    if (options?.responseFormat === &#39;json_object&#39;) {
      content = this.cleanJsonResponse(content);
    }

    this.logTokenUsage(completion);

    return { content };
  } catch (error) {
    this.logDetailedError(error, prompt);
    const message = error instanceof Error ? error.message : &#39;Unknown error&#39;;
    throw new Error(`LLM request failed: ${message}`);
  }
}
</code></pre>
<ul>
<li>Orchestrates request construction, sending, validation, and post-processing for a seamless response pipeline.</li>
<li>Integrates error handling with verbose logging for detailed debugging during signal failure.</li>
<li>Supports model-specific options and formatting, ensuring compatibility across advanced AI systems.</li>
</ul>
<pre><code class="language-typescript">constructor() {
  this.model = LLM_MODEL;
  const apiKey = this.getApiKey();

  if (!apiKey || !LLM_BASE_URL) {
    throw new Error(&#39;LLM configuration required. Please set LLM_BASE_URL and appropriate API key (LLM_API_KEY or GITHUB_TOKEN).&#39;);
  }

  if (this.isAzureOpenAI()) {
    const azureEndpoint = LLM_BASE_URL.split(&#39;/openai/deployments&#39;)[0];
    this.client = new AzureOpenAI({
      endpoint: azureEndpoint,
      apiKey,
      apiVersion: LLM_API_VERSION,
      deployment: this.model
    });
  } else {
    this.client = new OpenAI({
      apiKey,
      baseURL: LLM_BASE_URL
    });
  }
}
</code></pre>
<ul>
<li>Configures <code class="inline-code">LLMClient</code> by determining the API provider, endpoint, and credentials based on environmental variables.</li>
<li>Differentiates between Azure and OpenAI backends with unique configurations for each, ensuring broad compatibility.</li>
<li>Initializes the core model parameters used for all subsequent requests.</li>
</ul>
<pre><code class="language-typescript">private getApiKey(): string {
  if (LLM_BASE_URL.includes(&#39;models.inference.ai.azure.com&#39;)) {
    if (!GITHUB_TOKEN) {
      throw new Error(&#39;GITHUB_TOKEN required for GitHub Models. Set GITHUB_TOKEN environment variable.&#39;);
    }
    return GITHUB_TOKEN;
  }

  if (!LLM_API_KEY) {
    throw new Error(&#39;LLM_API_KEY required. Set LLM_API_KEY environment variable.&#39;);
  }
  return LLM_API_KEY;
}
</code></pre>
<ul>
<li>Implements a secure and hierarchal approach to fetching API keys, prioritizing environment variables.</li>
<li>Tailors its logic to differentiate between GitHub-hosted Azure models and other platforms.</li>
<li>Ensures misconfigurations are flagged early by throwing errors.</li>
</ul>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">async generateRepomixContext(projectPath: string, options: RepomixOptions = {}): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  const configuredFiles = extractUniqueFilePaths(projectPath);

  if (configuredFiles.length &gt; 0) {
    try {
      return await this.generateOptimizedContent(projectPath, configuredFiles);
    } catch (error) {
      console.warn(&#39;Failed to generate optimized content, falling back to full content generation.&#39;);
    }
  }

  const cacheKey = `${path.resolve(projectPath)}:${JSON.stringify(options)}`;
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }

  try {
    return await this.captureRepomixStdout([&#39;.&#39;], projectPath, {
      style: &#39;markdown&#39;,
      compress: true,
    });
  } catch (error) {
    throw new Error(`Repomix execution failed: ${error}`);
  }
}
</code></pre>
<ul>
<li>Dynamically prioritizes optimized content generation based on available configuration, falling back gracefully if needed.</li>
<li>Introduces caching to reduce redundant computational overhead while analyzing repeated signals.</li>
<li>Balances error reporting with fallback mechanisms to ensure mission continuity.</li>
</ul>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }

  const trimmedPath = projectPath.trim();
  if (!trimmedPath) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }

  if (trimmedPath.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid null bytes&#39;);
  }
}
</code></pre>
<ul>
<li>Ensures robust validation of project paths to prevent potential injection or misconfiguration errors.</li>
<li>Normalizes the input with trimming, protecting against accidental whitespace issues.</li>
<li>Flags paths containing dangerous characters such as null bytes.</li>
</ul>
<pre><code class="language-typescript">private async captureRepomixStdout(directories: string[], cwd: string, options: CliOptions): Promise&lt;string&gt; {
  return new Promise((resolve, reject) =&gt; {
    const args = [&#39;--stdout&#39;, &#39;--style&#39;, options.style || &#39;markdown&#39;];
    if (options.compress) args.push(&#39;--compress&#39;);
    const repomix = spawn(&#39;npx&#39;, [&#39;repomix&#39;, ...args], { cwd, stdio: [&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;] });

    let stdout = &#39;&#39;;
    let stdoutSize = 0;
    repomix.stdout.on(&#39;data&#39;, (data) =&gt; {
      const chunk = data.toString();
      stdoutSize += chunk.length;
      if (stdoutSize &gt; REPOMIX_MAX_BUFFER_SIZE) {
        repomix.kill(&#39;SIGKILL&#39;);
        reject(new Error(&#39;Output too large.&#39;));
      } else {
        stdout += chunk;
      }
    });

    repomix.on(&#39;close&#39;, (code) =&gt; {
      if (code === 0) {
        resolve(stdout);
      } else {
        reject(new Error(&#39;Process failed.&#39;));
      }
    });
  });
}
</code></pre>
<ul>
<li>Spins up a subprocess to execute the <code class="inline-code">repomix</code> tool, capturing its output efficiently.</li>
<li>Incorporates memory and timeout safeguards to prevent resource exhaustion or hangs.</li>
<li>Configures subprocess arguments flexibly, enabling high adaptability to mission-specific needs.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Look for patterns in optional parameters of <code class="inline-code">generateResponse</code> to tailor your signals for different use cases.</li>
<li>Pay close attention to the caching mechanisms in <code class="inline-code">generateRepomixContext</code> to understand how they minimize resource usage.</li>
<li>Explore how robust validation like <code class="inline-code">validateProjectPath</code> shields the starship from errant inputs.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries hidden in the galaxy of code.</p>
<p>Mission accomplished, Star Voyager! You&#39;ve successfully decoded the celestial symphony of Galactic Signals, blazing forward through the cosmic expanse‚Äîkeep this stellar momentum as you chart your next adventure! ‚≠êüöÄüì°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>