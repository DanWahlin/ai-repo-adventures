<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Galactic Quest Engine Assembly - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-space">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">Cosmic Chronicles: The Codebase Expedition</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Galactic Quest Engine Assembly</h1>
<hr>
<p>Inside the engine room of the starship <strong>Codebreaker</strong>, the Galactic Quest Engine pulses with incomplete energy. This vital module, responsible for generating immersive challenges and charting the unknown expanses of the galaxy, lies dormant. The crew must carefully explore its interconnected systems, reigniting its celestial power. By aligning its components and decoding its structures, you‚Äôll enable the starship to procedurally generate adventures that will define the future of cosmic exploration.</p>
<p>The time has come to unveil the mysteries of this engine and ensure its seamless operation.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>System Initialization Scan</strong>: How does <code class="inline-code">AdventureManager</code> initialize the storyline and connect thematic contexts to the project?  </li>
<li>‚ö° <strong>Quest Execution Flow</strong>: What processes are involved when a quest is explored and its content is generated?  </li>
<li>üõ°Ô∏è <strong>Code Validation Protocols</strong>: How are quest choices validated to ensure they align with system expectations?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Galactic Quest Manager</h3>
<p>The file <code class="inline-code">adventure-manager.ts</code> orchestrates interactions between the codebase and the Adventure State, serving as the main control pipeline for quest generation, initialization, and execution. This manager is the core of the Galactic Quest Engine‚Äîresponsible for transforming raw data and user input into structured narrative elements.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Prepares the overarching storyline and quests for a specific project context, establishing the Adventure State and injecting thematic elements.  </li>
<li><code class="inline-code">exploreQuest</code>: Validates and executes a selected quest based on user input, pulling from cache or generating new quest content as needed.  </li>
<li><code class="inline-code">generateQuestContent</code>: Produces the details of a quest, including narrative segments and code exploration content, by leveraging the repository analysis tools.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  // Reset state for new adventure
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  // Set custom theme data if provided
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  // Generate the overall story and quests
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  
  // Merge files from adventure config into the generated quests
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  
  // Enforce quest count from adventure.config.json if it exists
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  // Return the story with available quests
  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>This function initializes the <strong>Adventure State</strong>, ensuring that key project details, such as its path and theme, are passed into the quest engine.  </li>
<li>A connection to the <code class="inline-code">StoryGenerator</code> links the narrative process directly to the repository.  </li>
<li>Notice the validation and integration of custom theme data, hinting at the modular nature of the system.  </li>
<li>Quest files are dynamically adjusted based on configurations, allowing customization for individual projects.</li>
</ul>
<hr>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  
  // Check if this is a progress request
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  
  // Find the quest based on the choice
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }

  // Execute the quest
  return await this.executeQuest(quest);
}
</code></pre>
<ul>
<li>Implements user decision-making by locating the corresponding quest (<code class="inline-code">findQuest</code>) and determining the execution method.  </li>
<li>Includes robust validation mechanisms (<code class="inline-code">validateAndSanitizeChoice</code>) to prevent invalid inputs from processing.  </li>
<li>The function highlights extensibility in adding support for new user commands, such as viewing progress.</li>
</ul>
<hr>
<pre><code class="language-typescript">private async generateQuestContent(quest: Quest): Promise&lt;QuestContent&gt; {
  let codeContent: string;
  
  // Use targeted content if quest has specific files, otherwise use full content
  if (quest.codeFiles &amp;&amp; quest.codeFiles.length &gt; 0 &amp;&amp; this.state.projectPath) {
    try {
      console.log(`Generating targeted content for ${quest.codeFiles.length} files`);
      codeContent = await repoAnalyzer.generateTargetedContent(
        this.state.projectPath,
        quest.codeFiles,
        false  // Use uncompressed content
      );
    } catch (error) {
      console.warn(`Failed to generate targeted content, falling back to full content:`, error);
      codeContent = this.state.projectInfo!.repomixContent;
    }
  } else {
    codeContent = this.state.projectInfo!.repomixContent;
  }

  const questPosition = this.state.quests.findIndex(q =&gt; q.id === quest.id) + 1;
  const totalQuests = this.state.quests.length;

  return await this.storyGenerator.generateQuestContent({
    quest,
    theme: this.state.currentTheme!,
    codeContent,
    questPosition,
    totalQuests
  });
}
</code></pre>
<ul>
<li>Demonstrates fault-tolerant logic by falling back to the entire project‚Äôs representation if targeted generation fails.  </li>
<li>Leverages <code class="inline-code">quest.codeFiles</code> for focused exploration, ensuring efficiency when handling large codebases.  </li>
<li>Essential for dynamically creating contextual content aligned with the theme and quest structure.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Preparation Tip</strong>: Start by understanding how the <code class="inline-code">state</code> transitions between different phases of quest and story generation.  </li>
<li><strong>Exploration Recommendation</strong>: Focus on how <code class="inline-code">validateAndSanitizeChoice</code> interacts with user input to maintain code integrity.  </li>
<li><strong>Next Steps</strong>: Investigate the <code class="inline-code">StoryGenerator</code> in <code class="inline-code">story-generator.ts</code> to uncover how quests are designed procedurally.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Stellar success! You‚Äôve ignited the cosmic core and assembled the Galactic Quest Engine, propelling your mission 40% closer to the stars‚Äîkeep your trajectory blazing bright! ‚≠êüöÄ‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="prev-quest-btn">‚Üê Previous: Quest 2</a>
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>