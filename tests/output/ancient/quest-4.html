<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Glyphs of Configuration - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'ancient' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Lost Codex of the Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Glyphs of Configuration</h1>
<hr>
<p>The ancient Repository loomed before you like a sleeping giant, its chambers whispering secrets of civilizations past. Deep within its coded halls lies the fabled Glyphs of Configuration, powerful fragments that dictate the flow and structure of the entire digital labyrinth. It was said that no explorer had fully decoded these glyphs without activating their hidden mechanisms‚Äîpuzzles crafted by the First Codemasters to challenge even the most ardent seekers. As the stone gateway shifted open, glowing faintly from your touch, the air thickened with the weight of discovery. Would you dare to unravel configuration‚Äôs mysteries?</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Configuration for MCP Repo Adventure System</h3>
<p>This file serves as the cornerstone for setting up and regulating the behavior of the MCP Repo Adventure System. The <code class="inline-code">config.ts</code> file provides constants and utility variables that control many essential aspects of the system, such as request timeouts, cache expiration settings, and limits on file size and quest complexity. Through the use of environment variables like <code class="inline-code">LLM_API_KEY</code> and <code class="inline-code">GITHUB_TOKEN</code>, the file enables external configuration, ensuring that the adventure system is flexible and adaptable to various deployments. Additionally, it defines specific parameters for Large Language Model (LLM) interactions, such as <code class="inline-code">LLM_MAX_TOKENS</code> and <code class="inline-code">LLM_REQUEST_TIMEOUT</code>, to balance efficiency and robustness during story generation.</p>
<p>Key highlights include <code class="inline-code">REPOMIX_CACHE_TTL</code>, which determines how long processed content remains valid, and <code class="inline-code">IGNORE_PATTERNS</code>, which ensures sensitive files and system directories are skipped during code analysis. With its safety checks and granular controls, the file ensures the adventure remains stable while generating engaging challenges from intricate codebases.</p>
<h4>Highlights</h4>
<ul>
<li>Provides environment-variable-driven settings such as <code class="inline-code">LLM_API_KEY</code> and <code class="inline-code">GITHUB_TOKEN</code>.</li>
<li>Enforces strict file size limits (<code class="inline-code">MAX_FILE_SIZE_MB</code>) to prevent memory issues during analysis.</li>
<li>Defines default adventure settings, including <code class="inline-code">DEFAULT_THEME</code> and <code class="inline-code">MAX_FILES_PER_QUEST</code>.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Theme Definitions and Validation</h3>
<p>The <code class="inline-code">theme.ts</code> file orchestrates the themes that give each quest its unique identity. Among the available options, the ‚ÄúAncient Civilization‚Äù theme brings a wealth of archaeological metaphors, emphasizing exploration of lost knowledge and wisdom embodied as complex code systems. This file contains not only rich theme metadata‚Äîsuch as <code class="inline-code">THEMES</code> with their descriptions and keywords‚Äîbut also supporting functions like <code class="inline-code">parseTheme()</code> and <code class="inline-code">getAllThemes()</code> that ensure accurate validation and seamless user interactions.</p>
<p>This file simplifies user input by allowing theme selection through identifiers, keywords, or even descriptions. The function <code class="inline-code">isValidTheme()</code> verifies compatibility with predefined keys such as <code class="inline-code">space</code>, <code class="inline-code">mythical</code>, and <code class="inline-code">ancient</code>. Similarly, <code class="inline-code">formatThemeOption()</code> ensures every theme option is displayed with consistent formatting, including an emoji, ID, and description. Together, this system blends technical design with creativity, ensuring users feel immersed in their chosen storyline.</p>
<h4>Highlights</h4>
<ul>
<li>Establishes comprehensive theme definitions (<code class="inline-code">THEMES</code>) to support diverse quests.</li>
<li>Validates input using <code class="inline-code">isValidTheme()</code> to map user ideas to appropriate themes.</li>
<li>Simplifies onboarding with functions like <code class="inline-code">getAllThemes()</code> and <code class="inline-code">parseTheme()</code>.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Security and Input Validation</h3>
<p>Input validation stands as the guardian between your themed adventure and unwanted errors or manipulation, and the <code class="inline-code">input-validator.ts</code> file is its steadfast sentinel. This file ensures that user choices, project paths, and displayed outputs are not only syntactically clean but also safe for the system. The function <code class="inline-code">validateAdventureChoice()</code> rigorously sanitizes user inputs for length and emptiness, while <code class="inline-code">validateTheme()</code> maps user input to one of the allowable themes, throwing clear errors if invalid data appears.</p>
<p>Of notable importance is <code class="inline-code">sanitizeForDisplay()</code>, which removes dangerous characters and trims excessively long input to prevent injection attacks. The file&#39;s logic doesn‚Äôt just shield the system‚Äîit enhances user experience by guiding them with meaningful error messages like ‚ÄúInvalid theme‚Äù or ‚ÄúChoice is required.‚Äù Through its careful design, the file ensures your journey is rooted in clarity and respect for the Repository‚Äôs structure.</p>
<h4>Highlights</h4>
<ul>
<li>Implements length checks in <code class="inline-code">validateAdventureChoice()</code> to prevent overly long input.</li>
<li>Converts unsafe strings into secure formats with <code class="inline-code">sanitizeForDisplay()</code>.</li>
<li>Verifies theme mappings through <code class="inline-code">validateTheme()</code> to align with valid quest frameworks.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const REPOMIX_MAX_BUFFER_SIZE = 100 * 1024 * 1024; // 100MB max buffer to prevent memory exhaustion

export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
export const KEY_SOURCE_FILES = 10; // Number of key files to highlight in adventure generation
export const TOP_FUNCTIONS = 20; // Maximum functions to include in code analysis summaries
export const TOP_CLASSES = 5; // Maximum classes to include in analysis to keep stories focused
</code></pre>
<p>This snippet sets several boundaries to ensure the stability and predictability of the system, akin to sandbags protecting an archaeological dig from flooding.</p>
<hr>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  ANCIENT: {
    id: 3,
    key: &#39;ancient&#39;,
    displayName: &#39;Ancient Civilization&#39;,
    emoji: &#39;üè∫&#39;,
    description: &#39;Discover lost temples of code where algorithms are ancient wisdom and APIs are trade routes&#39;,
    keywords: [&#39;ancient&#39;, &#39;temple&#39;, &#39;pyramid&#39;, &#39;archaeology&#39;, &#39;historical&#39;, &#39;civilization&#39;, &#39;ruins&#39;]
  }
} as const;

export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;

  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }

  return null;
}
</code></pre>
<p>Here, the <code class="inline-code">parseTheme()</code> function maps input to meaningful themes much like a cartographer translating ancient maps into modern coordinates.</p>
<hr>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}

export function sanitizeForDisplay(input: string, maxLength = 1000): string {
  if (!input) return &#39;&#39;;
  
  return input
    .replace(/[&lt;&gt;{}&quot;`]/g, &#39;&#39;)
    .replace(/\s+/g, &#39; &#39;)
    .trim()
    .slice(0, maxLength);
}
</code></pre>
<p>The validation here acts as a gatekeeper, ensuring that only appropriate tokens and data can cross into the sacred code-filled halls of your quest.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Double-check environment variable values in <code class="inline-code">config.ts</code> for any overrides needed during custom setup.</li>
<li>Use <code class="inline-code">isValidTheme()</code> in <code class="inline-code">theme.ts</code> to generate a list of selectable themes for user-facing components.</li>
<li>Expand input sanitization tests in <code class="inline-code">input-validator.ts</code> to guard against emergent attacks or edge cases.</li>
</ul>
<hr>
<p>Huzzah, seeker of sacred wisdom, for thou hast unraveled the Glyphs of Configuration, ascending yet nearer to the apex of this venerable odyssey‚Äîonward now, for the final horizon beckons with its eternal brilliance! ‚≠ê‚ö°üíé</p>

</div>


    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>