<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Four Relics of the Mystic Protocol - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'mythical' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Chronicles of the Mystic Codebase: The Enchanted Repository</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Four Relics of the Mystic Protocol</h1>
<hr>
<p>The swirling winds of Codoria carried whispers of a dire task‚Äîretrieving the &quot;Four Relics of the Mystic Protocol&quot; to restore balance to the fragmented Great Repository. As you, a fledgling apprentice of the Order of Engineers, stepped into the Vault of Invocation, luminescent scripts danced in the air. The first challenge was clear: to awaken the &quot;Repo Adventure Server,&quot; slumbering in the depths of enchanted code, and learn the secrets it held. With your enchanted quill in hand, the journey to decipher its logic began.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>This file is the beating heart of the &quot;Repo Adventure Server,&quot; responsible for breathing life into Codoria‚Äôs gamified code exploration. Here, the <code class="inline-code">RepoAdventureServer</code> class channels mystical energy to host adventure tools, allowing coders to interact with the Great Repository. Its <code class="inline-code">setupHandlers()</code> method orchestrates the registration of requests to list and execute tools, akin to knights preparing their weapons for quests. Meanwhile, the <code class="inline-code">run()</code> method activates the server, connecting to the enchanted <code class="inline-code">StdioServerTransport</code> and loading the Precast Cache Ritual via <code class="inline-code">repoAnalyzer.preGenerate()</code> to warm up the repository&#39;s essence. The <code class="inline-code">main()</code> function serves as the pivotal entry point, casting protective charms for graceful shutdown and managing unforeseen errors.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers()</code> enables dynamic tool registration and invocation, centralizing quest-related intelligence.</li>
<li><code class="inline-code">RepoAdventureServer.run()</code> connects the server to processes and primes the repository cache for efficient exploration.</li>
<li><code class="inline-code">main()</code> ensures that the server maintains resilience through meticulous error handling and signal monitoring.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Adventure Tools Configuration</h3>
<p>This file is like the treasure chest of Codoria, housing the four legendary tools‚Äî<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. These tools enable adventurers to embark on journeys, select their themes, delve into quests, and track their progress. The <code class="inline-code">tools</code> object collects and organizes these artifacts, ensuring they are ready for deployment. Moreover, the file re-exports the <code class="inline-code">adventureManager</code>, the silent orchestrator tracking the user&#39;s entire journey, aligning quests with their choices.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code> prepares repository analysis and introduces adventurers to thematic realms of Codoria.</li>
<li><code class="inline-code">choose_theme.handler</code> transforms user inputs into tailored narratives within Codoria‚Äôs vast mythos.</li>
<li><code class="inline-code">explore_quest.handler</code> propels the journey, unlocking quests embedded in the Repository&#39;s arcane scrolls.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      // Execute the tool handler with validated arguments
      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>The <code class="inline-code">setupHandlers()</code> method is like a magical dispatcher, carefully matching adventurers&#39; requests to the proper enchanted tool while validating their scrolls for authenticity.</p>
<hr>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>The <code class="inline-code">tools</code> object acts as the Order‚Äôs reliquary, securely housing each of the adventure tools and ensuring their readiness for intrepid explorers.</p>
<h2>Helpful Hints</h2>
<ul>
<li><code class="inline-code">setupHandlers()</code> provides a perfect starting point when incorporating new features into the quest system‚Äîtrace its flow for adding tools.</li>
<li>Explore <code class="inline-code">start_adventure.handler</code> in the tools file to uncover how thematic introductions are intertwined with codebase analysis.</li>
<li>For a deeper understanding of cache management, investigate the <code class="inline-code">repoAnalyzer.preGenerate()</code> call within the <code class="inline-code">run()</code> method.</li>
</ul>
<hr>
<p>Hark, valiant seeker, the Kingdom of Knowledge exalts your triumph in uniting the Four Relics of the Mystic Protocol‚Äîyour heroic journey begins to gleam with the light of untold wisdom! ‚ö°üíéüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Engine of Eternal Stories ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>