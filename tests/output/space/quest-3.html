<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: The Code Analysis Observatory - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Infinity: Unraveling the Galaxy's Codebase</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: The Code Analysis Observatory</h1>
<hr>
<p>The <em>Starship Infinity</em> has reached a new star system in the Galactic Codebase Repository, an exotic sector known as the Code Analysis Observatory. The observatory orbits a volatile star, rich in encrypted flares of information. Your mission is to harness the celestial power of Repomix to analyze targeted code asteroids while avoiding security hazards and resource drain. With the clock ticking and the LLM reactors humming, the crew must validate data paths, decode patterns, and optimize their approach for stellar code synthesis. The Observatory is teeming with potential—will you mine its treasures or be lost in its complexity?</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/analyzer/repo-analyzer.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/analyzer/repo-analyzer.ts</code></a>: Integration with Repomix for Code Analysis</h3>
<p>This file serves as the heart of the code analysis pipeline aboard the <em>Starship Infinity</em>. The <code class="inline-code">RepoAnalyzer</code> class is your multi-tool for using Repomix, a CLI utility tailored to analyze expansive codebases. It handles everything from validating project paths to executing Repomix subprocesses with precision. The <code class="inline-code">generateRepomixContext()</code> method enables the class to create a comprehensive contextual view of the source repository by applying caching, optimizing memory usage, and ensuring security. For more focused operations, <code class="inline-code">generateTargetedContent()</code> emerges as a hero, isolating code fragments hinted at by adventure configurations. Furthermore, the <code class="inline-code">captureRepomixStdout()</code> method harnesses the raw output of the Repomix engine, delicately balancing resource efficiency and robust error handling. In essence, this file equips the <em>Starship Infinity</em> crew with a telescope for navigating the chaotic stars of the Galactic Codebase.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateRepomixContext()</code>: Produces a full repository analysis with sophisticated caching.</li>
<li><code class="inline-code">generateTargetedContent()</code>: Extracts poignant file data for targeted exploration.</li>
<li><code class="inline-code">captureRepomixStdout()</code>: Interfaces with Repomix processes, ensuring timeout and memory safety.</li>
<li><code class="inline-code">validateProjectPath()</code>: Shields the system from invalid or malicious paths.</li>
<li>Designed for robust error handling across file-centric tasks.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/llm/llm-client.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/llm/llm-client.ts</code></a>: Connecting with Language Models for Insight</h3>
<p>This file is the communication bridge to the LLM-powered AI copilots of the <em>Starship Infinity</em>. The <code class="inline-code">LLMClient</code> class processes the high-bandwidth communication between human astronauts and the machine intelligence that drives the ship forward. By invoking <code class="inline-code">generateResponse()</code>, this class enables deep conversational analysis, timely answers, and JSON-encoded responses for system concatenation. Each request is meticulously constructed in <code class="inline-code">buildRequestParams()</code> to accommodate various models like OpenAI’s GPT-4 or Azure-hosted deployments. The client even adapts for different providers using logic like <code class="inline-code">isAzureOpenAI()</code> and handles environmental configurations through <code class="inline-code">getApiKey()</code>. With timeout protections and extensive error logging, the LLM Client ensures a smooth conversational flow along the user interface.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse()</code>: Responsible for parsing LLM input, generating analysis, and handling JSON response parsing.</li>
<li><code class="inline-code">buildRequestParams()</code>: Adapts requests dynamically for different model configurations and parameters.</li>
<li><code class="inline-code">isAzureOpenAI()</code>: Detects provider-specific modifications for endpoint handling.</li>
<li><code class="inline-code">getApiKey()</code>: Dynamically locates the relevant API for interaction.</li>
<li>Logs extensive debugging information for failed LLM transmissions.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">private validateProjectPath(projectPath: string): void {
  if (!projectPath || typeof projectPath !== &#39;string&#39;) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }

  const trimmedPath = projectPath.trim();
  if (!trimmedPath) {
    throw new Error(&#39;Project path must be a non-empty string&#39;);
  }

  // Basic safety check for null bytes (can break file system operations)
  if (trimmedPath.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid null bytes&#39;);
  }
}
</code></pre>
<p>This function acts as a security officer, ensuring that no corrupted or harmful paths are set loose in the Observatory&#39;s sensitive systems.</p>
<pre><code class="language-typescript">async generateTargetedContent(projectPath: string, targetFiles: string[], compress: boolean = true): Promise&lt;string&gt; {
  this.validateProjectPath(projectPath);
  
  if (!targetFiles || targetFiles.length === 0) {
    throw new Error(&#39;Target files array cannot be empty&#39;);
  }
  
  const safeFiles = this.validateAndNormalizeTargetFiles(projectPath, targetFiles);
  if (safeFiles.length === 0) {
    throw new Error(&#39;No valid target files found after validation&#39;);
  }
  
  const cacheKey = `${path.resolve(projectPath)}:targeted:${safeFiles.join(&#39;,&#39;)}:compress=${compress}`;
  const cached = this.cache.get(cacheKey);
  if (cached &amp;&amp; (Date.now() - cached.timestamp) &lt; REPOMIX_CACHE_TTL) {
    return cached.content;
  }

  try {
    // Code for targeted generation
  } catch (error) {
    throw new Error(`Targeted repomix execution failed: ${error.message}`);
  }
}
</code></pre>
<p>This method is like a miner setting out with a compass and map, extracting only the most valuable deposits of data while ignoring the noise.</p>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">export class LLMClient {
  private client: OpenAI | AzureOpenAI;
  private model: string;

  constructor() {
    this.model = LLM_MODEL;

    const apiKey = this.getApiKey();
    if (!apiKey || !LLM_BASE_URL) {
      throw new Error(&#39;LLM configuration required. Please set LLM_BASE_URL and appropriate API key.&#39;);
    }

    if (this.isAzureOpenAI()) {
      const azureEndpoint = LLM_BASE_URL.split(&#39;/openai/deployments&#39;)[0];
      this.client = new AzureOpenAI({
        endpoint: azureEndpoint,
        apiKey,
        apiVersion: LLM_API_VERSION,
        deployment: this.model,
      });
    } else {
      this.client = new OpenAI({
        apiKey,
        baseURL: LLM_BASE_URL,
      });
    }
  }
}
</code></pre>
<p>This class is akin to a translator droid, perfectly tuned for communicating with various dialects within the Galaxy—be it OpenAI or Azure.</p>
<pre><code class="language-typescript">async generateResponse(prompt: string, options?: LLMRequestOptions): Promise&lt;LLMResponse&gt; {
  try {
    const requestParams = this.buildRequestParams(prompt, options);
    const completion = await this.executeRequest(requestParams);
    let content = this.validateResponse(completion);

    if (options?.responseFormat === &#39;json_object&#39;) {
      content = this.cleanJsonResponse(content);
    }

    return { content };
  } catch (error) {
    this.logDetailedError(error, prompt);
    throw new Error(`LLM request failed: ${error.message}`);
  }
}
</code></pre>
<p>This function is like a celestial postal service, ensuring every prompt reaches its destination and returns with valuable insights.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Always validate paths before analyzing files to avoid potential security risks.</li>
<li>Leverage <code class="inline-code">generateTargetedContent()</code> for smaller, more precise explorations if full repository scans are too resource-intensive.</li>
<li>Use the extensive logging in <code class="inline-code">LLMClient</code> to debug and refine interactions with various LLM models.</li>
</ul>
<p>Mission accomplished, Code Explorer! Your sharp analysis has illuminated the cosmos of Quest 3, propelling your starship to 50% completion—keep blazing through the galaxy like a supernova! 🚀⭐📡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: Unlocking the Themes Databank →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>