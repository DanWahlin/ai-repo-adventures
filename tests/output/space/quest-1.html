<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: Mapping the MCP Command Center - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Infinity: Unraveling the Galaxy's Codebase</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: Mapping the MCP Command Center</h1>
<hr>
<p>The <em>Starship Infinity</em> continued its journey through the vast Galactic Codebase Repository, its navigational charts incomplete and its systems whispering of unknown command centers hidden amongst the stellar void. Your mission: unravel the mysteries of the MCP&#39;s command framework on the planet of Serverium. The crew has identified critical files—beacons in the darkness—guiding you toward the inner workings of interactive protocols and the tools that power this cosmic adventure. Brace yourself for a deep dive into the energetic pulse of the <strong>MCP Command Center</strong>, where every line of code is a spark amidst the infinite stars.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server protocol implementation that hosts the adventure tools</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> file is the backbone of the MCP server, orchestrating communication between the <em>Starship Infinity</em> and the repository it explores. This file defines the <code class="inline-code">RepoAdventureServer</code> class, which configures handlers, manages connections, and warms up the system cache with repomix content for efficient operation. Specifically, the <code class="inline-code">setupHandlers()</code> method dynamically registers tools, forming a bridge between incoming requests and the tools implemented in <code class="inline-code">tools.ts</code>. It validates tool execution with <code class="inline-code">Zod</code> schemas, ensuring data integrity while executing commands. Additionally, the <code class="inline-code">run()</code> method connects the server using <code class="inline-code">stdio</code> transport, initiates the repomix content generation for preprocessing, and sets the stage for handling user commands. The <code class="inline-code">main()</code> function allows for a structured entry point, implementing graceful shutdown signals (<code class="inline-code">SIGINT</code>, <code class="inline-code">SIGTERM</code>) and handling potential errors during server operation, ensuring the mission doesn’t spiral out of control. Together, these components form a command hub for exploring interactive codebase journeys, establishing a sturdy and resilient operational framework.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code> configures the MCP protocol by registering tool handlers.</li>
<li>The <code class="inline-code">run()</code> method initiates the server and pre-generates repository context, warming up the adventure.</li>
<li>The <code class="inline-code">main()</code> function ensures a stable and recoverable server launch with error handling and shutdown support.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Adventure tools driving interaction</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/tools.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/tools.ts</code></a> file encapsulates the main MCP tools that power the exploratory journey into the Galactic Codebase Repository. It imports and ties together four pivotal tools: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. These tools provide the interface for users to engage with immersive storytelling and manage their navigation through quests. Each tool serves a specialized purpose: analyzing the codebase, personalizing the adventure theme, delving into quests, and tracking progress. This file ensures that all tools are registered under a unified object (<code class="inline-code">tools</code>) for dynamic access. By maintaining a clean and modular structure, the file allows for future growth of tool options, empowering the ever-evolving exploration mission.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code> initiates codebase analysis and gathers context for the entire journey.</li>
<li><code class="inline-code">explore_quest.handler</code> executes individual adventure quests with tracking mechanisms.</li>
<li>The <code class="inline-code">tools</code> object consolidates all tool options for dynamic inventory management.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));

    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      
      // Validate arguments using the tool&#39;s Zod schema
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      // Execute the tool handler with validated arguments
      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>This function is like a universal translator, ensuring that every incoming message finds the right tool for execution.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  // Pre-generate repomix content for the current working directory to warm up the cache
  // This happens in the background while waiting for user commands
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>This piece ensures the spaceship is fueled and its systems primed for exploration before taking off into the repository galaxy.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This is like assembling an adventure toolkit, with each tool ready for deployment in the cosmic adventure.</p>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;
</code></pre>
<p>Think of these imports as gathering crew members, each with a unique role, to ensure mission success.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Always validate incoming requests against schemas for secure execution.</li>
<li>Explore <code class="inline-code">setupHandlers()</code> to understand how tools are dynamically registered and executed.</li>
<li>Dive into the <code class="inline-code">tools.ts</code> file to see how modular tools enable mission flexibility and scalability.</li>
</ul>
<hr>
<p>The MCP Command Center awaits, with its mysteries and challenges drawing you ever closer. Prepare for the next quest! The universe itself is your canvas.</p>
<p>Stellar success, Cadet—Quest 1 complete! You&#39;ve charted the uncharted and illuminated the cosmic map of the MCP Command Center with precision and brilliance—onward to the stars! ⭐🚀📡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Quest Engine’s Power Core →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>