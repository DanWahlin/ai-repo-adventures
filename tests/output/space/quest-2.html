<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Quest Engine’s Power Core - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Infinity: Unraveling the Galaxy's Codebase</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Quest Engine’s Power Core</h1>
<hr>
<p>The <em>Starship Infinity</em> thrummed with a steady pulse, a symphony of logic and computation. Suspense hung in the air as Commander Juno addressed the crew, “Our next challenge lies within the star system of the Core Engine. The story generation matrix—the Quest Engine itself—requires optimized power output to fuel our adventures.” The team knew the importance of their mission: delve into the heart of the system’s story generator and configuration manager to ensure quests remain abundant and inspiring.</p>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Adventure orchestration and state management</h3>
<p>This file serves as the nerve center of the Quest Engine, controlling story initialization, quest execution, state tracking, and user feedback. It defines the <code class="inline-code">AdventureManager</code> class, which facilitates seamless transitions between quests, validates user choices, and generates personalized narratives based on theme and project context. A critical component in this file is the <code class="inline-code">AdventureState</code> class, which tracks the progression of quests, manages caching for previously completed adventures, and calculates completion percentages for progress updates. The <code class="inline-code">AdventureManager.initializeAdventure()</code> function taps into the story generator to create detailed adventures based on the provided theme, blending logic with creativity. Whether it’s executing quests through <code class="inline-code">exploreQuest()</code> or managing project configurations, this file ensures the Quest Engine runs efficiently while maintaining its immersive storytelling.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureState.progressPercentage</code> ensures transparent tracking of all completed quests across the system.  </li>
<li><code class="inline-code">AdventureManager.exploreQuest()</code> validates user input and retrieves completed quest data from cache when necessary.  </li>
<li><code class="inline-code">AdventureManager.initializeAdventure()</code> integrates theme guidelines and calls the story generator to set up adventures dynamically.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Story creation powered by AI</h3>
<p>This file is the creative powerhouse of the Quest Engine, employing advanced machine learning techniques to generate thematic narratives and quests. The <code class="inline-code">StoryGenerator.generateStoryAndQuests()</code> function provides a structured prompt to the Large Language Model (LLM), leveraging repomix content to produce both a story and a complementary set of quests. Another essential function is <code class="inline-code">generateQuestContent()</code>, which crafts detailed content for individual quests, including code snippets and exploration tasks. Constant validation using schemas ensures storytelling is precise and coherent. The file further integrates custom themes, mapping vocabulary directly into stories to achieve immersive results, while also offering a fallback for consistency when the LLM encounters communication constraints.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests()</code> creates entire narratives, including quests, using JSON responses validated by <code class="inline-code">Zod</code> schemas.  </li>
<li><code class="inline-code">generateQuestContent()</code> dynamically generates adventure tasks, integrating real-time project context and formatted configuration data.  </li>
<li>Handles custom themes seamlessly through <code class="inline-code">setCustomTheme()</code> to adapt vocabulary and make narratives unique.</li>
</ul>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Configuration system for guided adventure generation</h3>
<p>This file provides the foundational structure for enabling guided adventures. It parses the <code class="inline-code">adventure.config.json</code> file and transforms it into meaningful data—like file paths—used during story and quest generation. The function <code class="inline-code">extractUniqueFilePaths()</code> traverses the configuration to identify relevant code file paths for quests, ensuring the selected files match the specified patterns. Additionally, <code class="inline-code">formatAdventureConfigForPrompt()</code> prepares structured configuration data for embedding into LLM prompts, enforcing clear analysis sections for quests and file exploration tasks.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">extractUniqueFilePaths()</code> scans the configuration to extract files, ensuring security and validity of paths.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt()</code> structures config data into clear and readable sections tailored for LLM.  </li>
<li>Robust validation through the <code class="inline-code">parseAdventureConfig()</code> method prevents misconfigurations.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">export class AdventureManager {
  private state: AdventureState = new AdventureState();
  private storyGenerator: StoryGenerator;

  constructor() {
    this.storyGenerator = new StoryGenerator();
  }

  async initializeAdventure(
    projectInfo: ProjectInfo, 
    theme: AdventureTheme, 
    projectPath?: string, 
    customThemeData?: CustomThemeData
  ): Promise&lt;string&gt; {
    this.state.reset();
    this.state.projectInfo = projectInfo;
    this.state.currentTheme = theme;
    this.state.projectPath = projectPath || process.cwd();

    const storyResponse = await this.storyGenerator.generateStoryAndQuests(
      projectInfo, 
      theme, 
      this.state.projectPath
    );

    this.state.title = storyResponse.title;
    this.state.story = storyResponse.story;
    this.state.quests = storyResponse.quests;
    return `${storyResponse.story}\n\nAvailable Quests:\n${this.listQuests()}`;
  }
}
</code></pre>
<p>It’s like setting up a cosmic GPS: this code ensures your journey begins with clarity, mapping both the adventure and its possibilities in perfect harmony.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">export class StoryGenerator {
  async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme): Promise&lt;StoryResponse&gt; {
    const repomixContent = projectInfo.repomixContent || &quot;No repomix content available&quot;;
    const prompt = `Generate a ${theme} story based on the following content:\n${repomixContent}`;
    const response = await this.llmClient.generateResponse(prompt);
    
    const content = response.content || &quot;Failed to generate story.&quot;;
    const parsed = parseMarkdownToStoryResponse(content);
    return parsed;
  }
}
</code></pre>
<p>It’s like asking a librarian AI for a themed story—this function creates intricate quests and rich narratives by processing user-selected themes and project data.</p>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  const files = new Set&lt;string&gt;();
  const stack = [parsed];
  while (stack.length) {
    const node = stack.pop();
    if (node?.path &amp;&amp; typeof node.path === &quot;string&quot;) {
      files.add(node.path.trim());
    }
    Array.isArray(node) ? stack.push(...node) : stack.push(...Object.values(node));
  }
  return Array.from(files);
}
</code></pre>
<p>It’s like mining a treasure map for starting locations—this function pinpoints relevant file paths to guide exploration tasks in quests.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Make sure to validate adventure configuration files against adventure themes to catch conflicts early.</li>
<li>Check LLM response handling in <code class="inline-code">AdventureManager</code> for areas where retries or fallbacks could improve reliability.</li>
<li>Consider improving <code class="inline-code">StoryGenerator</code> to prioritize recursion in overlapping quests for added complexity!</li>
</ul>
<hr>
<p>Mission accomplished: the Quest Engine’s Power Core burns bright with your brilliance—stellar work, Commander; you&#39;re navigating this cosmic journey like a true star captain! ⭐🚀⚡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Code Analysis Observatory →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>