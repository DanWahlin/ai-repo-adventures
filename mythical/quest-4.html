<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Oracle‚Äôs Council - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Chronicles of the Enchanted Repository</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Oracle&#39;s Council</h1>
<hr>
<p>In the heart of Repositoria, the Oracle‚Äôs Council awaits ‚Äì a mystical circle of spells and wisdom governing the enchanted Kingdom‚Äôs thematic essence. It is revealed that confusion festers within the Oracle‚Äôs scripts, where themes and validations transform chaotic forces into harmonious adventures. The Scrolls of Infinite Knowledge indicate disturbances in the configuration and validation layers, and your destiny as the Hero of Syntax demands you unveil the mysteries hidden within these layers. Gather your courage, for the balance of Repositoria‚Äôs magical design depends on your swift actions. </p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Oracle&#39;s Insights</strong>: How does the <code class="inline-code">THEMES</code> configuration bring mythical settings to life and prevent misconceptions about valid themes?</li>
<li>‚ö° <strong>Theme Harmonization</strong>: What mechanisms ensure user inputs are sanitized and validated against enchanted theme definitions?</li>
<li>üõ°Ô∏è <strong>Guarding the Threshold</strong>: How do validation functions prevent errors like invalid paths or unsanctioned themes from causing chaos in the realm?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Magical Constants of Repositoria</h3>
<p>The <code class="inline-code">config.ts</code> file defines constants which act as the magical seals and temporal rules governing the enchanted scripts. From defining timeouts (agile guidelines for spell completion) to validation limits protecting the system from corruptions, the constants hold the magical essence of Repositoria together. This foundation ensures safety, preventing misuse of powerful configurations like <code class="inline-code">LLM_API_KEY</code> and guards the balance with structured <code class="inline-code">ERROR_MESSAGES</code>.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code> sets boundaries for long-running mystical responses from the Oracle.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> defines how temporal blessings (cache mechanisms) maintain recent insights.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> prevents the system from tripping over bulky, unpredictable files.</li>
<li><code class="inline-code">ERROR_MESSAGES</code> provides predictable, user-friendly spells to decode errors in a controlled manner.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> The Enchanted Theme Codex</h3>
<p>This file hosts <code class="inline-code">THEMES</code>, the mythical library of theme definitions, each configured with unique IDs, emoji sigils, descriptions, and keyword spells. Validations and helper functions like <code class="inline-code">parseTheme</code>, <code class="inline-code">getAllThemes</code>, and <code class="inline-code">isValidTheme</code> enforce harmony by ensuring consistency in theme choices. Here, input alignment with themes is cast with logic and flair.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code> is the central registry holding each theme&#39;s properties, structured like scrolls of ancient knowledge.</li>
<li><code class="inline-code">getAllThemes</code> enables the seamless retrieval of all magical themes.</li>
<li><code class="inline-code">parseTheme</code> ensures even user-derived, imperfectly-keyed inputs align with the sacred themes.</li>
<li><code class="inline-code">isValidTheme</code> validates the legitimacy of a theme to prevent disruptions in the Oracle&#39;s spells.</li>
<li><code class="inline-code">formatThemeOption</code> beautifully formats information about themes, making them easier for users to interpret.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Warding Spells of Validation</h3>
<p>The <code class="inline-code">input-validator.ts</code> file employs defensive validation to guard against corrupt or chaotic inputs. Whether it&#39;s checking the Hero‚Äôs choice or sanitizing dangerous symbols, these spells ensure adventurers progress without peril. The file includes dependable warding functions like <code class="inline-code">validateAdventureChoice</code> and <code class="inline-code">validateTheme</code>.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code> ensures the hero‚Äôs selection is neither empty nor overly long.</li>
<li><code class="inline-code">validateTheme</code> cross-verifies themes with the Oracle‚Äôs record, rejecting those unworthy of the quest.</li>
<li><code class="inline-code">validateProjectPath</code> checks the adventurer‚Äôs path to ensure it is untampered and safe for exploration.</li>
<li><code class="inline-code">sanitizeForDisplay</code> scrubs inputs of hazardous elements, ensuring data purity and stability.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">// Timeouts in milliseconds
export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env

// Analysis limits
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code

// Default error messages
export const ERROR_MESSAGES = {
  LLM_UNAVAILABLE: &#39;LLM service is currently unavailable. Please check your configuration.&#39;,
  ANALYSIS_FAILED: &#39;Failed to analyze the project. Please ensure the path is valid.&#39;,
} as const;
</code></pre>
<ul>
<li>Sets boundaries for LLM spell invocations like timeouts and cache durations.</li>
<li>Guards the system against oversized files that could destabilize magical processes.</li>
<li>Encodes default error messages that are consistent and helpful to guide users.</li>
</ul>
<hr>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">// Single source of truth for all themes
export const THEMES = {
  MYTHICAL: {
    id: 2,
    key: &#39;mythical&#39;,
    displayName: &#39;Enchanted Kingdom&#39;,
    emoji: &#39;üè∞&#39;,
    description: &#39;Explore magical realms where databases are dragon hoards&#39;,
    keywords: [&#39;magic&#39;, &#39;castle&#39;, &#39;dragon&#39;, &#39;kingdom&#39;]
  }
} as const;

export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  const normalized = input.toLowerCase().trim();
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  return null;
}
</code></pre>
<ul>
<li>Captures <code class="inline-code">MYTHICAL</code> as a core theme with detailed settings and keywords.</li>
<li>Offers <code class="inline-code">isValidTheme</code> as the gatekeeper ensuring only recognized themes pass through.</li>
<li>Provides <code class="inline-code">parseTheme</code> to interpret and normalize inputs, accounting for variations.</li>
</ul>
<hr>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  return input.trim();
}

export function validateTheme(input: string): string {
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    throw new Error(&#39;Invalid theme.&#39;);
  }
  return parsedTheme;
}
</code></pre>
<ul>
<li>Defends processes with <code class="inline-code">validateAdventureChoice</code>, ensuring inputs are of correct size and structure.</li>
<li>Verifies themes with <code class="inline-code">validateTheme</code>, preventing faulty entries from disrupting exploration.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When adding new theme definitions, maintain consistency in structure and keywords.</li>
<li>Explore validation outputs of <code class="inline-code">validateTheme</code> and <code class="inline-code">parseTheme</code> with test cases to ensure reliability.</li>
<li>Use constants like <code class="inline-code">ERROR_MESSAGES</code> to avoid repetitive error management logic.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>By the flames of the Eternal Phoenix and the sword of celestial wisdom, brave hero of the realm, you have conquered the Oracle‚Äôs Council and now stand triumphant with 60% of the cosmic map to glory etched upon your soul! ‚ö°üëÅÔ∏èüöÄ</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
</body>
</html>