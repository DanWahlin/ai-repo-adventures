<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Scribes' Workshop - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Enchanted Repository: A Hero's Tale</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Scribes&#39; Workshop</h1>
<hr>
<p>Within the sacred halls of the Mystic Keep lies the Scribes&#39; Workshop, a place where enchanted quills script the fates of heroes and weave paths through the realms of code and legend. It is here that the Codex of Creation gains its life essence, as the magic coursing through its pages is breathed into existence by cryptic algorithms and ancient glyphs. You are summoned, brave adventurer, to uncover the secrets of this sacred chamber and bring clarity to its enigma. Will your discovery unlock the final truth of the Codex?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:  </p>
<ul>
<li>üîç <strong>Glyph Recognition</strong>: How does the <code class="inline-code">parseAdventureConfig</code> function ensure safe and valid JSON parsing of the enchanted texts?  </li>
<li>‚ö° <strong>Pathfinder Exam</strong>: What mechanisms does <code class="inline-code">extractUniqueFilePaths</code> use to traverse and verify file paths in nested objects?  </li>
<li>üõ°Ô∏è <strong>Council Directive</strong>: How does the <code class="inline-code">formatAdventureConfigForPrompt</code> function optimize configurations to guide the Codex‚Äôs greater narrative flow?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Enchantment and Retrieval</h3>
<p>The file <code class="inline-code">adventure-config.ts</code> serves as the cornerstone of the Scribes&#39; Workshop, where raw configuration data is loaded, interpreted, and fortified into actionable constructs used by the Codex. The enchantments within ensure safe parsing of configurations, validate file paths mentioned in the scrolls, and condense verbose details for quicker delivery of insights. This file‚Äôs functions collectively empower the Codex to extract meaning from complex configurations while ensuring robustness and accuracy at every step.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: This function parses the textual contents of the configuration file to produce a structured artifact. Its role is critical in safeguarding against malformed entries and ensuring only valid configurations move forward.  </li>
<li><code class="inline-code">extractUniqueFilePaths</code>: A spell of file path scrying, this function journeys deep into nested objects and arrays to find and validate all file paths referenced in the configuration. It ensures that the Codex operates only on verified resources.  </li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: This optimization spell transforms the raw configuration into a concise format. By eliminating redundancy, it sharpens the focus of instructions and enables faster comprehension and execution by the Codex‚Äôs LLM components.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Ensures safe parsing of configuration files by wrapping the <code class="inline-code">JSON.parse</code> method in a <code class="inline-code">try-catch</code> block.  </li>
<li>Guards against the Codex being corrupted by malformed or incomplete configuration files.  </li>
<li>Tightly integrates with <code class="inline-code">loadAdventureConfig</code> to ensure only valid content reaches this stage.  </li>
<li>The function simplifies error handling by returning <code class="inline-code">null</code> when parsing fails.  </li>
<li>Promotes code reusability and centralizes parsing logic for all consumers of configuration data.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Recursively traverses deeply nested structures to extract every unique <code class="inline-code">path</code> reference encountered.  </li>
<li>Combines breadth-first traversal with validation to ensure accurate and clean results.  </li>
<li>Leverages <code class="inline-code">fs.existsSync</code> to confirm the existence of each file path, ensuring downstream tools operate only on real files.  </li>
<li>Maintains state efficiency with the use of a <code class="inline-code">Set</code> to eliminate duplicate paths.  </li>
<li>Exudes resilience in handling diverse object shapes (arrays vs. key-value objects) during exploration.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Transforms a verbose structure into a highly compact and actionable format suitable for LLM consumption.  </li>
<li>Outputs an organized summary of quests, including associated files and function names, while skipping excessive detail.  </li>
<li>Uses guard clauses extensively to ensure reliable results even with malformed or incomplete configurations.  </li>
<li>Supports dynamic scenarios by accommodating multiple quests with varied file-path and function lists.  </li>
<li>Empowers the Codex to leverage concise, contextually rich insights without unnecessary verbosity.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Always verify the format and content of configuration files before applying changes to the Codex.  </li>
<li>Review file paths flagged by <code class="inline-code">extractUniqueFilePaths</code> to ensure no essential data is missing.  </li>
<li>Use the resulting output from <code class="inline-code">formatAdventureConfigForPrompt</code> to validate high-level quest overviews.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Codex of Creation! Your adventure is complete. You emerge as the legendary keeper of mythical knowledge, a champion who safeguards the realm&#39;s enchanted systems. Bask in the glory of your achievements, for you are now a true Scribe of the Mystic Keep!</p>
<p>With the quill of divination now mastered, you ascend closer to the pinnacle of wisdom, forging the path of enlightenment like a true champion of the scribes‚Äô ancient dominion! ‚ö°üó∫Ô∏èüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>