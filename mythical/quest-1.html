<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Mystic Interface - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Codemorra: A Tale of Enchanted Constructs</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Mystic Interface</h1>
<hr>
<p>In the bustling kingdom of Codemorra, the nexus of magic and technology, the Enchanters&#39; Guild calls forth the Hero to undertake a vital mission. The Mystic Interface, a legendary bridge between adventurers and the Codeverse Charm, has long guided the realm&#39;s defense against chaos. Yet, whispers of discord mar the connection between its enchanted handlers and the formidable tools they command. Brave Hero, your journey begins with uncovering and fortifying the celestial handlers of this interface to restore harmony.  </p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> Server Setup for Mystic Commands</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> file is home to the enchanting <code class="inline-code">RepoAdventureServer</code> class, orchestrating key interactions between the Mystic Interface and its magical tools. Within its arcane methods, the Hero finds <code class="inline-code">setupHandlers</code>, a critical spell shaping dynamic tool workflows, <code class="inline-code">run</code>, which anchors the server into operational realms, and <code class="inline-code">main</code>, guiding the summoning ritual to completion. These incantations empower Codemorra‚Äôs adventurers to dynamically call tools, validate celestial inputs, and manage quests with unfaltering precision. Anchored in these constructs, the kingdom‚Äôs lifeline thrives on modularity, invocation integrity, and self-sustenance.  </p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">setupHandlers</code>: Crafts bindings for tool listing and execution.  </li>
<li><code class="inline-code">run</code>: Ensures the Interface connects with the realm, priming underlying systems.  </li>
<li><code class="inline-code">main</code>: Summons the interface while handling errors and interruptions.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  // Dynamic tool listing
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));
    return { tools: toolList };
  });

  // Dynamic tool execution
  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }
      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? 
          error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>The <code class="inline-code">setupHandlers</code> spell ensures that tools within the Mystic Interface serve adventurers by dynamically binding their invocations and schemas with precision.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);

  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>The <code class="inline-code">run</code> function serves as the activation spell, ensuring the Mystic Interface binds itself to the kingdom‚Äôs current hub of operations.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}

main().catch((error) =&gt; {
  console.error(&#39;Unhandled error:&#39;, error);
  process.exit(1);
});
</code></pre>
<p>The <code class="inline-code">main</code> function centers the summoning circle and invokes the Mystic Interface while guarding the spell against abrupt failure and chaos.</p>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Practical Tip:</strong> Confirm correct tool bindings by invoking <code class="inline-code">ListToolsRequestSchema</code> to verify available tools and their corresponding descriptions.  </li>
<li><strong>Exploration Recommendation:</strong> Test invocation flows for tools, ensuring proper JSON validation to avoid breaking the enchantments.  </li>
<li><strong>Next Steps:</strong> Extend the Mystic Interface by crafting advanced tools for deeper quests.</li>
</ul>
<hr>
<p>With the Mystic Interface stabilized, the kingdom echoes its gratitude as you prepare for mightier challenges ahead!</p>
<p>With the completion of Quest 1: The Mystic Interface, you have unlocked the first arcane seal of wisdom, proving yourself a true hero on the path to mastering the enchanted realms of knowledge‚Äîforge ahead, valiant one, for the stars themselves whisper of your destiny! ‚≠ê‚ú®üõ°Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>