<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The HTML Guild's Chronicle - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="../assets/shared/quest-navigator.css">
    <link rel="stylesheet" href="../assets/theme-toggle.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body class="theme-mythical">

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="../assets/shared/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
                <a href="index.html">The Enchanted Repository: Quests of the Mystic Codebase</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <button class="theme-toggle-btn" aria-label="Switch to light mode" type="button">
                    <div class="theme-toggle-slider">
                        <svg class="toggle-icon sun-icon" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                            <path d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="toggle-icon moon-icon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The HTML Guild&#39;s Chronicle</h1>
<hr>
<p>In the Kingdom of Codevale, where castles rise amidst rolling plains of code snippets, a mystical guild known as the HTML Guild stands watch over the enchanted art of webcrafting. These noble knights have sworn to unravel the secrets of dynamic webpage creation and the ancient engine that turns mere lines of code into vivid realms. Your quest is to journey through the Guild&#39;s sacred halls and investigate the spells found within their hallowed manuscripts, mastering the arcane tools required to forge a mythical digital kingdom.</p>
<h2>Quest Objectives</h2>
<p>As you explore the codes below, investigate these heroic questions:</p>
<ul>
<li>üîç <strong>Template Forge Mastery</strong>: How is <code class="inline-code">TemplateEngine.renderPage</code> combining templates and variables into fully crafted HTML pages?</li>
<li>‚ö° <strong>Asset Alchemy</strong>: How does <code class="inline-code">AssetManager.copyQuestNavigator</code> ensure shared assets are distributed effectively for single-theme setups?</li>
<li>üõ°Ô∏è <strong>Enchanted Server Protection</strong>: What safety mechanisms does <code class="inline-code">HTMLAdventureGenerator.startHttpServer</code> use to ensure secure file serving?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/generator/src/cli/template-engine.ts:</span> The Artisan&#39;s Forge</h3>
<p>The <code class="inline-code">TemplateEngine</code> class serves as the mystical forge where raw templates are imbued with life, transforming simple placeholders into intricate HTML configurations. It provides functionality for dynamic loading of template files, caching them for efficiency, and replacing placeholder variables with specific data. By doing so, <code class="inline-code">TemplateEngine.renderPage</code> forms the bedrock of modular web generation, enabling reuse and adaptability in crafting magical domains.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadTemplate</code>: Ensures templates are cached to maximize efficiency and avoid redundant file readings. This is vital for performance during complex quest generation.</li>
<li><code class="inline-code">replacePlaceholders</code>: Handles the substitution of variables into template placeholders. Essential for linking thematic elements with templates seamlessly.</li>
<li><code class="inline-code">renderPage</code>: Combines a base template and a content template along with a variables map to create complete web pages. Acts as the core spell for page creation.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/template-engine.ts</h3>
<pre><code class="language-typescript">/**
 * Load a template file with caching
 */
private loadTemplate(templateName: string): string {
  if (this.templateCache.has(templateName)) {
    return this.templateCache.get(templateName)!;
  }

  const templatePath = path.join(this.templatesDir, templateName);
  
  try {
    const content = fs.readFileSync(templatePath, &#39;utf-8&#39;);
    this.templateCache.set(templateName, content);
    return content;
  } catch (error) {
    throw new Error(`Failed to load template ${templateName}: ${error}`);
  }
}
</code></pre>
<ul>
<li>Caches frequently accessed templates using <code class="inline-code">Map</code> to avoid repeated disk operations and improve performance.</li>
<li>Reads files directly from the <code class="inline-code">templatesDir</code>, reinforcing modular design and separation of content.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Replace placeholders in template with variables
 */
private replacePlaceholders(template: string, variables: TemplateVariables): string {
  let result = template;
  
  for (const [key, value] of Object.entries(variables)) {
    const placeholder = `{{${key}}}`;
    result = result.replace(new RegExp(placeholder, &#39;g&#39;), value || &#39;&#39;);
  }
  
  return result;
}
</code></pre>
<ul>
<li>Iterates through variable mappings to dynamically inject data into predefined placeholders.</li>
<li>Uses regular expressions for precise replacement, avoiding errors when placeholders appear multiple times.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Render a complete page using base template + content template
 */
renderPage(contentTemplate: string, variables: TemplateVariables): string {
  const baseTemplate = this.loadTemplate(&#39;base-template.html&#39;);
  const contentHtml = this.loadTemplate(contentTemplate);
  
  // First render the content template
  const renderedContent = this.replacePlaceholders(contentHtml, variables);
  
  // Then render the base template with the content
  const pageVariables = {
    ...variables,
    CONTENT: renderedContent
  };
  
  return this.replacePlaceholders(baseTemplate, pageVariables);
}
</code></pre>
<ul>
<li>Combines templates to produce structured HTML output while maintaining modular design.</li>
<li>Ensures global variables (like <code class="inline-code">CONTENT</code>) and per-page variables are seamlessly integrated into the final render.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/asset-manager.ts:</span> Hall of Shared Wonders</h3>
<p>The <code class="inline-code">AssetManager</code> operates as the keeper of shared artifacts, ensuring critical assets are properly distributed across directories for single-theme and multi-theme adventures. Among its tasks, <code class="inline-code">copyQuestNavigator</code> ensures navigational tools (like CSS and JS files for quests) are placed in accessible locations, functioning as enchanted signposts for adventurers.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">copyImages</code>: Duplicates crucial thematic assets across directories, ensuring the codebase retains its visual allure.</li>
<li><code class="inline-code">copyQuestNavigator</code>: Deploys navigational resources to help adventurers traverse quests effectively, targeting specific theme directories.</li>
<li><code class="inline-code">copyGlobalAssets</code>: Centralizes shared resources for accessibility across multi-theme deployments, acting as a core mechanism for asset management.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/asset-manager.ts</h3>
<pre><code class="language-typescript">/**
 * Copy quest navigator files to theme-specific location (for single theme)
 */
copyQuestNavigator(outputDir: string): void {
  const templatesDir = path.join(this.sourceDir, &#39;templates&#39;);
  const sourceAssetsDir = path.join(this.sourceDir, &#39;assets&#39;);
  const cssSource = path.join(templatesDir, &#39;quest-navigator.css&#39;);
  const jsSource = path.join(templatesDir, &#39;quest-navigator.js&#39;);
  const svgSource = path.join(templatesDir, &#39;compass-icon.svg&#39;);
  
  // Theme toggle files
  const themeToggleCssSource = path.join(sourceAssetsDir, &#39;theme-toggle.css&#39;);
  const themeToggleJsSource = path.join(sourceAssetsDir, &#39;theme-toggle.js&#39;);

  const assetsDir = path.join(outputDir, &#39;assets&#39;);
  fs.mkdirSync(assetsDir, { recursive: true });

  // Copy navigator files
  if (fs.existsSync(cssSource)) {
    fs.copyFileSync(cssSource, path.join(assetsDir, &#39;quest-navigator.css&#39;));
  }
  if (fs.existsSync(jsSource)) {
    fs.copyFileSync(jsSource, path.join(assetsDir, &#39;quest-navigator.js&#39;));
  }
  if (fs.existsSync(svgSource)) {
    fs.copyFileSync(svgSource, path.join(assetsDir, &#39;compass-icon.svg&#39;));
  }

  // Copy theme toggle files
  if (fs.existsSync(themeToggleCssSource)) {
    fs.copyFileSync(themeToggleCssSource, path.join(assetsDir, &#39;theme-toggle.css&#39;));
  }
  if (fs.existsSync(themeToggleJsSource)) {
    fs.copyFileSync(themeToggleJsSource, path.join(assetsDir, &#39;theme-toggle.js&#39;));
  }
}
</code></pre>
<ul>
<li>Ensures essential navigation tools (<code class="inline-code">quest-navigator.css</code>, <code class="inline-code">quest-navigator.js</code>) are accessible within themed directories.</li>
<li>Handles the recursive creation of <code class="inline-code">assets</code> directories for proper file hierarchy.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/generator/src/cli/html-generator.ts:</span> The Crown Jewel of Codevale</h3>
<p>The <code class="inline-code">HTMLAdventureGenerator</code> class represents the pinnacle of web generation mastery, orchestrating the conversion of a codebase into a fully-fledged HTML adventure. Its <code class="inline-code">startHttpServer</code> method ensures explorers can traverse their generated creations safely via a local web server.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateAdventure</code>: Coordinates the generation of themes, assets, and quests into a cohesive web experience.</li>
<li><code class="inline-code">generateAllThemes</code>: Enables the construction of multiple thematic realms for simultaneous exploration.</li>
<li><code class="inline-code">startHttpServer</code>: Configures a local HTTP server while securing file access.</li>
<li><code class="inline-code">buildQuestHTML</code>: Produces individual quest pages, linking them with overarching adventure narratives.</li>
</ul>
<h2>Code</h2>
<h3>packages/generator/src/cli/html-generator.ts</h3>
<pre><code class="language-typescript">/**
 * Start an HTTP server in the output directory
 */
private async startHttpServer(port: number = 8080): Promise&lt;void&gt; {
  return new Promise((resolve, reject) =&gt; {
    const server = http.createServer((req, res) =&gt; {
      let filePath = path.join(this.outputDir, req.url === &#39;/&#39; ? &#39;index.html&#39; : req.url || &#39;&#39;);
      
      // Security check - ensure we stay within the directory
      if (!filePath.startsWith(this.outputDir)) {
        res.writeHead(403);
        res.end(&#39;Forbidden&#39;);
        return;
      }

      // Set content type based on file extension
      const extname = path.extname(filePath);
      let contentType = &#39;text/html&#39;;
      switch (extname) {
        case &#39;.js&#39;:
          contentType = &#39;text/javascript&#39;;
          break;
        case &#39;.css&#39;:
          contentType = &#39;text/css&#39;;
          break;
        case &#39;.json&#39;:
          contentType = &#39;application/json&#39;;
          break;
        case &#39;.png&#39;:
          contentType = &#39;image/png&#39;;
          break;
        case &#39;.jpg&#39;:
          contentType = &#39;image/jpg&#39;;
          break;
        case &#39;.svg&#39;:
          contentType = &#39;image/svg+xml&#39;;
          break;
      }

      fs.readFile(filePath, (err, content) =&gt; {
        if (err) {
          if (err.code === &#39;ENOENT&#39;) {
            res.writeHead(404);
            res.end(&#39;File not found&#39;);
          } else {
            res.writeHead(500);
            res.end(&#39;Server error&#39;);
          }
        } else {
          res.writeHead(200, { &#39;Content-Type&#39;: contentType });
          res.end(content, &#39;utf-8&#39;);
        }
      });
    });

    server.listen(port, () =&gt; {
      const url = `http://localhost:${port}`;
      console.log(chalk.green(`üåê HTTP server started on ${url}`));
      
      resolve();
    });

    server.on(&#39;error&#39;, (err) =&gt; {
      console.error(chalk.red(&#39;‚ùå Failed to start HTTP server:&#39;), err);
      reject(err);
    });
  });
}
</code></pre>
<ul>
<li>Implements strict file path validations to restrict access outside the served directory, enhancing security.</li>
<li>Sets content type dynamically based on file extensions to ensure proper format rendering.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Use the <code class="inline-code">replacePlaceholders</code> logic in <code class="inline-code">TemplateEngine</code> as a blueprint for understanding pattern replacement mechanics.</li>
<li>Focus on how <code class="inline-code">AssetManager</code> organizes assets across directories for scalability.</li>
<li>Explore <code class="inline-code">HTMLAdventureGenerator.startHttpServer</code> to learn secure server setup techniques.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries of Codevale‚Äôs enchanted repository.</p>
<p>The luminous scroll of the HTML Guild&#39;s Chronicle has been etched into the annals of your heroic lore; onward, valiant coder, the remaining quests await your mastery! ‚ö°üëÅÔ∏èüó∫Ô∏è</p>

</div>


      <div class="quest-navigation quest-navigation-bottom nav-next-only">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="../assets/shared/quest-navigator.js"></script>
    <!-- Theme Toggle Script (for light/dark mode toggle) -->
    <script src="../assets/theme-toggle.js"></script>
</body>
</html>