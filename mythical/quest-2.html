<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Grimoire of Storycraft - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Kingdom of Repository: A Tale of Heroic Adventures</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Grimoire of Storycraft</h1>
<hr>
<p>In the Kingdom of Repository, whispers echo of a page lost from the sacred Code Grimoire – the Page of Storycraft. This enchanted page holds the power to weave narratives, bringing clarity and magic to the repositories. Without it, the kingdom&#39;s adventures have become fragmented and lifeless. You, the Heroic Refactorer, must traverse the Treacherous Fields of Algorithms and reclaim the essence of storytelling. Beware – dragons of complexity guard the path to the grimoire’s secrets, their fire fueled by chaotic logic.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Quest Manager</h3>
<p>This file acts as the steadfast commander of the kingdom&#39;s narrative. It manages quests, validates paths, and ensures the Heroic Refactorer does not stray into the wilderness. The <code class="inline-code">AdventureManager</code> coordinates the initialization and execution of quests, ensuring the Grimoire&#39;s pages are sought out intentionally, while the <code class="inline-code">AdventureState</code> keeps track of progress and harmony across realms. A core function, <code class="inline-code">initializeAdventure</code>, weaves the foundation for all future storytelling by setting up the project context and orchestrating quest generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code> sets the stage for the entire adventure.</li>
<li><code class="inline-code">exploreQuest</code> allows heroes to delve into specific quests.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code> reveals how much of the journey is complete.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }
  
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);

  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<p>This is the enchanted map that sets the journey’s course, aligning the kingdom&#39;s theme and the hero’s path.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }
  return await this.executeQuest(quest);
}
</code></pre>
<p>The Heroic Refactorer wields this spell to navigate specific quests in search of the lost knowledge.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>This is the magical compass, showing how much of the kingdom has been restored.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration Wizard</h3>
<p>Within this file resides the wizardly tools for adventure configuration. It ensures the kingdom’s quests are aligned with the Heroic Refactorer’s journey, validating and extracting key elements for the greater adventure. By parsing the <code class="inline-code">adventure.config.json</code>, this file provides the spells necessary to extract unique file paths and optimize prompts for reliable guidance.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code> retrieves and validates the kingdom’s configuration.</li>
<li><code class="inline-code">extractUniqueFilePaths</code> gathers all files pivotal to the quest.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code> prepares a concise guide to summon responses from the great oracle.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<p>This is the wizard’s incantation, interpreting the kingdom’s configuration scroll with precision.</p>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];
  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];
  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }
  return Array.from(unique);
}
</code></pre>
<p>The enchanted sieve that isolates the magical file paths needed for the hero’s quest.</p>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }
  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }
  let formatted = `## Quest Structure\n\n`;
  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;
    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.filter((f: any) =&gt; f.path).map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
    const functions = quest.files.flatMap((f: any) =&gt; f.highlights || []).filter((h: any) =&gt; h.name).map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }
    formatted += `\n`;
  }
  return formatted;
}
</code></pre>
<p>The wizard’s scroll simplifies knowledge for the great oracle, ensuring clarity amidst the complexity.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Story Weaver</h3>
<p>The <code class="inline-code">StoryGenerator</code>, a masterful storyteller, crafts the adventures and blends quests seamlessly into the kingdom’s lore. This file forms the essence of the lost Page of Storycraft. From generating the initial tale (<code class="inline-code">generateStoryAndQuests</code>) to crafting quest-specific content (<code class="inline-code">generateQuestContent</code>), each line reverberates with myth.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code> unites the kingdom’s lore with the current theme.</li>
<li><code class="inline-code">generateQuestContent</code> brings life to enchanted quests.</li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code> transforms raw text into magical narratives.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(projectInfo: ProjectInfo, theme: AdventureTheme, projectPath?: string): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<p>The master scribe begins their work, aligning the tale with the kingdom’s essence.</p>
<pre><code class="language-typescript">async generateQuestContent(quest: Quest, theme: AdventureTheme, codeContent: string): Promise&lt;QuestContent&gt; {
  let adventureGuidance = &#39;&#39;;
  if (this.projectPath) {
    const formattedConfig = formatAdventureConfigForPrompt(this.projectPath);
    if (formattedConfig) {
      adventureGuidance = formattedConfig;
    }
  }
  const prompt = loadQuestContentPrompt({
    theme,
    adventureTitle: quest.title,
    codeContent,
    storyContent: this.currentStoryContent || &#39;No story context available.&#39;,
    adventureGuidance: adventureGuidance || &#39;&#39;,
    ...(this.customThemeData &amp;&amp; { customThemeData: this.customThemeData })
  }) + &#39;\n\nIMPORTANT: Respond with ONLY markdown content between explicit delimiters.\n\nFormat your response EXACTLY like this:\n\n---BEGIN MARKDOWN---\n[Your markdown content here starting with the quest title]\n

With the valiant completion of Quest 2: The Grimoire of Storycraft, you have unlocked the glimmering runes of creative mastery—let your newfound storytelling sorcery blaze onward, noble champion! ⚡💎🗺️
</code></pre>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">← Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>