<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Essence Core - Storycraft Forged in Code - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'developer' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Chronicles of the Code Repository: The Architect's Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Essence Core - Storycraft Forged in Code</h1>
<hr>
<p>As you venture deeper into the Architect&#39;s sprawling repository, the Essence Core hums with untold mysteries. Your journey into the MCP server unveils a magic-like tapestry woven through interactive protocols. It’s a realm where code breathes life into storytelling tools, blending machine precision with creative imagination. The stakes are clear—mastering the tools of this kingdom is your key to unraveling the Architect&#39;s secrets and unlocking boundless adventures!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server protocol implementation that hosts the adventure tools</h3>
<p>Behind the curtain lies the MCP server, a keystone of the adventure system that bridges the interactive storytelling tools and user interactions. The <code class="inline-code">RepoAdventureServer</code> class is the heart of this file, packed with robust methods like <code class="inline-code">setupHandlers()</code> to register MCP protocol handlers and <code class="inline-code">run()</code> to establish transport connections through <code class="inline-code">stdio</code>. Notably, the <code class="inline-code">main</code> function gracefully handles shutdown signals while ensuring ongoing error recovery—a clear design choice to offer durability in uncertain environments. This file highlights a gamified architecture combining storytelling and developer tools, allowing users to dynamically interact with the codebase. Its design lets the server respond to user requests like listing available tools and invoking them with securely validated data. This integration aligns seamlessly with project exploration, pre-generating repository analyses for optimal performance. With its focus on interoperability and error handling, this file provides the backbone for a smooth adventure experience.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers()</code>: Registers handlers for listing and executing tools.</li>
<li><code class="inline-code">RepoAdventureServer.run()</code>: Establishes a robust connection for stdio transport and repository pre-generation.</li>
<li>Graceful shutdown logic in <code class="inline-code">main()</code>: Ensures clean exits during interruption signals.</li>
<li>Dynamic tool listing using <code class="inline-code">zodToJsonSchema</code> for accurate schema representations.</li>
<li>Pre-generative content setup with <code class="inline-code">repoAnalyzer.preGenerate()</code>.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The 4 main MCP tools that provide the user interface to the adventure system</h3>
<p>The tools file is where the MCP server transforms from a mere protocol provider into an engaging adventure guide. Defined here are tools like <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>, each with tailored handlers to empower users to embark on quests and track their progress. The file invokes the <code class="inline-code">adventureManager</code>, which acts as the central logic hub, while segregating individual tools into intuitive, reusable modules. Not only does this file encourage modular design for easier maintainability, but it also introduces gamified elements like quest selection and adventure management. The shared export of tools ensures seamless registration and use within the MCP ecosystem. With tools named to match an intuitive MCP pattern, the file caters to a high-level overview while leaving flexibility for future features.</p>
<h4>Highlights</h4>
<ul>
<li>Four fully implemented tools: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>.</li>
<li>Modular design for cleaner code and maintainability.</li>
<li>Centralized logic in <code class="inline-code">adventureManager</code> for uniform adventure state.</li>
<li>Exports align precisely with MCP conventions to expedite tool registration.</li>
<li>Structured flow for gamified exploration and user progress monitoring.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));

      return { tools: toolList };
    });

    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;

        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }

        const tool = tools[name as keyof typeof tools];
        
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt;
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }

        return await tool.handler(validationResult.data as any);

      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
}
</code></pre>
<p>Every user interaction with tools flows through <code class="inline-code">setupHandlers()</code>, ensuring secure, schema-validated execution harmonized with the adventurous MCP spirit.</p>
<hr>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { adventureManager } from &#39;@ai-repo-adventures/core/adventure&#39;;
import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
import { viewProgress } from &#39;./tools/view-progress.js&#39;;

export { adventureManager };

export const start_adventure = startAdventure;
export const choose_theme = chooseTheme;
export const explore_quest = exploreQuest;
export const view_progress = viewProgress;

export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>The seamless export of tools builds a structured pipeline for quest dynamics, enriching exploration and user immersion in the codebase&#39;s narrative-driven adventure.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Modular designs, like the one in <code class="inline-code">tools.ts</code>, simplify future scalability while keeping code reusable and maintainable.</li>
<li>Use schema validation, as shown in <code class="inline-code">setupHandlers()</code>, to ensure user inputs remain secure and error-free.</li>
<li>Explore files used by <code class="inline-code">adventureManager</code> to dig deeper into quest orchestration logic and contextual storytelling elements.</li>
</ul>
<hr>
<p>🎉 Quest 1: The Essence Core successfully compiled and executed—your codebase of knowledge expands, logic flows strong, and the next adventure awaits; keep iterating towards mastery! 🚀💎⚡</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: Protocol Sanctum - The MCP Gate... →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>