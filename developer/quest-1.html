<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Four Instruments of Interaction - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Chronicles of Codecraft: Forge of Adventure</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Four Instruments of Interaction</h1>
<hr>
<p>As the digital forge pulses with the energy of infinite possibilities, your journey begins to peel back the layers of the mysterious Repository. Quest 1 unveils &quot;The Four Instruments of Interaction,&quot; the tools of an adventurer&#39;s trade. From the server protocols that shape communication to the interactive tools that guide the user&#39;s hands, each instrument reveals itself as both a marvel and a responsibility. Armed with your code-wizardry, explore these files to uncover the symphony of interactions that breathe life into code repositories.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server protocol implementation that hosts the adventure tools</h3>
<p>The <code class="inline-code">server.ts</code> file is the backbone of the interaction engine, implementing the MCP protocol to manage requests and host tools. This server acts as the bridge between the Repository and its adventurers. The <code class="inline-code">RepoAdventureServer</code> class sets up critical handlers via <code class="inline-code">setupHandlers</code>, providing dynamic capability to list tools and execute them. Once initialized, the <code class="inline-code">run</code> method establishes communication through the <code class="inline-code">stdio</code> transport and pre-generates adventure content to ensure fast responses. Lastly, the <code class="inline-code">main</code> function orchestrates the lifecycle of this server, handling graceful shutdowns and unhandled errors to maintain stability during long-running quests.</p>
<h4>Highlights</h4>
<ul>
<li><strong>RepoAdventureServer.setupHandlers</strong>: Dynamically registers handlers for managing MCP requests, including tools listing and execution logic.</li>
<li><strong>RepoAdventureServer.run</strong>: Establishes the serverâ€™s transport layer and warms the adventure cache.</li>
<li><strong>main</strong>: Central entry point ensuring clean shutdowns and robust error handling.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;
      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }
      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);
      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }
      return await tool.handler(validationResult.data as any);
    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>Here, handlers are akin to a wizardâ€™s spellbook, encoding unique rules for invoking the instruments with precision.</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>This snippet is the gateway, similar to the library where your magical tools are prepared before embarking on the quest.</p>
<pre><code class="language-typescript">async function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}

main().catch((error) =&gt; {
  console.error(&#39;Unhandled error:&#39;, error);
  process.exit(1);
});
</code></pre>
<p>This function is the map, outlining your adventure&#39;s journey while taking precautions against unknown dangers.</p>
<hr>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> The 4 main MCP tools that provide the user interface to the adventure system</h3>
<p>The <code class="inline-code">tools.ts</code> file organizes and exports the four core tools for adventurers: <code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>. Each tool fulfills an essential purpose, from selecting adventures to tracking progress. These components define the user interface of interactions with the gamified repository.</p>
<h4>Highlights</h4>
<ul>
<li><strong>start_adventure.handler</strong>: Analyzes codebases and suggests themes to embark on an adventure.</li>
<li><strong>choose_theme.handler</strong>: Crafts immersive stories tailored to user-selected themes.</li>
<li><strong>explore_quest.handler</strong>: Facilitates exploration of individual quests, ensuring progress is recorded.</li>
<li><strong>view_progress.handler</strong>: Provides users with an overview of completed and remaining tasks.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">import { startAdventure } from &#39;./tools/start-adventure.js&#39;;
export const start_adventure = startAdventure;
</code></pre>
<p>This tool is like the first spark that ignites the flames of adventure.</p>
<pre><code class="language-typescript">import { chooseTheme } from &#39;./tools/choose-theme.js&#39;;
export const choose_theme = chooseTheme;
</code></pre>
<p>Selecting a theme is akin to setting the tone for a bardâ€™s story, choosing between epic or tranquil melodies.</p>
<pre><code class="language-typescript">import { exploreQuest } from &#39;./tools/explore-quest.js&#39;;
export const explore_quest = exploreQuest;
</code></pre>
<p>Exploring a quest mirrors stepping into a labyrinth, carefully unraveling challenges while keeping track of your map.</p>
<pre><code class="language-typescript">import { viewProgress } from &#39;./tools/view-progress.js&#39;;
export const view_progress = viewProgress;
</code></pre>
<p>Viewing progress is the adventurerâ€™s journal, where milestones are inked and next steps planned.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li><strong>Handler Explanation</strong>: Review handler functions to understand the dynamic processing of tools and their integration into the server.</li>
<li><strong>Sequential Tool Use</strong>: Tools build logically from one another - examine flow diagrams or project architecture to grasp their interplay.</li>
<li><strong>Modify Locally</strong>: Experiment locally with the <code class="inline-code">tools.ts</code> module to customize or add new tools for your quests.</li>
</ul>
<hr>
<p>You have glimpsed the orchestration and instruments behind the immersive Repository experience. Press on, for deeper secrets lie ahead!</p>
<p>ðŸŽ‰ System.out.println(&quot;Achievement Unlocked: Quest 1 - The Four Instruments of Interaction complete; dependencies validated, knowledge committed to memory heap, and you&#39;re ready to deploy into the next adventure! ðŸš€ðŸ’Žâš¡&quot;);</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Heart of the Engine â†’</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
</body>
</html>