<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Story Weaver’s Manuscript - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'developer' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">The Code Chronicles: Forge of Adventures</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Forge’s Hidden Mechanisms</h1>
<hr>
<p>The <strong>Realm of Repositories</strong> hums with the energy of innovation, its gold-threaded pathways guiding knowledge seekers to the <strong>Forge of Adventures</strong>. The Story Weaver’s Manuscript is said to hold the key to evoking immersive worlds coded with precision and boundless creativity. But its fragmented nodes must be deciphered by those daring enough to challenge its scattered quests. Your journey begins here, brave developer—will you unveil the secrets of the forge’s mechanisms to sculpt narratives that ignite the imagination?</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Orchestration and State Management</h3>
<p>This file serves as the <strong>adventure control panel</strong> for the quest experience: it orchestrates the initialization, execution, and tracking of quests while managing the state of your adventure. The <code class="inline-code">AdventureManager</code> class is responsible for syncing the player&#39;s progress, generating themed content, and validating the integrity of choices made through user input. With methods like <code class="inline-code">initializeAdventure()</code>, it dynamically sets up the thematic foundation and uses the <code class="inline-code">StoryGenerator</code> to prepare engaging quests. The <code class="inline-code">exploreQuest()</code> method serves as the gateway for adventurers to dive into individual quests, employing choice validation and executing content generation strategies. This file showcases a thoughtful balance between user interaction and technical utility—offering insightful glimpses into a sophisticated adventure system.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">AdventureManager.initializeAdventure</code>: Dynamically sets up the adventure&#39;s context and generates quests using storytelling themes.</li>
<li><code class="inline-code">AdventureManager.exploreQuest</code>: Validates user input and executes quest-specific strategies via targeted content generation.</li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Provides a real-time completion metric to track quests finished against total quests.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> The Narrative Engine for Quest Generation</h3>
<p>As the heart of the Story Weaver’s Manuscript, this file powers the thematic and narrative content for quests. The <code class="inline-code">StoryGenerator</code> class uses LLM-driven methods like <code class="inline-code">generateStoryAndQuests()</code> to create overarching narratives alongside corresponding quest lists. By leveraging prompt engineering with context from <code class="inline-code">adventure.config.json</code>, it ensures that quests are rich in context while aligning with the chosen theme. <code class="inline-code">generateQuestContent()</code> dives even deeper, producing detailed settings, file explorations, and actionable tasks for each quest. With robust methods like <code class="inline-code">removeLLMMetaCommentary()</code>, the generator refines raw LLM output into polished, user-ready experiences. This file embodies the art of merging technical precision with creative storytelling.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">StoryGenerator.generateStoryAndQuests</code>: Builds thematic stories and quests through LLM-driven content generation.</li>
<li><code class="inline-code">StoryGenerator.generateQuestContent</code>: Details individual quests with rich analysis and exploration tasks.</li>
<li><code class="inline-code">StoryGenerator.removeLLMMetaCommentary</code>: Ensures output is clean and focused by filtering irrelevant LLM commentary.</li>
</ul>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Configuration System for Guided Adventures</h3>
<p>This file acts as a critical bridge between raw configuration data and meaningful quest structuring. It reads and parses the <code class="inline-code">adventure.config.json</code> file, validating its structure and extracting unique file paths for targeted analysis. The method <code class="inline-code">formatAdventureConfigForPrompt()</code> provides a blueprint for structuring quests and aligns each adventure with clear file analysis sections. This ensures smooth integration and accessibility of quest data when interacting with LLMs. The focus on rigorous file formatting and validation within this file exemplifies its role as an anchor for structured and purposeful quest design.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Verifies and parses the adventure’s configuration file into a usable object.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the configuration to find distinct file paths for inclusion.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Structures quest and file information to ensure coherence in LLM prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">export class AdventureManager {
  private state: AdventureState = new AdventureState();
  private storyGenerator: StoryGenerator;

  constructor() {
    this.storyGenerator = new StoryGenerator();
  }

  async initializeAdventure(
    projectInfo: ProjectInfo,
    theme: AdventureTheme,
    projectPath?: string,
    customThemeData?: CustomThemeData
  ): Promise&lt;string&gt; {
    this.state.reset();
    this.state.projectInfo = projectInfo;
    this.state.currentTheme = theme;
    this.state.projectPath = projectPath || process.cwd();

    if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
      this.storyGenerator.setCustomTheme(customThemeData);
    }
    const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
    
    this.state.title = storyResponse.title;
    this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
    this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
    this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

    return this.formatStoryWithQuests({
      ...storyResponse,
      quests: this.state.quests
    });
  }
}
</code></pre>
<p>This code piece functions as the entry point where an adventure&#39;s storyline and quests are crafted based on a selected theme.</p>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">export class StoryGenerator {
  async generateStoryAndQuests(
    projectInfo: ProjectInfo,
    theme: AdventureTheme,
    projectPath?: string
  ): Promise&lt;StoryResponse&gt; {
    const repomixContent = projectInfo.repomixContent || &#39;No repomix content available&#39;;
    let adventureGuidance = &#39;&#39;;
    if (projectPath) {
      const formattedConfig = formatAdventureConfigForPrompt(projectPath);
      if (formattedConfig) {
        adventureGuidance = formattedConfig;
      }
    }

    const prompt = loadStoryGenerationPrompt({
      theme,
      repomixContent,
      ...(adventureGuidance &amp;&amp; { adventureGuidance })
    });

    const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_STORY });
    if (!response.content || response.content.trim() === &#39;&#39;) {
      throw new Error(&#39;LLM returned empty response&#39;);
    }
    return parseMarkdownToStoryResponse(response.content.trim());
  }
}
</code></pre>
<p>This snippet illustrates how the code leverages thematic elements to generate adventures tailored to contexts defined in <code class="inline-code">adventure.config.json</code>.</p>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}

export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure Guidelines\n\n**CRITICAL: Each quest MUST include dedicated file analysis sections**\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    formatted += `${quest.description}\n\n**Required File Analysis Sections:**\n`;

    for (const file of quest.files) {
      if (!file.path || !file.description) continue;

      formatted += `**File: \`${file.path}\`**\n- Description: ${file.description}\n`;
    }
  }
  return formatted;
}
</code></pre>
<p>This fragment showcases methods that validate and format quest structures for integration into adventure prompts.</p>
<h2>Helpful Hints</h2>
<ul>
<li>To quickly kickstart adventures, ensure your repository has a well-organized <code class="inline-code">adventure.config.json</code> file.</li>
<li>Use the <code class="inline-code">AdventureState</code> and <code class="inline-code">progressPercentage</code> when monitoring quest completion for clearer feedback loops.</li>
<li>Explore how <code class="inline-code">StoryGenerator</code> applies prompt engineering to enrich thematic storylines—an inspiring area for further customization.</li>
</ul>
<hr>
<p>Congratulations on successfully executing the &quot;StoryWeaver.complete()&quot; method for Quest 2, pushing your progress to 25%—your coding journey shines 🚀 as you iterate toward mastery!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3: The Analyzer’s Compass →</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>