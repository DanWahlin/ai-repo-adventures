<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Storyteller‚Äôs Forge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Chronicles of the Codebase</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Storyteller‚Äôs Forge</h1>
<hr>
<p>Amidst the sprawling Adventure Forge, the Storyteller‚Äôs Forge lies at the heart of creative development, breathing life into coding challenges. This powerful mechanism transforms plain repositories into enthralling quests, guiding adventurers with tailored narratives and precisely crafted prompts. To wield this forge successfully, you must dive deep into its intricate machinery‚Äîanalyzing tools that structure dynamic adventures. Can you master the art of quest curation and storytelling as you explore its mechanisms?</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/adventure-manager.ts:</span> Adventure Manager Core Systems</h3>
<p>Adventure Manager is the orchestrator of quests in the ecosystem. At its core, it initializes adventures, validates user input, and merges custom configurations into dynamic quests. It uses a <code class="inline-code">StoryGenerator</code> instance to generate storylines and quests from repositories. Key methods include <code class="inline-code">initializeAdventure</code>, which prepares the adventure&#39;s state by generating themes and enforcing configurations, and <code class="inline-code">exploreQuest</code>, which manages the execution of a specific quest. These features allow adventurers to embark on tailored journeys while tracking their progress.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Initializes an adventure, resetting the state, configuring themes, parsing files, and generating stories.  </li>
<li><code class="inline-code">exploreQuest</code>: Validates a user‚Äôs quest choice, retrieves content (from cache or newly generated), and formats the result.  </li>
<li><code class="inline-code">AdventureState.progressPercentage</code>: Calculates and tracks quest completion progress.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/adventure-manager.ts</h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }
  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  this.state.title = storyResponse.title;
  this.state.story = typeof storyResponse.story === &#39;string&#39; ? storyResponse.story : storyResponse.story.content;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);
  return this.formatStoryWithQuests({...storyResponse, quests: this.state.quests});
}
</code></pre>
<p>This function initiates an adventure, similar to loading a map for a grand journey with tools and themes.</p>
<pre><code class="language-typescript">async exploreQuest(choice: string): Promise&lt;AdventureResult&gt; {
  const sanitizedChoice = this.validateAndSanitizeChoice(choice);
  if (this.isProgressRequest(sanitizedChoice)) {
    return this.getProgress();
  }
  const quest = this.findQuest(sanitizedChoice);
  if (!quest) {
    return this.createNotFoundResult();
  }
  return await this.executeQuest(quest);
}
</code></pre>
<p>This resembles choosing a path in the adventure, validating your choice and progressing through it.</p>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<p>This percentage tracker provides an adventure‚Äôs progress at a glance, like seeing how far you‚Äôve explored new terrain.</p>
<hr>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/adventure/story-generator.ts:</span> Quest and Story Creation</h3>
<p>The Story Generator is a critical component in the Adventure Forge, dedicated to weaving themes and narratives based on project files. It provides methods such as <code class="inline-code">generateStoryAndQuests</code>, which synthesizes dynamic narratives from configuration and code, and <code class="inline-code">generateQuestContent</code>, which enriches quests with specific code snippets. These utilities employ AI-driven prompts, offering immersive technical adventures tailored to the chosen theme.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Creates a project-based storyline and quest hooks via efficient AI-driven generators.  </li>
<li><code class="inline-code">generateQuestContent</code>: Enriches quests with code snippets and hints, leveraging dynamic inputs and AI.  </li>
<li><code class="inline-code">parseMarkdownToStoryResponse</code>: Parses markdown from AI responses into actionable data.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/adventure/story-generator.ts</h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme,
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;
  const validatedTheme = this.validateTheme(theme);
  return await this.generateWithLLM(projectInfo, validatedTheme);
}
</code></pre>
<p>This method architects the grand narrative, shaping a repository&#39;s components into a cohesive tale.</p>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest, 
  theme: AdventureTheme, 
  codeContent: string
): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({
    theme, 
    adventureTitle: quest.title, 
    codeContent
  }) + &#39;\n\nIMPORTANT: Respond with ONLY markdown content...&#39;;
  const response = await this.llmClient.generateResponse(prompt, { maxTokens: LLM_MAX_TOKENS_QUEST });
  const cleanContent = this.removeLLMMetaCommentary(response.content.trim());
  return {
    adventure: cleanContent,
    fileExploration: &#39;&#39;,
    codeSnippets: [],
    hints: []
  };
}
</code></pre>
<p>This generates the quest‚Äôs inner workings, like designing the mechanics of a game level.</p>
<pre><code class="language-typescript">function parseMarkdownToStoryResponse(markdownContent: string): StoryResponse {
  const tokens = marked.lexer(markdownContent);
  let title = &#39;&#39;;
  let story = &#39;&#39;;
  const quests: Quest[] = [];
  let currentSection = &#39;&#39;;
  for (const token of tokens) {
    if (token.type === &#39;heading&#39; &amp;&amp; token.depth === 1) {
      title = token.text;
    } else if (token.type === &#39;paragraph&#39; &amp;&amp; currentSection === &#39;story&#39;) {
      story += token.text + &#39;\n\n&#39;;
    }
  }
  return { title, story: story.trim(), quests };
}
</code></pre>
<p>This parses markdown like deciphering ancient runes, separating a story‚Äôs content from its metadata.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Always reset the adventure state when generating new ones to avoid overlaps.</li>
<li>Enforce configuration to ensure quests match repository requirements precisely.</li>
<li>Extend parsing for more robust markdown handling when managing dynamic content.</li>
</ul>
<hr>
<p>Your skills in wielding the Storyteller‚Äôs Forge are growing. Continue crafting adventurer journeys or explore new paths!</p>
<p>Congratulations on debugging the narrative flow and successfully committing Quest 2: The Storyteller‚Äôs Forge to the repository of progress‚Äîyour journey is 20% deployed towards the epic production pipeline! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>