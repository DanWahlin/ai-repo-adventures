<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 2: The Storyteller's Forge - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codekeeper's Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 2: The Storyteller&#39;s Forge</h1>
<hr>
<p>Within the ether of infinite codepaths, the Storyteller&#39;s Forge awaits. Here, the Adventure Manager collaborates with the Story Generator, smelting raw project details into shimmering tales of challenges and triumphs. As you delve into the forge, immerse yourself in the mechanisms that bring dynamic stories and quests to life. Analyze how the code intricately balances customization with structure, ensuring every tale resonates uniquely with its explorer.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Forge Alignment</strong>: How is the <code class="inline-code">initializeAdventure</code> function used to align project context, themes, and quest generation into a coherent adventure?</li>
<li>‚ö° <strong>Dynamic Craftsmanship</strong>: What are the roles of <code class="inline-code">generateStoryAndQuests</code> and <code class="inline-code">generateQuestContent</code> in turning project data into engaging story assets?</li>
<li>üõ°Ô∏è <strong>Code Integrity Check</strong>: How are <code class="inline-code">parseAdventureConfig</code> and <code class="inline-code">validateAdventureChoice</code> utilized to ensure safe and valid configurations for adventure progression?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a>: Adventure and Quest Management</h3>
<p>The <code class="inline-code">adventure-manager.ts</code> file defines how adventures are initialized, quests executed, and their states managed. With the <code class="inline-code">AdventureManager</code> class as its keystone, this file governs the seamless coordination between user inputs, project contexts, and the creative mechanics of story generation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">initializeAdventure</code>: Resets state, assigns themes, parses configuration files, and invokes the Story Generator to prepare stories and quests.</li>
<li><code class="inline-code">exploreQuest</code>: Orchestrates the execution of selected quests, integrating validation and progress tracking.</li>
<li><code class="inline-code">progressPercentage</code>: Provides a calculated metric for quest completion, essential for progress updates.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: Configuration Parsing</h3>
<p>This file structures how configuration files, such as <code class="inline-code">adventure.config.json</code>, are managed and validated. It focuses on extracting relevant details about the adventure&#39;s setup.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses and validates the project-specific configuration JSON, ensuring adherence to expected formats.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Collects all file paths mentioned in the configuration, validating their existence within the project structure.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a>: Story Creation Hub</h3>
<p>The <code class="inline-code">story-generator.ts</code> file defines the <code class="inline-code">StoryGenerator</code>&#39;s role in crafting adventures dynamically. It leverages advanced prompts and large language models to transform user projects into engaging narratives.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateStoryAndQuests</code>: Generates the foundational story and quest list for the adventure, mapping user themes onto project details.</li>
<li><code class="inline-code">generateQuestContent</code>: Produces intricate, detailed content for individual quests, tailoring the narrative to the project context.</li>
</ul>
<hr>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/adventure-manager.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/adventure-manager.ts</code></a></h3>
<pre><code class="language-typescript">async initializeAdventure(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string,
  customThemeData?: CustomThemeData
): Promise&lt;string&gt; {
  this.state.reset();
  this.state.projectInfo = projectInfo;
  this.state.currentTheme = theme;
  this.state.projectPath = projectPath || process.cwd();
  
  if (theme === &#39;custom&#39; &amp;&amp; customThemeData) {
    this.storyGenerator.setCustomTheme(customThemeData);
  }

  const storyResponse = await this.storyGenerator.generateStoryAndQuests(projectInfo, theme, this.state.projectPath);
  
  this.state.title = storyResponse.title;
  this.state.story = storyResponse.story;
  this.state.quests = this.mergeQuestFilesFromConfig(storyResponse.quests, this.state.projectPath);
  this.state.quests = this.enforceConfigQuestCount(this.state.quests, this.state.projectPath);

  return this.formatStoryWithQuests({
    ...storyResponse,
    quests: this.state.quests
  });
}
</code></pre>
<ul>
<li>Initializes a new adventure, resetting state and assigning themes.</li>
<li>Integrates project details with story generation to create a dynamic narrative foundation.</li>
<li>Ensures quests are merged and aligned with project configurations for contextual relevance.</li>
</ul>
<hr>
<pre><code class="language-typescript">get progressPercentage(): number {
  return this.quests.length &gt; 0 
    ? Math.round((this.completedQuests.size / this.quests.length) * 100)
    : 0;
}
</code></pre>
<ul>
<li>Dynamically tracks quest completion, exposing the percentage of progress.</li>
<li>Facilitates clear progress reporting for users during their adventure exploration.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Ensures configuration files are parsed reliably into usable JSON objects.</li>
<li>Handles errors gracefully, avoiding adventure disruptions from malformed configurations.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      unique.add(node.path.trim());
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    stack.push(...children.filter(child =&gt; child &amp;&amp; typeof child === &#39;object&#39;));
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Gathers all file paths specified in configuration, verifying their existence in the project.</li>
<li>Supports tailored quest generation by restricting focus to defined files.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/adventure/story-generator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/adventure/story-generator.ts</code></a></h3>
<pre><code class="language-typescript">async generateStoryAndQuests(
  projectInfo: ProjectInfo, 
  theme: AdventureTheme, 
  projectPath?: string
): Promise&lt;StoryResponse&gt; {
  this.currentProject = projectInfo;
  this.projectPath = projectPath;

  const prompt = loadStoryGenerationPrompt({
    theme,
    repomixContent: projectInfo.repomixContent || &#39;&#39;,
    ...(this.projectPath &amp;&amp; formatAdventureConfigForPrompt(this.projectPath))
  });

  const response = await this.llmClient.generateResponse(prompt);
  return parseMarkdownToStoryResponse(response.content.trim());
}
</code></pre>
<ul>
<li>Constructs a prompt using project context and theme, invoking the LLM to generate the story and quests.</li>
<li>Extracts and organizes quest data through markdown parsing, creating a clear structure for the adventure.</li>
</ul>
<hr>
<pre><code class="language-typescript">async generateQuestContent(
  quest: Quest, 
  theme: AdventureTheme, 
  codeContent: string
): Promise&lt;QuestContent&gt; {
  const prompt = loadQuestContentPrompt({ theme, quest, codeContent });
  const response = await this.llmClient.generateResponse(prompt);

  const cleanContent = this.removeLLMMetaCommentary(response.content.trim());
  return { adventure: cleanContent, codeSnippets: [] };
}
</code></pre>
<ul>
<li>Generates detailed quest descriptions based on associated files and system context.</li>
<li>Employs LLM responses to ensure nuanced narratives that align with user expectations.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Leverage <code class="inline-code">parseAdventureConfig</code> for debugging configuration-related errors.</li>
<li>Investigate <code class="inline-code">generateQuestContent</code> to explore approaches for dynamic content creation in storytelling systems.</li>
<li>Experiment with modifying <code class="inline-code">initializeAdventure</code> to introduce new thematic customizations.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries within the Codekeeper&#39;s repository!</p>
<p>Congratulations, developer! You‚Äôve successfully deployed &quot;Quest 2: The Storyteller&#39;s Forge&quot; to production‚Äî20% of the system‚Äôs architecture is complete; your codebase is scaling like a dream‚Äîkeep refactoring brilliance! üöÄüíª‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-1.html" class="prev-quest-btn">‚Üê Previous: Quest 1</a>
        <a href="quest-3.html" class="next-quest-btn">Next: Quest 3 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>