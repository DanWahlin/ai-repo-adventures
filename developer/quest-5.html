<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: Foundation of the Repository - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository of Forgotten Codes: An Adventure Awaits</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: Foundation of the Repository</h1>
<hr>
<p>The final layers of the Repository of Forgotten Codes await your discovery, adventurer. Here lies the cornerstone of this mysterious system: the <code class="inline-code">adventure-config.ts</code> file. This foundational script contains the essence of quest configurations, utility functions, and the blueprint for seamless interaction between project codebases and developer adventures. By exploring its depths, you will unravel the system‚Äôs inner mechanics and uncover the secrets of a dynamic quest generation engine. With this final understanding, you can restore the Repository‚Äôs full power and guide developers in crafting extraordinary narratives.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configuration Mapping</strong>: How does <code class="inline-code">parseAdventureConfig</code> handle and validate configuration files? What patterns are used for safety and correctness?</li>
<li>‚ö° <strong>Path Extraction Logic</strong>: How does <code class="inline-code">extractUniqueFilePaths</code> traverse configuration objects and validate file paths? What are the mechanisms for ensuring all paths exist?</li>
<li>üõ°Ô∏è <strong>Custom Optimization</strong>: What strategies are employed by <code class="inline-code">formatAdventureConfigForPrompt</code> to reduce configuration size while maintaining readability for language models?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> The framework for managing adventure configurations</h3>
<p>This file provides essential functions to handle adventure configuration files. It reads raw files, parses them into structured data, extracts critical information, and formats output for efficient processing. This is the backbone for validating input data and ensuring the system can leverage configuration files seamlessly.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Safely parses the configuration into an object and validates its structure. This ensures robust handling of malformed or missing configurations.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Analyzes configuration data to identify and validate unique file paths referenced in the adventure structure. It ensures paths exist before inclusion.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Condenses adventure configuration content to reduce output size, improving efficiency in using prompts for language model interactions. Optimized for clarity and length.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">/**
 * Parses the adventure config into an object (or null on error/missing).
 * Single point of JSON parsing and validation.
 */
export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Converts configuration files into structured JavaScript objects.</li>
<li>Uses error handling to ensure resilience against corrupted or missing files.</li>
<li>Validates the structure to ensure downstream functions can reliably use the data.</li>
<li>Demonstrates a single-entry approach to parsing and validation, centralizing logic for maintainability.</li>
<li>Implements safe JSON handling to avoid runtime disruptions during processing.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Identifies and validates unique file paths throughout the parsed adventure configuration object.</li>
<li>Utilizes a depth-first search approach to traverse nested configuration structures.</li>
<li>Ensures that only existing and valid paths are included in the result, enhancing robustness.</li>
<li>Demonstrates the combination of iterative traversal and conditional validation.</li>
<li>Helps maintain data integrity by verifying paths before they propagate within the system.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts
 * OPTIMIZED: Reduced from 7,279 to ~2,000 characters (72% reduction)
 * Eliminates redundant descriptions since LLM can infer from actual code
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths, no verbose descriptions
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    
    // Just function names, no descriptions
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Converts adventure configuration data into a concise, structured format suitable for language model prompts.</li>
<li>Reduces overall size by removing redundant information, focusing only on essential content.</li>
<li>Aggregates data like file paths and function names, making it easily interpretable for downstream users.</li>
<li>Optimizes clarity and minimizes cognitive overhead while preserving critical context.</li>
<li>Enhances system performance by generating an output tailored for efficiency and direct processing.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Carefully trace the flow of data from <code class="inline-code">loadAdventureConfig</code> to <code class="inline-code">formatAdventureConfigForPrompt</code> to understand how each function builds upon the other.</li>
<li>Experiment with a sample <code class="inline-code">adventure.config.json</code> file to see how changes impact the behavior of these utility functions.</li>
<li>Study the depth-first traversal used in <code class="inline-code">extractUniqueFilePaths</code> as a pattern for analyzing nested objects.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the Repository of Forgotten Codes! Your adventure is complete.</p>
<p>üéâ Congratulations, developer‚Äî&quot;Quest 5: Foundation of the Repository&quot; has been successfully committed and merged into your progress branch with 80% completion; keep executing with precision as you&#39;re just one pull request away from deploying the full achievement build! üöÄ‚ö°üíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>