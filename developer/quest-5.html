<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Tools of the Guild - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Mythos of the Codebase Chronicles</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Tools of the Guild</h1>
<hr>
<p>In the vibrant world of the Repository Adventure Engine, the guild of developers wields extraordinary tools to tame the chaos of code and transform raw data into epic narratives. &quot;Quest 5: The Tools of the Guild&quot; invites you to explore the very mechanisms underpinning this magical engine. The <code class="inline-code">adventure-config.ts</code> file is at the heart of this central repository, containing highly versatile tools to manage configuration, parse the unknown, and shape settings into coherent progress. As a dev-venturer, you must uncover the secrets of these tools and learn how they empower the guild.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üõ†Ô∏è <strong>Config Deciphering</strong>: How does the system safely read configuration files, and what measures ensure reliability in the face of missing or corrupted files?</li>
<li>üí° <strong>Path Mapping</strong>: How are unique file paths extracted and validated for use within the adventure engine?</li>
<li>üîç <strong>Prompt Optimization</strong>: How does the system condense adventure configurations into efficient, readable formats for use in dynamic storytelling?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a>: A toolkit for configuration parsing and optimization</h3>
<p>The <code class="inline-code">adventure-config.ts</code> file provides powerful tools used to manage the adventure engine‚Äôs core configurations. This file includes functions for reading configuration files, parsing their content, and extracting meaningful paths and details. Additionally, it introduces formatting mechanisms for generating lightweight configuration summaries, which are crucial for working with large language model (LLM) prompts. Each function in this file is carefully designed to ensure robustness, scalability, and ease of integration with other system components.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">loadAdventureConfig</code>: Reads the raw adventure configuration file as a string, ensuring reliability with error handling for file access issues.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Extracts all unique file paths referenced in the configuration, validating their existence and filtering duplicates.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Formats raw config data into a streamlined structure, optimizing content for prompt-based processing.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/adventure-config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/adventure-config.ts</code></a></h3>
<pre><code class="language-typescript">function readFileIfExists(filePath: string): string | null {
  try {
    return fs.readFileSync(filePath, &#39;utf-8&#39;);
  } catch {
    // Missing or unreadable file is non-fatal
    return null;
  }
}

/**
 * Loads the raw adventure config text if present.
 * Pure file read - no parsing here.
 */
export function loadAdventureConfig(projectPath: string): string | null {
  const configPath = path.join(projectPath, ADVENTURE_CONFIG_FILE);
  return readFileIfExists(configPath);
}
</code></pre>
<ul>
<li>This code provides a safe mechanism to read file content, catching errors such as missing or unreadable files.</li>
<li>The <code class="inline-code">readFileIfExists</code> function encapsulates error handling, promoting code reusability.</li>
<li><code class="inline-code">loadAdventureConfig</code> ensures the project path is combined with the config filename, adhering to modular design principles.</li>
<li>The approach ensures non-critical failures do not interrupt system functionality, enhancing robustness.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Extracts all unique, existing file paths referenced by &quot;path&quot; fields anywhere in the config.
 */
export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    // Extract and validate path
    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    // Add children to stack
    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li><code class="inline-code">extractUniqueFilePaths</code> recursively traverses a parsed configuration object, ensuring all embedded file paths are collected.</li>
<li>Validates file paths‚Äô existence using <code class="inline-code">fs.existsSync</code> to safeguard against invalid references.</li>
<li>Uses a <code class="inline-code">Set</code> to maintain unique paths, efficiently filtering duplicates during traversal.</li>
<li>The stack-based traversal approach allows the function to handle deeply nested configurations without recursion pitfalls.</li>
</ul>
<hr>
<pre><code class="language-typescript">/**
 * Formats adventure config into a minimal format for LLM prompts.
 */
export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    
    // Just file paths - LLM can see descriptions in actual code
    const filePaths = quest.files
      .filter((f: any) =&gt; f.path)
      .map((f: any) =&gt; f.path);
    if (filePaths.length &gt; 0) {
      formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    }
    
    // Just function names - LLM can understand purpose from implementation
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .filter((h: any) =&gt; h.name)
      .map((h: any) =&gt; h.name);
    if (functions.length &gt; 0) {
      formatted += `Functions: ${functions.join(&#39;, &#39;)}\n`;
    }
    
    formatted += `\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>This function creates condensed, human-readable summaries from configuration data for use in LLM prompts.</li>
<li>Groups and organizes information under meaningful headers, such as &quot;Quest Structure&quot; and per-quest details.</li>
<li>Limits unnecessary context, focusing on relevant file paths and function names to reduce complexity.</li>
<li>The design significantly reduces the size of configuration data, improving processing efficiency for downstream tasks.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>üõ°Ô∏è Always handle potential errors when reading external files to maintain system resilience.</li>
<li>üîç Explore nested objects incrementally to manage deeply hierarchical data without overwhelming memory resources.</li>
<li>‚ú® Use formatting techniques to layer information for better human and machine readability.</li>
</ul>
<hr>
<p>Your mastery of these tools will enable you to wield the full power of the guild. The adventure grows richer with each line of code uncovered!</p>
<p>Congratulations on successfully compiling Quest 5: The Tools of the Guild‚Äîyour codebase of skills is now 80% complete and optimized for the final deployment, keep iterating towards the ‚≠ê finale!</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>