<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 5: The Foundation Stones - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codekeeper's Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 5: The Foundation Stones</h1>
<hr>
<p>In the ever-growing labyrinth of code, the Codekeeper has prepared one final challenge for you, brave adventurer. The Foundation Stones represent the fundamental components that uphold this enchanted repository. By dissecting and mastering these base elements, you will gain the ultimate understanding required to command the magical repository and uncover its final mysteries. Will you succeed in unraveling the secrets preserved in these vital code artifacts?</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üìú <strong>Config Chronicle</strong>: How does <code class="inline-code">parseAdventureConfig</code> handle raw configuration data, and what techniques ensure reliability in JSON parsing?</li>
<li>üîó <strong>Pathfinder&#39;s Insight</strong>: What is the process behind <code class="inline-code">extractUniqueFilePaths</code> for identifying and validating file paths in the adventure config?</li>
<li>‚ú® <strong>Prompt Shaper</strong>: What mechanisms are employed by <code class="inline-code">formatAdventureConfigForPrompt</code> to condense configuration details for minimalistic output and optimized storytelling?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/adventure-config.ts:</span> Core configuration and parsing utilities</h3>
<p>This file contains the foundational utilities for loading, parsing, and handling configuration files that drive the enchanted repository. These utilities deal with raw file system operations, JSON validation, and data extraction, which form the backbone of the magical quest system. By exploring its mechanisms, you will observe robust handling of JSON data, recursive data traversal, and strategies for optimizing content for downstream usage.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">parseAdventureConfig</code>: Parses the raw configuration into a structured object, handles invalid or missing data gracefully, and centralizes JSON validation logic.</li>
<li><code class="inline-code">extractUniqueFilePaths</code>: Traverses the adventure config to extract validated file paths, using a combination of recursive exploration and file system checks.</li>
<li><code class="inline-code">formatAdventureConfigForPrompt</code>: Optimizes the adventure configuration for compact display, reducing size while retaining useful information for generated prompts.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/adventure-config.ts</h3>
<pre><code class="language-typescript">export function parseAdventureConfig(projectPath: string): unknown | null {
  const raw = loadAdventureConfig(projectPath);
  if (!raw) return null;
  try {
    return JSON.parse(raw);
  } catch {
    return null;
  }
}
</code></pre>
<ul>
<li>Parses raw JSON data using <code class="inline-code">JSON.parse</code>, with a fallback mechanism for invalid or missing files.</li>
<li>Centralizes parsing logic to unify error-handling and data validation in one place.</li>
<li>Ensures that the system remains resilient during configuration loading by returning <code class="inline-code">null</code> for errors.</li>
<li>Plays a pivotal role in maintaining clean and validated data pipelines for other functions.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function extractUniqueFilePaths(projectPath: string): string[] {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) return [];

  const unique = new Set&lt;string&gt;();
  const stack: any[] = [parsed];

  while (stack.length) {
    const node = stack.pop();
    if (!node || typeof node !== &#39;object&#39;) continue;

    if (typeof node.path === &#39;string&#39; &amp;&amp; node.path.trim()) {
      const rel = node.path.trim();
      if (fs.existsSync(path.resolve(projectPath, rel))) {
        unique.add(rel);
      }
    }

    const children = Array.isArray(node) ? node : Object.values(node);
    children.forEach(child =&gt; {
      if (child &amp;&amp; typeof child === &#39;object&#39;) stack.push(child);
    });
  }

  return Array.from(unique);
}
</code></pre>
<ul>
<li>Implements recursive traversal to explore all <code class="inline-code">path</code> fields in the config.</li>
<li>Validates file paths using <code class="inline-code">fs.existsSync</code> to ensure only real, existing files are included.</li>
<li>Uses a <code class="inline-code">Set</code> to store unique paths, demonstrating efficient deduplication techniques.</li>
<li>Addresses error resilience through type checking and fallback mechanisms during traversal.</li>
<li>Connects directly to project structure by working with relative and resolved paths.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function formatAdventureConfigForPrompt(projectPath: string): string {
  const parsed = parseAdventureConfig(projectPath);
  if (!parsed || typeof parsed !== &#39;object&#39;) {
    return &#39;&#39;;
  }

  const adventure = (parsed as any).adventure;
  if (!adventure || !Array.isArray(adventure.quests)) {
    return &#39;&#39;;
  }

  let formatted = `## Quest Structure\n`;

  for (const quest of adventure.quests) {
    if (!quest.title || !Array.isArray(quest.files)) continue;

    formatted += `### ${quest.title}\n`;
    const filePaths = quest.files.map((f: any) =&gt; f.path).filter(Boolean);
    formatted += `Files: ${filePaths.join(&#39;, &#39;)}\n`;
    const functions = quest.files
      .flatMap((f: any) =&gt; f.highlights || [])
      .map((h: any) =&gt; h.name)
      .filter(Boolean);
    formatted += `Functions: ${functions.join(&#39;, &#39;)}\n\n`;
  }

  return formatted;
}
</code></pre>
<ul>
<li>Reduces verbose configuration data to a concise output tailored for LLM prompts.</li>
<li>Extracts and formats only titles, file paths, and function names from quests, eliminating extraneous details.</li>
<li>Optimizes for readability by structuring key details in a markdown-like hierarchy.</li>
<li>Demonstrates effective String manipulation techniques for generating formatted content.</li>
<li>Aims for computational efficiency by limiting the processing overhead of unused data fields.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Pay close attention to how recursive traversal works in <code class="inline-code">extractUniqueFilePaths</code>; such patterns are useful for navigating tree-like structures.</li>
<li>Observe how error handling is seamlessly incorporated into all functions to maintain system robustness.</li>
<li>Take inspiration from the minimalistic strategy in <code class="inline-code">formatAdventureConfigForPrompt</code> for distilling complex data into simplified forms.</li>
</ul>
<hr>
<p>You have mastered all the secrets of the enchanted repository! Your adventure is complete.</p>
<p>Congratulations on successfully implementing Quest 5: The Foundation Stones‚Äîyour skill stack is now 80% optimized for launch; keep refactoring greatness and prepare to deploy the final milestone! üöÄ‚≠êüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="prev-quest-btn">‚Üê Previous: Quest 4</a>
        <a href="index.html" class="next-quest-btn complete-btn">Complete Adventure ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>