<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Library of Themes - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codekeeper's Chronicles</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Library of Themes</h1>
<hr>
<p>In the land of infinite repos, the Codekeeper unveils the fabled Library of Themes, a collection of enchanted templates that guide the creation of codebound adventures. Here, developers can imbue their projects with thematic essence, transforming snippets and methods into grand escapades. This quest challenges you to decipher the magic that powers dynamic themes and validate your choices as you prepare for the ultimate narrative journey. Arm yourself with knowledge, brave coder, for the Library beckons.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Theme Mapper</strong>: How does the system map user inputs (like IDs or keywords) to an appropriate theme, and what techniques ensure accuracy?</li>
<li>‚ö° <strong>Validation Rituals</strong>: How does input validation safeguard against incorrect or dangerous data in theme selection and project paths?</li>
<li>üõ°Ô∏è <strong>Fail-Safe Mechanics</strong>: What fallback mechanisms exist to handle errors, such as unavailable themes or configuration mismatches?</li>
</ul>
<h2>File Exploration</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/config.ts</code></a>: Magical configurations for code and theme management</h3>
<p>Configurations in this file control resource limits, timeouts, and provide key constants for the adventure system. These settings ensure that every adventure adheres to defined boundaries, improving reliability and performance.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Specifies the maximum duration for AI-driven story generation, balancing detail with responsiveness.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Caps the size of files analyzed to prevent memory overloads during processing.</li>
<li><code class="inline-code">THEMES</code>: Declares the foundational themes available, mapping them to metadata used across the codebase.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/config.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/config.ts</code></a></h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  MYTHICAL: { /* Omitted for brevity */ },
  ANCIENT: { /* Omitted for brevity */ },
  DEVELOPER: { /* Omitted for brevity */ },
  CUSTOM: { /* Omitted for brevity */ }
} as const;
</code></pre>
<ul>
<li>The <code class="inline-code">LLM_REQUEST_TIMEOUT</code> prevents excessively long waits during story generation by imposing a 60-second limit.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code> ensures that large files, which could hinder performance, are skipped during analysis, focusing only on manageable code.</li>
<li><code class="inline-code">THEMES</code> provides a structured overview of available themes, allowing clear metadata like IDs, keys, and emojis to support theming workflows.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a>: Ensuring valid and safe inputs</h3>
<p>This file implements critical validations for user inputs, covering theme choice, project paths, and formatting. These functions ensure that the system operates on clean data, mitigating runtime issues.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateTheme</code>: Validates the theme input, ensuring it matches recognized themes or throws descriptive errors.</li>
<li><code class="inline-code">validateAdventureChoice</code>: Limits the length and character quality of user-provided adventure choices to maintain integrity.</li>
<li><code class="inline-code">validateProjectPath</code>: Checks the project path&#39;s validity, applying basic sanitization and fallback to the current working directory.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/input-validator.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/input-validator.ts</code></a></h3>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }
  
  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);
  
  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }
  
  return parsedTheme;
}
</code></pre>
<ul>
<li><code class="inline-code">validateTheme</code> checks the theme input against normalized known themes, prompting meaningful error messages for invalid cases.</li>
<li>Use of <code class="inline-code">getAllThemes</code> ensures the available themes are dynamic and consistent throughout the codebase.</li>
<li>Parsing and keyword checks enable flexible user inputs, accommodating IDs, names, or general descriptors.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Validates the adventure choice to ensure it is non-empty and within a 200-character limit, preventing excess data or injection risks.</li>
<li>Trimming the input reduces the chance of errors from extraneous whitespace.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  
  if (input.length &gt; 500) {
    throw new Error(&#39;Project path too long (max 500 characters)&#39;);
  }
  
  if (input.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid characters&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li><code class="inline-code">validateProjectPath</code> safeguards against null-byte injection and excessive path lengths, intercepting invalid or malicious paths.</li>
<li>Defaults to the current working directory (<code class="inline-code">process.cwd</code>) if no input is provided, ensuring graceful fallback behavior.</li>
</ul>
<hr>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a>: Thematic essence and accessor functions</h3>
<p>This file defines the core data structure for themes, binding them to IDs and metadata. It also provides utility functions for retrieving, formatting, and validating theme choices.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">getThemeByKey</code>: Retrieves a theme by its key, ensuring accurate lookups for user-selected themes.</li>
<li><code class="inline-code">isValidTheme</code>: Checks if a string is a valid theme key, enforcing strict typing and consistency.</li>
<li><code class="inline-code">parseTheme</code>: Employs keyword matching and ID extraction to interpret user inputs flexibly.</li>
</ul>
<h2>Code</h2>
<h3><a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/core/src/shared/theme.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/core/src/shared/theme.ts</code></a></h3>
<pre><code class="language-typescript">export function getThemeByKey(key: string): ThemeDefinition | null {
  return THEMES_ARRAY.find(theme =&gt; theme.key === key) || null;
}
</code></pre>
<ul>
<li><code class="inline-code">getThemeByKey</code> employs a simple array find method to retrieve themes, balancing readability and efficiency.</li>
<li>The <code class="inline-code">null</code> fallback ensures no assumptions about invalid keys, supporting robust error handling downstream.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function isValidTheme(theme: string): theme is AdventureTheme {
  return THEMES_ARRAY.some(t =&gt; t.key === theme);
}
</code></pre>
<ul>
<li>Uses <code class="inline-code">THEMES_ARRAY</code>&#39;s <code class="inline-code">some</code> method to validate theme keys while employing TypeScript&#39;s type guards, improving code safety.</li>
<li>Simplifies conditional statements elsewhere, as the function guarantees a boolean response.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;
  
  const normalized = input.trim().toLowerCase();
  
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;
  
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }
  
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }
  
  return null;
}
</code></pre>
<ul>
<li>Implements a flexible approach by checking exact matches, ID conversions, and keyword associations for user inputs.</li>
<li>Handles edge cases for invalid or empty strings, making it robust in dynamic environments.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Compare and test themes by their <code class="inline-code">key</code> instead of <code class="inline-code">id</code> for consistent results.</li>
<li>When validating user choices, consider combining <code class="inline-code">sanitizeForDisplay</code> to further clean inputs for display purposes.</li>
<li>If adding new themes, ensure their <code class="inline-code">keyword</code> list is both comprehensive and intuitive to users.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations on successfully compiling Quest 4: The Library of Themes‚Äîyour codebase of skills is now 60% architected toward mastery; keep refactoring brilliance and deploying greatness! üöÄüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>