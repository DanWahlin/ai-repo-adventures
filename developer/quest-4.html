<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 4: The Configuration Scrolls - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">Repository of Forgotten Codes: An Adventure Awaits</a>
            </div>
            <div class="nav-middle">
            </div>
            <div class="nav-right">
                <a href="../index.html" class="nav-link">Change Theme</a>
                <a href="#" class="nav-link quest-map-trigger">Quests</a>
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/shared/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 4: The Configuration Scrolls</h1>
<hr>
<p>Amid the Repository of Forgotten Codes lies a collection of enigmatic Configuration Scrolls, safeguarding the rules and parameters that govern the mysterious system. These scrolls whisper tales of adaptive adventures and thematic transformations, imbued with the essence of developer ingenuity. Your task is to unravel their structure, understand their boundaries, and ensure the power of themes and configurations are preserved‚Äîheartbeats of the adventure system.</p>
<h2>Quest Objectives</h2>
<p>As you explore the code below, investigate these key questions:</p>
<ul>
<li>üîç <strong>Configuration Calibration</strong>: How do the <code class="inline-code">LLM</code> settings control performance and boundaries in adaptive content generation?</li>
<li>‚ö° <strong>Theme Invocation</strong>: How are themes structured, validated, and formatted for impactful user choice?</li>
<li>üõ°Ô∏è <strong>Validation Sentinel</strong>: How does the system ensure safe input for themes, paths, and adventure outcomes?</li>
</ul>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/shared/config.ts:</span> Central Configuration Constants</h3>
<p>This file defines the constants and environment-driven parameters that shape the functionality and limitations of critical systems like the <code class="inline-code">LLM</code>, file analysis, and process management. The settings here balance dynamic operation capabilities and ensure predictable execution within resource constraints.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">LLM_REQUEST_TIMEOUT</code>: Defines the maximum timeout for <code class="inline-code">LLM</code> requests, ensuring responsiveness during long operations.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code>: Sets the cache expiration time for content, controlling reuse and freshness of query results.</li>
<li><code class="inline-code">MAX_FILE_SIZE_MB</code>: Restricts file size for analysis to prevent memory exhaustion while prioritizing highly relevant data.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/config.ts</h3>
<pre><code class="language-typescript">export const LLM_REQUEST_TIMEOUT = 60000; // 60 seconds for complex story generation with large prompts
export const REPOMIX_CACHE_TTL = parseInt(process.env.REPOMIX_CACHE_TTL || &#39;60000&#39;); // 60 seconds, configurable via env
export const MAX_FILE_SIZE_MB = 10; // Skip files larger than this to avoid memory issues and focus on source code
</code></pre>
<ul>
<li>The <code class="inline-code">LLM_REQUEST_TIMEOUT</code> parameter ensures timely system responses when handling complex content generation tasks.</li>
<li><code class="inline-code">REPOMIX_CACHE_TTL</code> enables environment-driven adjustments to caching, reducing redundant operations while allowing flexibility.</li>
<li>The <code class="inline-code">MAX_FILE_SIZE_MB</code> safeguard avoids resource overload by excluding overly large files during system analysis.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/input-validator.ts:</span> Input Validation Framework</h3>
<p>This file houses functions that enforce input sanity and guard critical pathways from malformed or unsafe data. It ensures the integrity of themes, paths, and user choices through structured validation.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">validateAdventureChoice</code>: Sanitizes and ensures constraints on user-provided adventure selections.</li>
<li><code class="inline-code">validateTheme</code>: Checks theme validity against defined structures, applying normalization and informative error feedback.</li>
<li><code class="inline-code">validateProjectPath</code>: Validates supplied project paths for security and length conformity.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/input-validator.ts</h3>
<pre><code class="language-typescript">export function validateAdventureChoice(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Choice is required&#39;);
  }
  
  if (input.length &gt; 200) {
    throw new Error(&#39;Choice too long (max 200 characters)&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>This function ensures that adventure choices are not empty and conform to length standards, preventing misuse and accidental crashes.</li>
<li>Utilizes trimming for sanitization, ensuring clean inputs free of leading/trailing white spaces.</li>
<li>Error handling provides immediate feedback, assisting users with actionable messaging.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateTheme(input: string): string {
  if (!input?.trim()) {
    throw new Error(&#39;Theme is required&#39;);
  }

  const normalized = input.toLowerCase().trim();
  const parsedTheme = parseTheme(normalized);

  if (!parsedTheme || !isValidTheme(parsedTheme)) {
    const validThemes = getAllThemes().map(t =&gt; t.key).join(&#39;, &#39;);
    throw new Error(`Invalid theme. Valid themes: ${validThemes}`);
  }

  return parsedTheme;
}
</code></pre>
<ul>
<li><code class="inline-code">validateTheme</code> enforces user-provided theme alignment with predefined options, building on <code class="inline-code">parseTheme</code> and <code class="inline-code">isValidTheme</code>.</li>
<li>Provides comprehensive validation with normalized inputs and a fallback mechanism for clear error explanation.</li>
<li>Integrates with <code class="inline-code">theme.ts</code> functions to dynamically reference all available theme keys.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function validateProjectPath(input?: string): string {
  if (!input?.trim()) {
    return process.cwd();
  }
  
  if (input.length &gt; 500) {
    throw new Error(&#39;Project path too long (max 500 characters)&#39;);
  }
  
  if (input.includes(&#39;\0&#39;)) {
    throw new Error(&#39;Project path contains invalid characters&#39;);
  }
  
  return input.trim();
}
</code></pre>
<ul>
<li>Determines an appropriate project directory path, defaulting to <code class="inline-code">process.cwd()</code> when no input is provided.</li>
<li>Ensures proper path sanitization to prevent injection of harmful characters or unsafe operations.</li>
<li>Limits path length for consistency and to guard against overflows or unexpected behavior.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/shared/theme.ts:</span> Theme Management System</h3>
<p>This file acts as the single source of truth for the adventure system&#39;s themes. It defines their structure, data, and utility functions, enabling the dynamic support of various developer personas and narratives.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">THEMES</code>: Outline of the predefined theme definitions, enabling immersive experiences tailored to user intent.</li>
<li><code class="inline-code">getAllThemes</code>: Retrieves all available themes, ensuring modularity and data-driven adaptability.</li>
<li><code class="inline-code">parseTheme</code>: Simplifies normalization and keyword-based matching for user-friendly theme selection.</li>
</ul>
<h2>Code</h2>
<h3>packages/core/src/shared/theme.ts</h3>
<pre><code class="language-typescript">export const THEMES = {
  SPACE: {
    id: 1,
    key: &#39;space&#39;,
    displayName: &#39;Space Exploration&#39;,
    emoji: &#39;üöÄ&#39;,
    description: &#39;Journey through cosmic codebases where data flows like stardust and APIs connect distant galaxies&#39;,
    keywords: [&#39;space&#39;, &#39;cosmic&#39;, &#39;galaxy&#39;, &#39;starship&#39;, &#39;astronaut&#39;, &#39;sci-fi&#39;, &#39;futuristic&#39;]
  },
  // Remaining themes omitted for brevity...
} as const;
</code></pre>
<ul>
<li>The <code class="inline-code">THEMES</code> object encapsulates consistent data structures for all predefined themes, ensuring standardization.</li>
<li>Keywords provide robust, user-friendly search capabilities to match input with available themes.</li>
<li>Each theme communicates its purpose and vibe through <code class="inline-code">id</code>, <code class="inline-code">key</code>, <code class="inline-code">description</code>, and <code class="inline-code">emoji</code>.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function getAllThemes(): ThemeDefinition[] {
  return Object.values(THEMES);
}
</code></pre>
<ul>
<li>A straightforward function to expose all theme definitions for use across the system.</li>
<li>Keeps the data centralized, avoiding duplication or discrepancies between components.</li>
<li>Facilitates the dynamic listing of themes for user interaction points.</li>
</ul>
<hr>
<pre><code class="language-typescript">export function parseTheme(input: string): AdventureTheme | null {
  if (!input) return null;

  const normalized = input.trim().toLowerCase();

  // Check for exact key match
  const exactMatch = getThemeByKey(normalized);
  if (exactMatch) return exactMatch.key as AdventureTheme;

  // Check for numeric ID
  const numericId = parseInt(normalized, 10);
  if (!isNaN(numericId)) {
    const byId = getThemeById(numericId);
    if (byId) return byId.key as AdventureTheme;
  }

  // Check keywords using simple includes check
  for (const theme of THEMES_ARRAY) {
    if (theme.keywords.some(keyword =&gt; normalized.includes(keyword.toLowerCase()))) {
      return theme.key as AdventureTheme;
    }
  }

  return null;
}
</code></pre>
<ul>
<li>Matches user inputs to valid themes using a blend of exact key match, numeric ID resolution, and keyword checks.</li>
<li>Normalization enhances usability, reducing the risk of rejection from formatting inconsistencies.</li>
<li>A fallback mechanism ensures robust, friendly handling of edge cases.</li>
</ul>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>Pay attention to how configurations prioritize system stability while allowing flexibility with environment variables.</li>
<li>Follow the modularity in the theme system to understand how data is centralized for maintainability.</li>
<li>Observe the validation logic to inform your own safe implementations for user-provided inputs.</li>
</ul>
<hr>
<p>Excellent work! Continue to the next quest to uncover more mysteries.</p>
<p>Congratulations, Developer! You&#39;ve successfully debugged and deployed Quest 4: The Configuration Scrolls, achieving a new milestone in the software lifecycle‚Äîkeep your IDEs glowing, as you&#39;re now 60% closer to the final push toward mastering this epic codebase! üöÄüíé‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-3.html" class="prev-quest-btn">‚Üê Previous: Quest 3</a>
        <a href="quest-5.html" class="next-quest-btn">Next: Quest 5 ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script (for navbar Quests button functionality) -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>