<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The Chamber of Eternal Tasks - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <link rel="stylesheet" href="assets/quest-navigator.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader for syntax highlighting
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Trigger Prism highlighting after page load
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Prism) {
                window.Prism.highlightAll();
            }
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-left">
                <a href="index.html">The Codex of Ancient Wisdom</a>
            </div>
            <div class="nav-right">
                <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="github-link">
                    <img src="assets/images/github-mark-white.svg" alt="GitHub" width="24" height="24">
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The Chamber of Eternal Tasks</h1>
<hr>
<p>Deep within the entangled heart of the jungle lies the ominous Chamber of Eternal Tasks, a labyrinth of sacred engineering hubs devoted to the ancient Codex of Ancient Wisdom. Legends whisper that each chamber tests the chosen archaeotechnologist&#39;s power to reconstruct pieces of an advanced civilization. Your journey begins with deciphering the Codex‚Äôs sacred glyphs, translating their knowledge into today‚Äôs realm of understanding. Every execution of an ancient-ridden algorithm carries the echo of rituals long past. The jungle waits, as do the chambers‚Äîready to rise and fall with the fate of wisdom itself.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP server setup and tool execution mechanism</h3>
<p>The <a href="https://github.com/danwahlin/ai-repo-adventures/blob/main/packages/mcp/src/server.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">packages/mcp/src/server.ts</code></a> file encapsulates core logic for creating a gamified MCP server that drives interaction with repository codebases. At its heart is the <code class="inline-code">RepoAdventureServer</code> class, which establishes handlers for listing and invoking tools, ensuring arguments are properly validated using Zod schemas. The file includes lifecycle management for the server&#39;s execution and pre-generates analysis contexts to warm up for rapid exploration. Its structure mirrors ancient trial mechanisms, dynamically offering tools akin to sacred devices crafted to meet specific challenges.</p>
<p>Key functions ensure stability, validation, and execution amidst unexpected errors. The MCP server‚Äôs ability to execute tools dynamically and handle promises reflects old traditions where each glyph needed meticulous accuracy. By blending tool management and adaptive flow, the script embodies the essence of decoding complex wisdom.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code>: Configures handlers for tool listing and execution.</li>
<li><code class="inline-code">RepoAdventureServer.run</code>: Starts server and prepares repomix content.</li>
<li><code class="inline-code">main</code>: Bootstrap logic for server initialization, shutdown, and error handling.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
  this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
    const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
      name,
      description: tool.description,
      inputSchema: zodToJsonSchema(tool.schema, { 
        target: &#39;jsonSchema7&#39;,
        $refStrategy: &#39;none&#39;
      })
    }));
    return { tools: toolList };
  });

  this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
    try {
      const { name, arguments: args } = request.params;

      if (!(name in tools)) {
        throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
      }

      const tool = tools[name as keyof typeof tools];
      const validationResult = tool.schema.safeParse(args);

      if (!validationResult.success) {
        const errorMessages = validationResult.error.issues.map((err) =&gt; 
          `${err.path.join(&#39;.&#39;)}: ${err.message}`
        ).join(&#39;, &#39;);
        throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
      }

      return await tool.handler(validationResult.data as any);

    } catch (error) {
      if (error instanceof McpError) {
        throw error;
      }
      throw new McpError(
        ErrorCode.InternalError,
        `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
      );
    }
  });
}
</code></pre>
<p>[Like deciphering ancient glyphs for rituals, validation ensures only correctly formed knowledge is executed.]</p>
<pre><code class="language-typescript">async run() {
  const transport = new StdioServerTransport();
  await this.server.connect(transport);
  console.error(&#39;Repo Adventure MCP server running on stdio&#39;);
  
  const projectPath = process.cwd();
  console.error(`Pre-generating repomix content for project at ${projectPath}...`);
  repoAnalyzer.preGenerate(projectPath);
}
</code></pre>
<p>[Preparing the Codex chambers early mimics initiatory rites where sanctuaries are readied for wisdom seekers.]</p>
<pre><code class="language-typescript">function main() {
  try {
    const server = new RepoAdventureServer();
    [&#39;SIGINT&#39;, &#39;SIGTERM&#39;].forEach(sig =&gt; 
      process.on(sig as NodeJS.Signals, gracefulShutdown)
    );
    process.on(&#39;unhandledRejection&#39;, (reason) =&gt; {
      console.error(&#39;Unhandled promise rejection:&#39;, reason);
      console.error(&#39;MCP server continuing to run. Please report this error.&#39;);
    });
    await server.run();
  } catch (error) {
    console.error(&#39;Fatal error starting MCP server:&#39;, error);
    process.exit(1);
  }
}
</code></pre>
<p>[Adaptive startup and shutdown ceremonies ensure stability akin to safeguarding ancient temples.]</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use <code class="inline-code">setupHandlers</code> to scan tools and link their schemas dynamically.</li>
<li>Ensure your tool‚Äôs Zod schema matches its expected argument structure.</li>
<li>Triage unhandled promise rejections to deepen code ritual reliability.</li>
</ul>
<hr>
<p>The jungle trembles as chambers echo fragments of sacred wisdom. Push forward, brave adventurer!</p>
<p>Hail, seeker of wisdom, for thou hast triumphed in the sacred Chamber of Eternal Tasks, casting the first gleam of light upon the path to ultimate enlightenment‚Äîforge onward, for the Ancients watch with favor! ‚ö°üíé üó∫Ô∏è</p>

</div>


    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <span>Created using <a href="https://github.com/DanWahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">AI Repo Adventures</a></span>
        </div>
    </footer>
    
    <!-- Quest Navigator Script -->
    <script src="assets/quest-navigator.js"></script>
</body>
</html>