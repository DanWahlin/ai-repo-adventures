<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3: Cosmic Cartography: Code Analysis Engine - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Mission Analysis: Cosmic Chronicles of Code</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 3: Cosmic Cartography: Code Analysis Engine</h1>
<hr>
<p>The <em>Starship Codexus</em> approaches a stellar array of repository constellations, brimming with encoded cosmic pathways. The crew&#39;s primary task is to use the <strong>Code Analysis Engine</strong> to chart unknown data nebulae, extracting key pathways from binary star systems of code. As the <em>Starship Codexus</em> glides closer to its target, the team engages the <strong>repomix extraction protocols</strong>, readying the analyzer to pierce through layers of obfuscation. Will the decoder algorithms illuminate the intricacies of the repository&#39;s celestial structure, or will the mission drift into digital entropy? Let‚Äôs prepare to navigate the unknown!</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/core/src/analyzer/repo-analyzer.ts:</span> Repomix Integration Core</h3>
<p>This file is the heart of the <strong>Code Analysis Engine</strong>, responsible for connecting the <em>Starship Codexus</em> to the <em>repomix</em> subsystem. It ensures safe, efficient, and targeted exploration of the repository galaxy. The <code class="inline-code">RepoAnalyzer</code> class provides all the tools necessary to manage security, validate input, generate binary data constellations, and maintain performance while analyzing potentially massive datasets. Core features like <code class="inline-code">generateRepomixContext()</code> and <code class="inline-code">generateTargetedContent()</code> safely configure and execute <em>repomix</em> operations, transforming raw galactic data streams into usable context for further quests. To prevent overheating the ship&#39;s analyzers, it includes essential safeguards like path validation, deduplication, and caching. The <code class="inline-code">captureRepomixStdout()</code> method acts as the bridge between the Codexus and the <em>repomix engine</em>, capturing valuable insights while preventing the system from veering out of control.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateRepomixContext()</code> draws a complete cosmic map of the repository, including compression for efficient storage.</li>
<li><code class="inline-code">validateAndNormalizeTargetFiles()</code> protects the starship&#39;s systems with layered validation against invalid or malicious file paths.</li>
<li><code class="inline-code">captureRepomixStdout()</code> ensures smooth communication with the <em>repomix</em> engine, even under extreme computational pressures.</li>
</ul>
<hr>
<h3><span class="header-prefix">packages/core/src/llm/llm-client.ts:</span> Multi-Provider LLM Interface</h3>
<p>This file is the <em>Starship Codexus</em>‚Äôs direct uplink to powerful intergalactic knowledge systems such as OpenAI and Azure OpenAI. The <code class="inline-code">LLMClient</code> unites multiple providers into one cohesive system, ensuring seamless communication regardless of the endpoint. The spacecraft relies on <code class="inline-code">generateResponse()</code> to consult its LLM navigator via a structured query-response loop, gaining insights that enhance mission performance. Provider-specific nuances‚Äîlike <em>Azure OpenAI</em>&#39;s endpoint peculiarities and token usage constraints‚Äîare expertly handled by utility methods such as <code class="inline-code">getApiKey()</code> and <code class="inline-code">isAzureOpenAI()</code>. Dynamic features like GPT-5 parameters (e.g., <code class="inline-code">verbosity</code> and <code class="inline-code">reasoningEffort</code>) add another layer of customization to this highly configurable uplink. Together, these functions and classes prepare the crew to harness LLM intelligence for new frontiers of exploration.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">generateResponse()</code> processes LLM requests with robust validation and response cleanup mechanisms.</li>
<li><code class="inline-code">logTokenUsage()</code> provides a critical fuel gauge by monitoring token counts across prompts and completions.</li>
<li><code class="inline-code">cleanJsonResponse()</code> ensures that navigation data arrives in structured and readable formats.</li>
</ul>
<hr>
<h2>Code</h2>
<h3>packages/core/src/analyzer/repo-analyzer.ts</h3>
<pre><code class="language-typescript">private validateAndNormalizeTargetFiles(projectPath: string, targetFiles: string[]): string[] {
    const MAX_TARGET_FILES = 50; // Reasonable limit to prevent resource exhaustion
    const projectRoot = path.resolve(projectPath);
    
    const safeFiles = [...new Set(targetFiles)]
      .slice(0, MAX_TARGET_FILES)
      .map(file =&gt; {
        if (typeof file !== &#39;string&#39; || !file.trim()) {
          return null;
        }

        const trimmed = file.trim();
        if (trimmed.includes(&#39;\0&#39;) || trimmed.includes(&#39;..&#39;)) {
          console.warn(`Rejecting potentially unsafe file path: ${trimmed}`);
          return null;
        }

        return trimmed;
      })
      .filter((file): file is string =&gt; file !== null)
      .map(file =&gt; {
        const fullPath = path.resolve(projectPath, file);
        if (!fullPath.startsWith(projectRoot + path.sep) &amp;&amp; fullPath !== projectRoot) {
          console.warn(`Rejecting file outside project directory: ${file}`);
          return null;
        }
        if (!fs.existsSync(fullPath)) {
          console.warn(`Skipping non-existent file: \`${file}\``);
          return null;
        }
        return path.relative(projectPath, fullPath);
      })
      .filter((file): file is string =&gt; file !== null)
      .sort();
    
    return safeFiles;
}
</code></pre>
<p>This function acts like the <em>Codexus crew</em> validating the coordinates of stellar objects before plotting a course‚Äîdiscarding unsafe routes to shield the ship from danger.</p>
<hr>
<h3>packages/core/src/llm/llm-client.ts</h3>
<pre><code class="language-typescript">private async executeRequest(requestParams: OpenAIRequestParams) {
    return Promise.race([
      this.client.chat.completions.create(requestParams as any),
      new Promise&lt;never&gt;((_, reject) =&gt;
        setTimeout(() =&gt; reject(new Error(`LLM request timeout after ${LLM_REQUEST_TIMEOUT}ms`)), LLM_REQUEST_TIMEOUT)
      )
    ]);
}
</code></pre>
<p>This function is akin to navigating an interstellar relay, ensuring communication signals don‚Äôt exceed the ship‚Äôs transmission window.</p>
<hr>
<h2>Helpful Hints</h2>
<ul>
<li>When exploring large repositories, use <code class="inline-code">generateTargetedContent()</code> to avoid overwhelming the system.</li>
<li>For LLM output, try adjusting <code class="inline-code">verbosity</code> to fine-tune the level of detail in final reports.</li>
<li>Next, investigate how the <code class="inline-code">AdventureManager</code> links these tools to broader quest orchestration.</li>
</ul>
<hr>
<p>Stellar navigation unlocked, Cadet‚Äîyour mastery of the Code Analysis Engine has charted a brilliant course through the stars, propelling you 50% closer to mission completion! ‚≠êüöÄüíé</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-4.html" class="next-quest-btn">Next: Quest 4: Sustaining the Core: Configurat... ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>