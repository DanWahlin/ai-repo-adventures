<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 1: The MCP Command Deck - Repo Adventure</title>
    <link rel="stylesheet" href="assets/theme.css">
    <!-- Prism.js for syntax highlighting -->
    <!-- Using minimal theme since we override all styles with our custom theme -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Configure Prism autoloader
        if (window.Prism && window.Prism.plugins && window.Prism.plugins.autoloader) {
            window.Prism.plugins.autoloader.languages_path = 'https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/';
        }
        
        // Set theme-aware CSS variables for animations
        document.addEventListener('DOMContentLoaded', function() {
            // Manually trigger Prism highlighting after page load
            if (window.Prism) {
                window.Prism.highlightAll();
            }
            // Detect theme from current CSS variables or default to space
            const root = document.documentElement;
            
            // Simple theme detection based on page content or default to space
            const theme = 'space' || 'space';
            
            // Set display variables for animated elements
            root.style.setProperty('--space-display', theme === 'space' ? 'block' : 'none');
            root.style.setProperty('--ancient-display', theme === 'ancient' ? 'block' : 'none');
            root.style.setProperty('--mythical-display', theme === 'mythical' ? 'block' : 'none');
        });
    </script>
</head>
<body>

    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">Starship Horizons: Charting the Code Galaxy</a>
        </div>
    </nav>
    
    <div class="container">
        <div class="quest-content">
    <h1>Quest 1: The MCP Command Deck</h1>
<hr>
<p>The starship <em>Horizons</em> buzzed with activity as the crew headed toward their next challenge‚Äîrestoring the MCP Command Deck to regain full navigational control. A mysterious signal from an unstable repository had scrambled critical exploration tools. Captain Elara ordered the crew to decode the binary anomaly, invoking the MCP&#39;s core systems. Engineers scrambled to synchronize the onboard LLMs, while Commander Rilo prepared the ship&#39;s exploration toolkit. The mission was clear: repair the MCP‚Äôs command structure and ensure the tools were operational before entering deeper into the Repomix Nebula.</p>
<h2>File Exploration</h2>
<h3><span class="header-prefix">packages/mcp/src/server.ts:</span> MCP Server Protocol Implementation</h3>
<p>The <code class="inline-code">server.ts</code> file is the backbone of the MCP adventure system, hosting the server that enables communication between tools and the greater quest engine. It defines the <code class="inline-code">RepoAdventureServer</code> class, responsible for managing all interactions via the MCP protocol. Key areas of this file include <code class="inline-code">setupHandlers()</code>, where the core tools (like <code class="inline-code">ListTools</code> and <code class="inline-code">CallTool</code>) are registered with runtime logic, and <code class="inline-code">run()</code>, which sets the server in motion using a <code class="inline-code">StdioServerTransport</code>. Importantly, it also ensures background tasks such as repomix content generation are initiated. Another critical segment is the <code class="inline-code">main()</code> function, which establishes graceful shutdown procedures, ensuring lingering processes like caching are tidied before the server concludes its operations.</p>
<p>The system exhibits robust error handling. For instance, when a tool request fails, it catches and transforms errors into the MCP-compliant <code class="inline-code">McpError</code> type. This ensures a smoother user experience even when things go wrong. The file also showcases collaborative concurrency; the <code class="inline-code">preGenerate</code> feature warms up the Repomix Nebula for faster analysis, paralleling LLM requests for smoother gameplay.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">RepoAdventureServer.setupHandlers</code>: Registers the MCP tools and validates incoming requests.</li>
<li><code class="inline-code">RepoAdventureServer.run</code>: Starts the server and initializes repomix background tasks.</li>
<li><code class="inline-code">main</code>: Entry point with comprehensive error handling and shutdown signals.</li>
</ul>
<h3><span class="header-prefix">packages/mcp/src/tools.ts:</span> Interactive MCP Adventure Tools</h3>
<p>The <code class="inline-code">tools.ts</code> file serves as the control panel for the MCP adventure toolkit. It organizes the four main adventure functions‚Äî<code class="inline-code">start_adventure</code>, <code class="inline-code">choose_theme</code>, <code class="inline-code">explore_quest</code>, and <code class="inline-code">view_progress</code>‚Äîinto a structured interface. Each tool is defined in detail, including its schema for validating inputs using the <code class="inline-code">zod</code> library. For instance, the <code class="inline-code">start_adventure.handler</code> prompts an analytical breakdown of the user&#39;s repository, while <code class="inline-code">choose_theme.handler</code> sets the tone for a narrative by selecting themes like &quot;space&quot; or &quot;ancient civilizations.&quot; Meanwhile, <code class="inline-code">explore_quest.handler</code> dives into specific portions of the repository for a deeper interactive experience. Lastly, <code class="inline-code">view_progress.handler</code> keeps track of what missions remain.</p>
<p>The file exemplifies modular code design by separating tool logic into individual handlers, exported collectively via the <code class="inline-code">tools</code> object. This modularity not only makes it easy to maintain but also supports dynamic registration of new tools within the MCP&#39;s structure.</p>
<h4>Highlights</h4>
<ul>
<li><code class="inline-code">start_adventure.handler</code>: Launches the narrative-driven journey tied to the repository analysis.</li>
<li><code class="inline-code">choose_theme.handler</code>: Provides users with customizable storylines for their adventure.</li>
<li><code class="inline-code">explore_quest.handler</code>: Delivers detailed quest-based exploration of specific repository components.</li>
<li><code class="inline-code">view_progress.handler</code>: Tracks user progress through completed and pending quests.</li>
</ul>
<h2>Code</h2>
<h3>packages/mcp/src/server.ts</h3>
<pre><code class="language-typescript">private setupHandlers() {
    // Dynamic tool listing
    this.server.setRequestHandler(ListToolsRequestSchema, async () =&gt; {
      const toolList = Object.entries(tools).map(([name, tool]) =&gt; ({
        name,
        description: tool.description,
        inputSchema: zodToJsonSchema(tool.schema, { 
          target: &#39;jsonSchema7&#39;,
          $refStrategy: &#39;none&#39;
        })
      }));
      return { tools: toolList };
    });

    // Dynamic tool execution
    this.server.setRequestHandler(CallToolRequestSchema, async (request) =&gt; {
      try {
        const { name, arguments: args } = request.params;
        if (!(name in tools)) {
          throw new McpError(ErrorCode.MethodNotFound, `Unknown tool: ${name}`);
        }
        const tool = tools[name as keyof typeof tools];
        const validationResult = tool.schema.safeParse(args);
        if (!validationResult.success) {
          const errorMessages = validationResult.error.issues.map((err) =&gt; 
            `${err.path.join(&#39;.&#39;)}: ${err.message}`
          ).join(&#39;, &#39;);
          throw new McpError(ErrorCode.InvalidParams, `Invalid parameters: ${errorMessages}`);
        }
        return await tool.handler(validationResult.data as any);
      } catch (error) {
        if (error instanceof McpError) {
          throw error;
        }
        throw new McpError(
          ErrorCode.InternalError,
          `Tool execution failed: ${error instanceof Error ? error.message : String(error)}`
        );
      }
    });
}
</code></pre>
<p>This code is like a spaceship&#39;s command center, constantly validating and coordinating incoming tasks to ensure the tools respond correctly and safely.</p>
<h3>packages/mcp/src/tools.ts</h3>
<pre><code class="language-typescript">export const tools = {
  start_adventure,
  choose_theme,
  explore_quest,
  view_progress
};
</code></pre>
<p>This line acts like a well-organized inventory bay, neatly laying out all the adventure tools for the crew to use during the mission.</p>
<h2>Helpful Hints</h2>
<ul>
<li>Use the modular designs in <code class="inline-code">tools.ts</code> as inspiration for adding new interactive story-driven APIs.</li>
<li>Improve startup efficiency by analyzing repomix caching logic in <code class="inline-code">server.ts</code> and testing for bottlenecks.</li>
<li>Dive into the full repository&#39;s theme generator to link technical tool insights with dynamic narratives.</li>
</ul>
<hr>
<p>Congratulations, cadet, you&#39;ve successfully navigated the cosmic corridors of Quest 1: The MCP Command Deck‚Äîyour stellar mission is off to a blazing start in this galaxy of knowledge! üöÄ‚≠ê‚ö°</p>

</div>


      <div class="quest-navigation quest-navigation-bottom">
        <a href="quest-2.html" class="next-quest-btn">Next: Quest 2: The Stellar Cartography Nexus ‚Üí</a>
      </div>
    
    </div>
    
    <footer class="footer">
        <div class="footer-content">
            <a href="https://github.com/danwahlin/ai-repo-adventures" target="_blank" rel="noopener noreferrer" class="repo-link">
                <img src="assets/images/github-mark-white.svg" alt="GitHub" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
                MCP Repo Adventure
            </a>
        </div>
    </footer>
</body>
</html>